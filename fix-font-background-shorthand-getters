Don't say that the font or background shorthands are present when the properties that they reset but can't otherwise specify are not their initial values.  (Bug 376075)

diff --git a/layout/style/nsCSSDeclaration.cpp b/layout/style/nsCSSDeclaration.cpp
--- a/layout/style/nsCSSDeclaration.cpp
+++ b/layout/style/nsCSSDeclaration.cpp
@@ -800,16 +800,36 @@ nsCSSDeclaration::GetValue(nsCSSProperty
       const nsCSSProperty* subprops =
         nsCSSProps::SubpropertyEntryFor(aProperty);
       NS_ASSERTION(subprops[3] == eCSSProperty_UNKNOWN,
                    "not box property with physical vs. logical cascading");
       AppendValueToString(subprops[0], aValue);
       break;
     }
     case eCSSProperty_background: {
+      // The -moz-background-clip, -moz-background-origin, and
+      // -moz-background-inline-policy properties are reset by this
+      // shorthand property to their initial values, but can't be
+      // represented in its syntax.
+      const nsCSSValue *clipValue = static_cast<const nsCSSValue*>(
+        data->StorageFor(eCSSProperty__moz_background_clip));
+      const nsCSSValue *originValue = static_cast<const nsCSSValue*>(
+        data->StorageFor(eCSSProperty__moz_background_origin));
+      const nsCSSValue *inlinePolicyValue = static_cast<const nsCSSValue*>(
+        data->StorageFor(eCSSProperty__moz_background_inline_policy));
+      if (clipValue !=
+            nsCSSValue(NS_STYLE_BG_CLIP_BORDER, eCSSUnit_Enumerated) ||
+          originValue !=
+            nsCSSValue(NS_STYLE_BG_ORIGIN_PADDING, eCSSUnit_Enumerated) ||
+          inlinePolicyValue !=
+            nsCSSValue(NS_STYLE_BG_INLINE_POLICY_CONTINUOUS,
+                       eCSSUnit_Enumerated)) {
+        return NS_OK;
+      }
+      
       PRBool appendedSomething = PR_FALSE;
       if (AppendValueToString(eCSSProperty_background_color, aValue)) {
         appendedSomething = PR_TRUE;
         aValue.Append(PRUnichar(' '));
       }
       if (AppendValueToString(eCSSProperty_background_image, aValue)) {
         aValue.Append(PRUnichar(' '));
         appendedSomething = PR_TRUE;
@@ -848,16 +868,28 @@ nsCSSDeclaration::GetValue(nsCSSProperty
       GetValueOrImportantValue(eCSSProperty_font_size, size);
       GetValueOrImportantValue(eCSSProperty_line_height, lh);
       GetValueOrImportantValue(eCSSProperty_font_family, family);
 
       if (systemFont.GetUnit() != eCSSUnit_None &&
           systemFont.GetUnit() != eCSSUnit_Null) {
         AppendCSSValueToString(eCSSProperty__x_system_font, systemFont, aValue);
       } else {
+        // The font-stretch and font-size-adjust
+        // properties are reset by this shorthand property to their
+        // initial values, but can't be represented in its syntax.
+        const nsCSSValue *stretchValue = static_cast<const nsCSSValue*>(
+          data->StorageFor(eCSSProperty_font_stretch));
+        const nsCSSValue *sizeAdjustValue = static_cast<const nsCSSValue*>(
+          data->StorageFor(eCSSProperty_font_size_adjust));
+        if (stretchValue != nsCSSValue(eCSSUnit_Normal) ||
+            sizeAdjustValue != nsCSSValue(eCSSUnit_None)) {
+          return NS_OK;
+        }
+
         if (style.GetUnit() != eCSSUnit_Normal) {
           AppendCSSValueToString(eCSSProperty_font_style, style, aValue);
           aValue.Append(PRUnichar(' '));
         }
         if (variant.GetUnit() != eCSSUnit_Normal) {
           AppendCSSValueToString(eCSSProperty_font_variant, variant, aValue);
           aValue.Append(PRUnichar(' '));
         }
