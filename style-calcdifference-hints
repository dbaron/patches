Improve hint handling in nsStyleContext::CalcStyleDifference.

diff --git a/layout/style/nsStyleContext.cpp b/layout/style/nsStyleContext.cpp
--- a/layout/style/nsStyleContext.cpp
+++ b/layout/style/nsStyleContext.cpp
@@ -394,11 +394,12 @@ nsStyleContext::CalcStyleDifference(nsSt
   // two style changes in succession, the second of which causes a real
   // style change, the PeekStyleData doesn't fail.
 
-  // If our rule nodes are the same, then we are looking at the same
-  // style data.  We know this because CalcStyleDifference is always
-  // called on two style contexts that point to the same element, so we
-  // know that our position in the style context tree is the same and
-  // our position in the rule node tree is also the same.
+  // If our rule nodes are the same, then any differences in style data
+  // are already accounted for by differences on ancestors.  We know
+  // this because CalcStyleDifference is always called on two style
+  // contexts that point to the same element, so we know that our
+  // position in the style context tree is the same and our position in
+  // the rule node tree is also the same.
   PRBool compare = mRuleNode != aOther->mRuleNode;
 
   nsChangeHint maxHint = nsChangeHint(NS_STYLE_HINT_FRAMECHANGE |
@@ -414,7 +415,7 @@ nsStyleContext::CalcStyleDifference(nsSt
     if (this##struct_) {                                                      \
       const nsStyle##struct_* other##struct_ = aOther->GetStyle##struct_();   \
       if (compare &&                                                          \
-          !NS_IsHintSubset(maxHint, hint) &&                                  \
+          !NS_IsHintSubset(nsStyle##struct_::MaxDifference(), hint) &&        \
           this##struct_ != other##struct_) {                                  \
         NS_ASSERTION(NS_IsHintSubset(                                         \
              this##struct_->CalcDifference(*other##struct_),                  \
