Add a set of fonts for presence testing, each of which has a single glyph at the codepoint for a capital letter A-Z.

diff --git a/layout/reftests/font-face/delete-rule-1-ref.html b/layout/reftests/font-face/delete-rule-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/delete-rule-1-ref.html
@@ -0,0 +1,13 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/delete-rule-1.html b/layout/reftests/font-face/delete-rule-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/delete-rule-1.html
@@ -0,0 +1,42 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US" class="reftest-wait">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	@font-face {
+		font-family: "MarkB";
+		src: url(../fonts/markB.ttf);
+	}
+
+	body { font-family: "MarkA", "MarkB"; }
+
+	</style>
+	<script type="application/ecmascript">
+
+	function run() {
+		var sheet = document.getElementsByTagName("style")[0].sheet;
+		for (var i = sheet.cssRules.length - 1; i >= 0; --i) {
+			if (sheet.cssRules[i].type == CSSRule.FONT_FACE_RULE) {
+				sheet.deleteRule(i);
+			}
+		}
+
+		document.documentElement.removeAttribute("class");
+	}
+
+	</script>
+</head>
+<body onload="setTimeout(run, 20)">
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/disable-sheet-1-ref.html b/layout/reftests/font-face/disable-sheet-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/disable-sheet-1-ref.html
@@ -0,0 +1,13 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/disable-sheet-1.html b/layout/reftests/font-face/disable-sheet-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/disable-sheet-1.html
@@ -0,0 +1,34 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US" class="reftest-wait">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	body { font-family: "MarkA"; }
+
+	</style>
+	<script type="application/ecmascript">
+
+	function run() {
+		document.getElementsByTagName("style")[0].disabled = true;
+		document.documentElement.removeAttribute("class");
+	}
+
+	</script>
+</head>
+<body onload="setTimeout(run, 20)">
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/disable-sheet-2-ref.html b/layout/reftests/font-face/disable-sheet-2-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/disable-sheet-2-ref.html
@@ -0,0 +1,26 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkD";
+		src: url(../fonts/markD.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	body { font-family: "MarkD"; }
+
+	</style>
+</head>
+<body>
+
+<p>ADC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/disable-sheet-2.html b/layout/reftests/font-face/disable-sheet-2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/disable-sheet-2.html
@@ -0,0 +1,42 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US" class="reftest-wait">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkB";
+		src: url(../fonts/markB.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	body { font-family: "MarkA", "MarkB"; }
+
+	</style>
+	<script type="application/ecmascript">
+
+	function run() {
+		document.getElementsByTagName("style")[0].disabled = true;
+		document.documentElement.removeAttribute("class");
+	}
+
+	</script>
+</head>
+<body onload="setTimeout(run, 20)">
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/disable-sheet-3-ref.html b/layout/reftests/font-face/disable-sheet-3-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/disable-sheet-3-ref.html
@@ -0,0 +1,26 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	body { font-family: "MarkB", "MarkA"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/disable-sheet-3.html b/layout/reftests/font-face/disable-sheet-3.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/disable-sheet-3.html
@@ -0,0 +1,42 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US" class="reftest-wait">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkB";
+		src: url(../fonts/markB.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	body { font-family: "MarkA", "MarkB"; }
+
+	</style>
+	<script type="application/ecmascript">
+
+	function run() {
+		document.getElementsByTagName("style")[1].disabled = true;
+		document.documentElement.removeAttribute("class");
+	}
+
+	</script>
+</head>
+<body onload="setTimeout(run, 20)">
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/download-1-notref.html b/layout/reftests/font-face/download-1-notref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/download-1-notref.html
@@ -0,0 +1,18 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	body { font-family: "MarkA"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/download-1.html b/layout/reftests/font-face/download-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/download-1.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	body { font-family: "MarkA"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/download-2-ref.html b/layout/reftests/font-face/download-2-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/download-2-ref.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkB";
+		src: url(../fonts/markB.ttf);
+	}
+
+	body { font-family: "MarkB"; }
+
+	</style>
+</head>
+<body>
+
+<p>B</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/download-2.html b/layout/reftests/font-face/download-2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/download-2.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	body { font-family: "MarkA"; }
+
+	</style>
+</head>
+<body>
+
+<p>A</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/enable-sheet-1-ref.html b/layout/reftests/font-face/enable-sheet-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/enable-sheet-1-ref.html
@@ -0,0 +1,26 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	body { font-family: "MarkA"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/enable-sheet-1.html b/layout/reftests/font-face/enable-sheet-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/enable-sheet-1.html
@@ -0,0 +1,38 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US" class="reftest-wait">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	body { font-family: "MarkA"; }
+
+	</style>
+	<script type="application/ecmascript">
+
+	document.getElementsByTagName("style")[0].disabled = true;
+
+	function run() {
+		// The resize-detector iframe will remove the class attribute.
+		document.getElementsByTagName("iframe")[0].contentWindow.arm();
+
+		document.getElementsByTagName("style")[0].disabled = false;
+	}
+
+	</script>
+</head>
+<body onload="setTimeout(run, 20)">
+
+<p style="position:relative; width: -moz-max-content">ABC<iframe style="visibility:hidden;position:absolute;height:100%;width:100%" src="resize-detector-iframe.html"></iframe></p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/enable-sheet-2-ref.html b/layout/reftests/font-face/enable-sheet-2-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/enable-sheet-2-ref.html
@@ -0,0 +1,34 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkB";
+		src: url(../fonts/markB.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	body { font-family: "MarkA", "MarkB"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/enable-sheet-2.html b/layout/reftests/font-face/enable-sheet-2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/enable-sheet-2.html
@@ -0,0 +1,46 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US" class="reftest-wait">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkB";
+		src: url(../fonts/markB.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	body { font-family: "MarkA", "MarkB"; }
+
+	</style>
+	<script type="application/ecmascript">
+
+	document.getElementsByTagName("style")[0].disabled = true;
+
+	function run() {
+		// The resize-detector iframe will remove the class attribute.
+		document.getElementsByTagName("iframe")[0].contentWindow.arm();
+
+		document.getElementsByTagName("style")[0].disabled = false;
+	}
+
+	</script>
+</head>
+<body onload="setTimeout(run, 20)">
+
+<p style="position:relative; width: -moz-max-content">ABC<iframe style="visibility:hidden;position:absolute;height:100%;width:100%" src="resize-detector-iframe.html"></iframe></p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/enable-sheet-3.html b/layout/reftests/font-face/enable-sheet-3.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/enable-sheet-3.html
@@ -0,0 +1,46 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US" class="reftest-wait">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkB";
+		src: url(../fonts/markB.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	body { font-family: "MarkA", "MarkB"; }
+
+	</style>
+	<script type="application/ecmascript">
+
+	document.getElementsByTagName("style")[1].disabled = true;
+
+	function run() {
+		// The resize-detector iframe will remove the class attribute.
+		document.getElementsByTagName("iframe")[0].contentWindow.arm();
+
+		document.getElementsByTagName("style")[1].disabled = false;
+	}
+
+	</script>
+</head>
+<body onload="setTimeout(run, 20)">
+
+<p style="position:relative; width: -moz-max-content">ABC<iframe style="visibility:hidden;position:absolute;height:100%;width:100%" src="resize-detector-iframe.html"></iframe></p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/fallback-to-system-1-ref.html b/layout/reftests/font-face/fallback-to-system-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/fallback-to-system-1-ref.html
@@ -0,0 +1,13 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+</head>
+<body>
+
+<p>DEF</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/fallback-to-system-1.html b/layout/reftests/font-face/fallback-to-system-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/fallback-to-system-1.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	body { font-family: "MarkA"; }
+
+	</style>
+</head>
+<body>
+
+<p>DEF</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/insert-rule-1-ref.html b/layout/reftests/font-face/insert-rule-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/insert-rule-1-ref.html
@@ -0,0 +1,20 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	body { font-family: "MarkA", "MarkB"; }
+	@font-face { font-family: "MarkA"; src: url(../fonts/markA.ttf); }
+	@font-face { font-family: "MarkB"; src: url(../fonts/markB.ttf); }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/insert-rule-1.html b/layout/reftests/font-face/insert-rule-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/insert-rule-1.html
@@ -0,0 +1,30 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US" class="reftest-wait">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	body { font-family: "MarkA", "MarkB"; }
+
+	</style>
+	<script type="application/ecmascript">
+
+	function run() {
+		// The resize-detector iframe will remove the class attribute.
+		document.getElementsByTagName("iframe")[0].contentWindow.arm();
+
+		var sheet = document.getElementsByTagName("style")[0].sheet;
+		sheet.insertRule("@font-face { font-family: 'MarkA'; src: url(../fonts/markA.ttf); }", sheet.cssRules.length);
+		sheet.insertRule("@font-face { font-family: 'MarkB'; src: url(../fonts/markB.ttf); }", 0);
+	}
+
+	</script>
+</head>
+<body onload="setTimeout(run, 20)">
+
+<p style="position:relative; width: -moz-max-content">ABC<iframe style="visibility:hidden;position:absolute;height:100%;width:100%" src="resize-detector-iframe.html"></iframe></p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/multiple-descriptor-1-notref.html b/layout/reftests/font-face/multiple-descriptor-1-notref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/multiple-descriptor-1-notref.html
@@ -0,0 +1,14 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+</head>
+<body>
+
+<p>ABC</p>
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/multiple-descriptor-1-ref.html b/layout/reftests/font-face/multiple-descriptor-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/multiple-descriptor-1-ref.html
@@ -0,0 +1,24 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	/* The last descriptor in a given rule wins, per CSS 2.0 */
+
+	@font-face {
+		src: url(../fonts/markA.ttf);
+		font-family: "MarkA";
+	}
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+<p style="font-family: MarkA">ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/multiple-descriptor-1.html b/layout/reftests/font-face/multiple-descriptor-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/multiple-descriptor-1.html
@@ -0,0 +1,26 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	/* The last descriptor in a given rule wins, per CSS 2.0 */
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/markB.ttf);
+		src: url(../fonts/markA.ttf);
+		font-family: "Two";
+	}
+
+	</style>
+</head>
+<body>
+
+<p style="font-family: One">ABC</p>
+<p style="font-family: Two">ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/name-override-1-ref.html b/layout/reftests/font-face/name-override-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/name-override-1-ref.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkD";
+		src: url(../fonts/markD.ttf);
+	}
+
+	body { font-family: "MarkD"; }
+
+	</style>
+</head>
+<body>
+
+<p>DBD</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/name-override-1.html b/layout/reftests/font-face/name-override-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/name-override-1.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "Foobar";
+		src: url(../fonts/markA.ttf), url(../fonts.markC.ttf);
+	}
+
+	body { font-family: "Foobar"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/name-override-simple-1-ref.html b/layout/reftests/font-face/name-override-simple-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/name-override-simple-1-ref.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkD";
+		src: url(../fonts/markD.ttf);
+	}
+
+	body { font-family: "MarkD"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABD</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/name-override-simple-1.html b/layout/reftests/font-face/name-override-simple-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/name-override-simple-1.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "Foobar";
+		src: url(../fonts.markC.ttf);
+	}
+
+	body { font-family: "Foobar"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/order-1.html b/layout/reftests/font-face/order-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/order-1.html
@@ -0,0 +1,28 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/mark2A.ttf);
+	}
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/markA.ttf);
+	}
+
+	body { font-family: "One"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/order-2.html b/layout/reftests/font-face/order-2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/order-2.html
@@ -0,0 +1,38 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/markB.ttf);
+	}
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/mark2B.ttf);
+	}
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/mark2A.ttf);
+	}
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/markA.ttf);
+	}
+
+	body { font-family: "One"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/order-3.html b/layout/reftests/font-face/order-3.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/order-3.html
@@ -0,0 +1,38 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/markB.ttf);
+	}
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/mark2A.ttf);
+	}
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/mark2B.ttf);
+	}
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/markA.ttf);
+	}
+
+	body { font-family: "One"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/reftest.list b/layout/reftests/font-face/reftest.list
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/reftest.list
@@ -0,0 +1,41 @@
+# Everything here uses HTTP(..) because they use fonts in ../fonts/.  We
+# can't use file:/// URLs because of cross-directory access restrictions
+# on file: URLs.
+
+fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) != download-1.html download-1-notref.html
+fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) == download-2.html download-2-ref.html
+HTTP(..) != download-2.html about:blank
+fails-if(MOZ_WIDGET_TOOLKIT!="gtk2") HTTP(..) == fallback-to-system-1.html fallback-to-system-1-ref.html
+HTTP(..) == name-override-simple-1.html name-override-simple-1-ref.html
+fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) != name-override-simple-1.html download-1-notref.html
+fails HTTP(..) == name-override-1.html name-override-1-ref.html
+HTTP(..) == multiple-descriptor-1.html multiple-descriptor-1-ref.html
+fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) != multiple-descriptor-1.html multiple-descriptor-1-notref.html
+HTTP(..) == src-list-1.html src-list-1-ref.html
+fails-if(MOZ_WIDGET_TOOLKIT!="gtk2") HTTP(..) == src-list-2.html src-list-2-ref.html
+fails-if(MOZ_WIDGET_TOOLKIT!="gtk2") HTTP(..) == src-list-3.html src-list-3-ref.html
+# FIXME: The behavior here is neither mandated nor specified by the spec, but
+# it really ought to be.
+HTTP(..) == order-1.html src-list-1-ref.html
+fails-if(MOZ_WIDGET_TOOLKIT!="gtk2") HTTP(..) == order-2.html src-list-2-ref.html
+fails-if(MOZ_WIDGET_TOOLKIT!="gtk2") HTTP(..) == order-3.html src-list-3-ref.html
+
+# Dynamic changes
+skip-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) == enable-sheet-1.html enable-sheet-1-ref.html
+# (1) enable-sheet-2.html is random because the bug that causes
+# order-2.html to fail means we can end up with two resizes instead of
+# one, so we remove the reftest-wait attribute on the first of those
+# resizes
+# (2) enable-sheet-2-ref is sometimes right on Windows, but always wrong
+# on Mac
+skip-if(MOZ_WIDGET_TOOLKIT=="gtk2") random-if(MOZ_WIDGET_TOOLKIT=="cocoa") random-if(MOZ_WIDGET_TOOLKIT=="windows") HTTP(..) == enable-sheet-2.html enable-sheet-2-ref.html
+skip-if(MOZ_WIDGET_TOOLKIT=="gtk2") fails-if(MOZ_WIDGET_TOOLKIT=="cocoa") random-if(MOZ_WIDGET_TOOLKIT=="windows") HTTP(..) == enable-sheet-3.html enable-sheet-2-ref.html
+random-if(MOZ_WIDGET_TOOLKIT=="windows") fails-if(MOZ_WIDGET_TOOLKIT!="windows") HTTP(..) != enable-sheet-1-ref.html enable-sheet-2-ref.html
+HTTP(..) == disable-sheet-1.html disable-sheet-1-ref.html
+fails HTTP(..) == disable-sheet-2.html disable-sheet-2-ref.html
+fails-if(MOZ_WIDGET_TOOLKIT!="gtk2") HTTP(..) == disable-sheet-3.html disable-sheet-3-ref.html
+fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) == sheet-set-base-1.html sheet-set-base-1-ref.html
+skip-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) == sheet-set-switch-1.html sheet-set-switch-1-ref.html
+# insert-rule-1-ref is sometimes right on Windows, always wrong on Mac
+skip-if(MOZ_WIDGET_TOOLKIT=="gtk2") random-if(MOZ_WIDGET_TOOLKIT=="windows") HTTP(..) == insert-rule-1.html insert-rule-1-ref.html
+HTTP(..) == delete-rule-1.html delete-rule-1-ref.html
diff --git a/layout/reftests/font-face/resize-detector-iframe.html b/layout/reftests/font-face/resize-detector-iframe.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/resize-detector-iframe.html
@@ -0,0 +1,20 @@
+<!DOCTYPE HTML>
+<html>
+<head>
+	<title>Resize-notifying IFRAME</title>
+	<script type="application/ecmascript">
+
+	function arm() {
+		window.addEventListener("resize", got_resize, false);
+	}
+
+	function got_resize() {
+		// Remove the class="reftest-wait" from the parent
+		window.parent.document.documentElement.removeAttribute("class");
+	}
+
+	</script>
+</head>
+<body>
+</body>
+</html>
diff --git a/layout/reftests/font-face/sheet-set-base-1-ref.html b/layout/reftests/font-face/sheet-set-base-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/sheet-set-base-1-ref.html
@@ -0,0 +1,26 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkD";
+		src: url(../fonts/markD.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	body { font-family: "MarkD"; }
+
+	</style>
+</head>
+<body>
+
+<p>DBC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/sheet-set-base-1.html b/layout/reftests/font-face/sheet-set-base-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/sheet-set-base-1.html
@@ -0,0 +1,34 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css" title="Set A">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	</style>
+	<style type="text/css" title="Set B">
+
+	@font-face {
+		font-family: "MarkB";
+		src: url(../fonts/markB.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	body { font-family: "MarkA", "MarkB"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/sheet-set-switch-1-ref.html b/layout/reftests/font-face/sheet-set-switch-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/sheet-set-switch-1-ref.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkC";
+		src: url(../fonts/markC.ttf);
+	}
+
+	body { font-family: "MarkA", "MarkB", "MarkC"; }
+
+	</style>
+</head>
+<body>
+
+<p>ACC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/sheet-set-switch-1.html b/layout/reftests/font-face/sheet-set-switch-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/sheet-set-switch-1.html
@@ -0,0 +1,49 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US" class="reftest-wait">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css" title="Set A">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	</style>
+	<style type="text/css" title="Set B">
+
+	@font-face {
+		font-family: "MarkB";
+		src: url(../fonts/markB.ttf);
+	}
+
+	</style>
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkC";
+		src: url(../fonts/markC.ttf);
+	}
+
+	body { font-family: "MarkA", "MarkB", "MarkC"; }
+
+	</style>
+	<script type="application/ecmascript">
+
+	function run() {
+		// The resize-detector iframe will remove the class attribute.
+		document.getElementsByTagName("iframe")[0].contentWindow.arm();
+
+		document.selectedStyleSheetSet = "Set B";
+	}
+
+	</script>
+</head>
+<body onload="setTimeout(run, 20)">
+
+<p style="position:relative; width: -moz-max-content">ABC<iframe style="visibility:hidden;position:absolute;height:100%;width:100%" src="resize-detector-iframe.html"></iframe></p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/src-list-1-ref.html b/layout/reftests/font-face/src-list-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/src-list-1-ref.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	body { font-family: "MarkA"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/src-list-1.html b/layout/reftests/font-face/src-list-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/src-list-1.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/markA.ttf), url(../fonts/mark2A.ttf);
+	}
+
+	body { font-family: "One"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/src-list-2-ref.html b/layout/reftests/font-face/src-list-2-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/src-list-2-ref.html
@@ -0,0 +1,26 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	@font-face {
+		font-family: "Mark2B";
+		src: url(../fonts/mark2B.ttf);
+	}
+
+	</style>
+</head>
+<body>
+
+<p><span style="font-family: MarkA">A</span><span style="font-family: Mark2B">B</span>C</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/src-list-2.html b/layout/reftests/font-face/src-list-2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/src-list-2.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/markA.ttf), url(../fonts/mark2A.ttf), url(../fonts/mark2B.ttf), url(../fonts/markB.ttf);
+	}
+
+	body { font-family: "One"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/src-list-3-ref.html b/layout/reftests/font-face/src-list-3-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/src-list-3-ref.html
@@ -0,0 +1,26 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkA";
+		src: url(../fonts/markA.ttf);
+	}
+
+	@font-face {
+		font-family: "Mark2B";
+		src: url(../fonts/mark2B.ttf);
+	}
+
+	</style>
+</head>
+<body>
+
+<p><span style="font-family: MarkA">A</span><span style="font-family: Mark2B">B</span>C</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/src-list-3.html b/layout/reftests/font-face/src-list-3.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/src-list-3.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/markA.ttf), url(../fonts/mark2B.ttf), url(../fonts/mark2A.ttf), url(../fonts/markB.ttf);
+	}
+
+	body { font-family: "One"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/fonts/mark-generate.py b/layout/reftests/fonts/mark-generate.py
new file mode 100755
--- /dev/null
+++ b/layout/reftests/fonts/mark-generate.py
@@ -0,0 +1,68 @@
+#!/usr/bin/python
+# vim: set shiftwidth=4 tabstop=8 autoindent expandtab:
+# ***** BEGIN LICENSE BLOCK *****
+# Version: MPL 1.1/GPL 2.0/LGPL 2.1
+#
+# The contents of this file are subject to the Mozilla Public License Version
+# 1.1 (the "License"); you may not use this file except in compliance with
+# the License. You may obtain a copy of the License at
+# http://www.mozilla.org/MPL/
+#
+# Software distributed under the License is distributed on an "AS IS" basis,
+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
+# for the specific language governing rights and limitations under the
+# License.
+#
+# The Original Code is mark-generate.py .
+#
+# The Initial Developer of the Original Code is the Mozilla Foundation.
+# Portions created by the Initial Developer are Copyright (C) 2008
+# the Initial Developer. All Rights Reserved.
+#
+# Contributor(s):
+#   L. David Baron <dbaron@dbaron.org>, Mozilla Corporation (original author)
+#
+# Alternatively, the contents of this file may be used under the terms of
+# either the GNU General Public License Version 2 or later (the "GPL"), or
+# the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
+# in which case the provisions of the GPL or the LGPL are applicable instead
+# of those above. If you wish to allow use of your version of this file only
+# under the terms of either the GPL or the LGPL, and not to allow others to
+# use your version of this file under the terms of the MPL, indicate your
+# decision by deleting the provisions above and replace them with the notice
+# and other provisions required by the GPL or the LGPL. If you do not delete
+# the provisions above, a recipient may use your version of this file under
+# the terms of any one of the MPL, the GPL or the LGPL.
+#
+# ***** END LICENSE BLOCK *****
+
+# For general fontforge documentation, see:
+#   http://fontforge.sourceforge.net/
+# For fontforge scripting documentation, see:
+#   http://fontforge.sourceforge.net/scripting-tutorial.html
+#   http://fontforge.sourceforge.net/scripting.html
+# and most importantly:
+#   http://fontforge.sourceforge.net/python.html
+
+# To install what you need, on Ubuntu,
+#   sudo apt-get install python-fontforge
+
+import fontforge
+
+# generate a set of fonts, each with our special glyph at one codepoint,
+# and nothing else
+for codepoint in range(ord("A"), ord("D") + 1):
+    for (mark, width) in [("", 1500), ("2", 1800)]:
+        charname = chr(codepoint)
+        f = fontforge.font()
+        n = "Mark" + mark + charname
+        f.fontname = n
+        f.familyname = n
+        f.fullname = n
+        f.copyright = "Copyright (c) 2008 Mozilla Corporation"
+
+        g = f.createChar(codepoint, charname)
+        g.importOutlines("mark" + mark + "-glyph.svg")
+        g.width = width
+
+        f.generate("mark" + mark + charname + ".ttf")
diff --git a/layout/reftests/fonts/mark-glyph.svg b/layout/reftests/fonts/mark-glyph.svg
new file mode 100644
--- /dev/null
+++ b/layout/reftests/fonts/mark-glyph.svg
@@ -0,0 +1,6 @@
+<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewbox="0 0 1500 1000" width="1500px" height="1000px">
+  <rect x="500" y="100" height="200" width="500" fill="black" />
+  <rect x="300" y="400" height="200" width="900" fill="black" />
+  <!-- baseline defaults to being at 800 -->
+  <rect x="100" y="700" height="200" width="1300" fill="black" />
+</svg>
diff --git a/layout/reftests/fonts/mark2-glyph.svg b/layout/reftests/fonts/mark2-glyph.svg
new file mode 100644
--- /dev/null
+++ b/layout/reftests/fonts/mark2-glyph.svg
@@ -0,0 +1,3 @@
+<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewbox="0 0 1800 1000" width="1800px" height="1000px">
+  <polygon fill="black" points="100,100 100,800 1700,800 1700,100 1500,100 1500,600 300,600 300,100" />
+</svg>
diff --git a/layout/reftests/fonts/mark2A.ttf b/layout/reftests/fonts/mark2A.ttf
new file mode 100644
index 0000000000000000000000000000000000000000..063cab5bcd33bed3761ccb981bb401512ec50538
GIT binary patch
literal 1524
zc%02tOK1~882)B=vuU+ziw_hkY_#|!aTBRT3Dw#fJeXRjmePZ=Bxw>%x?vL^Q4d1#
zQayN-UR3DS()Owc5k<v|C-LAx4?;nF9P}Vq<2RFSRIuRD8D{_Qf6h0Pe*ytu6|O+X
zU^00kH88XA3<$iUwe$GUp4iF7>^?w@P#;d0oHEwvpQu0JI-EXNwGh&3fNs!l<eW;m
zUS}l)UQlnz6>DSXNAI}wucLlBpLH^yhi+dYe$BNnPebdy;40RV{;qtfdSU%WT%|rs
zy}jtB9prI>`7P8}l$;A?9L0Y6<J7Hjr<A?>ep7({8-TX9>{hDv8FX|1Y5I3To{j76
z?w8L`uStBxN_~MAJdQ_7O&J2rY3;t`3k{9I9Ay~|%6;iqm3|+FvKY-AO=U^jAw(KA
zf-T|;$W5D6wXQd$c!Q|WWP;h+toBFs!LcJ5R_R5rZq?%$RoTrLG79-pt_-2>uTDQE
zK}{&#fTdVA*!J?bQQ!K*rE0?bwYg-~yn(+mTW0A05c7Wz)x+!;IeQ>)fp;u+X;VB~
z5Ro~7J&F0Cfe*1cGw?bwuWN*u)1^5e&GSK1d{4{^Y2Vus>e#-wV{1sXE<AanO)ZXv
zv=Moe8Nbtlz*-r^m3eB+KK=GUyZ@t2d|B*ouvv|n=DlyjfR6=CO!%11gPT6qu?6pZ
zY`_#7d>lZ#IOt=O_EWMe4B2zXRF=d7Z8+;=jd;?>I{I<T#|GL&i;n}a#AY9xv=5>W
zF3PCELjgIy)hat~2h!L{8H3FkCrUBuA|r~N4t1I3F;9LS<`js=fj+lf^9s3q)!LEX
zX~k?iZl&Cdg<{dM`dqK<dQP?AGA_j=4`;YRFBQi-6O$5I-f)5E;oDASGljF1NmaP2
zq(_2TMJqyD77i$4zbZ8>-3TMf8E(=?(jBiRT`!llViDUqU^R9m=nhAtVM%itO2gdG
zL&ZOyrRqi1?zUop;jCBTi7eZWMr_-*mZ`J!D(e%p|Lsj0%BrEO(J6fA+EU!3o@*ba
I{QW=gCs2#VG5`Po

diff --git a/layout/reftests/fonts/mark2B.ttf b/layout/reftests/fonts/mark2B.ttf
new file mode 100644
index 0000000000000000000000000000000000000000..541df8dc21b96ac9d3f07860bbcd4632690d5494
GIT binary patch
literal 1524
zc%02tOK1~882)B=vq`m8OH~9FH@+=2-9)Of1eH{S2U82yB0VTek|v=^H*Dgg>Ol}M
z)q_XzqJn3&z1o9<q8<eCq6ZINgkF3c>Oru^ZzkKcLJJ<9VfO$2=X^8yClCPIa1}ZR
zQmMgo|HGNrK;Q$dn@*hUj-C3Q+YgA-)Q2)<r=qXczfgb5mCT&4SqN+6fNs!l<eh4z
zUS}l)-ck?cOXDLKhVQ%ducdyakaM!%Pu{ys{E=&4frgeR!8X>C{_TZw?c%x(xK8~s
z^))3o<Dh^+=7*@SC_5J`IEDlC$EjOmPC57J+r|L>w*al9;#O<*N9f`H59sfNJR8^h
zE$`l(U7h%WmHG@VcoC13n=%ZT5435?7aAIaIm$8|l>5@JDlHy{vKY-AO=U^jVMH1=
zf*~;ra?>VMt(y%gJ|QYJnP9dwtNm4dVB~0)Rgy^RRy~ekmEDXXqp&aK$`b1S+T_P1
zs0pPTuoTM%+a!M*^{qdfuO`fe%_Xbm4J^rQxuO3{(EmJC53^t7JP3IUykpU+-Qm%K
zh)fD}C#Hf1zQiWYz{kXtt`TBVm*#*pPX$f!D={UceQ$fXeb?UhZDG+e^YW#3XKo~{
zot8J5^*b#HbjTpC>?`B(tDjG`>EEqlcJ4@n%_=->-uq7U`&hulH6OEiaNEZ^w&Jso
z4VYrRj{{gE4*A%m{fz7iL-yQpl_jx2E6({?BcAZFjw871V*{-s<l_J=vDwEa?E~n8
ziwef!p@=-+YK<MY8yW1OjKSuN6Qvn-i4i4Ehq}!2m?ysubBaV`K%ZL~_lo&K&Dx#W
zW5sMcZl&Ez#Zt+!`dqK#dQPqAGA_*|52M^5NyYI-V^Si=8!qxZeB0?<ws?**r3%-S
z^hhwLXhlfNLa!pWP^n?*K^LN&T}}E(xns4I>*aG+EMi-|R%1tko~~%LOVV71(h&Fa
zQ1y>zsd`bhyR8^tDCbpqBFna;5!<${W$Mho%KA0hmwJ<ivTE4T=oG$lZ9eY#!5d$t
IT>PK+2Pz-NG5`Po

diff --git a/layout/reftests/fonts/mark2C.ttf b/layout/reftests/fonts/mark2C.ttf
new file mode 100644
index 0000000000000000000000000000000000000000..798eddd32b4b763377192b0c6c4ad28146053b98
GIT binary patch
literal 1524
zc%02tKWGzC9RA+j<<e@a)~YyExTvTVl3r3OQ9>0{gM+DsYLO1gk)%mz(hJw9jXDU$
zr8+o@iwd1f+tm&o6zw983Jxwp7e%lRf;E2c<r)<%IQky%e&6r!``*j%1p+`jZbQdV
zDs>?}IJde21m4ivb$+-fcCns|1L6|(kxbdCV5k0x`ZCw)%(be8kX8e9gMK6LOjhc3
zRzl!4^_G08Hg<jViA(=3>bD9xC;NH$@lE1)T*nGDv_1{CvzGK9ER?HLyZ7P_^?B+$
zN^ZtM0T-CxLVZiwnX2F{j?+(0uqK>xZsE(m0R8s?t+V1zR_pWV<NmYsAB8*{*W312
zD_6EBzGADsN(-LHBju(H0p_f>B>6%^V=zZqMuT!+`c<XhhoLM+Ge=Wd(sl}wMvY*L
zSOd9fGpg3Th7|7+6`D*iTbtGXs6I4yCd(>GBz3DE$EeC~#*k6SmvUtZb$@mFF$roy
z=>{ytvcWdV-$s4w%Nx~%`D=5@s(Ax{Wwz<i|0(MK9jb@fFLL%n-U9Df9MvB3WI;q0
z1bPySK?5IS3ufS5Vo}!!v7k$HK$;hWrud#%6w=<?5$ZVH+i@TyT327Z&>pUjg|tiZ
zCbNF01%XZ(#Fc$%%)k7$tS$X$6Km@O4K~{_*Sz;b81%7#iD@6RdGNr;I`-p(j}4e&
zkB<Y`Ax`?(r2Vq&3PbkXIh7@`KpU?5SR<bCv5o;e^09$7(c<F(EV0kWChbG)QWq7}
z;Gu{--)fZ|cLW)9Q^sI(#);C5y1|GNr$b$4dCZevhdD)}3AUzNsd>eGp=uq;bXzgo
zj$3K>MzK_KtfcEzT+gW%UB;!E<YAl}B&j&wcuY#<c*8}Whi^Nb%NDOvrc~jok{$`>
z6s-tpSvaAH{i@Wk^dXEWXShipDR-ipa=m=cibZVegw@!Qpf4Pah9%8SD2;GG50n1!
zELAV6cDEG+jO4sYp2)K8XvDT{Ym+(~ud+T(``_NAp{yFaMRf|_xwaAatpDyODS!XZ
F`w0WT#xei^

diff --git a/layout/reftests/fonts/mark2D.ttf b/layout/reftests/fonts/mark2D.ttf
new file mode 100644
index 0000000000000000000000000000000000000000..ab0765c30a05734a2e374f8ff0f3ca9522c37369
GIT binary patch
literal 1524
zc%02tO=uHA6#iy+vuU;3ma2GA+^E<eXu3(M#1d3&4IWG_D5dnEEJ>P#Cf%@2wXGh6
z;-z}<D7~oAv)Fo6(1T*Vc@aE#@FMi$&!HlMHGVVMrWIQ7=nS*(dvD%*^UcefKmgc<
zo6s?sNL)$|JX(1J1m4qn;KIeO=nyg|05ME`C{=VyXf(f4f5CMob+v3Eq)h|5!F?m^
zOq41WW<uaC^}1|fdi2`JLznw|sNcwCob<Pg53Un`;5we8q5f%b7jwz|qq$;vYVUsB
zqW+kAQ^8F+$l(&>>!|N2I#VT_gX9yVZjC#|%#$C70^Gj~Xe}joqFh--56@rVeh1{;
zxZVX{zPi#F|Bjvd3N3gQ3m0oL1egojGszbks)I4gG7^;Ma$jZIJPc(qYB8FMlD5+b
zS91jG#45;5n^U>&RHgWch|pw!SzpWcSN6ftvuS4ON55`WVi-};H6Jnx`BJVlq3*8(
zzE7N*P`Uw2v8=M~=WnCFmFMf(gt>9JWL2xcmdv&v`oFpTuS4}P`$f)^kX2xfMTa)e
ziv<y06zGaC1r2<TE}DT4@g-d&#G)?E0cl<en&MY{Nl1HlbEvtsyZJ~+)UUjLt<A5E
zhO}W>$+X{TL7+uCaiy1y$ICxoXwQB(h}E_JDx2MSRIB?j4ER{U#H^3mJh<m$9f$GB
z#|BKX&&L5YiBmo{X}>JH!jL_8UPVbP(11xFYs7Ot*4cgceQcmX)cH67OC0pEN&6uB
z;G%?Sc*rBmw_0Y$wIPLe$|!8k7*Ud5GxR8MI@D#9$2j?Q7?UR&2m0L7w3pB3%2r#d
z-HO_F%u2d5`9i_5`dqK%dQLg-(l5y%4`V!l6-zqaSX4@6Sm8YH!?&Hxr1O)M36;34
zq(_1oMJr5N7J3!2jZ9Tb4>}Ry?5xp8!W}OsTrZokqG8+WwW=o)^mIldos#A@l=$CC
z<Ai@bOXZ8G({057Lm6*^H?nLy61HvI+9uEXtE|k@zSWyFlvP7(wNv=cwROLjCvSg|
Ia`S)Q9}n5ZGXMYp

diff --git a/layout/reftests/fonts/markA.ttf b/layout/reftests/fonts/markA.ttf
new file mode 100644
index 0000000000000000000000000000000000000000..66f5fee2e4f29f68a13d286a3d790561581f100d
GIT binary patch
literal 1528
zc%02tO=uHA6#iy^(jT?9*y6>*28*^r<0hpNN)&4~BA8ZaDdI(zBuzq-ZrG;M76e5_
zP!AsTQhMmoQ?bR1;6X%by?gAT$6mA`@#IhZW_A-5B6xI$$@|`W^WJ<j`(7Xb9KbE;
zxROjxrpDHG-vj10tw+WuPR6F3OgkX1QlCnfoH7pTd(>ZZolD=SSO{y2fNs!l<ea&3
zt;S3+KTvPY6&I&lBg^CTcT<0q&pMgCzSYCTGXJSO4XuyOo6IHsz4=mQq3a3mQGZUo
zv*@NBlrhQpR_g5~XQ7NsI8A??x;5*RvP+#k!}PBLT1(lTtJKyo#Pgrge**GuT(Lu+
zUtT|$_=0`<E-iQ$kCYlRTw5_0v{#ZZH28xt+N;_MuBmr`xu7!rJ`80suwUMmLsL=G
zb`}vohq*1PFzI@rvOn^r*g;fiG9c8}$o5C}E7KP;%rb%z-KxcLjZv9jd&nppNV%j(
z57v=jPlB3Ix&ceE^x2N^+o<2#n|d}8`gOQu)p&uX%>FX;f7tVX4^_jg7dexVufR7J
zC$weWtp$;Ffs=`i76Tt+>mhSHv7u{(Sl6Z5l;(|=kocC^5Yj%_74AAd*mX24+IBZL
zwdL>AVeP7XrA$z1GUq<#9}4$0R#jBLpV#kxePMQs>ekke5B^f@I<VIG4#zMSV8PnD
z9bgs{o(5Pa_niP6FhxgzO>~M=0S?hVA*;lYHF#M?Ni5Kg`2cII?fU`NaSkg1Hqg#%
z`q+fU&h>GK_KO&W%Z^=yhXQiQqrwX8LmK^*G1#1Oq7-*6aYvEUp)R95#>roYF$JPo
zVAL%ydWBrRV)do_t(a}ct(3b|C>9-S)b+})=Tr(V_oW!*VTLV(l;h1vfh=32z{{}F
zQ`t;mo-(PjR+RL}E~_|2$jQR6VpUJ$>q8holyjiL97%V!l61XX)`~@JYuHl9Q4S46
zqXUv)Gcr>=$-`W5D@)~ys&j31Hm0)P94}(ob~Iw!w$&_2y)$cf$fj9e8p^7n*RKxt
Rx>n!!_RPaiQvUwG_Y?g_(Ifx>

diff --git a/layout/reftests/fonts/markB.ttf b/layout/reftests/fonts/markB.ttf
new file mode 100644
index 0000000000000000000000000000000000000000..f3317b5f49d3a95bd6b5194487a32c7923f11bf0
GIT binary patch
literal 1528
zc%02tO=uHA6#iy^(zMn7NTrt^Hu%>T8aF8|L83^j5y7Zn3B`-7Nty(cZrG;Mih`md
zs0R;vDLwS)soElV@t~ln_a1xbu@~zlp8Sd5%x<GX1&_`!dEa|)-kWb`-wOnQ-M9%I
z=ToVP^x5UjkAS&OYu~vGhvS*cxpqKIQqN>7PF3&JKT&_pHI}_vvk=kd0o|bAC^$3K
zMuVAPu2Byc%JWm<=)yVrd#FDw=AGQ<{-s`GnSZoML->(-gSn)Cf3Z@V>wb*8)SpxD
zD!W++RZK8GOuen*%vEt3N9j*cx2By+{`#KYB>hW()>3t6YK><Y;rUPLAB4OcSAYA~
z%S)ZfFKE{{X~DZhw9=H3#-cf=y^?&P!5@s#UNshRQN07qIhE=6VJM4%UGlaZnu?OP
z<B0k>%ym(RN!NXq{h=?#24X^!0io7rwm-6;pE{XimNAU!RwIFnjLQAmLq?H6$|XH|
zu=;{MNoqpr1}w$WXFJAkqkbE2wzG-Qufrv)<_qk|>~BN=mreikP&LeYkuwGP3VdTR
zs4ehnEr_lN98Rvb82A)l37PB3Rb3;*iZ0EjG_SUV#JA+CkoMv3NcW-P?tKx_y7~US
zw(xx_qD{(2$_14sbIP6?iR^8zx~P9Yq2KxX!t4?C4<CN4`Af0uz;g3D9K_iG3)a@H
z0JE6zB)~ekZv@zYDLMjdqDzbhI7IseStW+7!80mKVu3cy23TWl-wUwLYFrGkfi_;#
z$0jUxu8%{spTam?cI-Snlu$qsHCA9hvKXL@!{$s7rMc@Gca%9D>N3h>ocwhdQzDuM
z#@*_?S1J^1R)2QDiraR=O1sxe<+5XqyI$4xoLb4{zBGe8Tp>xM9q)=1$g?#{ybK#X
zozInKDN`zIO-YaJ@`_WGoGctsthUqm`Ur*);~Z)-N6MY9rChI&x8hOTI%28gC`X23
zu^~xtCo&nH<Y6Ybm8EjU)Va1g8=1T}!;4t99gEtwZS9m~yE7ZN$!4d%G?Z1t0lzxf
R>)Q6dx5plAN%{N#-cQz&(Ifx>

diff --git a/layout/reftests/fonts/markC.ttf b/layout/reftests/fonts/markC.ttf
new file mode 100644
index 0000000000000000000000000000000000000000..5894180a899b1a459d1545158de520ac0d637472
GIT binary patch
literal 1528
zc%02tO-NKx7(Ms>jK7(N5rK<06s3aWn+auzDMD)^Xi889aTAZ3ab{@7H$2Bsp(rYX
za?zqT;=*MsQ)%g<MWO9mx^O8$wy{;&bncz!XkgH?d%5$S@4NRq_uTuwI}iYl;URPk
z#p5H1TT9!Y0CSVkj@!e%kz^{}42V(s$yCuP;e@_J|2@Y*>R#DGP@4gCgY!n#nJiT*
zWP<sbetotuGhQE>zs>n}`g6IAlm6DZc#2r^_vaX>e`($)mz+PFE0(9*Ug0VIW%{iJ
zH|3y&5$4y^Z!9{~CEUOz&PVB66HYPnp#Ah^&MyL5UCEs+SC-Mo{oioD8}e)%U3*{N
z-Z>uojwXGZ5qyk>iZvUoESS^Un$!yo)y5oct+IeIbq_G771QBnsEC1Pd0IA2Wy#nT
zgsL3orr3qasppD)u4=^=!a|b?frc8}AM8Wp*V1Ge#Gr0fq8MXV`d|$e1$`@roYDQ!
z;jf9&6UsMWDV0^VgZwt?xAK0UO#}`$m#S(vaHO)oHvOMg{l87sFzZG3IOHwxjzzaN
z&y&?5v?9<OTdgzjHL?;gH)E^1Mu-(%hD{k>tqX{su~i}C7utet=P$IK35tg8^>uB2
zZ#<}t$~#K?l_oix$ln({SsS}zckinH<i|U+UF>db{Q6uSN?i+<YTw};ZuwZSwjTMI
z#e~;B)~S8V#|BK%;$su7qTj~>#)oB<7_tU$sw{~G8ZqT#jkW#E$2tbE;9~=gJZ2S}
zu=sMTIKcRIR;|kyI|C1SWRXLe71)Usx@aS?*`q`WuA1eF0=q+BW_iq$zYcTqL=!Ak
zw>0DBv$?X>nd-74wjH$+?rgqLaI8VsE4iLi&bwTfV3LQsq(Q>*?n;9UpGKaC;X_Yk
z()lUcxMD3U>rq`sX$n!3g^NnnK26o{Ll462JvHTsyA$QO>t!=mBxG9`EwvqOUr#vP
zBLyBMCdr*VO!}v?6jxa7YpcDH%y^SLh-KU1kZs%6Q6&2>v+|f~j(V4difXJ7RULfm
Q+Wxu^mtX8id-#9vH@+d#BLDyZ

diff --git a/layout/reftests/fonts/markD.ttf b/layout/reftests/fonts/markD.ttf
new file mode 100644
index 0000000000000000000000000000000000000000..5440c1c4cf3620e57453981f29be18a869debf27
GIT binary patch
literal 1528
zc%02tO-vI(6#iy^3W5Sn{5i;B8~>1mvaP{1rWylSV`9MsLI@YLX-nJCvdvNrH8Ihs
zF;Na4^g=jr(-RTm(L@g#@a~ZVM=r_*PyW<zW|x8qCLW#1^nLHWd2ha%eXkGz4&fej
z+(@NH(?d&}p8#{6*3RLP-uPHHdk7HY)W<Sqr-Js-7WMaB{h8ZU3lXgb=mz~p-kGV?
z>&yi6Gxg?tsW#ahogb$EF!i}Y&dF|dEgmD5`Og<<XntniWiIJIStwU$!_V=E`fKVP
zB{$=sf>FjdQ*S9dvlU#!Mfwxet!by6yLa^XW%?HZt*PS9RO`#=<N2@X?}oe^*QxIt
zFK@OdzoAv%qy--n(Q-pZ>I>$q_Ez$R27fR{ds|<?gn9><vntcxVJM4%gYvc<nu?OP
z%ZU0p%yqF1lddN!`<ySu24X^!0igqpY=30GF?l7+EQ1)-t$G3zjLPorA)`nj<&qvf
zSe?P1BsHOQ1D0axvmNBOQNQ(fJK02N_i)Lo@dEoY`}@%UZQK7kR1LFU<V-=n0^eA4
zYxBHV6Qauky~&j(17G6HA#**sqHBa$)}`5$=9Q+9_>o)@(ta)+37<I^J`oWIHdj}*
z`Ja;!ZCpN4HmEe2vz7V#B1al)TWtRv)E|C-V;&aUYiqwg`%AHF!&2iroW@Xq1#9bm
zfLTm<5n!F%Hv(+H6m0=E(IL(UI7Iu1tP(@k;B^%xu|NxM1z2NkKMt^tek=soKnt(w
zV-prT*T*5+uVMf$JGKT7MdVRHl@-{949-%<VRI&k(%f~2J4&1mbs6O`PX0QKDH2Ts
z18$|}74wCv)s;DG#cexbrQJKlQpvFfT(9DKPPOQAUz$N4rr0t_JKmHO$gwqwybK#X
zoy!()QKnSZs*)br<rJqVIa#=%SnZ_o^*;0<#@W+gj+8rHO}Sn^XT_tob-_}{QTFx3
zVm*@Jeq_dYl82e#R+h>YQ|H?1Y>ef+8D7M)?O4>dZEL?IJDpj7KsNjJrJ<}E&iK{A
SUe|W^eYo`WtCV~H_kIJHdD0^Q

diff --git a/layout/reftests/reftest.list b/layout/reftests/reftest.list
--- a/layout/reftests/reftest.list
+++ b/layout/reftests/reftest.list
@@ -47,16 +47,19 @@ include counters/reftest.list
 # generated-content/
 include generated-content/reftest.list
 
 # first-letter/
 include first-letter/reftest.list
 
 # first-line/
 include first-line/reftest.list
+
+# font-face
+include font-face/reftest.list
 
 # forms
 include forms/reftest.list
 
 # block-inside-inline splits
 include ib-split/reftest.list
 
 # image-region/
