From: L. David Baron <dbaron@dbaron.org>

Fix GC race in test by doing QueryInterface when needed, in case a the wrapper has been GCed since the last QueryInterface.  (Bug 600785)  r=ted.mielczarek  a2.0=tests

diff --git a/toolkit/crashreporter/test/browser/aboutcrashes_utils.js b/toolkit/crashreporter/test/browser/aboutcrashes_utils.js
--- a/toolkit/crashreporter/test/browser/aboutcrashes_utils.js
+++ b/toolkit/crashreporter/test/browser/aboutcrashes_utils.js
@@ -52,17 +52,18 @@ function make_fake_appdir() {
     dirSvc.undefine("UAppData");
   } catch(ex) {} // it's ok if this fails, the value might not be cached yet
   return appD.clone();
 }
 
 function cleanup_fake_appdir() {
   let dirSvc = Cc["@mozilla.org/file/directory_service;1"]
                .getService(Ci.nsIProperties);
-  dirSvc.unregisterProvider(_provider);
+  dirSvc.QueryInterface(Ci.nsIDirectoryService)
+        .unregisterProvider(_provider);
   // undefine our value so future calls get the real value
   try {
     dirSvc.undefine("UAppData");
   } catch(ex) {
     dump("cleanup_fake_appdir: dirSvc.undefine failed: " + ex.message +"\n");
   }
 }
 
