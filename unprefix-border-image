From: L. David Baron <dbaron@dbaron.org>

Unprefix the border-image-* properties and add a temporary alias for -moz-border-image (but not for its subproperties, which we haven't shipped prefixed).  (Bug 713643, patch 5)

FIXME: Need to go through all tests (mochitest and reftest).

diff --git a/dom/interfaces/css/nsIDOMCSS2Properties.idl b/dom/interfaces/css/nsIDOMCSS2Properties.idl
--- a/dom/interfaces/css/nsIDOMCSS2Properties.idl
+++ b/dom/interfaces/css/nsIDOMCSS2Properties.idl
@@ -46,17 +46,17 @@
  * The nsIDOMCSS2Properties interface is a datatype for additional
  * reflection of data already provided in nsIDOMCSSStyleDeclaration in
  * the Document Object Model.
  *
  * For more information on this interface please see
  * http://www.w3.org/TR/DOM-Level-2-Style
  */
 
-[builtinclass, scriptable, uuid(8d58fba8-33d1-4a09-8251-dfc9cfc96863)]
+[builtinclass, scriptable, uuid(08fd9493-9276-4861-9b16-add2653e2f53)]
 interface nsIDOMCSS2Properties : nsISupports
 {
            attribute DOMString        background;
                                         // raises(DOMException) on setting
 
            attribute DOMString        backgroundAttachment;
                                         // raises(DOMException) on setting
 
@@ -637,17 +637,17 @@ interface nsIDOMCSS2Properties : nsISupp
                                         // raises(DOMException) on setting
 
            attribute DOMString        MozBorderStartWidth;
                                         // raises(DOMException) on setting
 
            attribute DOMString        MozStackSizing;
                                         // raises(DOMException) on setting
 
-           attribute DOMString        MozBorderImage;
+           attribute DOMString        borderImage;
                                         // raises(DOMException) on setting
 
            attribute DOMString        MozColumns;
                                         // raises(DOMException) on setting
 
            attribute DOMString        MozColumnRule;
                                         // raises(DOMException) on setting
 
@@ -754,26 +754,29 @@ interface nsIDOMCSS2Properties : nsISupp
                                         // raises(DOMException) on setting
 
            attribute DOMString        MozAnimation;
                                         // raises(DOMException) on setting
 
            attribute DOMString        MozTextSizeAdjust;
                                         // raises(DOMException) on setting
 
-           attribute DOMString        MozBorderImageSource;
+           attribute DOMString        borderImageSource;
                                         // raises(DOMException) on setting
 
-           attribute DOMString        MozBorderImageSlice;
+           attribute DOMString        borderImageSlice;
                                         // raises(DOMException) on setting
 
-           attribute DOMString        MozBorderImageWidth;
+           attribute DOMString        borderImageWidth;
                                         // raises(DOMException) on setting
 
-           attribute DOMString        MozBorderImageOutset;
+           attribute DOMString        borderImageOutset;
                                         // raises(DOMException) on setting
 
-           attribute DOMString        MozBorderImageRepeat;
+           attribute DOMString        borderImageRepeat;
                                         // raises(DOMException) on setting
 
            attribute DOMString        MozColorCorrection;
                                         // raises(DOMException) on setting
+
+           attribute DOMString        MozBorderImage;
+                                        // raises(DOMException) on setting
 };
diff --git a/layout/style/nsCSSPropAliasList.h b/layout/style/nsCSSPropAliasList.h
--- a/layout/style/nsCSSPropAliasList.h
+++ b/layout/style/nsCSSPropAliasList.h
@@ -58,8 +58,9 @@
   the property that 'aliasname' is being aliased to.
 
   -. 'method' is the CSS2Properties property name.  Unlike
   nsCSSPropList.h, prefixes should just be included in this file (rather
   than needing the CSS_PROP_DOMPROP_PREFIXED(prop) macro).
 
  ******/
 
+CSS_PROP_ALIAS(-moz-border-image, border_image, MozBorderImage)
diff --git a/layout/style/nsCSSPropList.h b/layout/style/nsCSSPropList.h
--- a/layout/style/nsCSSPropList.h
+++ b/layout/style/nsCSSPropList.h
@@ -696,65 +696,65 @@ CSS_PROP_BORDER(
         CSS_PROPERTY_VALUE_NONNEGATIVE |
         CSS_PROPERTY_APPLIES_TO_FIRST_LETTER,
     VARIANT_HKL | VARIANT_CALC,
     kBorderWidthKTable,
     CSS_PROP_NO_OFFSET,
     eStyleAnimType_None)
 #endif
 CSS_PROP_SHORTHAND(
-    -moz-border-image,
+    border-image,
     border_image,
-    CSS_PROP_DOMPROP_PREFIXED(BorderImage),
+    BorderImage,
     CSS_PROPERTY_PARSE_FUNCTION)
 CSS_PROP_BORDER(
-    -moz-border-image-source,
+    border-image-source,
     border_image_source,
-    CSS_PROP_DOMPROP_PREFIXED(BorderImageSource),
+    BorderImageSource,
     CSS_PROPERTY_PARSE_VALUE |
         CSS_PROPERTY_APPLIES_TO_FIRST_LETTER |
         CSS_PROPERTY_START_IMAGE_LOADS,
     VARIANT_HUO,
     nsnull,
     CSS_PROP_NO_OFFSET,
     eStyleAnimType_None)
 CSS_PROP_BORDER(
-    -moz-border-image-slice,
+    border-image-slice,
     border_image_slice,
-    CSS_PROP_DOMPROP_PREFIXED(BorderImageSlice),
+    BorderImageSlice,
     CSS_PROPERTY_PARSE_FUNCTION |
         CSS_PROPERTY_APPLIES_TO_FIRST_LETTER,
     0,
     kBorderImageSliceKTable,
     CSS_PROP_NO_OFFSET,
     eStyleAnimType_None)
 CSS_PROP_BORDER(
-    -moz-border-image-width,
+    border-image-width,
     border_image_width,
-    CSS_PROP_DOMPROP_PREFIXED(BorderImageWidth),
+    BorderImageWidth,
     CSS_PROPERTY_PARSE_FUNCTION |
         CSS_PROPERTY_APPLIES_TO_FIRST_LETTER,
     0,
     nsnull,
     CSS_PROP_NO_OFFSET,
     eStyleAnimType_None)
 CSS_PROP_BORDER(
-    -moz-border-image-outset,
+    border-image-outset,
     border_image_outset,
-    CSS_PROP_DOMPROP_PREFIXED(BorderImageOutset),
+    BorderImageOutset,
     CSS_PROPERTY_PARSE_FUNCTION |
         CSS_PROPERTY_APPLIES_TO_FIRST_LETTER,
     0,
     nsnull,
     CSS_PROP_NO_OFFSET,
     eStyleAnimType_None)
 CSS_PROP_BORDER(
-    -moz-border-image-repeat,
+    border-image-repeat,
     border_image_repeat,
-    CSS_PROP_DOMPROP_PREFIXED(BorderImageRepeat),
+    BorderImageRepeat,
     CSS_PROPERTY_PARSE_FUNCTION |
         CSS_PROPERTY_APPLIES_TO_FIRST_LETTER,
     0,
     kBorderImageRepeatKTable,
     CSS_PROP_NO_OFFSET,
     eStyleAnimType_None)
 CSS_PROP_SHORTHAND(
     border-left,
diff --git a/layout/style/test/property_database.js b/layout/style/test/property_database.js
--- a/layout/style/test/property_database.js
+++ b/layout/style/test/property_database.js
@@ -225,21 +225,21 @@ var gCSSProperties = {
 			"-moz-calc(0px)",
 			"-moz-calc(5em)",
 			"-moz-calc(3*25px)",
 			"-moz-calc(25px*3)",
 			"-moz-calc(3*25px + 5em)",
 		],
 		invalid_values: [ "5%" ]
 	},
-	"-moz-border-image": {
-		domProp: "MozBorderImage",
+	"border-image": {
+		domProp: "borderImage",
 		inherited: false,
 		type: CSS_TYPE_TRUE_SHORTHAND,
-		subproperties: [ "-moz-border-image-source", "-moz-border-image-slice", "-moz-border-image-width", "-moz-border-image-outset", "-moz-border-image-repeat" ],
+		subproperties: [ "border-image-source", "border-image-slice", "border-image-width", "border-image-outset", "border-image-repeat" ],
 		initial_values: [ "none" ],
 		other_values: [ "url('border.png') 27 27 27 27",
 						"url('border.png') 27",
 						"stretch url('border.png')",
 						"url('border.png') 27 fill",
 						"url('border.png') 27 27 27 27 repeat",
 						"repeat url('border.png') 27 27 27 27",
 						"url('border.png') repeat 27 27 27 27",
@@ -261,50 +261,50 @@ var gCSSProperties = {
 						  "url('border.png') fill / 1em",
 						  "url('border.png') / repeat",
 						  "url('border.png') 1 /",
 						  "url('border.png') 1 / /",
 						  "1 / url('border.png')",
 						  "url('border.png') / 1",
 						  "url('border.png') / / 1"]
 	},
-	"-moz-border-image-source": {
-		domProp: "MozBorderImageSource",
+	"border-image-source": {
+		domProp: "borderImageSource",
 		inherited: false,
 		type: CSS_TYPE_LONGHAND,
 		initial_values: [ "none" ],
 		other_values: [ "url('border.png')" ],
 		invalid_values: [ "url('border.png') url('border.png')" ]
 	},
-	"-moz-border-image-slice": {
-		domProp: "MozBorderImageSlice",
+	"border-image-slice": {
+		domProp: "borderImageSlice",
 		inherited: false,
 		type: CSS_TYPE_LONGHAND,
 		initial_values: [ "100%", "100% 100% 100% 100%" ],
 		other_values: [ "0%", "10", "10 100% 0 2", "0 0 0 0", "fill 10 10", "10 10 fill" ],
 		invalid_values: [ "-10%", "-10", "10 10 10 10 10", "10 10 10 10 -10", "10px", "-10px", "fill", "fill fill 10px", "10px fill fill" ]
 	},
-	"-moz-border-image-width": {
-		domProp: "MozBorderImageWidth",
+	"border-image-width": {
+		domProp: "borderImageWidth",
 		inherited: false,
 		type: CSS_TYPE_LONGHAND,
 		initial_values: [ "1", "1 1 1 1" ],
 		other_values: [ "0", "0%", "0px", "auto auto auto auto", "10 10% auto 15px", "10px 10px 10px 10px", "10", "10 10", "10 10 10" ],
 		invalid_values: [ "-10", "-10px", "-10%", "10 10 10 10 10", "10 10 10 10 auto", "auto auto auto auto auto" ]
 	},
-	"-moz-border-image-outset": {
-		domProp: "MozBorderImageOutset",
+	"border-image-outset": {
+		domProp: "borderImageOutset",
 		inherited: false,
 		type: CSS_TYPE_LONGHAND,
 		initial_values: [ "0", "0 0 0 0" ],
 		other_values: [ "10px", "10", "10 10", "10 10 10", "10 10 10 10", "10px 10 10 10px" ],
 		invalid_values: [ "-10", "-10px", "-10%", "10%", "10 10 10 10 10" ]
 	},
-	"-moz-border-image-repeat": {
-		domProp: "MozBorderImageRepeat",
+	"border-image-repeat": {
+		domProp: "borderImageRepeat",
 		inherited: false,
 		type: CSS_TYPE_LONGHAND,
 		initial_values: [ "stretch", "stretch stretch" ],
 		other_values: [ "round", "repeat", "stretch round", "repeat round", "stretch repeat", "round round", "repeat repeat" ],
 		invalid_values: [ "none", "stretch stretch stretch", "0", "10", "0%", "0px" ]
 	},
 	"-moz-border-left-colors": {
 		domProp: "MozBorderLeftColors",
@@ -1649,17 +1649,17 @@ var gCSSProperties = {
 			"-moz-calc(-20%) -moz-calc(-50%)"
 		],
 		invalid_values: [ "contain contain", "cover cover", "cover auto", "auto cover", "contain cover", "cover contain", "-5px 3px", "3px -5px", "auto -5px", "-5px auto" ]
 	},
 	"border": {
 		domProp: "border",
 		inherited: false,
 		type: CSS_TYPE_TRUE_SHORTHAND,
-		subproperties: [ "border-bottom-color", "border-bottom-style", "border-bottom-width", "border-left-color", "border-left-style", "border-left-width", "border-right-color", "border-right-style", "border-right-width", "border-top-color", "border-top-style", "border-top-width", "-moz-border-top-colors", "-moz-border-right-colors", "-moz-border-bottom-colors", "-moz-border-left-colors", "-moz-border-image-source", "-moz-border-image-slice", "-moz-border-image-width", "-moz-border-image-outset", "-moz-border-image-repeat" ],
+		subproperties: [ "border-bottom-color", "border-bottom-style", "border-bottom-width", "border-left-color", "border-left-style", "border-left-width", "border-right-color", "border-right-style", "border-right-width", "border-top-color", "border-top-style", "border-top-width", "-moz-border-top-colors", "-moz-border-right-colors", "-moz-border-bottom-colors", "-moz-border-left-colors", "border-image-source", "border-image-slice", "border-image-width", "border-image-outset", "border-image-repeat" ],
 		initial_values: [ "none", "medium", "currentColor", "thin", "none medium currentcolor", "-moz-calc(4px - 1px) none" ],
 		other_values: [ "solid", "medium solid", "green solid", "10px solid", "thick solid", "-moz-calc(2px) solid blue" ],
 		invalid_values: [ "5%" ]
 	},
 	"border-bottom": {
 		domProp: "borderBottom",
 		inherited: false,
 		type: CSS_TYPE_TRUE_SHORTHAND,
diff --git a/layout/style/test/test_shorthand_property_getters.html b/layout/style/test/test_shorthand_property_getters.html
--- a/layout/style/test/test_shorthand_property_getters.html
+++ b/layout/style/test/test_shorthand_property_getters.html
@@ -16,17 +16,17 @@ https://bugzilla.mozilla.org/show_bug.cg
 </div>
 <pre id="test">
 <script type="application/javascript">
 
 /** Test for Bug 376075 **/
 
 var e = document.getElementById("display");
 
-var borderExtras = ";-moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; -moz-border-image: none";
+var borderExtras = ";-moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-image: none";
 
 // Test that we only serialize the 'border' shorthand when appropriate.
 e.setAttribute("style", "border-left: medium solid blue; border-right: medium solid blue; border-top: medium blue solid; border-bottom: blue medium solid" + borderExtras);
 isnot(e.style.border, "", "should be able to serialize border");
 e.setAttribute("style", "border-left: medium solid blue; border-right: medium solid blue; border-top: medium blue solid; border-bottom: green medium solid" + borderExtras);
 is(e.style.border, "", "should not be able to serialize border");
 e.setAttribute("style", "border-width: 3px 3px 3px 3px; border-style: solid; border-color: green" + borderExtras);
 isnot(e.style.border, "", "should be able to serialize border");
@@ -164,24 +164,24 @@ is(e.style.MozTransition, "", "should no
 e.setAttribute("style", "-moz-transition-property: color, width; -moz-transition-duration: 1s, 200ms; -moz-transition-timing-function: ease-in, linear, ease-out; -moz-transition-delay: 0s, 1s");
 is(e.style.MozTransition, "", "should not have -moz-transition shorthand (lists different lengths)");
 e.setAttribute("style", "-moz-transition-property: color, width; -moz-transition-duration: 1s, 200ms; -moz-transition-timing-function: ease-in, linear; -moz-transition-delay: 0s, 1s, 0s");
 is(e.style.MozTransition, "", "should not have -moz-transition shorthand (lists different lengths)");
 
 // Check that the 'border' shorthand resets 'border-image' and
 // '-moz-border-*-colors', but that other 'border-*' shorthands don't
 // (bug 482692).
-e.setAttribute("style", '-moz-border-image: url("foo.png") 5 5 5 5 / 5 5 5 5 / 5 5 5 5 repeat repeat; border-left: medium solid green');
+e.setAttribute("style", 'border-image: url("foo.png") 5 5 5 5 / 5 5 5 5 / 5 5 5 5 repeat repeat; border-left: medium solid green');
 is(e.style.cssText,
-   '-moz-border-image: url("foo.png") 5 5 5 5 / 5 5 5 5 / 5 5 5 5 repeat repeat; border-left: medium solid green;',
-   "border-left does NOT reset -moz-border-image");
-e.setAttribute("style", '-moz-border-image: url("foo.png") 5 5 5 5; border: medium solid green');
+   'border-image: url("foo.png") 5 5 5 5 / 5 5 5 5 / 5 5 5 5 repeat repeat; border-left: medium solid green;',
+   "border-left does NOT reset border-image");
+e.setAttribute("style", 'border-image: url("foo.png") 5 5 5 5; border: medium solid green');
 is(e.style.cssText,
    'border: medium solid green;',
-   "border DOES reset -moz-border-image");
+   "border DOES reset border-image");
 e.setAttribute("style", '-moz-border-left-colors: fuchsia blue; border-left: medium solid green');
 is(e.style.cssText,
    '-moz-border-left-colors: fuchsia blue; border-left: medium solid green;',
    "border-left does NOT reset -moz-border-left-colors");
 e.setAttribute("style", '-moz-border-left-colors: fuchsia blue; border: medium solid green');
 is(e.style.cssText,
    'border: medium solid green;',
    "border DOES reset -moz-border-left-colors");
