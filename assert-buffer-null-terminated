From: L. David Baron <dbaron@dbaron.org>

Assert that strings marked as having a null-terminated buffer are actually null-terminated.

MozReview-Commit-ID: 12sQLHtJ4xc

diff --git a/xpcom/string/nsTSubstring.h b/xpcom/string/nsTSubstring.h
--- a/xpcom/string/nsTSubstring.h
+++ b/xpcom/string/nsTSubstring.h
@@ -316,16 +316,18 @@ protected:
   }
 
   void AssertValid()
   {
     MOZ_ASSERT(!(mClassFlags & ClassFlags::NULL_TERMINATED) ||
                (mDataFlags & DataFlags::TERMINATED),
                "String classes whose static type guarantees a null-terminated "
                "buffer must not be assigned a non-null-terminated buffer.");
+    MOZ_ASSERT(!(mDataFlags & DataFlags::TERMINATED) || mData[mLength] == 0,
+               "String marked as null-terminated must be null-terminated.");
   }
 
   char_type* mData;
   size_type mLength;
   DataFlags mDataFlags;
   ClassFlags const mClassFlags;
 };
 
