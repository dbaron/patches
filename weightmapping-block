From: L. David Baron <dbaron@dbaron.org>

Fix an underlying issue with weightmapping reftests that shows up in weightmapping-458.html on Windows once bug 93725 is fixed:  avoid differences because we're inconsistent about whether we're setting the correct font on a block or an inline.

diff --git a/layout/reftests/font-matching/weightmapping-12-ref.html b/layout/reftests/font-matching/weightmapping-12-ref.html
--- a/layout/reftests/font-matching/weightmapping-12-ref.html
+++ b/layout/reftests/font-matching/weightmapping-12-ref.html
@@ -8,16 +8,20 @@
 
 body {
   margin: 50px;
   font-family: Futura, Verdana, sans-serif;
 }
 
 h3, h4 { font-weight: normal; }
 
+/* make all the spans blocks to avoid influence of what's outside them
+   on line-height calculations */
+span { display: block; }
+
 @font-face {
   font-family: test;
   src: url(../fonts/mplus/mplus-1p-thin.ttf);
   font-weight: 100;
 }
 
 @font-face {
   font-family: test;
diff --git a/layout/reftests/font-matching/weightmapping-12.html b/layout/reftests/font-matching/weightmapping-12.html
--- a/layout/reftests/font-matching/weightmapping-12.html
+++ b/layout/reftests/font-matching/weightmapping-12.html
@@ -8,16 +8,20 @@
 
 body {
   margin: 50px;
   font-family: Futura, Verdana, sans-serif;
 }
 
 h3, h4 { font-weight: normal; }
 
+/* make all the spans blocks to avoid influence of what's outside them
+   on line-height calculations */
+span { display: block; }
+
 @font-face {
   font-family: test;
   src: url(../fonts/mplus/mplus-1p-thin.ttf);
   font-weight: 100;
 }
 
 @font-face {
   font-family: test;
@@ -162,9 +166,9 @@ thead { font-weight: 400; font-size: 75%
 <td class="cbo"><span>東京特許許可局</span></td>
 <td class="cbobo"><span>東京特許許可局</span></td>
 </tr>
 </table>
 
 <p>tokyotokkyokyokakyoku</p>
 
 </body>
-</html>
\ No newline at end of file
+</html>
diff --git a/layout/reftests/font-matching/weightmapping-12579-ref.html b/layout/reftests/font-matching/weightmapping-12579-ref.html
--- a/layout/reftests/font-matching/weightmapping-12579-ref.html
+++ b/layout/reftests/font-matching/weightmapping-12579-ref.html
@@ -8,16 +8,20 @@
 
 body {
   margin: 50px;
   font-family: Futura, Verdana, sans-serif;
 }
 
 h3, h4 { font-weight: normal; }
 
+/* make all the spans blocks to avoid influence of what's outside them
+   on line-height calculations */
+span { display: block; }
+
 @font-face {
   font-family: test;
   src: url(../fonts/mplus/mplus-1p-thin.ttf);
   font-weight: 100;
 }
 
 @font-face {
   font-family: test;
diff --git a/layout/reftests/font-matching/weightmapping-12579.html b/layout/reftests/font-matching/weightmapping-12579.html
--- a/layout/reftests/font-matching/weightmapping-12579.html
+++ b/layout/reftests/font-matching/weightmapping-12579.html
@@ -8,16 +8,20 @@
 
 body {
   margin: 50px;
   font-family: Futura, Verdana, sans-serif;
 }
 
 h3, h4 { font-weight: normal; }
 
+/* make all the spans blocks to avoid influence of what's outside them
+   on line-height calculations */
+span { display: block; }
+
 @font-face {
   font-family: test;
   src: url(../fonts/mplus/mplus-1p-thin.ttf);
   font-weight: 100;
 }
 
 @font-face {
   font-family: test;
@@ -195,9 +199,9 @@ thead { font-weight: 400; font-size: 75%
 <td class="cbo"><span>東京特許許可局</span></td>
 <td class="cbobo"><span>東京特許許可局</span></td>
 </tr>
 </table>
 
 <p>tokyotokkyokyokakyoku</p>
 
 </body>
-</html>
\ No newline at end of file
+</html>
diff --git a/layout/reftests/font-matching/weightmapping-25-ref.html b/layout/reftests/font-matching/weightmapping-25-ref.html
--- a/layout/reftests/font-matching/weightmapping-25-ref.html
+++ b/layout/reftests/font-matching/weightmapping-25-ref.html
@@ -8,16 +8,20 @@
 
 body {
   margin: 50px;
   font-family: Futura, Verdana, sans-serif;
 }
 
 h3, h4 { font-weight: normal; }
 
+/* make all the spans blocks to avoid influence of what's outside them
+   on line-height calculations */
+span { display: block; }
+
 @font-face {
   font-family: test;
   src: url(../fonts/mplus/mplus-1p-light.ttf);
   font-weight: 200;
 }
 
 @font-face {
   font-family: test;
diff --git a/layout/reftests/font-matching/weightmapping-25.html b/layout/reftests/font-matching/weightmapping-25.html
--- a/layout/reftests/font-matching/weightmapping-25.html
+++ b/layout/reftests/font-matching/weightmapping-25.html
@@ -8,16 +8,20 @@
 
 body {
   margin: 50px;
   font-family: Futura, Verdana, sans-serif;
 }
 
 h3, h4 { font-weight: normal; }
 
+/* make all the spans blocks to avoid influence of what's outside them
+   on line-height calculations */
+span { display: block; }
+
 @font-face {
   font-family: test;
   src: url(../fonts/mplus/mplus-1p-light.ttf);
   font-weight: 200;
 }
 
 @font-face {
   font-family: test;
@@ -162,9 +166,9 @@ thead { font-weight: 400; font-size: 75%
 <td class="cbo"><span>東京特許許可局</span></td>
 <td class="cbobo"><span>東京特許許可局</span></td>
 </tr>
 </table>
 
 <p>tokyotokkyokyokakyoku</p>
 
 </body>
-</html>
\ No newline at end of file
+</html>
diff --git a/layout/reftests/font-matching/weightmapping-45-ref.html b/layout/reftests/font-matching/weightmapping-45-ref.html
--- a/layout/reftests/font-matching/weightmapping-45-ref.html
+++ b/layout/reftests/font-matching/weightmapping-45-ref.html
@@ -8,16 +8,20 @@
 
 body {
   margin: 50px;
   font-family: Futura, Verdana, sans-serif;
 }
 
 h3, h4 { font-weight: normal; }
 
+/* make all the spans blocks to avoid influence of what's outside them
+   on line-height calculations */
+span { display: block; }
+
 @font-face {
   font-family: test;
   src: url(../fonts/mplus/mplus-1p-regular.ttf);
   font-weight: normal;
 }
 
 @font-face {
   font-family: test;
diff --git a/layout/reftests/font-matching/weightmapping-45.html b/layout/reftests/font-matching/weightmapping-45.html
--- a/layout/reftests/font-matching/weightmapping-45.html
+++ b/layout/reftests/font-matching/weightmapping-45.html
@@ -8,16 +8,20 @@
 
 body {
   margin: 50px;
   font-family: Futura, Verdana, sans-serif;
 }
 
 h3, h4 { font-weight: normal; }
 
+/* make all the spans blocks to avoid influence of what's outside them
+   on line-height calculations */
+span { display: block; }
+
 @font-face {
   font-family: test;
   src: url(../fonts/mplus/mplus-1p-regular.ttf);
   font-weight: normal;
 }
 
 @font-face {
   font-family: test;
@@ -162,9 +166,9 @@ thead { font-weight: 400; font-size: 75%
 <td class="cbo"><span>東京特許許可局</span></td>
 <td class="cbobo"><span>東京特許許可局</span></td>
 </tr>
 </table>
 
 <p>tokyotokkyokyokakyoku</p>
 
 </body>
-</html>
\ No newline at end of file
+</html>
diff --git a/layout/reftests/font-matching/weightmapping-458-ref.html b/layout/reftests/font-matching/weightmapping-458-ref.html
--- a/layout/reftests/font-matching/weightmapping-458-ref.html
+++ b/layout/reftests/font-matching/weightmapping-458-ref.html
@@ -8,16 +8,20 @@
 
 body {
   margin: 50px;
   font-family: Futura, Verdana, sans-serif;
 }
 
 h3, h4 { font-weight: normal; }
 
+/* make all the spans blocks to avoid influence of what's outside them
+   on line-height calculations */
+span { display: block; }
+
 @font-face {
   font-family: test;
   src: url(../fonts/mplus/mplus-1p-regular.ttf);
   font-weight: normal;
 }
 
 @font-face {
   font-family: test;
diff --git a/layout/reftests/font-matching/weightmapping-458.html b/layout/reftests/font-matching/weightmapping-458.html
--- a/layout/reftests/font-matching/weightmapping-458.html
+++ b/layout/reftests/font-matching/weightmapping-458.html
@@ -8,16 +8,20 @@
 
 body {
   margin: 50px;
   font-family: Futura, Verdana, sans-serif;
 }
 
 h3, h4 { font-weight: normal; }
 
+/* make all the spans blocks to avoid influence of what's outside them
+   on line-height calculations */
+span { display: block; }
+
 @font-face {
   font-family: test;
   src: url(../fonts/mplus/mplus-1p-regular.ttf);
   font-weight: normal;
 }
 
 @font-face {
   font-family: test;
@@ -173,9 +177,9 @@ thead { font-weight: 400; font-size: 75%
 <td class="cbo"><span>東京特許許可局</span></td>
 <td class="cbobo"><span>東京特許許可局</span></td>
 </tr>
 </table>
 
 <p>tokyotokkyokyokakyoku</p>
 
 </body>
-</html>
\ No newline at end of file
+</html>
diff --git a/layout/reftests/font-matching/weightmapping-478-ref.html b/layout/reftests/font-matching/weightmapping-478-ref.html
--- a/layout/reftests/font-matching/weightmapping-478-ref.html
+++ b/layout/reftests/font-matching/weightmapping-478-ref.html
@@ -8,16 +8,20 @@
 
 body {
   margin: 50px;
   font-family: Futura, Verdana, sans-serif;
 }
 
 h3, h4 { font-weight: normal; }
 
+/* make all the spans blocks to avoid influence of what's outside them
+   on line-height calculations */
+span { display: block; }
+
 @font-face {
   font-family: test;
   src: url(../fonts/mplus/mplus-1p-regular.ttf);
   font-weight: normal;
 }
 
 @font-face {
   font-family: test;
diff --git a/layout/reftests/font-matching/weightmapping-478.html b/layout/reftests/font-matching/weightmapping-478.html
--- a/layout/reftests/font-matching/weightmapping-478.html
+++ b/layout/reftests/font-matching/weightmapping-478.html
@@ -8,16 +8,20 @@
 
 body {
   margin: 50px;
   font-family: Futura, Verdana, sans-serif;
 }
 
 h3, h4 { font-weight: normal; }
 
+/* make all the spans blocks to avoid influence of what's outside them
+   on line-height calculations */
+span { display: block; }
+
 @font-face {
   font-family: test;
   src: url(../fonts/mplus/mplus-1p-regular.ttf);
   font-weight: normal;
 }
 
 @font-face {
   font-family: test;
@@ -173,9 +177,9 @@ thead { font-weight: 400; font-size: 75%
 <td class="cbo"><span>東京特許許可局</span></td>
 <td class="cbobo"><span>東京特許許可局</span></td>
 </tr>
 </table>
 
 <p>tokyotokkyokyokakyoku</p>
 
 </body>
-</html>
\ No newline at end of file
+</html>
diff --git a/layout/reftests/font-matching/weightmapping-7-ref.html b/layout/reftests/font-matching/weightmapping-7-ref.html
--- a/layout/reftests/font-matching/weightmapping-7-ref.html
+++ b/layout/reftests/font-matching/weightmapping-7-ref.html
@@ -8,16 +8,20 @@
 
 body {
   margin: 50px;
   font-family: Futura, Verdana, sans-serif;
 }
 
 h3, h4 { font-weight: normal; }
 
+/* make all the spans blocks to avoid influence of what's outside them
+   on line-height calculations */
+span { display: block; }
+
 @font-face {
   font-family: test;
   src: url(../fonts/mplus/mplus-1p-bold.ttf);
   font-weight: 700;
 }
 
 @font-face {
   font-family: test700;
@@ -199,9 +203,9 @@ thead { font-weight: 400; font-size: 75%
 <td class="cbo"><span>東京特許許可局</span></td>
 <td class="cbobo"><span>東京特許許可局</span></td>
 </tr>
 </table>
 
 <p>tokyotokkyokyokakyoku</p>
 
 </body>
-</html>
\ No newline at end of file
+</html>
diff --git a/layout/reftests/font-matching/weightmapping-7.html b/layout/reftests/font-matching/weightmapping-7.html
--- a/layout/reftests/font-matching/weightmapping-7.html
+++ b/layout/reftests/font-matching/weightmapping-7.html
@@ -8,16 +8,20 @@
 
 body {
   margin: 50px;
   font-family: Futura, Verdana, sans-serif;
 }
 
 h3, h4 { font-weight: normal; }
 
+/* make all the spans blocks to avoid influence of what's outside them
+   on line-height calculations */
+span { display: block; }
+
 @font-face {
   font-family: test;
   src: url(../fonts/mplus/mplus-1p-bold.ttf);
   font-weight: 700;
 }
 
 @font-face {
   font-family: test700;
@@ -151,9 +155,9 @@ thead { font-weight: 400; font-size: 75%
 <td class="cbo"><span>東京特許許可局</span></td>
 <td class="cbobo"><span>東京特許許可局</span></td>
 </tr>
 </table>
 
 <p>tokyotokkyokyokakyoku</p>
 
 </body>
-</html>
\ No newline at end of file
+</html>
