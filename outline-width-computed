Make getComputedStyle() for 'outline-width' return values in pixels even when keywords are used.  (Bug 474184)  r+sr=bzbarsky

diff --git a/layout/style/nsComputedDOMStyle.cpp b/layout/style/nsComputedDOMStyle.cpp
--- a/layout/style/nsComputedDOMStyle.cpp
+++ b/layout/style/nsComputedDOMStyle.cpp
@@ -1626,24 +1626,29 @@ nsComputedDOMStyle::GetOutline(nsIDOMCSS
 nsresult
 nsComputedDOMStyle::GetOutlineWidth(nsIDOMCSSValue** aValue)
 {
   nsROCSSPrimitiveValue* val = GetROCSSPrimitiveValue();
   NS_ENSURE_TRUE(val, NS_ERROR_OUT_OF_MEMORY);
 
   const nsStyleOutline* outline = GetStyleOutline();
 
-  nsStyleCoord coord;
-  PRUint8 outlineStyle = outline->GetOutlineStyle();
-  if (outlineStyle == NS_STYLE_BORDER_STYLE_NONE) {
-    coord.SetCoordValue(0);
-  } else {
-    coord = outline->mOutlineWidth;
-  }
-  SetValueToCoord(val, coord, nsnull, nsCSSProps::kBorderWidthKTable);
+  nscoord width;
+  if (outline->GetOutlineStyle() == NS_STYLE_BORDER_STYLE_NONE) {
+    NS_ASSERTION(outline->GetOutlineWidth(width) && width == 0,
+                 "unexpected width");
+    width = 0;
+  } else {
+#ifdef DEBUG
+    PRBool res =
+#endif
+      outline->GetOutlineWidth(width);
+    NS_ASSERTION(res, "percent outline doesn't exist");
+  }
+  val->SetAppUnits(width);
 
   return CallQueryInterface(val, aValue);
 }
 
 nsresult
 nsComputedDOMStyle::GetOutlineStyle(nsIDOMCSSValue** aValue)
 {
   nsROCSSPrimitiveValue* val = GetROCSSPrimitiveValue();
diff --git a/layout/style/test/test_value_computation.html b/layout/style/test/test_value_computation.html
--- a/layout/style/test/test_value_computation.html
+++ b/layout/style/test/test_value_computation.html
@@ -31,19 +31,16 @@
   
 </div>
 <pre id="test">
 <script class="testbody" type="text/javascript">
 
 /** Test for computation of values in property database **/
 
 var gBadComputed = {
-  // The 'medium' keyword should be computing to '3px', not 'medium'.
-  "outline-width": [ "3px" ],
-
   // These values are treated as auto.
   "page-break-after": [ "avoid" ],
   "page-break-before": [ "avoid" ],
 
   // These are probably bogus tests...
   "-moz-outline-radius": [ "0%" ],
   "-moz-outline-radius-bottomleft": [ "0%" ],
   "-moz-outline-radius-bottomright": [ "0%" ],
