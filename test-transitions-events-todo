From: L. David Baron <dbaron@dbaron.org>

When setTimeout fires much later than it should, which happens on unit test boxes a good bit, make test_transitions_events.html report a todo rather than a fail.  (Bug 537573)

diff --git a/layout/style/test/test_transitions_events.html b/layout/style/test/test_transitions_events.html
--- a/layout/style/test/test_transitions_events.html
+++ b/layout/style/test/test_transitions_events.html
@@ -65,16 +65,17 @@ var got_one_target_borderleft = false;
 var got_one_target_columnrule = false;
 var got_two_target = false;
 var got_three_top = false;
 var got_three_right = false;
 var got_three_bottom = false;
 var got_three_left = false;
 var got_four_root = false;
 var got_body = false;
+var did_stops = false;
 
 document.documentElement.addEventListener("transitionend",
   function(event) {
     if (event.target == $("one")) {
       ok(!got_one_root, "transitionend on one on root");
       is(event.propertyName, "border-right-color",
          "propertyName for transitionend on one");
       is(event.elapsedTime, 0.5,
@@ -100,16 +101,22 @@ document.documentElement.addEventListene
       is(event.propertyName, "some-unknown-prop",
          "propertyName for transitionend on body");
       // Reported time should (really?) be shortened by reversing.
       is(event.elapsedTime, -4.75,
          "elapsedTime for transitionend on body");
       got_body = true;
       finished_test();
     } else {
+      if (!did_stops &&
+          (event.target == $("five") || event.target == $("six"))) {
+        todo(false,
+             "timeout to stop transitions firing later than it should be");
+        return;
+      }
       ok(false,
          "unexpected event on " + event.target.nodeName +
          " element with id '" + event.target.id + "' " +
          "elapsedTime=" + event.elapsedTime +
          " propertyName='" + event.propertyName + "'");
     }
   }, false);
 
@@ -241,16 +248,17 @@ started_test();
 // then changing the value, so we should get no event.
 $("six").style.color = "lime";
 
 setTimeout(function() {
              $("five").style.MozTransitionProperty = "margin-left";
              $("six").style.MozTransitionDuration = "0s";
              $("six").style.MozTransitionDelay = "0s";
              $("six").style.color = "blue";
+             did_stops = true;
            }, 100);
 function poll_start_reversal() {
   if (cs("four").color != "rgb(0, 0, 255)") {
     // The forward transition has started.
     $("four").style.color = "blue";
   } else {
     // The forward transition has not started yet.
     setTimeout(poll_start_reversal, 20);
