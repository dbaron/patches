# HG changeset patch
# User Markus Stange <mstange@themasta.com>
# Date 1428633299 14400
#      Thu Apr 09 22:34:59 2015 -0400
# Node ID 157e70a3136e8c17b759bce63d03fff48b7bff28
# Parent  56e2412bc64ce25ef60d6ce044cfafa4a4f287af
Bug 947753 - Don't throttle main-thread execution of animations when the layer is in a non-OMTC layer tree.

diff --git a/layout/style/AnimationCommon.cpp b/layout/style/AnimationCommon.cpp
--- a/layout/style/AnimationCommon.cpp
+++ b/layout/style/AnimationCommon.cpp
@@ -882,16 +882,20 @@ AnimationPlayerCollection::CanThrottleAn
     }
 
     Layer* layer = FrameLayerBuilder::GetDedicatedLayer(
                      frame, record.mLayerType);
     if (!layer || mAnimationGeneration > layer->GetAnimationGeneration()) {
       return false;
     }
 
+    if (layer->Manager()->GetBackendType() != layers::LayersBackend::LAYERS_CLIENT) {
+      return false;
+    }
+
     if (record.mProperty == eCSSProperty_transform &&
         !CanThrottleTransformChanges(aTime)) {
       return false;
     }
   }
 
   return true;
 }
