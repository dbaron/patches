From: L. David Baron <dbaron@dbaron.org>

Bug 1265280 - Temporary debugging code to crash with a useful abort message.

MozReview-Commit-ID: G1XOUcfwY20

diff --git a/layout/base/nsDisplayList.cpp b/layout/base/nsDisplayList.cpp
--- a/layout/base/nsDisplayList.cpp
+++ b/layout/base/nsDisplayList.cpp
@@ -2163,16 +2163,24 @@ static bool IsCSSOrderLEQ(nsDisplayItem*
   nsIFrame* frame2 = aItem2->Frame();
   int32_t order1 = frame1 ? frame1->StylePosition()->mOrder : 0;
   int32_t order2 = frame2 ? frame2->StylePosition()->mOrder : 0;
   return order1 <= order2;
 }
 
 static bool IsZOrderLEQ(nsDisplayItem* aItem1, nsDisplayItem* aItem2,
                         void* aClosure) {
+  {
+    // TEMPORARY debugging code for bug 1265280
+    nsIFrame* f2 = aItem2->Frame();
+    if (!f2 || !f2->StyleContext()) {
+      NS_RUNTIMEABORT(nsPrintfCString("bad display item %p type %s frame %p",
+                                      aItem2, aItem2->Name(), f2).get());
+    }
+  }
   // Note that we can't just take the difference of the two
   // z-indices here, because that might overflow a 32-bit int.
   return aItem1->ZIndex() <= aItem2->ZIndex();
 }
 
 void nsDisplayList::SortByZOrder() {
   Sort(IsZOrderLEQ, nullptr);
 }
