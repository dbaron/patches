From: L. David Baron <dbaron@dbaron.org>

Expose the cycle collector language runtimes so that other code can do cycle collection traversal.

diff --git a/xpcom/base/nsCycleCollector.cpp b/xpcom/base/nsCycleCollector.cpp
--- a/xpcom/base/nsCycleCollector.cpp
+++ b/xpcom/base/nsCycleCollector.cpp
@@ -960,16 +960,17 @@ struct nsCycleCollector
 
     nsTPtrArray<PtrInfo> *mWhiteNodes;
     PRUint32 mWhiteNodeCount;
 
     nsPurpleBuffer mPurpleBuf;
 
     void RegisterRuntime(PRUint32 langID, 
                          nsCycleCollectionLanguageRuntime *rt);
+    nsCycleCollectionLanguageRuntime * GetRuntime(PRUint32 langID);
     void ForgetRuntime(PRUint32 langID);
 
     void SelectPurple(GCGraphBuilder &builder);
     void MarkRoots(GCGraphBuilder &builder);
     void ScanRoots();
     void RootWhite();
     PRBool CollectWhite(); // returns whether anything was collected
 
@@ -2006,16 +2007,24 @@ nsCycleCollector::RegisterRuntime(PRUint
         Fault("unknown language runtime in registration");
 
     if (mRuntimes[langID])
         Fault("multiple registrations of language runtime", rt);
 
     mRuntimes[langID] = rt;
 }
 
+nsCycleCollectionLanguageRuntime *
+nsCycleCollector::GetRuntime(PRUint32 langID)
+{
+    if (langID > nsIProgrammingLanguage::MAX)
+        return nsnull;
+
+    return mRuntimes[langID];
+}
 
 void 
 nsCycleCollector::ForgetRuntime(PRUint32 langID)
 {
     if (mParams.mDoNothing)
         return;
 
     if (langID > nsIProgrammingLanguage::MAX)
@@ -3033,16 +3042,23 @@ nsCycleCollector::WasFreed(nsISupports *
 void 
 nsCycleCollector_registerRuntime(PRUint32 langID, 
                                  nsCycleCollectionLanguageRuntime *rt)
 {
     if (sCollector)
         sCollector->RegisterRuntime(langID, rt);
 }
 
+nsCycleCollectionLanguageRuntime *
+nsCycleCollector_getRuntime(PRUint32 langID)
+{
+    if (sCollector)
+        sCollector->GetRuntime(langID);
+    return nsnull;
+}
 
 void 
 nsCycleCollector_forgetRuntime(PRUint32 langID)
 {
     if (sCollector)
         sCollector->ForgetRuntime(langID);
 }
 
diff --git a/xpcom/base/nsCycleCollector.h b/xpcom/base/nsCycleCollector.h
--- a/xpcom/base/nsCycleCollector.h
+++ b/xpcom/base/nsCycleCollector.h
@@ -87,11 +87,12 @@ NS_COM PRBool nsCycleCollector_finishCol
 #ifdef DEBUG
 NS_COM void nsCycleCollector_DEBUG_shouldBeFreed(nsISupports *n);
 NS_COM void nsCycleCollector_DEBUG_wasFreed(nsISupports *n);
 #endif
 
 // Helpers for interacting with language-identified scripts
 
 NS_COM void nsCycleCollector_registerRuntime(PRUint32 langID, nsCycleCollectionLanguageRuntime *rt);
+NS_COM nsCycleCollectionLanguageRuntime * nsCycleCollector_getRuntime(PRUint32 langID);
 NS_COM void nsCycleCollector_forgetRuntime(PRUint32 langID);
 
 #endif // nsCycleCollector_h__
