From: L. David Baron <dbaron@dbaron.org>

Bug 1110277 patch 1 - Consider the ib-split chain when checking for ::before and ::after in order to reframe when they're missing.

This patch is not needed to fix the bug, but it seems like it's probably
desirable.  In fact, it's not clear to me why it's not needed.

diff --git a/layout/base/RestyleManager.cpp b/layout/base/RestyleManager.cpp
--- a/layout/base/RestyleManager.cpp
+++ b/layout/base/RestyleManager.cpp
@@ -3671,18 +3671,19 @@ ElementRestyler::MaybeReframeForBeforePs
   // can't have generated content.
   nsContainerFrame* cif;
   if (!aStyleContext->GetPseudo() &&
       ((aGenConParentFrame->GetStateBits() & NS_FRAME_MAY_HAVE_GENERATED_CONTENT) ||
        // Our content insertion frame might have gotten flagged.
        ((cif = aGenConParentFrame->GetContentInsertionFrame()) &&
         (cif->GetStateBits() & NS_FRAME_MAY_HAVE_GENERATED_CONTENT)))) {
     // Check for a ::before pseudo style and the absence of a ::before content,
-    // but only if aFrame is null or is the first continuation.
-    if (!aFrame || !aFrame->GetPrevContinuation()) {
+    // but only if aFrame is null or is the first continuation/ib-split.
+    if (!aFrame ||
+        nsLayoutUtils::IsFirstContinuationOrIBSplitSibling(aFrame)) {
       // Checking for a ::before frame is cheaper than getting the
       // ::before style context.
       if (!nsLayoutUtils::GetBeforeFrameForContent(aGenConParentFrame, aContent) &&
           nsLayoutUtils::HasPseudoStyle(aContent, aStyleContext,
                                         nsCSSPseudoElements::ePseudo_before,
                                         mPresContext)) {
         // Have to create the new ::before frame.
         LOG_RESTYLE("MaybeReframeForBeforePseudo, appending "
@@ -3717,18 +3718,19 @@ ElementRestyler::MaybeReframeForAfterPse
   // can't have generated content.
   nsContainerFrame* cif;
   if (!aStyleContext->GetPseudo() &&
       ((aGenConParentFrame->GetStateBits() & NS_FRAME_MAY_HAVE_GENERATED_CONTENT) ||
        // Our content insertion frame might have gotten flagged.
        ((cif = aGenConParentFrame->GetContentInsertionFrame()) &&
         (cif->GetStateBits() & NS_FRAME_MAY_HAVE_GENERATED_CONTENT)))) {
     // Check for an ::after pseudo style and the absence of an ::after content,
-    // but only if aFrame is null or is the last continuation.
-    if (!aFrame || !aFrame->GetNextContinuation()) {
+    // but only if aFrame is null or is the last continuation/ib-split.
+    if (!aFrame ||
+        !nsLayoutUtils::GetNextContinuationOrIBSplitSibling(aFrame)) {
       // Checking for an ::after frame is cheaper than getting the
       // ::after style context.
       if (!nsLayoutUtils::GetAfterFrameForContent(aGenConParentFrame, aContent) &&
           nsLayoutUtils::HasPseudoStyle(aContent, aStyleContext,
                                         nsCSSPseudoElements::ePseudo_after,
                                         mPresContext)) {
         // Have to create the new ::after frame.
         LOG_RESTYLE("MaybeReframeForAfterPseudo, appending "
