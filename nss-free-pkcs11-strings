Fix shutdown leak of configuration strings.  (Bug 437690)

diff --git a/security/manager/ssl/src/nsNSSComponent.cpp b/security/manager/ssl/src/nsNSSComponent.cpp
--- a/security/manager/ssl/src/nsNSSComponent.cpp
+++ b/security/manager/ssl/src/nsNSSComponent.cpp
@@ -117,16 +117,19 @@
 #include "nssckbi.h"
 #include "base64.h"
 #include "secerr.h"
 #include "sslerr.h"
 
 extern "C" {
 #include "pkcs12.h"
 #include "p12plcy.h"
+
+/* not in nss.h yet, will be next update */
+void PK11_UnconfigurePKCS11(void);
 }
 
 #ifdef PR_LOGGING
 PRLogModuleInfo* gPIPNSSLog = nsnull;
 #endif
 
 #define NS_CRYPTO_HASH_BUFFER_SIZE 4096
 
@@ -1682,16 +1685,17 @@ nsNSSComponent::ShutdownNSS()
     }
 
     ShutdownSmartCardThreads();
     SSL_ClearSessionCache();
     UnloadLoadableRoots();
     CleanupIdentityInfo();
     PR_LOG(gPIPNSSLog, PR_LOG_DEBUG, ("evaporating psm resources\n"));
     mShutdownObjectList->evaporateAllNSSResources();
+    PK11_UnconfigurePKCS11();
     if (SECSuccess != ::NSS_Shutdown()) {
       PR_LOG(gPIPNSSLog, PR_LOG_ALWAYS, ("NSS SHUTDOWN FAILURE\n"));
       rv = NS_ERROR_FAILURE;
     }
     else {
       PR_LOG(gPIPNSSLog, PR_LOG_DEBUG, ("NSS shutdown =====>> OK <<=====\n"));
     }
   }
