From: L. David Baron <dbaron@dbaron.org>

Slightly better handling of media queries in page style menu.

diff --git a/browser/base/content/browser.js b/browser/base/content/browser.js
--- a/browser/base/content/browser.js
+++ b/browser/base/content/browser.js
@@ -5835,19 +5835,26 @@ function stylesheetFillPopup(menuPopup) 
   for (let i = 0; i < styleSheets.length; ++i) {
     let currentStyleSheet = styleSheets[i];
 
     if (!currentStyleSheet.title)
       continue;
 
     // Skip any stylesheets that don't match the screen media type.
     if (currentStyleSheet.media.length > 0) {
-      let media = currentStyleSheet.media.mediaText.split(", ");
-      if (media.indexOf("screen") == -1 &&
-          media.indexOf("all") == -1)
+      let media = currentStyleSheet.media;
+      let match = false;
+      for (let j = 0; j < media.length; ++j) {
+        // very rough approximation of media query behavior
+        if (media.item(j).match(/^(screen|all|not)\b/)) {
+          match = true;
+          break;
+        }
+      }
+      if (!match)
         continue;
     }
 
     if (!currentStyleSheet.disabled)
       altStyleSelected = true;
 
     haveAltSheets = true;
 
