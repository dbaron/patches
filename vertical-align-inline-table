Make 'vertical-align' work on 'display: inline-table'.  b=404030

diff --git a/layout/reftests/bugs/404030-1-notref.html b/layout/reftests/bugs/404030-1-notref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/404030-1-notref.html
@@ -0,0 +1,27 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Testcase, bug 404030</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+    span { display: inline-block; height: 2em; border: thin solid; }
+
+	</style>
+</head>
+<body>
+
+<p>Test: <span>inline-table</span>.</p>
+<p>Test: <span>inline-table</span>.</p>
+<p>Test: <span>inline-table</span>.</p>
+<p>Test: <span>inline-table</span>.</p>
+<p>Test: <span>inline-table</span>.</p>
+<p>Test: <span>inline-table</span>.</p>
+<p>Test: <span>inline-table</span>.</p>
+<p>Test: <span>inline-table</span>.</p>
+<p>Test: <span>inline-table</span>.</p>
+
+</body>
+</html>
diff --git a/layout/reftests/bugs/404030-1-notref2.html b/layout/reftests/bugs/404030-1-notref2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/404030-1-notref2.html
@@ -0,0 +1,29 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Testcase, bug 404030</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+    span { display: inline-block; height: 2em; border: thin solid; }
+
+	</style>
+</head>
+<body>
+
+<!-- vary only the last test, to make sure line-height works -->
+
+<p>Test: <span style="vertical-align: top">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: text-top">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: middle">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: text-bottom">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: bottom">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: baseline">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: 4px">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: 50%">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: 50%">inline-table</span>.</p>
+
+</body>
+</html>
diff --git a/layout/reftests/bugs/404030-1-ref.html b/layout/reftests/bugs/404030-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/404030-1-ref.html
@@ -0,0 +1,27 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Testcase, bug 404030</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+    span { display: inline-block; height: 2em; border: thin solid; }
+
+	</style>
+</head>
+<body>
+
+<p>Test: <span style="vertical-align: top">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: text-top">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: middle">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: text-bottom">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: bottom">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: baseline">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: 4px">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: 50%">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: 50%; line-height: 3">inline-table</span>.</p>
+
+</body>
+</html>
diff --git a/layout/reftests/bugs/404030-1.html b/layout/reftests/bugs/404030-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/404030-1.html
@@ -0,0 +1,27 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Testcase, bug 404030</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+    span { display: inline-table; height: 2em; border: thin solid; }
+
+	</style>
+</head>
+<body>
+
+<p>Test: <span style="vertical-align: top">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: text-top">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: middle">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: text-bottom">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: bottom">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: baseline">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: 4px">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: 50%">inline-table</span>.</p>
+<p>Test: <span style="vertical-align: 50%; line-height: 3">inline-table</span>.</p>
+
+</body>
+</html>
diff --git a/layout/reftests/bugs/reftest.list b/layout/reftests/bugs/reftest.list
--- a/layout/reftests/bugs/reftest.list
+++ b/layout/reftests/bugs/reftest.list
@@ -454,3 +454,7 @@ fails == 393655-2.html 393655-2-ref.html
 == 403656-4.html 403656-4-ref.html
 == 403656-5.html 403656-5-ref.html
 == 403733-1.html 403733-1-ref.html
+== 404030-1.html 404030-1-ref.html
+!= 404030-1-notref.html 404030-1.html
+!= 404030-1-notref2.html 404030-1.html
+
diff --git a/layout/style/ua.css b/layout/style/ua.css
--- a/layout/style/ua.css
+++ b/layout/style/ua.css
@@ -77,6 +77,8 @@
   z-index: inherit;
   page-break-before: inherit;
   page-break-after: inherit;
+  vertical-align: inherit; /* needed for inline-table */
+  line-height: inherit; /* needed for vertical-align on inline-table */
 }
 
 *|*::-moz-table-row {
