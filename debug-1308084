From: L. David Baron <dbaron@dbaron.org>

Debugging patch to get diagnostics for bug 1308084.

MozReview-Commit-ID: 1xh6OAAEy64

diff --git a/netwerk/base/nsChannelClassifier.cpp b/netwerk/base/nsChannelClassifier.cpp
--- a/netwerk/base/nsChannelClassifier.cpp
+++ b/netwerk/base/nsChannelClassifier.cpp
@@ -73,17 +73,23 @@ nsChannelClassifier::ShouldEnableTrackin
     }
 
     nsresult rv;
     nsCOMPtr<mozIThirdPartyUtil> thirdPartyUtil =
         do_GetService(THIRDPARTYUTIL_CONTRACTID, &rv);
     NS_ENSURE_SUCCESS(rv, rv);
 
     nsCOMPtr<nsIHttpChannelInternal> chan = do_QueryInterface(aChannel, &rv);
-    NS_ENSURE_SUCCESS(rv, rv);
+    if (NS_FAILED(rv)) {
+      nsCOMPtr<nsIURI> chanURI;
+      aChannel->GetURI(getter_AddRefs(chanURI));
+      printf("Not an HTTP Channel: uri=%s\n",
+             chanURI ? chanURI->GetSpecOrDefault().get() : "[null URI]");
+      NS_ENSURE_SUCCESS(rv, rv);
+    }
 
     nsCOMPtr<nsIURI> topWinURI;
     rv = chan->GetTopWindowURI(getter_AddRefs(topWinURI));
     NS_ENSURE_SUCCESS(rv, rv);
 
     if (!topWinURI) {
       LOG(("nsChannelClassifier[%p]: No window URI\n", this));
     }
