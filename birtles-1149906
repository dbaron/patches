# HG changeset patch
# User Brian Birtles <birtles@gmail.com>
# Date 1427876522 -32400
#      Wed Apr 01 17:22:02 2015 +0900
Bug 1149906 - Consider play-pending animations to be playing as well  r=dbaron

diff --git a/dom/animation/AnimationPlayer.h b/dom/animation/AnimationPlayer.h
--- a/dom/animation/AnimationPlayer.h
+++ b/dom/animation/AnimationPlayer.h
@@ -228,18 +228,21 @@ public:
    * still running but we only consider it playing when it is in its active
    * interval. This definition is used for fetching the animations that are
    * are candidates for running on the compositor (since we don't ship
    * animations to the compositor when they are in their delay phase or
    * paused).
    */
   bool IsPlaying() const
   {
-    return HasInPlaySource() && // Check we are in the active interval
-           PlayState() == AnimationPlayState::Running; // And not paused
+    // We need to have a source animation in its active interval, and
+    // be either running or waiting to run.
+    return HasInPlaySource() &&
+           (PlayState() == AnimationPlayState::Running ||
+            mPendingState == PendingState::PlayPending);
   }
 
   bool IsRelevant() const { return mIsRelevant; }
   void UpdateRelevance();
 
   void SetIsRunningOnCompositor() { mIsRunningOnCompositor = true; }
   void ClearIsRunningOnCompositor() { mIsRunningOnCompositor = false; }
 
