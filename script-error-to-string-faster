From: L. David Baron <dbaron@dbaron.org>

Bug 1157648 - Make nsScriptError::ToString use only the first 512 characters of mSourceName and mSourceLine.  r=bholley

This means that when mSourceName and mSourceLine are large, ToString is
not excessively expensive.

This is particularly important for CSS errors, where we don't make an
attempt to truncate these prior to constructing the script error, but we
do ensure that when we report multiple errors on the same line (which is
common for minified CSS), we share from the same string buffer and avoid
copying.

diff --git a/js/xpconnect/src/nsScriptError.cpp b/js/xpconnect/src/nsScriptError.cpp
--- a/js/xpconnect/src/nsScriptError.cpp
+++ b/js/xpconnect/src/nsScriptError.cpp
@@ -198,19 +198,21 @@ nsScriptError::ToString(nsACString& /*UT
     char* temp;
     char* tempMessage = nullptr;
     char* tempSourceName = nullptr;
     char* tempSourceLine = nullptr;
 
     if (!mMessage.IsEmpty())
         tempMessage = ToNewUTF8String(mMessage);
     if (!mSourceName.IsEmpty())
-        tempSourceName = ToNewUTF8String(mSourceName);
+        // Use at most 512 characters from mSourceName.
+        tempSourceName = ToNewUTF8String(StringHead(mSourceName, 512));
     if (!mSourceLine.IsEmpty())
-        tempSourceLine = ToNewUTF8String(mSourceLine);
+        // Use at most 512 characters from mSourceLine.
+        tempSourceLine = ToNewUTF8String(StringHead(mSourceLine, 512));
 
     if (nullptr != tempSourceName && nullptr != tempSourceLine)
         temp = JS_smprintf(format0,
                            severity,
                            tempMessage,
                            tempSourceName,
                            mLineNumber,
                            mColumnNumber,
