From: Timothy Nikkel <tnikkel@gmail.com>

Bug 517737. Don't allow starting a drag if something is capturing the mouse.

diff --git a/content/events/src/nsEventStateManager.cpp b/content/events/src/nsEventStateManager.cpp
--- a/content/events/src/nsEventStateManager.cpp
+++ b/content/events/src/nsEventStateManager.cpp
@@ -1882,16 +1882,22 @@ nsEventStateManager::GenerateDragGesture
     {
       nsCOMPtr<nsFrameSelection> frameSel = mCurrentTarget->GetFrameSelection();
       if (frameSel && frameSel->GetMouseDownState()) {
         StopTrackingDragGesture();
         return;
       }
     }
 
+    // If something is capturing the mouse don't start a drag.
+    if (nsIPresShell::GetCapturingContent()) {
+      StopTrackingDragGesture();
+      return;
+    }
+
     static PRInt32 pixelThresholdX = 0;
     static PRInt32 pixelThresholdY = 0;
 
     if (!pixelThresholdX) {
       nsILookAndFeel *lf = aPresContext->LookAndFeel();
       lf->GetMetric(nsILookAndFeel::eMetric_DragThresholdX, pixelThresholdX);
       lf->GetMetric(nsILookAndFeel::eMetric_DragThresholdY, pixelThresholdY);
       if (!pixelThresholdX)
