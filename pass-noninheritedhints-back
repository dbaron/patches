From: L. David Baron <dbaron@dbaron.org>

Bug 828312, patch 2:  Give nsFrameManager::ReResolveStyleContext the ability to pass its nonInheritedHints variable back to its caller.

diff --git a/layout/base/RestyleManager.cpp b/layout/base/RestyleManager.cpp
--- a/layout/base/RestyleManager.cpp
+++ b/layout/base/RestyleManager.cpp
@@ -1973,17 +1973,18 @@ RestyleManager::ReResolveStyleContext(ns
                                       nsIContent        *aParentContent,
                                       nsStyleChangeList *aChangeList,
                                       nsChangeHint       aMinChange,
                                       nsChangeHint       aParentFrameHintsNotHandledForDescendants,
                                       nsRestyleHint      aRestyleHint,
                                       RestyleTracker&    aRestyleTracker,
                                       DesiredA11yNotifications aDesiredA11yNotifications,
                                       nsTArray<nsIContent*>& aVisibleKidsOfHiddenElement,
-                                      TreeMatchContext &aTreeMatchContext)
+                                      TreeMatchContext &aTreeMatchContext,
+                                      nsChangeHint      *aHintsNotHandledForChildren)
 {
   // We need to generate a new change list entry for every frame whose style
   // comparision returns one of these hints. These hints don't automatically
   // update all their descendant frames.
   aMinChange = NS_SubtractHint(aMinChange, NS_HintsNotHandledForDescendantsIn(aMinChange));
 
   // It would be nice if we could make stronger assertions here; they
   // would let us simplify the ?: expressions below setting |content|
@@ -2315,16 +2316,20 @@ RestyleManager::ReResolveStyleContext(ns
           }
         }
       }
       else {
         break;
       }
     }
 
+    if (aHintsNotHandledForChildren) {
+      *aHintsNotHandledForChildren = nonInheritedHints;
+    }
+
     // now look for undisplayed child content and pseudos
 
     // When the root element is display:none, we still construct *some*
     // frames that have the root element as their mContent, down to the
     // DocElementContainingBlock.
     bool checkUndisplayed;
     nsIContent* undisplayedParent;
     nsCSSFrameConstructor* frameConstructor = FrameConstructor();
diff --git a/layout/base/RestyleManager.h b/layout/base/RestyleManager.h
--- a/layout/base/RestyleManager.h
+++ b/layout/base/RestyleManager.h
@@ -213,17 +213,18 @@ private:
                           nsIContent* aParentContent,
                           nsStyleChangeList* aChangeList,
                           nsChangeHint aMinChange,
                           nsChangeHint aParentFrameHintsNotHandledForDescendants,
                           nsRestyleHint aRestyleHint,
                           RestyleTracker& aRestyleTracker,
                           DesiredA11yNotifications aDesiredA11yNotifications,
                           nsTArray<nsIContent*>& aVisibleKidsOfHiddenElement,
-                          TreeMatchContext& aTreeMatchContext);
+                          TreeMatchContext& aTreeMatchContext,
+                          nsChangeHint* aHintsNotHandledForChildren = nullptr);
 
   /**
    * Notify the frame constructor that an element needs to have its
    * style recomputed.
    * @param aElement: The element to be restyled.
    * @param aRestyleHint: Which nodes need to have selector matching run
    *                      on them.
    * @param aMinChangeHint: A minimum change hint for aContent and its
