From: L. David Baron <dbaron@dbaron.org>

Bug 1343715 - Use SetDataFlags in ForgetSharedBuffer.

I believe this should fix some incorrect clearing of F_CLASS_FIXED.

MozReview-Commit-ID: 4ga2NEM9M5Z

diff --git a/xpcom/string/nsTSubstring.h b/xpcom/string/nsTSubstring.h
--- a/xpcom/string/nsTSubstring.h
+++ b/xpcom/string/nsTSubstring.h
@@ -1040,17 +1040,17 @@ public:
    * If the string uses a shared buffer, this method
    * clears the pointer without releasing the buffer.
    */
   void ForgetSharedBuffer()
   {
     if (mFlags & nsAString::F_SHARED) {
       mData = char_traits::sEmptyBuffer;
       mLength = 0;
-      mFlags = F_TERMINATED;
+      SetDataFlags(F_TERMINATED);
     }
   }
 
 public:
 
   /**
    * this is public to support automatic conversion of tuple to string
    * base type, which helps avoid converting to nsTAString.
