From: L. David Baron <dbaron@dbaron.org>

Add more tests for invalid URL parsing for CSS 2.1 issue 129.

diff --git a/layout/reftests/css-parsing/invalid-url-handling-ref.xhtml b/layout/reftests/css-parsing/invalid-url-handling-ref.xhtml
--- a/layout/reftests/css-parsing/invalid-url-handling-ref.xhtml
+++ b/layout/reftests/css-parsing/invalid-url-handling-ref.xhtml
@@ -18,10 +18,13 @@
   <div id="seven">This should have a green background</div>
   <div id="eight">This should have a green background</div>
   <div id="nine">This should have a green background</div>
   <div id="ten">This should have a green background</div>
   <div id="eleven">This should have a green background</div>
   <div id="twelve">This should have a green background</div>
   <div id="thirteen">This should have a green background</div>
   <div id="fourteen">This should have a green background</div>
+  <div id="fifteen">This should have a green background</div>
+  <div id="sixteen">This should have a green background</div>
+  <div id="seventeen">This should have a green background</div>
  </body>
 </html>
diff --git a/layout/reftests/css-parsing/invalid-url-handling.xhtml b/layout/reftests/css-parsing/invalid-url-handling.xhtml
--- a/layout/reftests/css-parsing/invalid-url-handling.xhtml
+++ b/layout/reftests/css-parsing/invalid-url-handling.xhtml
@@ -76,26 +76,46 @@
   #thirteen { background: url(["")]); background-color: green; }
   </style>
   <style type="text/css">
   /* not a URI token; the opening ( is never matched */
   #fourteen { background-color: green; }
   #foo { background: url(() }
   #fourteen { background-color: red; }
   </style>
+  /* The next three tests test that when things don't match a URI
+     token, brace-matching is done properly.  (The first is a reference.) */
+  <style type="text/css">
+  #fifteen { background-color: red }
+  #foo { background: url(a()); }
+  #fifteen { background-color: green }
+  </style>
+  <style type="text/css">
+  #sixteen { background-color: green }
+  #foo { background: url([()); }
+  #sixteen { background-color: red }
+  </style>
+  <style type="text/css">
+  #seventeen { background-color: green }
+  #foo { background: url([()); }
+  #seventeen { background-color: red }
+  </style>
  </head>
  <body>
   <div id="one">This should have a green background</div>
   <div id="two">This should have a green background</div>
   <div id="three">This should have a green background</div>
   <div id="four">This should have a green background</div>
   <div id="five">This should have a green background</div>
   <div id="six">This should have a green background</div>
   <div id="seven">This should have a green background</div>
   <div id="eight">This should have a green background</div>
   <div id="nine">This should have a green background</div>
   <div id="ten">This should have a green background</div>
   <div id="eleven">This should have a green background</div>
   <div id="twelve">This should have a green background</div>
   <div id="thirteen">This should have a green background</div>
   <div id="fourteen">This should have a green background</div>
+  <div id="fifteen">This should have a green background</div>
+  <div id="sixteen">This should have a green background</div>
+  <div id="seventeen">This should have a green background</div>
  </body>
 </html>
