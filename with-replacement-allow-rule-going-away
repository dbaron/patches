From: L. David Baron <dbaron@dbaron.org>

Bug 960465 patch N - Make RuleNodeWithReplacement allow the animation or transition rule to go away as part of the replacement, so we can use this codepath for more cases.

diff --git a/layout/style/nsStyleSet.cpp b/layout/style/nsStyleSet.cpp
--- a/layout/style/nsStyleSet.cpp
+++ b/layout/style/nsStyleSet.cpp
@@ -1369,34 +1369,32 @@ nsStyleSet::RuleNodeWithReplacement(Elem
       case eRestyle_CSSAnimations:
         {
           // FIXME: This should probably be more similar to what
           // FileRules does.
           nsAnimationManager* animationManager =
             PresContext()->AnimationManager();
           ElementAnimationCollection* collection = animationManager->GetElementAnimations(
             aElement, aPseudoType, false);
-          NS_ASSERTION(collection,
-            "Rule has level eAnimationSheet without animation on manager");
-
-          ruleWalker.ForwardOnPossiblyCSSRule(collection->mStyleRule);
+          if (collection && collection->mStyleRule) {
+            ruleWalker.ForwardOnPossiblyCSSRule(collection->mStyleRule);
+          }
         }
         break;
       case eRestyle_CSSTransitions:
         {
           // FIXME: This should probably be more similar to what
           // FileRules does.
           nsPresContext* presContext = PresContext();
           ElementAnimationCollection* collection =
             presContext->TransitionManager()->GetElementTransitions(
               aElement, aPseudoType, false);
-          NS_ASSERTION(collection,
-            "Rule has level eTransitionSheet without transition on manager");
-
-          ruleWalker.ForwardOnPossiblyCSSRule(collection->mStyleRule);
+          if (collection) {
+            ruleWalker.ForwardOnPossiblyCSSRule(collection->mStyleRule);
+          }
         }
         break;
       default:
         break;
       }
     }
 
     while (rulesIndex != 0) {
