Free gIconFactory in GTK nsIconChannel implementation.  (Bug 488184)  r=karlt

diff --git a/modules/libpr0n/decoders/icon/gtk/nsIconChannel.cpp b/modules/libpr0n/decoders/icon/gtk/nsIconChannel.cpp
--- a/modules/libpr0n/decoders/icon/gtk/nsIconChannel.cpp
+++ b/modules/libpr0n/decoders/icon/gtk/nsIconChannel.cpp
@@ -186,17 +186,16 @@ ensure_stock_image_widget()
 
 #if GTK_CHECK_VERSION(2,4,0)
 static void
 ensure_icon_factory()
 {
   if (!gIconFactory) {
     gIconFactory = gtk_icon_factory_new();
     gtk_icon_factory_add_default(gIconFactory);
-    g_object_unref(gIconFactory);
   }
 }
 #endif
 
 #ifdef MOZ_ENABLE_GNOMEUI
 static nsresult
 ensure_libgnomeui()
 {
@@ -515,16 +514,23 @@ nsIconChannel::Init(nsIURI* aURI)
 
 void
 nsIconChannel::Shutdown() {
   if (gProtoWindow) {
     gtk_widget_destroy(gProtoWindow);
     gProtoWindow = nsnull;
     gStockImageWidget = nsnull;
   }
+#if GTK_CHECK_VERSION(2,4,0)
+  if (gIconFactory) {
+    gtk_icon_factory_remove_default(gIconFactory);
+    g_object_unref(gIconFactory);
+    gIconFactory = nsnull;
+  }
+#endif
 #ifdef MOZ_ENABLE_GNOMEUI
   if (gIconTheme) {
     g_object_unref(G_OBJECT(gIconTheme));
     gIconTheme = nsnull;
   }
   gTriedToLoadGnomeLibs = PR_FALSE;
   if (gLibGnomeUI) {
     PR_UnloadLibrary(gLibGnomeUI);
