From: fantasai <fantasai.cvs@inkedblade.net>

Do IsProperAncestorFrame check before destroying floats, but not for popups.  (Bug 588158)  r=dbaron  a2.0=blocking

diff --git a/layout/generic/nsPlaceholderFrame.cpp b/layout/generic/nsPlaceholderFrame.cpp
--- a/layout/generic/nsPlaceholderFrame.cpp
+++ b/layout/generic/nsPlaceholderFrame.cpp
@@ -158,17 +158,17 @@ nsPlaceholderFrame::DestroyFrom(nsIFrame
   if (oof) {
     // Unregister out-of-flow frame
     shell->FrameManager()->UnregisterPlaceholderFrame(this);
     mOutOfFlowFrame = nsnull;
     // If aDestructRoot is not an ancestor of the out-of-flow frame,
     // then call RemoveFrame on it here.
     // Also destroy it here if it's a popup frame. (Bug 96291)
     if (shell->FrameManager() &&
-        ((GetStateBits() & PLACEHOLDER_FOR_FLOAT) ||
+        ((GetStateBits() & PLACEHOLDER_FOR_POPUP) ||
          !nsLayoutUtils::IsProperAncestorFrame(aDestructRoot, oof))) {
       nsIAtom* listName = nsLayoutUtils::GetChildListNameFor(oof);
       shell->FrameManager()->RemoveFrame(listName, oof);
     }
     // else oof will be destroyed by its parent
   }
 
   nsFrame::DestroyFrom(aDestructRoot);
