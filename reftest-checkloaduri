Add checkLoadURI calls to reftest harness.

diff -r b512ee71b238 layout/tools/reftest/reftest.js
--- a/layout/tools/reftest/reftest.js	Thu Feb 08 17:54:39 2007 -0800
+++ b/layout/tools/reftest/reftest.js	Thu Feb 08 18:40:52 2007 -0800
@@ -45,6 +45,8 @@ const IO_SERVICE_CONTRACTID = "@mozilla.
 const IO_SERVICE_CONTRACTID = "@mozilla.org/network/io-service;1";
 const NS_LOCALFILEINPUTSTREAM_CONTRACTID =
           "@mozilla.org/network/file-input-stream;1";
+const NS_SCRIPTSECURITYMANAGER_CONTRACTID =
+          "@mozilla.org/scriptsecuritymanager;1";
 
 var gBrowser;
 var gProgressListener;
@@ -96,6 +98,9 @@ function ReadManifest(aURL)
 {
     var ios = CC[IO_SERVICE_CONTRACTID].getService(CI.nsIIOService);
     var listURL = aURL.QueryInterface(CI.nsIFileURL);
+
+    var secMan = CC[NS_SCRIPTSECURITYMANAGER_CONTRACTID]
+                     .getService(CI.nsIScriptSecurityManager);
 
     var fis = CC[NS_LOCALFILEINPUTSTREAM_CONTRACTID].
                   createInstance(CI.nsIFileInputStream);
@@ -150,14 +155,23 @@ function ReadManifest(aURL)
         if (items[0] == "include") {
             if (items.length != 2)
                 throw "Error in manifest file " + aURL + " line " + lineNo;
-            ReadManifest(ios.newURI(items[1], null, listURL));
+            var incURI = ios.newURI(items[1], null, listURL);
+            secMan.checkLoadURI(aURL, incURI,
+                                CI.nsIScriptSecurityManager.DISALLOW_SCRIPT);
+            ReadManifest(incURI);
         } else if (items[0] == "==" || items[0] == "!=") {
             if (items.length != 3)
                 throw "Error in manifest file " + aURL + " line " + lineNo;
+            var testURI = ios.newURI(items[1], null, listURL);
+            var refURI = ios.newURI(items[2], null, listURL);
+            secMan.checkLoadURI(aURL, testURI,
+                                CI.nsIScriptSecurityManager.DISALLOW_SCRIPT);
+            secMan.checkLoadURI(aURL, refURI,
+                                CI.nsIScriptSecurityManager.DISALLOW_SCRIPT);
             gURLs.push( { equal: (items[0] == "=="),
                           expected: expected_status,
-                          url1: ios.newURI(items[1], null, listURL),
-                          url2: ios.newURI(items[2], null, listURL)} );
+                          url1: testURI,
+                          url2: refURI} );
         } else {
             throw "Error in manifest file " + aURL + " line " + lineNo;
         }
