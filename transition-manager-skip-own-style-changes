From: L. David Baron <dbaron@dbaron.org>

Bug 960465 patch N - nsTransitionManager should skip style changes that it posted while starting transitions.

This will be needed when (in later patches) we stop separating animation
phases.

diff --git a/layout/style/nsTransitionManager.cpp b/layout/style/nsTransitionManager.cpp
--- a/layout/style/nsTransitionManager.cpp
+++ b/layout/style/nsTransitionManager.cpp
@@ -176,16 +176,27 @@ nsTransitionManager::StyleContextChanged
     GetAnimationPlayers(aElement, pseudoType, false);
   if (!collection &&
       disp->mTransitionPropertyCount == 1 &&
       disp->mTransitions[0].GetDelay() == 0.0f &&
       disp->mTransitions[0].GetDuration() == 0.0f) {
     return;
   }
 
+  if (collection &&
+      collection->mAnimationGeneration ==
+        mPresContext->RestyleManager()->GetAnimationGeneration()) {
+    // When we start a new transition, we immediately post a restyle.
+    // If the animation generation on the collection is current, that
+    // means *this* is that restyle, since we bump the animation
+    // generation on the restyle manager whenever there's a real style
+    // change (i.e., one where mInAnimationOnlyStyleUpdate isn't true,
+    // which causes us to return above).  Thus we shouldn't do anything.
+    return;
+  }
 
   // FIXME (bug 960465): This test should go away.
   if (newStyleContext->PresContext()->RestyleManager()->
         IsProcessingAnimationStyleChange()) {
     return;
   }
 
   if (newStyleContext->GetParent() &&
