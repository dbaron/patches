From: L. David Baron <dbaron@dbaron.org>

Add missing UngetToken() for invalid contents of @charset rule.  (Bug 604172)  r=bzbarsky

diff --git a/layout/style/nsCSSParser.cpp b/layout/style/nsCSSParser.cpp
--- a/layout/style/nsCSSParser.cpp
+++ b/layout/style/nsCSSParser.cpp
@@ -1513,16 +1513,17 @@ CSSParserImpl::ParseCharsetRule(RuleAppe
                                 void* aData)
 {
   if (!GetToken(PR_TRUE)) {
     REPORT_UNEXPECTED_EOF(PECharsetRuleEOF);
     return PR_FALSE;
   }
 
   if (eCSSToken_String != mToken.mType) {
+    UngetToken();
     REPORT_UNEXPECTED_TOKEN(PECharsetRuleNotString);
     return PR_FALSE;
   }
 
   nsAutoString charset = mToken.mIdent;
 
   if (!ExpectSymbol(';', PR_TRUE)) {
     return PR_FALSE;
