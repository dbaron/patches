From: L. David Baron <dbaron@dbaron.org>

Pull pushed floats back from the next-in-flow at the start of reflow.  (Bug 588237)

diff --git a/layout/generic/nsBlockFrame.cpp b/layout/generic/nsBlockFrame.cpp
--- a/layout/generic/nsBlockFrame.cpp
+++ b/layout/generic/nsBlockFrame.cpp
@@ -4584,16 +4584,40 @@ nsBlockFrame::DrainOverflowLines(nsBlock
   }
 
   return PR_TRUE;
 }
 
 void
 nsBlockFrame::DrainPushedFloats(nsBlockReflowState& aState)
 {
+  // If we're getting reflowed multiple times without our
+  // next-continuation being reflowed, we might need to pull back floats
+  // that we just put in the list to be pushed to our next-in-flow.
+  // But we can't pull any next-in-flows of floats on our own float list.
+  nsFrameList *ourPushedFloats = GetPushedFloats();
+  if (ourPushedFloats) {
+    for (nsIFrame *f = ourPushedFloats->LastChild(), *next; f; f = next) {
+      next = f->GetPrevSibling();
+
+      if (!f->GetPrevContinuation() &&
+          f->Properties().Get(PushedFloatOriginalParent()) != this) {
+        // This is a first continuation that was pushed from one of our
+        // previous continuations.  Take it out of the pushed floats
+        // list and put it on the beginning of our floats list.
+        ourPushedFloats->RemoveFrame(f);
+        mFloats.InsertFrame(nsnull, nsnull, f);
+      }
+    }
+
+    if (ourPushedFloats->IsEmpty()) {
+      RemovePushedFloats();
+    }
+  }
+
   // After our prev-in-flow has completed reflow, it may have a pushed
   // floats list, containing floats that we need to own.  Take these.
   nsBlockFrame* prevBlock = static_cast<nsBlockFrame*>(GetPrevInFlow());
   if (!prevBlock)
     return;
   nsFrameList *list = prevBlock->RemovePushedFloats();
   if (list) {
     if (list->NotEmpty()) {
