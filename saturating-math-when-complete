From: L. David Baron <dbaron@dbaron.org>

Use saturating nscoord math to avoid taking the better (frame-complete) codepath cause an increase in assertion count on layout/base/crashtests/265899-1.html .  (Bug 563584)

diff --git a/layout/generic/nsBlockFrame.cpp b/layout/generic/nsBlockFrame.cpp
--- a/layout/generic/nsBlockFrame.cpp
+++ b/layout/generic/nsBlockFrame.cpp
@@ -1377,26 +1377,27 @@ nsBlockFrame::ComputeFinalSize(const nsH
       // here. We need GetSkipSides to check whether we ran out of content
       // height in the current frame, not whether it's last-in-flow.
     }
 
     // Don't carry out a bottom margin when our height is fixed.
     aMetrics.mCarriedOutBottomMargin.Zero();
   }
   else if (NS_FRAME_IS_COMPLETE(aState.mReflowStatus)) {
-    nscoord autoHeight = bottomEdgeOfChildren;
-    autoHeight -= borderPadding.top;
+    nscoord autoHeight = NS_MAX(0,
+      NSCoordSaturatingSubtract(bottomEdgeOfChildren, borderPadding.top, 0));
     nscoord oldAutoHeight = autoHeight;
     aReflowState.ApplyMinMaxConstraints(nsnull, &autoHeight);
     if (autoHeight != oldAutoHeight) {
       // Our min-height or max-height made our height change.  Don't carry out
       // our kids' bottom margins.
       aMetrics.mCarriedOutBottomMargin.Zero();
     }
-    autoHeight += borderPadding.top + borderPadding.bottom;
+    autoHeight = NSCoordSaturatingAdd(autoHeight, borderPadding.top);
+    autoHeight = NSCoordSaturatingAdd(autoHeight, borderPadding.bottom);
     aMetrics.height = autoHeight;
   }
   else {
     NS_ASSERTION(aReflowState.availableHeight != NS_UNCONSTRAINEDSIZE,
       "Shouldn't be incomplete if availableHeight is UNCONSTRAINED.");
     aMetrics.height = NS_MAX(aState.mY, aReflowState.availableHeight);
     if (aReflowState.availableHeight == NS_UNCONSTRAINEDSIZE)
       // This should never happen, but it does. See bug 414255
