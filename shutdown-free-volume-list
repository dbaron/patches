Delete gVolumeList on shutdown.  b=397305

diff --git a/netwerk/base/src/nsURLHelper.h b/netwerk/base/src/nsURLHelper.h
--- a/netwerk/base/src/nsURLHelper.h
+++ b/netwerk/base/src/nsURLHelper.h
@@ -67,6 +67,9 @@ enum netCoalesceFlags
 
 /* shutdown frees URL parser */
 NS_HIDDEN_(void) net_ShutdownURLHelper();
+#ifdef XP_MACOSX
+NS_HIDDEN_(void) net_ShutdownURLHelperOSX();
+#endif
 
 /* access URL parsers */
 NS_HIDDEN_(nsIURLParser *) net_GetAuthURLParser();
diff --git a/netwerk/base/src/nsURLHelperOSX.cpp b/netwerk/base/src/nsURLHelperOSX.cpp
--- a/netwerk/base/src/nsURLHelperOSX.cpp
+++ b/netwerk/base/src/nsURLHelperOSX.cpp
@@ -39,7 +39,7 @@
  *
  * ***** END LICENSE BLOCK ***** */
 
-/* Unix-specific local file uri parsing */
+/* Mac OS X-specific local file uri parsing */
 #include "nsURLHelper.h"
 #include "nsEscape.h"
 #include "nsILocalFile.h"
@@ -47,6 +47,8 @@
 #include "nsReadableUtils.h"
 #include <Files.h>
 
+static nsCStringArray *gVolumeList = nsnull;
+
 static PRBool pathBeginsWithVolName(const nsACString& path, nsACString& firstPathComponent)
 {
   // Return whether the 1st path component in path (escaped) is equal to the name
@@ -54,10 +56,15 @@ static PRBool pathBeginsWithVolName(cons
   // This needs to be done as quickly as possible, so we cache a list of volume names.
   // XXX Register an event handler to detect drives being mounted/unmounted?
   
-  static nsCStringArray gVolumeList; // We will leak this - one for the life of the app :-/
+  if (!gVolumeList) {
+    gVolumeList = new nsCStringArray;
+    if (!gVolumeList) {
+      return PR_FALSE; // out of memory
+    }
+  }
 
   // Cache a list of volume names
-  if (!gVolumeList.Count()) {
+  if (!gVolumeList->Count()) {
     OSErr err;
     ItemCount volumeIndex = 1;
     
@@ -68,7 +75,7 @@ static PRBool pathBeginsWithVolName(cons
       if (err == noErr) {
         NS_ConvertUTF16toUTF8 volNameStr(Substring((PRUnichar *)volName.unicode,
                                                    (PRUnichar *)volName.unicode + volName.length));
-        gVolumeList.AppendCString(volNameStr);
+        gVolumeList->AppendCString(volNameStr);
         volumeIndex++;
       }
     } while (err == noErr);
@@ -85,9 +92,16 @@ static PRBool pathBeginsWithVolName(cons
   
   nsCAutoString flatComponent((Substring(start, component_end)));
   NS_UnescapeURL(flatComponent);
-  PRInt32 foundIndex = gVolumeList.IndexOf(flatComponent);
+  PRInt32 foundIndex = gVolumeList->IndexOf(flatComponent);
   firstPathComponent = flatComponent;
   return (foundIndex != -1);
+}
+
+void
+net_ShutdownURLHelperOSX()
+{
+  delete gVolumeList;
+  gVolumeList = nsnull;
 }
 
 static nsresult convertHFSPathtoPOSIX(const nsACString& hfsPath, nsACString& posixPath)
diff --git a/netwerk/build/nsNetModule.cpp b/netwerk/build/nsNetModule.cpp
--- a/netwerk/build/nsNetModule.cpp
+++ b/netwerk/build/nsNetModule.cpp
@@ -605,6 +605,9 @@ static void PR_CALLBACK nsNetShutdown(ns
 
     // Release global state used by the URL helper module.
     net_ShutdownURLHelper();
+#ifdef XP_MACOSX
+    net_ShutdownURLHelperOSX();
+#endif
 
     // Release necko strings
     delete gNetStrings;
