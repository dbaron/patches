Add tests that exercise nsSpanningCellSorter, including with large colspans, since code coverage runs showed we don't hit that code.

diff --git a/layout/reftests/table-width/reftest.list b/layout/reftests/table-width/reftest.list
--- a/layout/reftests/table-width/reftest.list
+++ b/layout/reftests/table-width/reftest.list
@@ -41,8 +41,16 @@
 == cellspacing.html cellspacing-ref.html
 == percent-basis.html percent-basis-ref.html
 == default-box-sizing-separate-standards.html default-box-sizing-separate-standards-ref.html
 == default-box-sizing-separate-quirks.html default-box-sizing-separate-quirks-ref.html
 fails == default-box-sizing-collapse-standards.html default-box-sizing-collapse-standards-ref.html # bug 155955, bug 371180
 fails == default-box-sizing-collapse-quirks.html default-box-sizing-collapse-quirks-ref.html # bug 371180
 == colspan-percent-distribution-1.html colspan-percent-distribution-1-ref.html
 == colspan-percent-distribution-2.html colspan-percent-distribution-2-ref.html
+== spanning-cell-sort-1-small.html spanning-cell-sort-1-ref.html
+== spanning-cell-sort-1-large.html spanning-cell-sort-1-ref.html
+== spanning-cell-sort-1-small-fixed.html spanning-cell-sort-1-fixed-ref.html
+== spanning-cell-sort-1-large-fixed.html spanning-cell-sort-1-fixed-ref.html
+== spanning-cell-sort-2-small.html spanning-cell-sort-2-ref.html
+== spanning-cell-sort-2-large.html spanning-cell-sort-2-ref.html
+== spanning-cell-sort-2-small-fixed.html spanning-cell-sort-2-fixed-ref.html
+== spanning-cell-sort-2-large-fixed.html spanning-cell-sort-2-fixed-ref.html
diff --git a/layout/reftests/table-width/spanning-cell-sort-1-fixed-ref.html b/layout/reftests/table-width/spanning-cell-sort-1-fixed-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-width/spanning-cell-sort-1-fixed-ref.html
@@ -0,0 +1,24 @@
+<!DOCTYPE HTML>
+<title>Testcase to exercise nsSpanningCellSorter</title>
+<style type="text/css">
+
+table, td {
+	border-spacing: 0;
+	padding: 0; margin: 0; border: none;
+	empty-cells: show;
+}
+
+td { height: 20px; }
+
+</style>
+
+<table>
+  <tr>
+    <td style="width: 150px; background-color: yellow"></td>
+    <td style="width: 450px; background-color: aqua"></td>
+  </tr>
+  <tr>
+    <td style="background-color: blue"></td>
+    <td style="background-color: blue"></td>
+  </tr>
+</table>
diff --git a/layout/reftests/table-width/spanning-cell-sort-1-large-fixed.html b/layout/reftests/table-width/spanning-cell-sort-1-large-fixed.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-width/spanning-cell-sort-1-large-fixed.html
@@ -0,0 +1,25 @@
+<!DOCTYPE HTML>
+<title>Testcase to exercise nsSpanningCellSorter</title>
+<style type="text/css">
+
+table, td {
+	border-spacing: 0;
+	padding: 0; margin: 0; border: none;
+	empty-cells: show;
+}
+
+td { height: 20px; }
+
+</style>
+
+<table style="width: 600px">
+  <tr>
+    <td style="background-color: yellow" colspan="100"></td>
+    <td style="background-color: aqua" colspan="300"><div style="width: 300px"></div></td>
+  </tr>
+  <tr>
+    <td style="background-color: blue" colspan="200"><div style="width: 200px"></div></td>
+    <td style="background-color: fuchsia" colspan="100"></td>
+    <td style="background-color: maroon" colspan="100"></td>
+  </tr>
+</table>
diff --git a/layout/reftests/table-width/spanning-cell-sort-1-large.html b/layout/reftests/table-width/spanning-cell-sort-1-large.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-width/spanning-cell-sort-1-large.html
@@ -0,0 +1,25 @@
+<!DOCTYPE HTML>
+<title>Testcase to exercise nsSpanningCellSorter</title>
+<style type="text/css">
+
+table, td {
+	border-spacing: 0;
+	padding: 0; margin: 0; border: none;
+	empty-cells: show;
+}
+
+td { height: 20px; }
+
+</style>
+
+<table>
+  <tr>
+    <td style="background-color: yellow" colspan="4"></td>
+    <td style="background-color: aqua" colspan="12"><div style="width: 300px"></div></td>
+  </tr>
+  <tr>
+    <td style="background-color: blue" colspan="8"><div style="width: 200px"></div></td>
+    <td style="background-color: fuchsia" colspan="4"></td>
+    <td style="background-color: maroon" colspan="4"></td>
+  </tr>
+</table>
diff --git a/layout/reftests/table-width/spanning-cell-sort-1-ref.html b/layout/reftests/table-width/spanning-cell-sort-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-width/spanning-cell-sort-1-ref.html
@@ -0,0 +1,24 @@
+<!DOCTYPE HTML>
+<title>Testcase to exercise nsSpanningCellSorter</title>
+<style type="text/css">
+
+table, td {
+	border-spacing: 0;
+	padding: 0; margin: 0; border: none;
+	empty-cells: show;
+}
+
+td { height: 20px; }
+
+</style>
+
+<table>
+  <tr>
+    <td style="width: 100px; background-color: yellow"></td>
+    <td style="width: 300px; background-color: aqua"></td>
+  </tr>
+  <tr>
+    <td style="background-color: blue"></td>
+    <td style="background-color: blue"></td>
+  </tr>
+</table>
diff --git a/layout/reftests/table-width/spanning-cell-sort-1-small-fixed.html b/layout/reftests/table-width/spanning-cell-sort-1-small-fixed.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-width/spanning-cell-sort-1-small-fixed.html
@@ -0,0 +1,25 @@
+<!DOCTYPE HTML>
+<title>Testcase to exercise nsSpanningCellSorter</title>
+<style type="text/css">
+
+table, td {
+	border-spacing: 0;
+	padding: 0; margin: 0; border: none;
+	empty-cells: show;
+}
+
+td { height: 20px; }
+
+</style>
+
+<table style="width: 600px">
+  <tr>
+    <td style="background-color: yellow"></td>
+    <td style="background-color: aqua" colspan="3"><div style="width: 300px"></div></td>
+  </tr>
+  <tr>
+    <td style="background-color: blue" colspan="2"><div style="width: 200px"></div></td>
+    <td style="background-color: fuchsia"></td>
+    <td style="background-color: maroon"></td>
+  </tr>
+</table>
diff --git a/layout/reftests/table-width/spanning-cell-sort-1-small.html b/layout/reftests/table-width/spanning-cell-sort-1-small.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-width/spanning-cell-sort-1-small.html
@@ -0,0 +1,25 @@
+<!DOCTYPE HTML>
+<title>Testcase to exercise nsSpanningCellSorter</title>
+<style type="text/css">
+
+table, td {
+	border-spacing: 0;
+	padding: 0; margin: 0; border: none;
+	empty-cells: show;
+}
+
+td { height: 20px; }
+
+</style>
+
+<table>
+  <tr>
+    <td style="background-color: yellow"></td>
+    <td style="background-color: aqua" colspan="3"><div style="width: 300px"></div></td>
+  </tr>
+  <tr>
+    <td style="background-color: blue" colspan="2"><div style="width: 200px"></div></td>
+    <td style="background-color: fuchsia"></td>
+    <td style="background-color: maroon"></td>
+  </tr>
+</table>
diff --git a/layout/reftests/table-width/spanning-cell-sort-2-fixed-ref.html b/layout/reftests/table-width/spanning-cell-sort-2-fixed-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-width/spanning-cell-sort-2-fixed-ref.html
@@ -0,0 +1,24 @@
+<!DOCTYPE HTML>
+<title>Testcase to exercise nsSpanningCellSorter</title>
+<style type="text/css">
+
+table, td {
+	border-spacing: 0;
+	padding: 0; margin: 0; border: none;
+	empty-cells: show;
+}
+
+td { height: 20px; }
+
+</style>
+
+<table>
+  <tr>
+    <td style="background-color: blue"></td>
+    <td style="background-color: blue"></td>
+  </tr>
+  <tr>
+    <td style="width: 150px; background-color: yellow"></td>
+    <td style="width: 450px; background-color: aqua"></td>
+  </tr>
+</table>
diff --git a/layout/reftests/table-width/spanning-cell-sort-2-large-fixed.html b/layout/reftests/table-width/spanning-cell-sort-2-large-fixed.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-width/spanning-cell-sort-2-large-fixed.html
@@ -0,0 +1,25 @@
+<!DOCTYPE HTML>
+<title>Testcase to exercise nsSpanningCellSorter</title>
+<style type="text/css">
+
+table, td {
+	border-spacing: 0;
+	padding: 0; margin: 0; border: none;
+	empty-cells: show;
+}
+
+td { height: 20px; }
+
+</style>
+
+<table style="width: 600px">
+  <tr>
+    <td style="background-color: blue" colspan="20"><div style="width: 200px"></div></td>
+    <td style="background-color: fuchsia" colspan="10"></td>
+    <td style="background-color: maroon" colspan="10"></td>
+  </tr>
+  <tr>
+    <td style="background-color: yellow" colspan="10"></td>
+    <td style="background-color: aqua" colspan="30"><div style="width: 300px"></div></td>
+  </tr>
+</table>
diff --git a/layout/reftests/table-width/spanning-cell-sort-2-large.html b/layout/reftests/table-width/spanning-cell-sort-2-large.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-width/spanning-cell-sort-2-large.html
@@ -0,0 +1,25 @@
+<!DOCTYPE HTML>
+<title>Testcase to exercise nsSpanningCellSorter</title>
+<style type="text/css">
+
+table, td {
+	border-spacing: 0;
+	padding: 0; margin: 0; border: none;
+	empty-cells: show;
+}
+
+td { height: 20px; }
+
+</style>
+
+<table>
+  <tr>
+    <td style="background-color: blue" colspan="40"><div style="width: 200px"></div></td>
+    <td style="background-color: fuchsia" colspan="20"></td>
+    <td style="background-color: maroon" colspan="20"></td>
+  </tr>
+  <tr>
+    <td style="background-color: yellow" colspan="20"></td>
+    <td style="background-color: aqua" colspan="60"><div style="width: 300px"></div></td>
+  </tr>
+</table>
diff --git a/layout/reftests/table-width/spanning-cell-sort-2-ref.html b/layout/reftests/table-width/spanning-cell-sort-2-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-width/spanning-cell-sort-2-ref.html
@@ -0,0 +1,24 @@
+<!DOCTYPE HTML>
+<title>Testcase to exercise nsSpanningCellSorter</title>
+<style type="text/css">
+
+table, td {
+	border-spacing: 0;
+	padding: 0; margin: 0; border: none;
+	empty-cells: show;
+}
+
+td { height: 20px; }
+
+</style>
+
+<table>
+  <tr>
+    <td style="background-color: blue"></td>
+    <td style="background-color: blue"></td>
+  </tr>
+  <tr>
+    <td style="width: 100px; background-color: yellow"></td>
+    <td style="width: 300px; background-color: aqua"></td>
+  </tr>
+</table>
diff --git a/layout/reftests/table-width/spanning-cell-sort-2-small-fixed.html b/layout/reftests/table-width/spanning-cell-sort-2-small-fixed.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-width/spanning-cell-sort-2-small-fixed.html
@@ -0,0 +1,25 @@
+<!DOCTYPE HTML>
+<title>Testcase to exercise nsSpanningCellSorter</title>
+<style type="text/css">
+
+table, td {
+	border-spacing: 0;
+	padding: 0; margin: 0; border: none;
+	empty-cells: show;
+}
+
+td { height: 20px; }
+
+</style>
+
+<table style="width: 600px">
+  <tr>
+    <td style="background-color: blue" colspan="2"><div style="width: 200px"></div></td>
+    <td style="background-color: fuchsia"></td>
+    <td style="background-color: maroon"></td>
+  </tr>
+  <tr>
+    <td style="background-color: yellow"></td>
+    <td style="background-color: aqua" colspan="3"><div style="width: 300px"></div></td>
+  </tr>
+</table>
diff --git a/layout/reftests/table-width/spanning-cell-sort-2-small.html b/layout/reftests/table-width/spanning-cell-sort-2-small.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-width/spanning-cell-sort-2-small.html
@@ -0,0 +1,25 @@
+<!DOCTYPE HTML>
+<title>Testcase to exercise nsSpanningCellSorter</title>
+<style type="text/css">
+
+table, td {
+	border-spacing: 0;
+	padding: 0; margin: 0; border: none;
+	empty-cells: show;
+}
+
+td { height: 20px; }
+
+</style>
+
+<table>
+  <tr>
+    <td style="background-color: blue" colspan="2"><div style="width: 200px"></div></td>
+    <td style="background-color: fuchsia"></td>
+    <td style="background-color: maroon"></td>
+  </tr>
+  <tr>
+    <td style="background-color: yellow"></td>
+    <td style="background-color: aqua" colspan="3"><div style="width: 300px"></div></td>
+  </tr>
+</table>
