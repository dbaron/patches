From: L. David Baron <dbaron@dbaron.org>

Make nsMenuFrame::SizeToPopup consider its own border/padding properly, by increasing the popup's content's width by the larger of its own border/padding or the popup's scrollbar, rather than only the latter.  (Bug 623922)  r=enndeakin

diff --git a/layout/xul/base/src/nsMenuFrame.cpp b/layout/xul/base/src/nsMenuFrame.cpp
--- a/layout/xul/base/src/nsMenuFrame.cpp
+++ b/layout/xul/base/src/nsMenuFrame.cpp
@@ -1370,24 +1370,37 @@ nsMenuFrame::SizeToPopup(nsBoxLayoutStat
   if (!IsCollapsed(aState)) {
     PRBool widthSet, heightSet;
     nsSize tmpSize(-1, 0);
     nsIBox::AddCSSPrefSize(this, tmpSize, widthSet, heightSet);
     if (!widthSet && GetFlex(aState) == 0) {
       if (!mPopupFrame)
         return PR_FALSE;
       tmpSize = mPopupFrame->GetPrefSize(aState);
-      aSize.width = tmpSize.width;
+
+      // Produce a size such that:
+      //  (1) the menu and its popup can be the same width
+      //  (2) there's enough room in the menu for the content and its
+      //      border-padding
+      //  (3) there's enough room in the popup for the content and its
+      //      scrollbar
+      nsMargin borderPadding;
+      GetBorderAndPadding(borderPadding);
 
       // if there is a scroll frame, add the desired width of the scrollbar as well
       nsIScrollableFrame* scrollFrame = do_QueryFrame(mPopupFrame->GetFirstChild(nsnull));
+      nscoord scrollbarWidth = 0;
       if (scrollFrame) {
-        aSize.width += scrollFrame->GetDesiredScrollbarSizes(&aState).LeftRight();
+        scrollbarWidth =
+          scrollFrame->GetDesiredScrollbarSizes(&aState).LeftRight();
       }
 
+      aSize.width =
+        tmpSize.width + NS_MAX(borderPadding.LeftRight(), scrollbarWidth);
+
       return PR_TRUE;
     }
   }
 
   return PR_FALSE;
 }
 
 nsSize
