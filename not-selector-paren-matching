From: L. David Baron <dbaron@dbaron.org>

Correct parenthesis-matching inside of :not().

diff --git a/layout/style/nsCSSParser.cpp b/layout/style/nsCSSParser.cpp
--- a/layout/style/nsCSSParser.cpp
+++ b/layout/style/nsCSSParser.cpp
@@ -3332,21 +3332,23 @@ CSSParserImpl::ParseNegatedSimpleSelecto
     parsingStatus = ParseAttributeSelector(aDataMask, *newSel);
   }
   else {
     // then it should be a type element or universal selector
     parsingStatus = ParseTypeOrUniversalSelector(aDataMask, *newSel, PR_TRUE);
   }
   if (eSelectorParsingStatus_Error == parsingStatus) {
     REPORT_UNEXPECTED_TOKEN(PENegationBadInner);
+    SkipUntil(')');
     return parsingStatus;
   }
   // close the parenthesis
   if (!ExpectSymbol(')', PR_TRUE)) {
     REPORT_UNEXPECTED_TOKEN(PENegationNoClose);
+    SkipUntil(')');
     return eSelectorParsingStatus_Error;
   }
 
   NS_ASSERTION(newSel->mNameSpace == kNameSpaceID_Unknown ||
                (!newSel->mIDList && !newSel->mClassList &&
                 !newSel->mPseudoClassList && !newSel->mAttrList),
                "Need to fix the serialization code to deal with this");
 
