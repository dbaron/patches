From: L. David Baron <dbaron@dbaron.org>

Propagate whether we have a relevant link out of selector matching.  (Bug 147777)

diff --git a/layout/style/nsCSSRuleProcessor.cpp b/layout/style/nsCSSRuleProcessor.cpp
--- a/layout/style/nsCSSRuleProcessor.cpp
+++ b/layout/style/nsCSSRuleProcessor.cpp
@@ -1214,18 +1214,23 @@ RuleProcessorData::GetNthIndex(PRBool aI
  * has input to the matching.)
  */
 struct MatchContext {
   // Is this matching operation for the creation of a style context?
   // (If it is, we need to set slow selector bits on nodes indicating
   // that certain restyling needs to happen.)
   const PRBool mForStyling;
 
+  // Did this matching operation find a relevant link?  (If so, we'll
+  // need to construct a StyleIfVisited().)
+  PRBool mHaveRelevantLink;
+
   MatchContext(PRBool aForStyling)
     : mForStyling(aForStyling)
+    , mHaveRelevantLink(PR_FALSE)
   {
   }
 };
 
 static PRBool ValueIncludes(const nsSubstring& aValueList,
                             const nsSubstring& aValue,
                             const nsStringComparator& aComparator)
 {
