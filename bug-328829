Make things inside foreignObject reflow in response to style changes that cause reflow.  b=328829

diff -r 032fc5f14c9b layout/svg/base/src/nsSVGForeignObjectFrame.cpp
--- a/layout/svg/base/src/nsSVGForeignObjectFrame.cpp	Sun Jan 28 09:21:05 2007 -0800
+++ b/layout/svg/base/src/nsSVGForeignObjectFrame.cpp	Sun Jan 28 09:21:25 2007 -0800
@@ -144,6 +144,31 @@ nsSVGForeignObjectFrame::DidSetStyleCont
   return NS_OK;
 }
 
+/* virtual */ void
+nsSVGForeignObjectFrame::MarkIntrinsicWidthsDirty()
+{
+  if (GetStateBits() & NS_FRAME_FIRST_REFLOW)
+    // If we haven't had an InitialUpdate yet, nothing to do.
+    return;
+
+  // Use the fact that we get a MarkIntrinsicWidthsDirty whenever
+  // there's a style change that requires reflow to actually cause that
+  // reflow, since the SVG outer frame doesn't know to reflow us.
+  nsIFrame* kid = GetFirstChild(nsnull);
+  if (!kid)
+    return;
+  // Since we don't know whether this is because of a style change on an
+  // ancestor or descendant, mark the kid dirty.  If it's a descendant,
+  // all we need is the NS_FRAME_IS_DIRTY_CHILDREN that our caller is
+  // going to set, though.
+  kid->AddStateBits(NS_FRAME_IS_DIRTY);
+  // This is really a style change, except we're already being called
+  // from MarkIntrinsicWidthsDirty, so say it's a resize to avoid doing
+  // the same work over again.
+  GetPresContext()->PresShell()->FrameNeedsReflow(kid,
+                                                  nsIPresShell::eResize);
+}
+
 NS_IMETHODIMP
 nsSVGForeignObjectFrame::Reflow(nsPresContext*           aPresContext,
                                 nsHTMLReflowMetrics&     aDesiredSize,
diff -r 032fc5f14c9b layout/svg/base/src/nsSVGForeignObjectFrame.h
--- a/layout/svg/base/src/nsSVGForeignObjectFrame.h	Sun Jan 28 09:21:05 2007 -0800
+++ b/layout/svg/base/src/nsSVGForeignObjectFrame.h	Sun Jan 28 09:21:25 2007 -0800
@@ -78,6 +78,7 @@ public:
   }
 
   NS_IMETHOD DidSetStyleContext();
+  virtual void MarkIntrinsicWidthsDirty();
 
   NS_IMETHOD Reflow(nsPresContext*           aPresContext,
                     nsHTMLReflowMetrics&     aDesiredSize,
diff -r 032fc5f14c9b layout/svg/base/src/nsSVGOuterSVGFrame.cpp
--- a/layout/svg/base/src/nsSVGOuterSVGFrame.cpp	Sun Jan 28 09:21:05 2007 -0800
+++ b/layout/svg/base/src/nsSVGOuterSVGFrame.cpp	Sun Jan 28 09:21:25 2007 -0800
@@ -228,10 +228,6 @@ nsSVGOuterSVGFrame::Reflow(nsPresContext
     // This means that something happened to one of our descendants
     // (excluding those inside svg:foreignObject, since
     // nsSVGForeignObjectFrame is a reflow root).
-
-    // XXXldb If this incremental reflow was the result of a style
-    // change to something that *contains* a foreignObject, then we're
-    // dropping the change completely on the floor!
     aStatus = NS_FRAME_COMPLETE;
     return NS_OK;
   }
