Make plugin placeholders inline-block.  b=367247  r+sr=bzbarsky

diff -r 6e9c23cb2950 layout/base/nsCSSFrameConstructor.cpp
--- a/layout/base/nsCSSFrameConstructor.cpp	Sat Jan 27 10:19:26 2007 -0800
+++ b/layout/base/nsCSSFrameConstructor.cpp	Sat Jan 27 10:21:21 2007 -0800
@@ -6392,9 +6392,7 @@ nsCSSFrameConstructor::ConstructFrameByD
   // If the frame is a block-level frame and is scrollable, then wrap it
   // in a scroll frame.
   // XXX Ignore tables for the time being
-  if (aDisplay->IsBlockLevel() &&
-      aDisplay->mDisplay != NS_STYLE_DISPLAY_TABLE &&
-      aDisplay->mDisplay != NS_STYLE_DISPLAY_INLINE_TABLE &&
+  if (aDisplay->IsBlockInside() &&
       aDisplay->IsScrollableOverflow() &&
       !propagatedScrollToViewport) {
 
diff -r 6e9c23cb2950 layout/generic/nsFrame.cpp
--- a/layout/generic/nsFrame.cpp	Sat Jan 27 10:19:26 2007 -0800
+++ b/layout/generic/nsFrame.cpp	Sat Jan 27 10:24:25 2007 -0800
@@ -3766,17 +3766,9 @@ nsFrame::IsFrameTreeTooDeep(const nsHTML
   return PR_FALSE;
 }
 
-// Style sizing methods
 /* virtual */ PRBool nsFrame::IsContainingBlock() const
 {
-  const nsStyleDisplay* display = GetStyleDisplay();
-
-  // Absolute positioning causes |display->mDisplay| to be set to block,
-  // if needed.
-  return display->mDisplay == NS_STYLE_DISPLAY_BLOCK || 
-         display->mDisplay == NS_STYLE_DISPLAY_INLINE_BLOCK || 
-         display->mDisplay == NS_STYLE_DISPLAY_LIST_ITEM ||
-         display->mDisplay == NS_STYLE_DISPLAY_TABLE_CELL;
+  return PR_FALSE;
 }
 
 #ifdef NS_DEBUG
diff -r 6e9c23cb2950 layout/style/nsStyleStruct.h
--- a/layout/style/nsStyleStruct.h	Sat Jan 27 10:19:26 2007 -0800
+++ b/layout/style/nsStyleStruct.h	Sat Jan 27 10:22:45 2007 -0800
@@ -785,9 +785,38 @@ struct nsStyleDisplay : public nsStyleSt
   PRUint8 mOverflowY;           // [reset] see nsStyleConsts.h
   PRUint8   mClipFlags;         // [reset] see nsStyleConsts.h
   
-  PRBool IsBlockLevel() const {return (NS_STYLE_DISPLAY_BLOCK == mDisplay) ||
-                                      (NS_STYLE_DISPLAY_LIST_ITEM == mDisplay) ||
-                                      (NS_STYLE_DISPLAY_TABLE == mDisplay);}
+  // XXX Deprecated.  Prefer |IsBlockOutside|.
+  PRBool IsBlockLevel() const {
+    return IsBlockOutside();
+  }
+
+  PRBool IsBlockInside() const {
+    return NS_STYLE_DISPLAY_BLOCK == mDisplay ||
+           NS_STYLE_DISPLAY_LIST_ITEM == mDisplay ||
+           NS_STYLE_DISPLAY_INLINE_BLOCK == mDisplay;
+    // Should TABLE_CELL and TABLE_CAPTION go here?  They have
+    // block frames nested inside of them.
+    // (But please audit all callers before changing.)
+  }
+
+  PRBool IsBlockOutside() const {
+    return NS_STYLE_DISPLAY_BLOCK == mDisplay ||
+           NS_STYLE_DISPLAY_LIST_ITEM == mDisplay ||
+           NS_STYLE_DISPLAY_TABLE == mDisplay;
+  }
+
+  PRBool IsInlineOutside() const {
+    return NS_STYLE_DISPLAY_INLINE == mDisplay ||
+           NS_STYLE_DISPLAY_INLINE_BLOCK == mDisplay ||
+           NS_STYLE_DISPLAY_INLINE_TABLE == mDisplay ||
+           NS_STYLE_DISPLAY_INLINE_BOX == mDisplay ||
+           NS_STYLE_DISPLAY_INLINE_GRID == mDisplay ||
+           NS_STYLE_DISPLAY_INLINE_STACK == mDisplay ||
+           // Are these really inlines? :
+           NS_STYLE_DISPLAY_DECK == mDisplay ||
+           NS_STYLE_DISPLAY_POPUP == mDisplay ||
+           NS_STYLE_DISPLAY_GROUPBOX == mDisplay;
+  }
 
   PRBool IsFloating() const {
     return NS_STYLE_FLOAT_NONE != mFloats;
diff -r 6e9c23cb2950 layout/tables/nsTableCellFrame.cpp
--- a/layout/tables/nsTableCellFrame.cpp	Sat Jan 27 10:19:26 2007 -0800
+++ b/layout/tables/nsTableCellFrame.cpp	Sat Jan 27 10:25:11 2007 -0800
@@ -964,6 +964,12 @@ nsTableCellFrame::GetType() const
   return nsGkAtoms::tableCellFrame;
 }
 
+/* virtual */ PRBool
+nsTableCellFrame::IsContainingBlock() const
+{
+  return PR_TRUE;
+}
+
 #ifdef DEBUG
 NS_IMETHODIMP
 nsTableCellFrame::GetFrameName(nsAString& aResult) const
diff -r 6e9c23cb2950 layout/tables/nsTableCellFrame.h
--- a/layout/tables/nsTableCellFrame.h	Sat Jan 27 10:19:26 2007 -0800
+++ b/layout/tables/nsTableCellFrame.h	Sat Jan 27 10:24:43 2007 -0800
@@ -148,6 +148,8 @@ public:
    */
   virtual nsIAtom* GetType() const;
 
+  virtual PRBool IsContainingBlock() const;
+
 #ifdef DEBUG
   NS_IMETHOD GetFrameName(nsAString& aResult) const;
 #endif
diff -r 6e9c23cb2950 toolkit/themes/pinstripe/mozapps/plugins/missingPlugin.css
--- a/toolkit/themes/pinstripe/mozapps/plugins/missingPlugin.css	Sat Jan 27 10:19:26 2007 -0800
+++ b/toolkit/themes/pinstripe/mozapps/plugins/missingPlugin.css	Sat Jan 27 10:21:21 2007 -0800
@@ -14,8 +14,10 @@ html|applet > *|* {
 
 html|a {
   text-align: -moz-center;
-  overflow: -moz-hidden-unscrollable;
-  display: block;
+  overflow: hidden;
+  display: inline-block;
+  /* overflow:hidden makes baseline vertical-alignment act like plugins */
+  vertical-align: inherit;
   border: 1px outset;
   padding: 5px;
   font-size: 12px;
diff -r 6e9c23cb2950 toolkit/themes/winstripe/mozapps/plugins/missingPlugin.css
--- a/toolkit/themes/winstripe/mozapps/plugins/missingPlugin.css	Sat Jan 27 10:19:26 2007 -0800
+++ b/toolkit/themes/winstripe/mozapps/plugins/missingPlugin.css	Sat Jan 27 10:21:21 2007 -0800
@@ -14,8 +14,10 @@ html|applet > *|* {
 
 html|a {
   text-align: -moz-center;
-  overflow: -moz-hidden-unscrollable;
-  display: block;
+  overflow: hidden;
+  display: inline-block;
+  /* overflow:hidden makes baseline vertical-alignment act like plugins */
+  vertical-align: inherit;
   border: 1px outset;
   padding: 5px;
   font-size: 12px;
