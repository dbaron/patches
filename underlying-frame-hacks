From: L. David Baron <dbaron@dbaron.org>

Horrible hacks to deal with things that want an underlying frame.  (Bug 485501)

diff --git a/layout/base/FrameLayerBuilder.cpp b/layout/base/FrameLayerBuilder.cpp
--- a/layout/base/FrameLayerBuilder.cpp
+++ b/layout/base/FrameLayerBuilder.cpp
@@ -972,17 +972,26 @@ ContainerState::ProcessDisplayItems(cons
     } else {
       nsRefPtr<BasicLayerManager> tempLayerManager;
       if (layerState == LAYER_INACTIVE) {
         tempLayerManager = BuildTempManagerForInactiveLayer(mBuilder, item);
         if (!tempLayerManager)
           continue;
       }
 
-      nsIFrame* f = item->GetUnderlyingFrame();
+      nsIFrame* f;
+      for (nsDisplayItem *i = item;;) {
+        f = i->GetUnderlyingFrame();
+        if (f)
+          break;
+        NS_ABORT_IF_FALSE(i->GetType() ==
+                            nsDisplayItem::TYPE_CLIP_BORDER_RADIUS,
+                          "unexpected type");
+        i = i->GetList()->GetTop();
+      }
       nsIFrame* activeScrolledRoot =
         nsLayoutUtils::GetActiveScrolledRootFor(f, mBuilder->ReferenceFrame());
       if (item->IsFixedAndCoveringViewport(mBuilder)) {
         // Make its active scrolled root be the active scrolled root of
         // the enclosing viewport, since it shouldn't be scrolled by scrolled
         // frames in its document. InvalidateFixedBackgroundFramesFromList in
         // nsGfxScrollFrame will not repaint this item when scrolling occurs.
         nsIFrame* viewportFrame =
