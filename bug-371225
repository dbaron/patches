Snap edges to pixels rather than sizes.  b=371225

diff -r 4178ce0c8b3e gfx/src/thebes/nsThebesRenderingContext.cpp
--- a/gfx/src/thebes/nsThebesRenderingContext.cpp	Thu Feb 22 16:16:00 2007 -0800
+++ b/gfx/src/thebes/nsThebesRenderingContext.cpp	Thu Feb 22 21:31:02 2007 -0800
@@ -994,18 +994,19 @@ nsThebesRenderingContext::DrawImage(imgI
     // and has nothing to do with the current transform (it's a region
     // of the image)
     double p2a = nsIDeviceContext::AppUnitsPerCSSPixel();
-    nsIntRect pxSr(NSAppUnitsToIntPixels(twSrcRect.x, p2a),
-                   NSAppUnitsToIntPixels(twSrcRect.y, p2a),
-                   NSAppUnitsToIntPixels(twSrcRect.width, p2a),
-                   NSAppUnitsToIntPixels(twSrcRect.height, p2a));
+    nsIntRect pxSr;
+    pxSr.x = NSAppUnitsToIntPixels(twSrcRect.x, p2a);
+    pxSr.y = NSAppUnitsToIntPixels(twSrcRect.y, p2a);
+    pxSr.width = NSAppUnitsToIntPixels(twSrcRect.XMost(), p2a) - pxSr.x;
+    pxSr.height = NSAppUnitsToIntPixels(twSrcRect.YMost(), p2a) - pxSr.y;
 
     // the dest rect is affected by the current transform; that'll be
     // handled by Image::Draw(), when we actually set up the rectangle.
     nsIntRect pxDr;
-    pxDr.x = NSToIntRound(FROM_TWIPS(twDestRect.x));
-    pxDr.y = NSToIntRound(FROM_TWIPS(twDestRect.y));
-    pxDr.width = NSToIntRound(FROM_TWIPS(twDestRect.width));
-    pxDr.height = NSToIntRound(FROM_TWIPS(twDestRect.height));
+    pxDr.x = FROM_TWIPS_INT(twDestRect.x);
+    pxDr.y = FROM_TWIPS_INT(twDestRect.y);
+    pxDr.width = FROM_TWIPS_INT(twDestRect.XMost()) - pxDr.x;
+    pxDr.height = FROM_TWIPS_INT(twDestRect.YMost()) - pxDr.y;
 
     // If we were asked to draw a 0-width or 0-height image,
     // as either the src or dst, just bail; we can't do anything
diff -r 4178ce0c8b3e layout/reftests/pixel-rounding/reftest.list
--- a/layout/reftests/pixel-rounding/reftest.list	Thu Feb 22 16:16:00 2007 -0800
+++ b/layout/reftests/pixel-rounding/reftest.list	Thu Feb 22 22:11:34 2007 -0800
@@ -52,7 +52,7 @@ fails-if(MOZ_WIDGET_TOOLKIT=="cocoa") ==
 
 != background-image-base.html background-image-height-10-ref.html
 == background-image-height-4.html background-image-base.html
-fails-if(MOZ_WIDGET_TOOLKIT!="cocoa") == background-image-height-5.html background-image-height-10-ref.html # bug 371225
+random == background-image-height-5.html background-image-height-10-ref.html # bug 371316
 == background-image-height-6.html background-image-height-10-ref.html
 != background-image-base.html background-image-top-10-ref.html
 == background-image-top-4.html background-image-base.html
@@ -60,27 +60,24 @@ fails-if(MOZ_WIDGET_TOOLKIT!="cocoa") ==
 == background-image-top-6.html background-image-top-10-ref.html
 != background-image-base.html background-image-width-10-ref.html
 == background-image-width-4.html background-image-base.html
-fails-if(MOZ_WIDGET_TOOLKIT!="cocoa") == background-image-width-5.html background-image-width-10-ref.html # bug 371225
+random == background-image-width-5.html background-image-width-10-ref.html # bug 371316
 == background-image-width-6.html background-image-width-10-ref.html
 != background-image-base.html background-image-left-10-ref.html
 == background-image-left-4.html background-image-base.html
 == background-image-left-5.html background-image-left-10-ref.html
 == background-image-left-6.html background-image-left-10-ref.html
-# These tests have different patterns of failures on different
-# platforms.  It doesn't make sense yet, but once bug 371225 is fixed
-# they might make more sense.
-random == background-image-top-height-4.html background-image-height-4.html
-random == background-image-top-height-5.html background-image-height-5.html
-random == background-image-top-height-6.html background-image-height-6.html
-random == background-image-left-width-4.html background-image-width-4.html
-random == background-image-left-width-5.html background-image-width-5.html
-random == background-image-left-width-6.html background-image-width-6.html
-random == background-image-height-top-4.html background-image-height-4.html
-random == background-image-height-top-5.html background-image-height-5.html
-random == background-image-height-top-6.html background-image-height-6.html
-random == background-image-width-left-4.html background-image-width-4.html
-random == background-image-width-left-5.html background-image-width-5.html
-random == background-image-width-left-6.html background-image-width-6.html
+== background-image-top-height-4.html background-image-height-4.html
+== background-image-top-height-5.html background-image-height-5.html
+== background-image-top-height-6.html background-image-height-6.html
+== background-image-left-width-4.html background-image-width-4.html
+== background-image-left-width-5.html background-image-width-5.html
+== background-image-left-width-6.html background-image-width-6.html
+== background-image-height-top-4.html background-image-height-4.html
+random == background-image-height-top-5.html background-image-height-5.html # bug 371316
+== background-image-height-top-6.html background-image-height-6.html
+== background-image-width-left-4.html background-image-width-4.html
+random == background-image-width-left-5.html background-image-width-5.html # bug 371316
+== background-image-width-left-6.html background-image-width-6.html
 
 
 # These all fail due to any of bug 371182, bug 155955, and maybe also
