From: L. David Baron <dbaron@dbaron.org>

Bug 404077:  Do GC in a small number of tests to reduce the spread of GC-related assertions.

If this is needed in further mochitests, I'd like to take your review+
as covering those as well.

diff --git a/content/base/test/test_mutationobservers.html b/content/base/test/test_mutationobservers.html
--- a/content/base/test/test_mutationobservers.html
+++ b/content/base/test/test_mutationobservers.html
@@ -78,16 +78,21 @@ if (!("SimpleTest" in window)) {
   }
 }
 
 function then(thenFn) {
   setTimeout(function() {
     if (thenFn) {
       setTimeout(thenFn, 0);
     } else {
+      // Garbage collecting the windows created in this test can cause
+      // assertions, so GC now to blame those assertions to this test.
+      // ("mArguments wasn't cleaned up properly!" in ~nsGlobalWindow)
+      SpecialPowers.gc();
+
       SimpleTest.finish();
     }
   }, 0);
 }
 
 var m;
 var m2;
 var m3;
diff --git a/dom/tests/mochitest/bugs/test_bug291653.html b/dom/tests/mochitest/bugs/test_bug291653.html
--- a/dom/tests/mochitest/bugs/test_bug291653.html
+++ b/dom/tests/mochitest/bugs/test_bug291653.html
@@ -30,16 +30,22 @@ var w = window.open("file_bug291653.html
 
 function closeTest() {
   w.setTimeout("close()", 0);
   setTimeout("finish()", 500);
 }
 
 function finish() {
   ok(!secondListenerDidRun, "Shouldn't have run second listener!");
+
+  // Garbage collecting the windows created in this test can cause
+  // assertions, so GC now to blame those assertions to this test.
+  // ("mArguments wasn't cleaned up properly!" in ~nsGlobalWindow)
+  SpecialPowers.gc();
+
   SimpleTest.finish();
 }
 
 function end() {
   setTimeout("closeTest()", 500);
 }
 
 
