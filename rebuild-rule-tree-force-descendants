From: L. David Baron <dbaron@dbaron.org>

Bug 1060194 - Use eRestyle_ForceDescendants when rebuilding rule tree.

When we're rebuilding the rule tree, we need to create new style
contexts for all frames.  This seems as good a place to ensure that as
any, I think.

This is a regression from bug 931668.

diff --git a/layout/base/RestyleManager.cpp b/layout/base/RestyleManager.cpp
--- a/layout/base/RestyleManager.cpp
+++ b/layout/base/RestyleManager.cpp
@@ -1515,17 +1515,18 @@ RestyleManager::DoRebuildAllStyleData(Re
   // XXX This could be made faster by not rerunning rule matching
   // (but note that nsPresShell::SetPreferenceStyleRules currently depends
   // on us re-running rule matching here
   // XXX Does it matter that we're passing aExtraHint to the real root
   // frame and not the root node's primary frame?  (We could do
   // roughly what we do for aRestyleHint above.)
   // Note: The restyle tracker we pass in here doesn't matter.
   ComputeAndProcessStyleChange(mPresContext->PresShell()->GetRootFrame(),
-                               aExtraHint, aRestyleTracker, aRestyleHint);
+                               aExtraHint, aRestyleTracker,
+                               aRestyleHint | eRestyle_ForceDescendants);
   FlushOverflowChangedTracker();
 
   // Tell the style set it's safe to destroy the old rule tree.  We
   // must do this after the ProcessRestyledFrames call in case the
   // change list has frame reconstructs in it (since frames to be
   // reconstructed will still have their old style context pointers
   // until they are destroyed).
   mPresContext->StyleSet()->EndReconstruct();
