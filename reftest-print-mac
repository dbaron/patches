From: L. David Baron <dbaron@dbaron.org>

reftest-print assertion workaround needs to expect three assertions for every reftest-print test on Mac.  (Bug 472557)

diff --git a/layout/tools/reftest/reftest.js b/layout/tools/reftest/reftest.js
--- a/layout/tools/reftest/reftest.js
+++ b/layout/tools/reftest/reftest.js
@@ -697,18 +697,21 @@ function OnDocumentLoad(event)
        ps.footerStrCenter = "";
        ps.footerStrRight = "";
        gBrowser.docShell.contentViewer.setPageMode(true, ps);
 
        // WORKAROUND FOR ASSERTIONS IN BUG 534478:  Calling setPageMode
        // above causes 2 assertions.  So that we don't have to annotate
        // the manifests for every reftest-print reftest, bump the
        // assertion count by two right here.
-       gURLs[0].minAsserts += 2;
-       gURLs[0].maxAsserts += 2;
+       // And on Mac, it causes *three* assertions.
+       var xr = CC[NS_XREAPPINFO_CONTRACTID].getService(CI.nsIXULRuntime);
+       var count = (xr.widgetToolkit == "cocoa") ? 3 : 2;
+       gURLs[0].minAsserts += count;
+       gURLs[0].maxAsserts += count;
     }
 
     setupZoom(contentRootElement);
 
     if (shouldWait()) {
         // The testcase will let us know when the test snapshot should be made.
         // Register a mutation listener to know when the 'reftest-wait' class
         // gets removed.
