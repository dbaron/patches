From: L. David Baron <dbaron@dbaron.org>

Add reftest for bug 676538 (text-decoration offsets on block, child inline, and grandchild inline).

diff --git a/layout/reftests/text-decoration/676538-1-ref.html b/layout/reftests/text-decoration/676538-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/text-decoration/676538-1-ref.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html>
+<html lang="en-US">
+<head>
+<title>text-decoration alignment</title>
+<meta charset=UTF-8>
+<style>
+
+span.block { position: absolute; top: 0; left: 0; }
+span.dec { text-decoration: underline }
+span.hide { color: transparent }
+
+</style>
+</head>
+<body>
+
+<p style="position: relative">
+  <span class="block" style="margin-top: 16px"><span class="hide"></span><span class="dec" style="color:black  ">x<span class="hide">xx</span></span></span>
+  <span class="block" style="margin-top: 08px"><span class="hide">x</span><span class="dec" style="color:fuchsia">x<span class="hide">x</span></span></span>
+  <span class="block" style="margin-top: 00px"><span class="hide">xx</span><span class="dec" style="color:aqua   ">x<span class="hide"></span></span></span>
+</p>
+
+</body>
+</html>
diff --git a/layout/reftests/text-decoration/676538-1.html b/layout/reftests/text-decoration/676538-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/text-decoration/676538-1.html
@@ -0,0 +1,22 @@
+<!DOCTYPE html>
+<html lang="en-US">
+<head>
+<title>text-decoration alignment</title>
+<meta charset=UTF-8>
+<style>
+
+p, span { text-decoration: underline }
+span { vertical-align: 8px }
+p > span { color: fuchsia }
+p > span > span { color: aqua }
+
+em { font-style: normal; font-size: 5em }
+
+</style>
+</head>
+<body>
+
+<p>x<span>x<span>x</span></span></p>
+
+</body>
+</html>
diff --git a/layout/reftests/text-decoration/reftest.list b/layout/reftests/text-decoration/reftest.list
--- a/layout/reftests/text-decoration/reftest.list
+++ b/layout/reftests/text-decoration/reftest.list
@@ -91,8 +91,9 @@ fails == underline-block-propagation-2-q
 == 641444-1.html 641444-1-ref.html
 == decoration-css21.html decoration-css21-ref.html
 == decoration-color-override-quirks.html decoration-color-override-quirks-ref.html
 == decoration-color-override-standards.html decoration-color-override-standards-ref.html
 != decoration-color-override-standards-ref.html decoration-color-override-quirks-ref.html
 == decoration-css21-block.html decoration-css21-block-ref.html
 != inline-baseline-almost-standards.html inline-baseline-almost-standards-ref.html
 != inline-baseline-quirks.html inline-baseline-quirks-ref.html
+== 676538-1.html 676538-1-ref.html
