Allow the initial value of -moz-user-select to be specified with 'auto'.  b=432888  r+sr=bzbarsky

diff --git a/layout/style/nsCSSParser.cpp b/layout/style/nsCSSParser.cpp
--- a/layout/style/nsCSSParser.cpp
+++ b/layout/style/nsCSSParser.cpp
@@ -5095,17 +5095,17 @@ PRBool CSSParserImpl::ParseSingleValuePr
                         nsCSSProps::kUserFocusKTable);
   case eCSSProperty_user_input:
     return ParseVariant(aErrorCode, aValue, VARIANT_AHK | VARIANT_NONE,
                         nsCSSProps::kUserInputKTable);
   case eCSSProperty_user_modify:
     return ParseVariant(aErrorCode, aValue, VARIANT_HK,
                         nsCSSProps::kUserModifyKTable);
   case eCSSProperty_user_select:
-    return ParseVariant(aErrorCode, aValue, VARIANT_HOK,
+    return ParseVariant(aErrorCode, aValue, VARIANT_AHK | VARIANT_NONE,
                         nsCSSProps::kUserSelectKTable);
   case eCSSProperty_vertical_align:
     return ParseVariant(aErrorCode, aValue, VARIANT_HKLP,
                         nsCSSProps::kVerticalAlignKTable);
   case eCSSProperty_visibility:
     return ParseVariant(aErrorCode, aValue, VARIANT_HK, 
                         nsCSSProps::kVisibilityKTable);
   case eCSSProperty_voice_family:
diff --git a/layout/style/nsRuleNode.cpp b/layout/style/nsRuleNode.cpp
--- a/layout/style/nsRuleNode.cpp
+++ b/layout/style/nsRuleNode.cpp
@@ -2914,18 +2914,18 @@ nsRuleNode::ComputeUIResetData(void* aSt
   }
   else if (eCSSUnit_None == uiData.mUserSelect.GetUnit()) {
     ui->mUserSelect = NS_STYLE_USER_SELECT_NONE;
   }
   else if (eCSSUnit_Inherit == uiData.mUserSelect.GetUnit()) {
     inherited = PR_TRUE;
     ui->mUserSelect = parentUI->mUserSelect;
   }
-  else if (eCSSUnit_Initial == uiData.mUserSelect.GetUnit()) {
-    // FIXME There's no other way to specify this value!
+  else if (eCSSUnit_Initial == uiData.mUserSelect.GetUnit() ||
+           eCSSUnit_Auto == uiData.mUserSelect.GetUnit()) {
     ui->mUserSelect = NS_STYLE_USER_SELECT_AUTO;
   }
 
   // ime-mode: auto, normal, enum, inherit
   if (eCSSUnit_Auto == uiData.mIMEMode.GetUnit() ||
       eCSSUnit_Initial == uiData.mIMEMode.GetUnit()) {
     ui->mIMEMode = NS_STYLE_IME_MODE_AUTO;
   }
diff --git a/layout/style/test/test_compute_data_with_start_struct.html b/layout/style/test/test_compute_data_with_start_struct.html
--- a/layout/style/test/test_compute_data_with_start_struct.html
+++ b/layout/style/test/test_compute_data_with_start_struct.html
@@ -15,24 +15,18 @@
   <span id="test"></span>
 </p>
 <div id="content" style="display: none">
   
 </div>
 <pre id="test">
 <script class="testbody" type="text/javascript">
 
-var gXFailComputed = {
-  // The initial value of -moz-user-select can't be specified and isn't
-  // serialized correctly.
-  "-moz-user-select": true
-};
-
 function xfail_computecheck(prop, roundnum) {
-    return prop in gXFailComputed;
+    return false;
 }
 
 function xfail_test(prop, roundnum) {
     return false;
 }
 
 var gStyleSheet = document.getElementById("stylesheet").sheet;
 var gRule1 = gStyleSheet.cssRules[gStyleSheet.insertRule("#base, #test {}", gStyleSheet.cssRules.length)];
diff --git a/layout/style/test/test_value_computation.html b/layout/style/test/test_value_computation.html
--- a/layout/style/test/test_value_computation.html
+++ b/layout/style/test/test_value_computation.html
@@ -32,17 +32,16 @@
 </div>
 <pre id="test">
 <script class="testbody" type="text/javascript">
 
 /** Test for computation of values in property database **/
 
 var gNotAccepted = {
   "-moz-column-width": [ "50%" ],
-  "-moz-user-select": [ "auto" ],
   "list-style": [ "none disc outside" ],
 };
 
 var gBadComputed = {
   // NS_STYLE_COLUMN_COUNT_AUTO is 0
   "-moz-column-count": [ "0" ],
 
   "clip": [ "rect(auto,auto,auto,auto)" ],
diff --git a/layout/style/test/test_value_storage.html b/layout/style/test/test_value_storage.html
--- a/layout/style/test/test_value_storage.html
+++ b/layout/style/test/test_value_storage.html
@@ -54,17 +54,16 @@ var gShorthandsWithoutCondensingSerializ
   "font": true,
   "list-style": true,
   "outline": true,
   "pause": true,
 };
 
 var gNotAccepted = {
   "-moz-column-width": [ "50%" ],
-  "-moz-user-select": [ "auto" ],
   "list-style": [ "none disc outside" ],
 };
 
 var gSystemFont = {
   "caption": true,
   "icon": true,
   "menu": true,
   "message-box": true,
