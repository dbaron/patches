From: L. David Baron <dbaron@dbaron.org>
Bug 1089417 patch 3 - Add mochitest.

diff --git a/layout/style/test/file_bug1089417_iframe.html b/layout/style/test/file_bug1089417_iframe.html
new file mode 100644
--- /dev/null
+++ b/layout/style/test/file_bug1089417_iframe.html
@@ -0,0 +1,17 @@
+<!DOCTYPE HTML>
+<html>
+<head>
+  <title>Bug 1089417</title>
+  <style>
+    html { background: red }
+    @media (min-height: 300px) { html { background: green } }
+  </style>
+  <style id="s">/* empty */</style>
+  <script>
+    document.getElementById("s").disabled = true;
+  </script>
+</head>
+<body>
+
+</body>
+</html>
diff --git a/layout/style/test/mochitest.ini b/layout/style/test/mochitest.ini
--- a/layout/style/test/mochitest.ini
+++ b/layout/style/test/mochitest.ini
@@ -97,16 +97,18 @@ support-files = file_bug645998-1.css fil
 [test_bug765590.html]
 [test_bug798567.html]
 [test_bug798843_pref.html]
 [test_bug829816.html]
 [test_bug874919.html]
 support-files = file_bug829816.css
 [test_bug887741_at-rules_in_declaration_lists.html]
 [test_bug892929.html]
+[test_bug1089417.html]
+support-files = file_bug1089417_iframe.html
 [test_cascade.html]
 [test_ch_ex_no_infloops.html]
 [test_compute_data_with_start_struct.html]
 [test_computed_style.html]
 [test_computed_style_no_pseudo.html]
 [test_computed_style_prefs.html]
 [test_condition_text.html]
 [test_condition_text_assignment.html]
diff --git a/layout/style/test/test_bug1089417.html b/layout/style/test/test_bug1089417.html
new file mode 100644
--- /dev/null
+++ b/layout/style/test/test_bug1089417.html
@@ -0,0 +1,40 @@
+<!DOCTYPE HTML>
+<html>
+<!--
+https://bugzilla.mozilla.org/show_bug.cgi?id=1089417
+-->
+<head>
+  <meta charset="utf-8">
+  <title>Test for Bug 1089417</title>
+  <script type="application/javascript" src="/tests/SimpleTest/SimpleTest.js"></script>
+  <link rel="stylesheet" type="text/css" href="/tests/SimpleTest/test.css"/>
+  <script type="application/javascript">
+
+  /** Test for Bug 1089417 **/
+
+  SimpleTest.waitForExplicitFinish();
+
+  function run() {
+    var f = document.getElementById("f");
+    var fwin = f.contentWindow;
+    var fdoc = f.contentDocument;
+
+    f.height = "400";
+    fdoc.getElementById("s").disabled = false;
+    todo(fwin.getComputedStyle(fdoc.documentElement).backgroundColor,
+       "rgb(0, 128, 0)",
+       "media query change should have restyled");
+    SimpleTest.finish();
+  }
+
+  </script>
+</head>
+<body onload="run()">
+<a target="_blank" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1089417">Mozilla Bug 1089417</a>
+<div id="display">
+  <iframe id="f" src="file_bug1089417_iframe.html" width="300" height="200"></iframe>
+</div>
+<pre id="test">
+</pre>
+</body>
+</html>
