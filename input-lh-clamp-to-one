From: L. David Baron <dbaron@dbaron.org>

Bug 349259 patch 2:  Prevent html:input elements from having a line-height smaller than 1.

diff --git a/layout/generic/nsHTMLReflowState.cpp b/layout/generic/nsHTMLReflowState.cpp
--- a/layout/generic/nsHTMLReflowState.cpp
+++ b/layout/generic/nsHTMLReflowState.cpp
@@ -2482,16 +2482,26 @@ nsHTMLReflowState::CalcLineHeight(nsICon
 {
   NS_PRECONDITION(aStyleContext, "Must have a style context");
 
   nscoord lineHeight =
     ComputeLineHeight(aStyleContext, aBlockHeight, aFontSizeInflation);
 
   NS_ASSERTION(lineHeight >= 0, "ComputeLineHeight screwed up");
 
+  if (aContent && aContent->IsHTML(nsGkAtoms::input)) {
+    // For Web-compatibility, input elements cannot have a line-height
+    // smaller than one.
+    nscoord lineHeightOne =
+      aFontSizeInflation * aStyleContext->StyleFont()->mFont.size;
+    if (lineHeight < lineHeightOne) {
+      lineHeight = lineHeightOne;
+    }
+  }
+
   return lineHeight;
 }
 
 bool
 nsCSSOffsetState::ComputeMargin(nscoord aHorizontalPercentBasis,
                                 nscoord aVerticalPercentBasis)
 {
   // SVG text frames have no margin.
