Don't let columns with no cells originating in them expand in the pass for expanding zero-width columns.  b=425972  r=dholbert  sr=roc  a=blocking1.9+

diff --git a/layout/reftests/bugs/425972-1-ref.html b/layout/reftests/bugs/425972-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/425972-1-ref.html
@@ -0,0 +1,14 @@
+<html>
+ <head>
+ <meta http-equiv="content-type" content="text/html; charset=UTF-8">
+ <title>there should not be a red bar over the whole page</title>
+</head>
+<body >
+  <table width="100%">
+  <tbody>
+ 
+   <tr><td bgcolor="#ff3333" width="100%" height="50px"></td></tr>
+  </tbody>
+ </table>
+</body>
+</html>
diff --git a/layout/reftests/bugs/425972-1.html b/layout/reftests/bugs/425972-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/425972-1.html
@@ -0,0 +1,15 @@
+<html>
+ <head>
+ <meta http-equiv="content-type" content="text/html; charset=UTF-8">
+ <title>there should be a red bar over the whole page</title>
+</head>
+<body >
+  <table width="100%">
+  <tbody>
+ 
+   <tr><td bgcolor="#ff3333" width="1%" height="50px"></td></tr>
+   <tr><td colspan="2"></td></tr>
+  </tbody>
+ </table>
+</body>
+</html>
diff --git a/layout/reftests/bugs/425972-2-ref.html b/layout/reftests/bugs/425972-2-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/425972-2-ref.html
@@ -0,0 +1,14 @@
+<html>
+ <head>
+ <meta http-equiv="content-type" content="text/html; charset=UTF-8">
+ <title>there should not be a red bar over the whole page</title>
+</head>
+<body >
+  <table width="100%">
+  <tbody>
+ 
+   <tr><td bgcolor="#ff3333" width="1%" height="50px"></td><td style="padding:0">&nbsp;&nbsp;</td></tr>
+  </tbody>
+ </table>
+</body>
+</html>
diff --git a/layout/reftests/bugs/425972-2.html b/layout/reftests/bugs/425972-2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/425972-2.html
@@ -0,0 +1,15 @@
+<html>
+ <head>
+ <meta http-equiv="content-type" content="text/html; charset=UTF-8">
+ <title>there should not be a red bar over the whole page</title>
+</head>
+<body >
+  <table width="100%">
+  <tbody>
+ 
+   <tr><td bgcolor="#ff3333" width="1%" height="50px"></td><td style="padding:0"></td></tr>
+   <tr><td colspan="2"></td></tr>
+  </tbody>
+ </table>
+</body>
+</html>
diff --git a/layout/reftests/bugs/reftest.list b/layout/reftests/bugs/reftest.list
--- a/layout/reftests/bugs/reftest.list
+++ b/layout/reftests/bugs/reftest.list
@@ -785,3 +785,6 @@ fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") == 
 fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") == 424074-1-ref2.xul 424074-1-ref3.xul
 == 424236-10.html 424236-10-ref.html
 == 424631-1.html 424631-1-ref.html
+== 425972-1.html 425972-1-ref.html
+== 425972-2.html 425972-2-ref.html
+!= 425972-1.html 425972-2.html
diff --git a/layout/tables/BasicTableLayoutStrategy.cpp b/layout/tables/BasicTableLayoutStrategy.cpp
--- a/layout/tables/BasicTableLayoutStrategy.cpp
+++ b/layout/tables/BasicTableLayoutStrategy.cpp
@@ -680,9 +680,10 @@ BasicTableLayoutStrategy::DistributeWidt
      *   percent width have nonzero pref width, in proportion to pref
      *   width [total_flex_pref]
      *
-     *   b. (NOTE: this case is for BTLS_FINAL_WIDTH only) otherwise, if any
-     *   columns without a specified coordinate width or percent width have
-     *   zero pref width, equally between these [numNonSpecZeroWidthCols]
+     *   b. (NOTE: this case is for BTLS_FINAL_WIDTH only) otherwise, if
+     *   any columns without a specified coordinate width or percent
+     *   width, but with cells originating in them have zero pref width,
+     *   equally between these [numNonSpecZeroWidthCols]
      *
      *   c. otherwise, if any columns without percent width have nonzero
      *   pref width, in proportion to pref width [total_fixed_pref]
@@ -739,7 +740,8 @@ BasicTableLayoutStrategy::DistributeWidt
                 total_fixed_pref = NSCoordSaturatingAdd(total_fixed_pref, 
                                                         pref_width);
             } else if (pref_width == 0) {
-                if (aWidthType == BTLS_FINAL_WIDTH) {
+                if (aWidthType == BTLS_FINAL_WIDTH &&
+                    mTableFrame->GetNumCellsOriginatingInCol(col)) {
                     ++numNonSpecZeroWidthCols;
                 }
             } else {
@@ -937,7 +939,8 @@ BasicTableLayoutStrategy::DistributeWidt
                              "FLEX_FLEX_LARGE_ZERO only should be hit "
                              "when we're setting final width.");
                 if (pct == 0.0f &&
-                    !colFrame->GetHasSpecifiedCoord()) {
+                    !colFrame->GetHasSpecifiedCoord() &&
+                    mTableFrame->GetNumCellsOriginatingInCol(col)) {
 
                     NS_ASSERTION(col_width == 0 &&
                                  colFrame->GetPrefCoord() == 0,
