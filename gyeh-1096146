From: Gina Yeh <gyeh@mozilla.com>

Bug 1096146, Patch 1(v1): No default actions of keydown event should be made if mozbrowserbeforekeydown event is defaultPrevented.

diff --git a/layout/base/nsPresShell.cpp b/layout/base/nsPresShell.cpp
index 6649c08..aa349d6 100644
--- a/layout/base/nsPresShell.cpp
+++ b/layout/base/nsPresShell.cpp
@@ -7158,16 +7158,17 @@ PresShell::HandleKeyboardEvent(nsINode* aTarget,
   // after event.
   size_t chainIndex;
   bool defaultPrevented = false;
   DispatchBeforeKeyboardEventInternal(chain, aEvent, chainIndex,
                                       defaultPrevented);
 
   // Dispatch after events to partial items.
   if (defaultPrevented) {
+    *aStatus = nsEventStatus_eConsumeNoDefault;
     DispatchAfterKeyboardEventInternal(chain, aEvent,
                                        aEvent.mFlags.mDefaultPrevented, chainIndex);
 
     // No need to forward the event to child process.
     aEvent.mFlags.mNoCrossProcessBoundaryForwarding = true;
     return;
   }
 
