From: L. David Baron <dbaron@dbaron.org>

Bug 1329601 - Condition changing flush type for media queries on media queries actually being present.

MozReview-Commit-ID: ETxokFiNc5T

diff --git a/dom/base/nsDocument.cpp b/dom/base/nsDocument.cpp
--- a/dom/base/nsDocument.cpp
+++ b/dom/base/nsDocument.cpp
@@ -7945,16 +7945,19 @@ nsDocument::FlushPendingNotifications(Fl
   // container is reflowed if its size was changed.  But if it's not safe to
   // flush ourselves, then don't flush the parent, since that can cause things
   // like resizes of our frame's widget, which we can't handle while flushing
   // is unsafe.
   // Since media queries mean that a size change of our container can
   // affect style, we need to promote a style flush on ourself to a
   // layout flush on our parent, since we need our container to be the
   // correct size to determine the correct style.
+  // FIXME: Should condition this on actually having media queries.
+  // Also, maybe we should have telemetry for how often different types
+  // of flushes happen?
   if (mParentDocument && IsSafeToFlush()) {
     FlushType parentType = aType;
     if (aType >= FlushType::Style)
       parentType = std::max(FlushType::Layout, aType);
     mParentDocument->FlushPendingNotifications(parentType);
   }
 
   if (nsIPresShell* shell = GetShell()) {
