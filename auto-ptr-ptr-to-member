From: L. David Baron <dbaron@dbaron.org>

Add operator->* to nsAutoPtr and nsRefPtr.  (Bug 525205)

diff --git a/xpcom/base/nsAutoPtr.h b/xpcom/base/nsAutoPtr.h
--- a/xpcom/base/nsAutoPtr.h
+++ b/xpcom/base/nsAutoPtr.h
@@ -179,16 +179,24 @@ class nsAutoPtr
 
       T*
       operator->() const
         {
           NS_PRECONDITION(mRawPtr != 0, "You can't dereference a NULL nsAutoPtr with operator->().");
           return get();
         }
 
+      template <class U, class V>
+      U&
+      operator->*(U V::* aMember)
+        {
+          NS_PRECONDITION(mRawPtr != 0, "You can't dereference a NULL nsAutoPtr with operator->*().");
+          return get()->*aMember;
+        }
+
 #ifdef CANT_RESOLVE_CPP_CONST_AMBIGUITY
   // broken version for IRIX
 
       nsAutoPtr<T>*
       get_address() const
           // This is not intended to be used by clients.  See |address_of|
           // below.
         {
@@ -1080,16 +1088,24 @@ class nsRefPtr
 
       T*
       operator->() const
         {
           NS_PRECONDITION(mRawPtr != 0, "You can't dereference a NULL nsRefPtr with operator->().");
           return get();
         }
 
+      template <class U, class V>
+      U&
+      operator->*(U V::* aMember)
+        {
+          NS_PRECONDITION(mRawPtr != 0, "You can't dereference a NULL nsRefPtr with operator->*().");
+          return get()->*aMember;
+        }
+
 #ifdef CANT_RESOLVE_CPP_CONST_AMBIGUITY
   // broken version for IRIX
 
       nsRefPtr<T>*
       get_address() const
           // This is not intended to be used by clients.  See |address_of|
           // below.
         {
