From: L. David Baron <dbaron@dbaron.org>

Use 'progress' events instead of 'suspend' events and don't check readyState, in order to fix random test timeouts.  (Bug 528001)

diff --git a/toolkit/content/tests/widgets/videocontrols_direction_test.js b/toolkit/content/tests/widgets/videocontrols_direction_test.js
--- a/toolkit/content/tests/widgets/videocontrols_direction_test.js
+++ b/toolkit/content/tests/widgets/videocontrols_direction_test.js
@@ -15,20 +15,19 @@ RemoteCanvas.prototype.load = function(c
   var iframe = document.createElement("iframe");
   iframe.id = this.id + "-iframe";
   iframe.width = RemoteCanvas.CANVAS_WIDTH + "px";
   iframe.height = RemoteCanvas.CANVAS_HEIGHT + "px";
   iframe.src = this.url;
   var me = this;
   iframe.addEventListener("load", function() {
     var m = iframe.contentDocument.getElementById("av");
-    m.addEventListener("suspend", function(aEvent) {
-      if (m.readyState == m.HAVE_ENOUGH_DATA &&
-          aEvent.loaded == aEvent.total) {
-        m.removeEventListener("suspend", arguments.callee, false);
+    m.addEventListener("progress", function(aEvent) {
+      if (aEvent.loaded == aEvent.total) {
+        m.removeEventListener("progress", arguments.callee, false);
         setTimeout(function() {
           me.remotePageLoaded(callback);
         }, 0);
       }
     }, false);
     m.src = m.getAttribute("source");
   }, false);
   window.document.body.appendChild(iframe);
