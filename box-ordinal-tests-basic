From: L. David Baron <dbaron@dbaron.org>

Add some basic reftests for dynamic changes of -moz-box-ordinal-group.  (Bug 555987)

diff --git a/layout/reftests/box-ordinal/dynamic-1-add-to-one-grouped.xul b/layout/reftests/box-ordinal/dynamic-1-add-to-one-grouped.xul
new file mode 100644
--- /dev/null
+++ b/layout/reftests/box-ordinal/dynamic-1-add-to-one-grouped.xul
@@ -0,0 +1,17 @@
+<?xml version="1.0"?>
+<!DOCTYPE window>
+<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul" class="reftest-wait" onload="run()">
+  <script type="application/javascript"><![CDATA[
+
+  function run() {
+    var c = document.getElementById("C");
+    getComputedStyle(c, "").width; // flush
+    c.style.MozBoxOrdinalGroup = "2";
+    document.documentElement.removeAttribute("class");
+  }
+
+  ]]></script>
+  <label id="A" value="A" />
+  <label id="C" value="C" />
+  <label id="B" value="B" />
+</window>
diff --git a/layout/reftests/box-ordinal/dynamic-1-add-to-two-grouped-1.xul b/layout/reftests/box-ordinal/dynamic-1-add-to-two-grouped-1.xul
new file mode 100644
--- /dev/null
+++ b/layout/reftests/box-ordinal/dynamic-1-add-to-two-grouped-1.xul
@@ -0,0 +1,17 @@
+<?xml version="1.0"?>
+<!DOCTYPE window>
+<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul" class="reftest-wait" onload="run()">
+  <script type="application/javascript"><![CDATA[
+
+  function run() {
+    var c = document.getElementById("C");
+    getComputedStyle(c, "").width; // flush
+    c.style.MozBoxOrdinalGroup = "2";
+    document.documentElement.removeAttribute("class");
+  }
+
+  ]]></script>
+  <label id="B" value="B" style="-moz-box-ordinal-group: 2" />
+  <label id="C" value="C" />
+  <label id="A" value="A" />
+</window>
diff --git a/layout/reftests/box-ordinal/dynamic-1-add-to-two-grouped-2.xul b/layout/reftests/box-ordinal/dynamic-1-add-to-two-grouped-2.xul
new file mode 100644
--- /dev/null
+++ b/layout/reftests/box-ordinal/dynamic-1-add-to-two-grouped-2.xul
@@ -0,0 +1,17 @@
+<?xml version="1.0"?>
+<!DOCTYPE window>
+<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul" class="reftest-wait" onload="run()">
+  <script type="application/javascript"><![CDATA[
+
+  function run() {
+    var b = document.getElementById("B");
+    getComputedStyle(b, "").width; // flush
+    b.style.MozBoxOrdinalGroup = "2";
+    document.documentElement.removeAttribute("class");
+  }
+
+  ]]></script>
+  <label id="B" value="B" />
+  <label id="C" value="C" style="-moz-box-ordinal-group: 2" />
+  <label id="A" value="A" />
+</window>
diff --git a/layout/reftests/box-ordinal/dynamic-1-ref.xul b/layout/reftests/box-ordinal/dynamic-1-ref.xul
new file mode 100644
--- /dev/null
+++ b/layout/reftests/box-ordinal/dynamic-1-ref.xul
@@ -0,0 +1,7 @@
+<?xml version="1.0"?>
+<!DOCTYPE window>
+<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
+  <label id="A" value="A" />
+  <label id="B" value="B" />
+  <label id="C" value="C" />
+</window>
diff --git a/layout/reftests/box-ordinal/dynamic-1-remove-to-none-grouped.xul b/layout/reftests/box-ordinal/dynamic-1-remove-to-none-grouped.xul
new file mode 100644
--- /dev/null
+++ b/layout/reftests/box-ordinal/dynamic-1-remove-to-none-grouped.xul
@@ -0,0 +1,17 @@
+<?xml version="1.0"?>
+<!DOCTYPE window>
+<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul" class="reftest-wait" onload="run()">
+  <script type="application/javascript"><![CDATA[
+
+  function run() {
+    var b = document.getElementById("B");
+    getComputedStyle(b, "").width; // flush
+    b.style.MozBoxOrdinalGroup = "";
+    document.documentElement.removeAttribute("class");
+  }
+
+  ]]></script>
+  <label id="A" value="A" />
+  <label id="B" value="B" style="-moz-box-ordinal-group: 2" />
+  <label id="C" value="C" />
+</window>
diff --git a/layout/reftests/box-ordinal/dynamic-1-remove-to-one-grouped-1.xul b/layout/reftests/box-ordinal/dynamic-1-remove-to-one-grouped-1.xul
new file mode 100644
--- /dev/null
+++ b/layout/reftests/box-ordinal/dynamic-1-remove-to-one-grouped-1.xul
@@ -0,0 +1,17 @@
+<?xml version="1.0"?>
+<!DOCTYPE window>
+<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul" class="reftest-wait" onload="run()">
+  <script type="application/javascript"><![CDATA[
+
+  function run() {
+    var b = document.getElementById("B");
+    getComputedStyle(b, "").width; // flush
+    b.style.MozBoxOrdinalGroup = "";
+    document.documentElement.removeAttribute("class");
+  }
+
+  ]]></script>
+  <label id="C" value="C" style="-moz-box-ordinal-group: 2" />
+  <label id="A" value="A" />
+  <label id="B" value="B" style="-moz-box-ordinal-group: 2" />
+</window>
diff --git a/layout/reftests/box-ordinal/dynamic-1-remove-to-one-grouped-2.xul b/layout/reftests/box-ordinal/dynamic-1-remove-to-one-grouped-2.xul
new file mode 100644
--- /dev/null
+++ b/layout/reftests/box-ordinal/dynamic-1-remove-to-one-grouped-2.xul
@@ -0,0 +1,17 @@
+<?xml version="1.0"?>
+<!DOCTYPE window>
+<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul" class="reftest-wait" onload="run()">
+  <script type="application/javascript"><![CDATA[
+
+  function run() {
+    var a = document.getElementById("A");
+    getComputedStyle(a, "").width; // flush
+    a.style.MozBoxOrdinalGroup = "";
+    document.documentElement.removeAttribute("class");
+  }
+
+  ]]></script>
+  <label id="C" value="C" style="-moz-box-ordinal-group: 2" />
+  <label id="A" value="A" style="-moz-box-ordinal-group: 2" />
+  <label id="B" value="B" />
+</window>
diff --git a/layout/reftests/box-ordinal/reftest.list b/layout/reftests/box-ordinal/reftest.list
new file mode 100644
--- /dev/null
+++ b/layout/reftests/box-ordinal/reftest.list
@@ -0,0 +1,6 @@
+== dynamic-1-remove-to-none-grouped.xul dynamic-1-ref.xul
+== dynamic-1-add-to-one-grouped.xul dynamic-1-ref.xul
+== dynamic-1-remove-to-one-grouped-1.xul dynamic-1-ref.xul
+== dynamic-1-remove-to-one-grouped-2.xul dynamic-1-ref.xul
+== dynamic-1-add-to-two-grouped-1.xul dynamic-1-ref.xul
+== dynamic-1-add-to-two-grouped-2.xul dynamic-1-ref.xul
diff --git a/layout/reftests/reftest.list b/layout/reftests/reftest.list
--- a/layout/reftests/reftest.list
+++ b/layout/reftests/reftest.list
@@ -21,16 +21,19 @@ include backgrounds/reftest.list
 include bidi/reftest.list
 
 # border-image
 include border-image/reftest.list
 
 # border-radius/
 include border-radius/reftest.list
 
+# box-ordinal/
+include box-ordinal/reftest.list
+
 # box-properties/
 include box-properties/reftest.list
 
 # box-shadow/
 include box-shadow/reftest.list
 
 # bugs/
 include bugs/reftest.list
