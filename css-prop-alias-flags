From: L. David Baron <dbaron@dbaron.org>

Bug 837211 patch 2:  Add flags field to CSS_PROP_ALIAS macro.  r=bzbarsky

diff --git a/dom/webidl/CSS2PropertiesProps.h b/dom/webidl/CSS2PropertiesProps.h
--- a/dom/webidl/CSS2PropertiesProps.h
+++ b/dom/webidl/CSS2PropertiesProps.h
@@ -17,17 +17,17 @@
 
 #include "nsCSSPropList.h"
 
 #undef CSS_PROP_LIST_EXCLUDE_INTERNAL
 #undef CSS_PROP_PUBLIC_OR_PRIVATE
 #undef CSS_PROP_SHORTHAND
 #undef CSS_PROP
 
-#define CSS_PROP_ALIAS(name, id, method, pref) \
+#define CSS_PROP_ALIAS(name, id, method, flags, pref) \
   DO_PROP(method, pref)
 
 #include "nsCSSPropAliasList.h"
 
 #undef CSS_PROP_ALIAS
 
 #undef DO_PROP
 
diff --git a/layout/style/nsCSSPropAliasList.h b/layout/style/nsCSSPropAliasList.h
--- a/layout/style/nsCSSPropAliasList.h
+++ b/layout/style/nsCSSPropAliasList.h
@@ -24,36 +24,128 @@
 
   -. 'id' should be the same as the 'id' field in nsCSSPropList.h for
   the property that 'aliasname' is being aliased to.
 
   -. 'method' is the CSS2Properties property name.  Unlike
   nsCSSPropList.h, prefixes should just be included in this file (rather
   than needing the CSS_PROP_DOMPROP_PREFIXED(prop) macro).
 
+  -. 'flags' is a flags word, as for properties.  Currently only
+  CSS_PROPERTY_DISABLED_BY_DEFAULT is supported, and the flags are
+  not otherwise available for aliases.
+
   -. 'pref' is the name of a pref that controls whether the property
   is enabled.  The property is enabled if 'pref' is an empty string,
   or if the boolean property whose name is 'pref' is set to true.
 
  ******/
 
-CSS_PROP_ALIAS(-moz-transform-origin, transform_origin, MozTransformOrigin, "layout.css.prefixes.transforms")
-CSS_PROP_ALIAS(-moz-perspective-origin, perspective_origin, MozPerspectiveOrigin, "layout.css.prefixes.transforms")
-CSS_PROP_ALIAS(-moz-perspective, perspective, MozPerspective, "layout.css.prefixes.transforms")
-CSS_PROP_ALIAS(-moz-transform-style, transform_style, MozTransformStyle, "layout.css.prefixes.transforms")
-CSS_PROP_ALIAS(-moz-backface-visibility, backface_visibility, MozBackfaceVisibility, "layout.css.prefixes.transforms")
-CSS_PROP_ALIAS(-moz-border-image, border_image, MozBorderImage, "layout.css.prefixes.border-image")
-CSS_PROP_ALIAS(-moz-transition, transition, MozTransition, "layout.css.prefixes.transitions")
-CSS_PROP_ALIAS(-moz-transition-delay, transition_delay, MozTransitionDelay, "layout.css.prefixes.transitions")
-CSS_PROP_ALIAS(-moz-transition-duration, transition_duration, MozTransitionDuration, "layout.css.prefixes.transitions")
-CSS_PROP_ALIAS(-moz-transition-property, transition_property, MozTransitionProperty, "layout.css.prefixes.transitions")
-CSS_PROP_ALIAS(-moz-transition-timing-function, transition_timing_function, MozTransitionTimingFunction, "layout.css.prefixes.transitions")
-CSS_PROP_ALIAS(-moz-animation, animation, MozAnimation, "layout.css.prefixes.animations")
-CSS_PROP_ALIAS(-moz-animation-delay, animation_delay, MozAnimationDelay, "layout.css.prefixes.animations")
-CSS_PROP_ALIAS(-moz-animation-direction, animation_direction, MozAnimationDirection, "layout.css.prefixes.animations")
-CSS_PROP_ALIAS(-moz-animation-duration, animation_duration, MozAnimationDuration, "layout.css.prefixes.animations")
-CSS_PROP_ALIAS(-moz-animation-fill-mode, animation_fill_mode, MozAnimationFillMode, "layout.css.prefixes.animations")
-CSS_PROP_ALIAS(-moz-animation-iteration-count, animation_iteration_count, MozAnimationIterationCount, "layout.css.prefixes.animations")
-CSS_PROP_ALIAS(-moz-animation-name, animation_name, MozAnimationName, "layout.css.prefixes.animations")
-CSS_PROP_ALIAS(-moz-animation-play-state, animation_play_state, MozAnimationPlayState, "layout.css.prefixes.animations")
-CSS_PROP_ALIAS(-moz-animation-timing-function, animation_timing_function, MozAnimationTimingFunction, "layout.css.prefixes.animations")
-CSS_PROP_ALIAS(font-feature-settings, font_feature_settings, FontFeatureSettings, "layout.css.font-features.enabled")
-CSS_PROP_ALIAS(font-language-override, font_language_override, FontLanguageOverride, "layout.css.font-features.enabled")
+CSS_PROP_ALIAS(-moz-transform-origin,
+               transform_origin,
+               MozTransformOrigin,
+               0,
+              "layout.css.prefixes.transforms")
+CSS_PROP_ALIAS(-moz-perspective-origin,
+               perspective_origin,
+               MozPerspectiveOrigin,
+               0,
+              "layout.css.prefixes.transforms")
+CSS_PROP_ALIAS(-moz-perspective,
+               perspective,
+               MozPerspective,
+               0,
+              "layout.css.prefixes.transforms")
+CSS_PROP_ALIAS(-moz-transform-style,
+               transform_style,
+               MozTransformStyle,
+               0,
+              "layout.css.prefixes.transforms")
+CSS_PROP_ALIAS(-moz-backface-visibility,
+               backface_visibility,
+               MozBackfaceVisibility,
+               0,
+              "layout.css.prefixes.transforms")
+CSS_PROP_ALIAS(-moz-border-image,
+               border_image,
+               MozBorderImage,
+               0,
+              "layout.css.prefixes.border-image")
+CSS_PROP_ALIAS(-moz-transition,
+               transition,
+               MozTransition,
+               0,
+              "layout.css.prefixes.transitions")
+CSS_PROP_ALIAS(-moz-transition-delay,
+               transition_delay,
+               MozTransitionDelay,
+               0,
+              "layout.css.prefixes.transitions")
+CSS_PROP_ALIAS(-moz-transition-duration,
+               transition_duration,
+               MozTransitionDuration,
+               0,
+              "layout.css.prefixes.transitions")
+CSS_PROP_ALIAS(-moz-transition-property,
+               transition_property,
+               MozTransitionProperty,
+               0,
+              "layout.css.prefixes.transitions")
+CSS_PROP_ALIAS(-moz-transition-timing-function,
+               transition_timing_function,
+               MozTransitionTimingFunction,
+               0,
+              "layout.css.prefixes.transitions")
+CSS_PROP_ALIAS(-moz-animation,
+               animation,
+               MozAnimation,
+               0,
+              "layout.css.prefixes.animations")
+CSS_PROP_ALIAS(-moz-animation-delay,
+               animation_delay,
+               MozAnimationDelay,
+               0,
+              "layout.css.prefixes.animations")
+CSS_PROP_ALIAS(-moz-animation-direction,
+               animation_direction,
+               MozAnimationDirection,
+               0,
+              "layout.css.prefixes.animations")
+CSS_PROP_ALIAS(-moz-animation-duration,
+               animation_duration,
+               MozAnimationDuration,
+               0,
+              "layout.css.prefixes.animations")
+CSS_PROP_ALIAS(-moz-animation-fill-mode,
+               animation_fill_mode,
+               MozAnimationFillMode,
+               0,
+              "layout.css.prefixes.animations")
+CSS_PROP_ALIAS(-moz-animation-iteration-count,
+               animation_iteration_count,
+               MozAnimationIterationCount,
+               0,
+              "layout.css.prefixes.animations")
+CSS_PROP_ALIAS(-moz-animation-name,
+               animation_name,
+               MozAnimationName,
+               0,
+              "layout.css.prefixes.animations")
+CSS_PROP_ALIAS(-moz-animation-play-state,
+               animation_play_state,
+               MozAnimationPlayState,
+               0,
+              "layout.css.prefixes.animations")
+CSS_PROP_ALIAS(-moz-animation-timing-function,
+               animation_timing_function,
+               MozAnimationTimingFunction,
+               0,
+              "layout.css.prefixes.animations")
+CSS_PROP_ALIAS(font-feature-settings,
+               font_feature_settings,
+               FontFeatureSettings,
+               0,
+               "layout.css.font-features.enabled")
+CSS_PROP_ALIAS(font-language-override,
+               font_language_override,
+               FontLanguageOverride,
+               0,
+               "layout.css.font-features.enabled")
diff --git a/layout/style/nsCSSProperty.h b/layout/style/nsCSSProperty.h
--- a/layout/style/nsCSSProperty.h
+++ b/layout/style/nsCSSProperty.h
@@ -32,17 +32,17 @@ enum nsCSSProperty {
     eCSSProperty_##id_,
   #include "nsCSSPropList.h"
   #undef CSS_PROP_SHORTHAND
 
   eCSSProperty_COUNT,
   // Make the count continue where it left off:
   eCSSProperty_COUNT_DUMMY2 = eCSSProperty_COUNT - 1,
 
-  #define CSS_PROP_ALIAS(aliasname_, id_, method_, pref_) \
+  #define CSS_PROP_ALIAS(aliasname_, id_, method_, flags_, pref_) \
     eCSSPropertyAlias_##method_,
   #include "nsCSSPropAliasList.h"
   #undef CSS_PROP_ALIAS
 
   eCSSProperty_COUNT_with_aliases,
   // Make the count continue where it left off:
   eCSSProperty_COUNT_DUMMY3 = eCSSProperty_COUNT_with_aliases - 1,
 
diff --git a/layout/style/nsCSSProps.cpp b/layout/style/nsCSSProps.cpp
--- a/layout/style/nsCSSProps.cpp
+++ b/layout/style/nsCSSProps.cpp
@@ -36,17 +36,17 @@ const char* const kCSSRawProperties[eCSS
 #define CSS_PROP(name_, id_, method_, flags_, pref_, parsevariant_, kwtable_, \
                  stylestruct_, stylestructoffset_, animtype_)                 \
   #name_,
 #include "nsCSSPropList.h"
 #undef CSS_PROP
 #define CSS_PROP_SHORTHAND(name_, id_, method_, flags_, pref_) #name_,
 #include "nsCSSPropList.h"
 #undef CSS_PROP_SHORTHAND
-#define CSS_PROP_ALIAS(aliasname_, id_, method_, pref_) #aliasname_,
+#define CSS_PROP_ALIAS(aliasname_, id_, method_, flags_, pref_) #aliasname_,
 #include "nsCSSPropAliasList.h"
 #undef CSS_PROP_ALIAS
 };
 
 using namespace mozilla;
 
 static int32_t gTableRefCount;
 static nsStaticCaseInsensitiveNameTable* gPropertyTable;
@@ -82,17 +82,17 @@ SortPropertyAndCount(const void* s1, con
 // We need eCSSAliasCount so we can make gAliases nonzero size when there
 // are no aliases.
 enum {
   eCSSAliasCount = eCSSProperty_COUNT_with_aliases - eCSSProperty_COUNT
 };
 
 // The names are in kCSSRawProperties.
 static nsCSSProperty gAliases[eCSSAliasCount != 0 ? eCSSAliasCount : 1] = {
-#define CSS_PROP_ALIAS(aliasname_, propid_, aliasmethod_, pref_)  \
+#define CSS_PROP_ALIAS(aliasname_, propid_, aliasmethod_, flags_, pref_)  \
   eCSSProperty_##propid_ ,
 #include "nsCSSPropAliasList.h"
 #undef CSS_PROP_ALIAS
 };
 
 void
 nsCSSProps::AddRefTable(void)
 {
@@ -154,17 +154,17 @@ nsCSSProps::AddRefTable(void)
       #include "nsCSSPropList.h"
       #undef CSS_PROP
 
       #define  CSS_PROP_SHORTHAND(name_, id_, method_, flags_, pref_) \
         OBSERVE_PROP(pref_, eCSSProperty_##id_)
       #include "nsCSSPropList.h"
       #undef CSS_PROP_SHORTHAND
 
-      #define CSS_PROP_ALIAS(aliasname_, propid_, aliasmethod_, pref_)    \
+      #define CSS_PROP_ALIAS(aliasname_, propid_, aliasmethod_, flags_, pref_)\
         OBSERVE_PROP(pref_, eCSSPropertyAlias_##aliasmethod_)
       #include "nsCSSPropAliasList.h"
       #undef CSS_PROP_ALIAS
 
       #undef OBSERVE_PROP
     }
   }
 }
@@ -2651,13 +2651,13 @@ nsCSSProps::gPropertyEnabled[eCSSPropert
   #include "nsCSSPropList.h"
   #undef CSS_PROP
 
   #define  CSS_PROP_SHORTHAND(name_, id_, method_, flags_, pref_) \
     true,
   #include "nsCSSPropList.h"
   #undef CSS_PROP_SHORTHAND
 
-  #define CSS_PROP_ALIAS(aliasname_, propid_, aliasmethod_, pref_) \
+  #define CSS_PROP_ALIAS(aliasname_, propid_, aliasmethod_, flags_, pref_) \
     true,
   #include "nsCSSPropAliasList.h"
   #undef CSS_PROP_ALIAS
 };
diff --git a/layout/style/nsDOMCSSDeclaration.h b/layout/style/nsDOMCSSDeclaration.h
--- a/layout/style/nsDOMCSSDeclaration.h
+++ b/layout/style/nsDOMCSSDeclaration.h
@@ -75,17 +75,17 @@ public:
     rv = SetPropertyValue(eCSSProperty_##id_, aValue);                       \
   }
 
 #define CSS_PROP_LIST_EXCLUDE_INTERNAL
 #define CSS_PROP_SHORTHAND(name_, id_, method_, flags_, pref_)  \
   CSS_PROP(name_, id_, method_, flags_, pref_, X, X, X, X, X)
 #include "nsCSSPropList.h"
 
-#define CSS_PROP_ALIAS(aliasname_, propid_, aliasmethod_, pref_)  \
+#define CSS_PROP_ALIAS(aliasname_, propid_, aliasmethod_, flags_, pref_) \
   CSS_PROP(X, propid_, aliasmethod_, X, pref_, X, X, X, X, X)
 #include "nsCSSPropAliasList.h"
 #undef CSS_PROP_ALIAS
 
 #undef CSS_PROP_SHORTHAND
 #undef CSS_PROP_LIST_EXCLUDE_INTERNAL
 #undef CSS_PROP
 #undef CSS_PROP_PUBLIC_OR_PRIVATE
diff --git a/layout/style/test/ListCSSProperties.cpp b/layout/style/test/ListCSSProperties.cpp
--- a/layout/style/test/ListCSSProperties.cpp
+++ b/layout/style/test/ListCSSProperties.cpp
@@ -58,17 +58,17 @@ const PropertyInfo gShorthandProperties[
     { #name_, LISTCSSPROPERTIES_INNER_MACRO(method_), pref_ },
 
 #include "nsCSSPropList.h"
 
 #undef CSS_PROP_SHORTHAND
 #undef LISTCSSPROPERTIES_INNER_MACRO
 #undef CSS_PROP_PUBLIC_OR_PRIVATE
 
-#define CSS_PROP_ALIAS(name_, id_, method_, pref_) \
+#define CSS_PROP_ALIAS(name_, id_, method_, flags_, pref_) \
     { #name_, #method_, pref_ },
 
 #include "nsCSSPropAliasList.h"
 
 #undef CSS_PROP_ALIAS
 
 };
 
@@ -79,17 +79,17 @@ const char* gShorthandPropertiesWithDOMP
 #define CSS_PROP_SHORTHAND(name_, id_, method_, flags_, pref_)	\
     #name_,
 
 #include "nsCSSPropList.h"
 
 #undef CSS_PROP_SHORTHAND
 #undef CSS_PROP_LIST_EXCLUDE_INTERNAL
 
-#define CSS_PROP_ALIAS(name_, id_, method_, pref_) \
+#define CSS_PROP_ALIAS(name_, id_, method_, flags_, pref_) \
     #name_,
 
 #include "nsCSSPropAliasList.h"
 
 #undef CSS_PROP_ALIAS
 
 };
 
