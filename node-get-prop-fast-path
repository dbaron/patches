From: L. David Baron <dbaron@dbaron.org>

Give nsINode::GetProperty a fast path for nodes that do not have properties.  r?peterv

I wasn't able to measure any performance improvement on talos.  I
haven't tried to measure anything more specific.

However, it seems like avoiding a hashtable lookup should be worthwhile.

(At one point I thought I saw nsINode::GetProperty show up as
significant in a profile, but then I concluded I was mislead, I think
because I had focused on a very small slice of the profile and the
numbers weren't significant.  I don't entirely remember since this was a
while ago.)

MozReview-Commit-ID: A9OoL9qV02D

diff --git a/dom/base/nsINode.cpp b/dom/base/nsINode.cpp
--- a/dom/base/nsINode.cpp
+++ b/dom/base/nsINode.cpp
@@ -153,16 +153,22 @@ nsINode::~nsINode()
   MOZ_ASSERT(!HasSlots(), "nsNodeUtils::LastRelease was not called?");
   MOZ_ASSERT(mSubtreeRoot == this, "Didn't restore state properly?");
 }
 
 void*
 nsINode::GetProperty(uint16_t aCategory, nsIAtom *aPropertyName,
                      nsresult *aStatus) const
 {
+  if (!HasProperties()) { // a fast HasFlag() test
+    if (aStatus) {
+      *aStatus = NS_PROPTABLE_PROP_NOT_THERE;
+    }
+    return nullptr;
+  }
   return OwnerDoc()->PropertyTable(aCategory)->GetProperty(this, aPropertyName,
                                                            aStatus);
 }
 
 nsresult
 nsINode::SetProperty(uint16_t aCategory, nsIAtom *aPropertyName, void *aValue,
                      NSPropertyDtorFunc aDtor, bool aTransfer,
                      void **aOldValue)
