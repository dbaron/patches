From: L. David Baron <dbaron@dbaron.org>

Add reftests for bug 563584.  r=roc

diff --git a/layout/reftests/bugs/563584-1-ref.html b/layout/reftests/bugs/563584-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/563584-1-ref.html
@@ -0,0 +1,24 @@
+<html class="reftest-print">
+<head>
+<title>Bug 563584, reftest-print version of original testcase</title>
+<style type="text/css">
+
+ div{
+   border: 1px solid green; 
+ }
+
+
+ </style>
+</head>
+<body>
+
+
+<div style="width:2in">
+    <div style="width:1in; height:2.5in;">A</div>
+    <div style="width:1in; height:0.4in;">B</div>
+</div>
+
+
+<div style="width:3in; height: 0.4in">C</div>
+
+<div style="width:3in; height: 0.4in">D</div>
diff --git a/layout/reftests/bugs/563584-1.html b/layout/reftests/bugs/563584-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/563584-1.html
@@ -0,0 +1,24 @@
+<html class="reftest-print">
+<head>
+<title>Bug 563584, reftest-print version of original testcase</title>
+<style type="text/css">
+
+ div{
+   border: 1px solid green; 
+ }
+
+
+ </style>
+</head>
+<body>
+
+
+<div style="width:2in; float:left">
+    <div style="width:1in; height:2.5in;">A</div>
+    <div style="width:1in; height:0.4in;">B</div>
+</div>
+
+
+<div style="float:left; width:3in; height: 0.4in">C</div>
+
+<div style="float:left; width:3in; height: 0.4in">D</div>
diff --git a/layout/reftests/bugs/563584-2-ref.html b/layout/reftests/bugs/563584-2-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/563584-2-ref.html
@@ -0,0 +1,25 @@
+<html class="reftest-print">
+<head>
+<title>Bug 563584, reftest-print version of original testcase, with anchor points</title>
+<style type="text/css">
+
+ div{
+   border: 1px solid green; 
+ }
+
+
+ </style>
+</head>
+<body>
+
+
+<div style="height: 0; margin-left: 2in; border: none; padding-left: 2px">c d e</div>
+<div style="width:2in;">
+    <div style="width:1in; height:2.5in;">A</div>
+    <div style="width:1in; height:0.4in;">B</div>
+</div>
+
+
+<div style="width:3in; height: 0.4in">C</div>
+
+<div style="width:3in; height: 0.4in">D</div>
diff --git a/layout/reftests/bugs/563584-2.html b/layout/reftests/bugs/563584-2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/563584-2.html
@@ -0,0 +1,26 @@
+<html class="reftest-print">
+<head>
+<title>Bug 563584, reftest-print version of original testcase, with anchor points</title>
+<style type="text/css">
+
+ div{
+   border: 1px solid green; 
+ }
+
+
+ </style>
+</head>
+<body>
+
+
+<div style="width:2in; float:left">
+    <div style="width:1in; height:2.5in;">A</div>
+    <div style="width:1in; height:0.4in;">B</div>
+</div>
+c
+
+<div style="float:left; width:3in; height: 0.4in">C</div>
+d
+
+<div style="float:left; width:3in; height: 0.4in">D</div>
+e
diff --git a/layout/reftests/bugs/563584-3-ref.html b/layout/reftests/bugs/563584-3-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/563584-3-ref.html
@@ -0,0 +1,24 @@
+<html class="reftest-print">
+<head>
+<title>Bug 563584, variant split over three pages</title>
+<style type="text/css">
+
+ div{
+   border: 1px solid green; 
+ }
+
+
+ </style>
+</head>
+<body>
+
+
+<div style="width:2in">
+    <div style="width:1in; height:3.5in;">A</div>
+    <div style="width:1in; height:0.5in;">B</div>
+</div>
+
+
+<div style="width:3in; height: 0.5in">C</div>
+
+<div style="width:3in; height: 0.5in">D</div>
diff --git a/layout/reftests/bugs/563584-3.html b/layout/reftests/bugs/563584-3.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/563584-3.html
@@ -0,0 +1,24 @@
+<html class="reftest-print">
+<head>
+<title>Bug 563584, variant split over three pages</title>
+<style type="text/css">
+
+ div{
+   border: 1px solid green; 
+ }
+
+
+ </style>
+</head>
+<body>
+
+
+<div style="width:2in; float:left">
+    <div style="width:1in; height:3.5in;">A</div>
+    <div style="width:1in; height:0.5in;">B</div>
+</div>
+
+
+<div style="float:left; width:3in; height: 0.5in">C</div>
+
+<div style="float:left; width:3in; height: 0.5in">D</div>
diff --git a/layout/reftests/bugs/563584-4-ref.html b/layout/reftests/bugs/563584-4-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/563584-4-ref.html
@@ -0,0 +1,24 @@
+<html class="reftest-print">
+<head>
+<title>Bug 563584, variant split over three pages, with anchor points</title>
+<style type="text/css">
+
+ div{
+   border: 1px solid green; 
+ }
+
+
+ </style>
+</head>
+<body>
+
+
+<div style="height: 0; margin-left: 2in; border: none; padding-left: 2px">c d e</div>
+<div style="width:2in;">
+    <div style="width:1in; height:3.5in;">A</div>
+    <div style="width:1in; height:0.5in;">B</div>
+</div>
+
+<div style="width:3in; height: 0.5in">C</div>
+
+<div style="width:3in; height: 0.5in">D</div>
diff --git a/layout/reftests/bugs/563584-4.html b/layout/reftests/bugs/563584-4.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/563584-4.html
@@ -0,0 +1,26 @@
+<html class="reftest-print">
+<head>
+<title>Bug 563584, variant split over three pages, with anchor points</title>
+<style type="text/css">
+
+ div{
+   border: 1px solid green; 
+ }
+
+
+ </style>
+</head>
+<body>
+
+
+<div style="width:2in; float:left">
+    <div style="width:1in; height:3.5in;">A</div>
+    <div style="width:1in; height:0.5in;">B</div>
+</div>
+c
+
+<div style="float:left; width:3in; height: 0.5in">C</div>
+d
+
+<div style="float:left; width:3in; height: 0.5in">D</div>
+e
diff --git a/layout/reftests/bugs/563584-5-ref.html b/layout/reftests/bugs/563584-5-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/563584-5-ref.html
@@ -0,0 +1,8 @@
+<!DOCTYPE HTML>
+<html class="reftest-print">
+<title>Test for handling of float that is reflowed and then entirely pushed</title>
+<body style="margin: 0">
+<div style="background: blue; height: 1.75in"></div>
+<div style="page-break-before: always; background: yellow; padding-top: 1in; width: 3in">
+  <div>hello</div>
+</div>
diff --git a/layout/reftests/bugs/563584-5.html b/layout/reftests/bugs/563584-5.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/563584-5.html
@@ -0,0 +1,9 @@
+<!DOCTYPE HTML>
+<html class="reftest-print">
+<title>Test for handling of float that is reflowed and then entirely pushed</title>
+<body style="margin: 0">
+<div style="background: blue; height: 1.75in"></div>
+<div style="float: left; background: yellow; width: 3in">
+  <span style="display:inline-block; height: 1in; width: 1in; vertical-align: top"></span>
+  <div>hello</div>
+</div>
diff --git a/layout/reftests/bugs/reftest.list b/layout/reftests/bugs/reftest.list
--- a/layout/reftests/bugs/reftest.list
+++ b/layout/reftests/bugs/reftest.list
@@ -1439,16 +1439,21 @@ random-if(!haveTestPlugin) == 546071-1.h
 == 561981-3.html 561981-3-ref.html
 == 561981-4.html 561981-4-ref.html
 == 561981-5.html 561981-5-ref.html
 == 561981-6.html 561981-6-ref.html
 == 561981-7.html 561981-7-ref.html
 == 561981-8.html 561981-8-ref.html
 == 562835-1.html 562835-ref.html
 == 562835-2.html 562835-ref.html
+== 563584-1.html 563584-1-ref.html
+== 563584-2.html 563584-2-ref.html
+== 563584-3.html 563584-3-ref.html
+== 563584-4.html 563584-4-ref.html
+== 563584-5.html 563584-5-ref.html
 == 563584-6-columns.html 563584-6-columns-ref.html
 == 563584-6-printing.html 563584-6-printing-ref.html
 == 563584-7.html 563584-7-ref.html
 # FIXME: It would be nice to have variants of these -8 tests for the
 # table narrowing quirk causing a change to mIsTopOfPage (though I'm not
 # entirely sure our behavior is the right one, either).
 == 563584-8a.html 563584-8a-ref.html
 == 563584-8b.html 563584-8b-ref.html
diff --git a/layout/reftests/pagination/reftest.list b/layout/reftests/pagination/reftest.list
--- a/layout/reftests/pagination/reftest.list
+++ b/layout/reftests/pagination/reftest.list
@@ -17,30 +17,30 @@ fails == border-breaking-004-cols.xhtml 
 == content-inserted-005.xhtml content-inserted-002.ref.xhtml
 == content-inserted-006.xhtml content-inserted-002.ref.xhtml
 == content-inserted-007.xhtml content-inserted-002.ref.xhtml
 == content-inserted-008.xhtml content-inserted-001.ref.xhtml
 == content-inserted-009.xhtml content-inserted-002.ref.xhtml
 == dynamic-abspos-overflow-01-cols.xhtml dynamic-abspos-overflow-01-cols.ref.xhtml
 fails == float-clear-000.html float-clear-000.ref.html
 fails == float-clear-001.html float-clear-000.ref.html
-fails == float-clear-002.html float-clear-000.ref.html # bug 507510
+fails == float-clear-002.html float-clear-000.ref.html
 fails == float-clear-003.html float-clear-000.ref.html # bug 377204
 == float-clear-000-print.html float-clear-000-print.ref.html
 == float-clear-001-print.html float-clear-000-print.ref.html
-fails == float-clear-002-print.html float-clear-000-print.ref.html # bug 507510
+== float-clear-002-print.html float-clear-000-print.ref.html
 fails == float-clear-003-print.html float-clear-000-print.ref.html # bug 377204
 fails == float-continuations-000.html float-continuations-000.ref.html
 == resize-reflow-000.html resize-reflow-000.ref.html
 == resize-reflow-001.html resize-reflow-001.ref.html
 == table-page-break-before-auto-1.html table-page-break-before-auto-1-ref.html
 #== table-page-break-before-auto-2.html table-page-break-before-auto-2-ref.html bug 563280
 == table-page-break-before-always-1.html table-page-break-before-auto-2-ref.html
 == table-page-break-before-left-1.html table-page-break-before-auto-2-ref.html
 == table-page-break-before-right-1.html table-page-break-before-auto-2-ref.html
 == table-page-break-after-always-1.html table-page-break-before-auto-2-ref.html
 == table-page-break-after-left-1.html table-page-break-before-auto-2-ref.html
 == table-page-break-after-right-1.html table-page-break-before-auto-2-ref.html
 == rowgroup-page-break-after-always-1.html table-page-break-before-auto-2-ref.html
 == row-page-break-after-always-1.html table-page-break-before-auto-2-ref.html
 == row-page-break-after-always-2.html table-page-break-before-auto-2-ref.html
 == rowgroup-thead-page-break-after-always-1.html table-page-break-before-auto-3-ref.html 
-== rowgroup-tfoot-page-break-after-always-1.html table-page-break-before-auto-3-ref.html
\ No newline at end of file
+== rowgroup-tfoot-page-break-after-always-1.html table-page-break-before-auto-3-ref.html
