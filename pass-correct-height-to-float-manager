From: L. David Baron <dbaron@dbaron.org>

Pass correct *remaining* height to float manager, rather than the whole height of the content area.  (Bug 563584)

diff --git a/layout/generic/nsBlockReflowState.cpp b/layout/generic/nsBlockReflowState.cpp
--- a/layout/generic/nsBlockReflowState.cpp
+++ b/layout/generic/nsBlockReflowState.cpp
@@ -327,21 +327,22 @@ nsBlockReflowState::GetFloatAvailableSpa
 #ifdef DEBUG
   // Verify that the caller setup the coordinate system properly
   nscoord wx, wy;
   mFloatManager->GetTranslation(wx, wy);
   NS_ASSERTION((wx == mFloatManagerX) && (wy == mFloatManagerY),
                "bad coord system");
 #endif
 
+  nscoord y = aY - BorderPadding().top;
+  nscoord height = (mContentArea.height == nscoord_MAX)
+                     ? nscoord_MAX : NS_MAX(mContentArea.height - y, 0);
   nsFlowAreaRect result =
-    mFloatManager->GetFlowArea(aY - BorderPadding().top, 
-                               nsFloatManager::BAND_FROM_POINT,
-                               mContentArea.height, mContentArea.width,
-                               aState);
+    mFloatManager->GetFlowArea(y, nsFloatManager::BAND_FROM_POINT,
+                               height, mContentArea.width, aState);
   // Keep the width >= 0 for compatibility with nsSpaceManager.
   if (result.mRect.width < 0)
     result.mRect.width = 0;
 
 #ifdef DEBUG
   if (nsBlockFrame::gNoisyReflow) {
     nsFrame::IndentBy(stdout, nsBlockFrame::gNoiseIndent);
     printf("GetAvailableSpace: band=%d,%d,%d,%d hasfloats=%d\n",
