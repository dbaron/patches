From: L. David Baron <dbaron@dbaron.org>

Bug 960465 patch N - Use new no-selector-matching hints for animation restyles.

diff --git a/layout/style/AnimationCommon.h b/layout/style/AnimationCommon.h
--- a/layout/style/AnimationCommon.h
+++ b/layout/style/AnimationCommon.h
@@ -422,32 +422,45 @@ struct CommonElementAnimationData : publ
            mElementProperty == nsGkAtoms::transitionsOfBeforeProperty;
   }
 
   bool IsForAfterPseudo() const {
     return mElementProperty == nsGkAtoms::animationsOfAfterProperty ||
            mElementProperty == nsGkAtoms::transitionsOfAfterProperty;
   }
 
+  bool IsForTransitions() const {
+    return mElementProperty == nsGkAtoms::transitionsProperty ||
+           mElementProperty == nsGkAtoms::transitionsOfBeforeProperty ||
+           mElementProperty == nsGkAtoms::transitionsOfAfterProperty;
+  }
+
+  bool IsForAnimations() const {
+    return mElementProperty == nsGkAtoms::animationsProperty ||
+           mElementProperty == nsGkAtoms::animationsOfBeforeProperty ||
+           mElementProperty == nsGkAtoms::animationsOfAfterProperty;
+  }
+
   nsString PseudoElement()
   {
     if (IsForElement()) {
       return EmptyString();
     } else if (IsForBeforePseudo()) {
       return NS_LITERAL_STRING("::before");
     } else {
       return NS_LITERAL_STRING("::after");
     }
   }
 
   mozilla::dom::Element* ElementToRestyle() const;
 
   void PostRestyleForAnimation(nsPresContext *aPresContext) {
-    aPresContext->PresShell()->RestyleForAnimation(ElementToRestyle(),
-                                                   eRestyle_Self);
+    nsRestyleHint hint = IsForTransitions() ? eRestyle_CSSTransitions
+                                            : eRestyle_CSSAnimations;
+    aPresContext->PresShell()->RestyleForAnimation(ElementToRestyle(), hint);
   }
 
   static void LogAsyncAnimationFailure(nsCString& aMessage,
                                        const nsIContent* aContent = nullptr);
 
   dom::Element *mElement;
 
   // the atom we use in mElement's prop table (must be a static atom,
