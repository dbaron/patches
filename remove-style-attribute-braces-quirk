From: L. David Baron <dbaron@dbaron.org>

Bug 915053:  Remove quirk allowing {} around style attribute.  r=heycam

The tests pass with the patch; without the patch
test_style_attribute_quirks.html fails 2 tests.

diff --git a/layout/style/nsCSSParser.cpp b/layout/style/nsCSSParser.cpp
--- a/layout/style/nsCSSParser.cpp
+++ b/layout/style/nsCSSParser.cpp
@@ -953,32 +953,17 @@ CSSParserImpl::ParseStyleAttribute(const
 
   // XXX line number?
   nsCSSScanner scanner(aAttributeValue, 0);
   css::ErrorReporter reporter(scanner, mSheet, mChildLoader, aDocURI);
   InitScanner(scanner, reporter, aDocURI, aBaseURI, aNodePrincipal);
 
   mSection = eCSSSection_General;
 
-  // In quirks mode, allow style declarations to have braces or not
-  // (bug 99554).
-  bool haveBraces;
-  if (mNavQuirkMode && GetToken(true)) {
-    haveBraces = eCSSToken_Symbol == mToken.mType &&
-                 '{' == mToken.mSymbol;
-    UngetToken();
-  }
-  else {
-    haveBraces = false;
-  }
-
   uint32_t parseFlags = eParseDeclaration_AllowImportant;
-  if (haveBraces) {
-    parseFlags |= eParseDeclaration_InBraces;
-  }
 
   css::Declaration* declaration = ParseDeclarationBlock(parseFlags);
   if (declaration) {
     // Create a style rule for the declaration
     NS_ADDREF(*aResult = new css::StyleRule(nullptr, declaration));
   } else {
     *aResult = nullptr;
   }
diff --git a/layout/style/test/Makefile.in b/layout/style/test/Makefile.in
--- a/layout/style/test/Makefile.in
+++ b/layout/style/test/Makefile.in
@@ -147,16 +147,19 @@ MOCHITEST_FILES =	test_acid3_test46.html
 		test_rem_unit.html \
 		test_rule_insertion.html \
 		test_rule_serialization.html \
 		test_rules_out_of_sheets.html \
 		test_selectors.html \
 		test_selectors_on_anonymous_content.html \
 		test_shorthand_property_getters.html \
 		test_specified_value_serialization.html \
+		test_style_attribute_quirks.html \
+		test_style_attribute_standards.html \
+		style_attribute_tests.js \
 		test_style_struct_copy_constructors.html \
 		test_supports_rules.html \
 		test_system_font_serialization.html \
 		test_transitions_and_zoom.html \
 		test_transitions_cancel_near_end.html \
 		test_transitions_computed_values.html \
 		test_transitions_computed_value_combinations.html \
 		test_transitions_events.html \
diff --git a/layout/style/test/style_attribute_tests.js b/layout/style/test/style_attribute_tests.js
new file mode 100644
--- /dev/null
+++ b/layout/style/test/style_attribute_tests.js
@@ -0,0 +1,27 @@
+
+SimpleTest.waitForExplicitFinish();
+
+window.addEventListener("load", runTests, false);
+
+function runTests(event)
+{
+    if (event.target != document) {
+        return;
+    }
+
+    var elt = document.getElementById("content");
+
+    elt.setAttribute("style", "color: blue; background-color: fuchsia");
+    is(elt.style.color, "blue",
+       "setting correct style attribute (color)");
+    is(elt.style.backgroundColor, "fuchsia",
+       "setting correct style attribute (color)");
+
+    elt.setAttribute("style", "{color: blue; background-color: fuchsia}");
+    is(elt.style.color, "",
+       "setting braced style attribute (color)");
+    is(elt.style.backgroundColor, "",
+       "setting braced style attribute (color)");
+
+    SimpleTest.finish();
+}
diff --git a/layout/style/test/test_style_attribute_quirks.html b/layout/style/test/test_style_attribute_quirks.html
new file mode 100644
--- /dev/null
+++ b/layout/style/test/test_style_attribute_quirks.html
@@ -0,0 +1,18 @@
+<html>
+<!--
+https://bugzilla.mozilla.org/show_bug.cgi?id=915093
+-->
+<head>
+  <meta charset="utf-8">
+  <title>Test for Bug 915093</title>
+  <script type="application/javascript" src="/tests/SimpleTest/SimpleTest.js"></script>
+  <link rel="stylesheet" type="text/css" href="/tests/SimpleTest/test.css"/>
+  <script type="application/javascript" src="style_attribute_tests.js"></script>
+</head>
+<body>
+<a target="_blank" href="https://bugzilla.mozilla.org/show_bug.cgi?id=915093">Mozilla Bug 915093</a>
+<div id="content"></div>
+<pre id="test">
+</pre>
+</body>
+</html>
diff --git a/layout/style/test/test_style_attribute_standards.html b/layout/style/test/test_style_attribute_standards.html
new file mode 100644
--- /dev/null
+++ b/layout/style/test/test_style_attribute_standards.html
@@ -0,0 +1,19 @@
+<!DOCTYPE HTML>
+<html>
+<!--
+https://bugzilla.mozilla.org/show_bug.cgi?id=915093
+-->
+<head>
+  <meta charset="utf-8">
+  <title>Test for Bug 915093</title>
+  <script type="application/javascript" src="/tests/SimpleTest/SimpleTest.js"></script>
+  <link rel="stylesheet" type="text/css" href="/tests/SimpleTest/test.css"/>
+  <script type="application/javascript" src="style_attribute_tests.js"></script>
+</head>
+<body>
+<a target="_blank" href="https://bugzilla.mozilla.org/show_bug.cgi?id=915093">Mozilla Bug 915093</a>
+<div id="content"></div>
+<pre id="test">
+</pre>
+</body>
+</html>
