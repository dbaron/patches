From: L. David Baron <dbaron@dbaron.org>

Bug 451791 patch 2 - Report block non-empty to its parent block during margin collapsing if we encounter clearance.

diff --git a/layout/generic/nsBlockReflowContext.cpp b/layout/generic/nsBlockReflowContext.cpp
--- a/layout/generic/nsBlockReflowContext.cpp
+++ b/layout/generic/nsBlockReflowContext.cpp
@@ -131,16 +131,20 @@ nsBlockReflowContext::ComputeCollapsedBS
         if (line->IsInline()) {
           isEmpty = line->IsEmpty();
         } else {
           nsIFrame* kid = line->mFirstChild;
           if (kid == aClearanceFrame) {
             line->SetHasClearance();
             line->MarkDirty();
             dirtiedLine = true;
+            if (!setBlockIsEmpty && aBlockIsEmpty) {
+              setBlockIsEmpty = true;
+              *aBlockIsEmpty = false;
+            }
             goto done;
           }
           // Here is where we recur. Now that we have determined that a
           // generational collapse is required we need to compute the
           // child blocks margin and so in so that we can look into
           // it. For its margins to be computed we need to have a reflow
           // state for it.
 
