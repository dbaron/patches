From: L. David Baron <dbaron@dbaron.org>

Bug 1367576 - Make IsWidgetStateSafe not truncate the bits that it needs to test.  r?karlt

This fix a mistake that goes back to the original code from bug 174585
(gecko-dev 9611b23530704402a714fa39cb433a01dca0bb6e, 2005-08-20).

(This makes me wonder how important the code is in the first place if it
didn't work correctly.)

MozReview-Commit-ID: B6q0o5n5hDw

diff --git a/widget/gtk/nsNativeThemeGTK.cpp b/widget/gtk/nsNativeThemeGTK.cpp
--- a/widget/gtk/nsNativeThemeGTK.cpp
+++ b/widget/gtk/nsNativeThemeGTK.cpp
@@ -135,26 +135,26 @@ GetWidgetStateKey(uint8_t aWidgetType, G
           aWidgetType << 5);
 }
 
 static bool IsWidgetStateSafe(uint8_t* aSafeVector,
                                 uint8_t aWidgetType,
                                 GtkWidgetState *aWidgetState)
 {
   MOZ_ASSERT(aWidgetType < ThemeWidgetType_COUNT);
-  uint8_t key = GetWidgetStateKey(aWidgetType, aWidgetState);
+  uint16_t key = GetWidgetStateKey(aWidgetType, aWidgetState);
   return (aSafeVector[key >> 3] & (1 << (key & 7))) != 0;
 }
 
 static void SetWidgetStateSafe(uint8_t *aSafeVector,
                                uint8_t aWidgetType,
                                GtkWidgetState *aWidgetState)
 {
   MOZ_ASSERT(aWidgetType < ThemeWidgetType_COUNT);
-  uint8_t key = GetWidgetStateKey(aWidgetType, aWidgetState);
+  uint16_t key = GetWidgetStateKey(aWidgetType, aWidgetState);
   aSafeVector[key >> 3] |= (1 << (key & 7));
 }
 
 /* static */ GtkTextDirection
 nsNativeThemeGTK::GetTextDirection(nsIFrame* aFrame)
 {
   // IsFrameRTL() treats vertical-rl modes as right-to-left (in addition to
   // horizontal text with direction=RTL), rather than just considering the
