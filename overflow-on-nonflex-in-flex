From: L. David Baron <dbaron@dbaron.org>

Fix behavior of -moz-box-shadow on flexible non-flexbox children of flexboxes.  (Bug 531098)

diff --git a/layout/generic/nsFrame.cpp b/layout/generic/nsFrame.cpp
--- a/layout/generic/nsFrame.cpp
+++ b/layout/generic/nsFrame.cpp
@@ -6354,16 +6354,19 @@ nsFrame::DoLayout(nsBoxLayoutState& aSta
       }
 
       // ensure our size is what we think is should be. Someone could have
       // reset the frame to be smaller or something dumb like that. 
       SetSize(nsSize(ourRect.width, ourRect.height));
     }
   }
 
+  // Should we do this if IsCollapsed() is true?
+  FinishAndStoreOverflow(&desiredSize.mOverflowArea, GetSize());
+
   SyncLayout(aState);
 
   return rv;
 }
 
 nsresult
 nsFrame::BoxReflow(nsBoxLayoutState&        aState,
                    nsPresContext*           aPresContext,
