From: L. David Baron <dbaron@dbaron.org>

Bug 1432341 - Add reftest for column-rule broken across columns.  r=mattwoodrow

I tested locally that the reftest fails without the previous patch, and
passes with it.  The failure is because the column rules overflow (as
though they're drawn in each column for the entire extent of the inner
columnset rather than just the piece visible in that column, i.e.,
overflowing only below in the first column, above and below in the
second column, and only above in the third column).

MozReview-Commit-ID: 4bDcnYiXEQt

diff --git a/layout/reftests/w3c-css/submitted/multicol3/broken-column-rule-1-ref.html b/layout/reftests/w3c-css/submitted/multicol3/broken-column-rule-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/w3c-css/submitted/multicol3/broken-column-rule-1-ref.html
@@ -0,0 +1,31 @@
+<!DOCTYPE HTML>
+<title>CSS Test Reference: breaking of column rule</title>
+<meta charset="utf-8">
+<link rel="author" title="L. David Baron" href="https://dbaron.org/">
+<style>
+
+.ref1, .ref2 {
+  display: inline-block;
+  vertical-align: top;
+
+  border: 2px solid blue;
+  border-top: none;
+  border-bottom: none;
+}
+
+.ref1 {
+  margin-left:49px;
+  height: 100px;
+  width: 148px;
+}
+
+.ref2 {
+  margin-left: 148px;
+  height: 50px;
+  width: 10px;
+
+  border-right: none;
+}
+
+</style>
+<span class="ref1"></span><span class="ref2"></span>
diff --git a/layout/reftests/w3c-css/submitted/multicol3/broken-column-rule-1.html b/layout/reftests/w3c-css/submitted/multicol3/broken-column-rule-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/w3c-css/submitted/multicol3/broken-column-rule-1.html
@@ -0,0 +1,34 @@
+<!DOCTYPE HTML>
+<title>CSS Test: breaking of column rule</title>
+<meta charset="utf-8">
+<link rel="author" title="L. David Baron" href="https://dbaron.org/">
+<link rel="help" href="https://drafts.csswg.org/css-multicol/#column-gaps-and-rules">
+<link rel="match" href="broken-column-rule-1-ref.html">
+<style>
+
+.outer {
+  height: 100px;
+  column-fill: auto;
+  width: 550px;
+  column-count: 4;
+  column-gap: 50px;
+  /* leaves 100px for each column */
+}
+
+.inner {
+  column-count: 2;
+  column-rule: 2px solid blue;
+  height: 250px;
+}
+
+.fill {
+  height: 500px; /* work around https://bugzilla.mozilla.org/show_bug.cgi?id=1374479#c4 */
+}
+
+</style>
+
+<div class="outer">
+  <div class="inner">
+    <div class="fill"></div>
+  </div>
+</div>
diff --git a/layout/reftests/w3c-css/submitted/multicol3/reftest.list b/layout/reftests/w3c-css/submitted/multicol3/reftest.list
--- a/layout/reftests/w3c-css/submitted/multicol3/reftest.list
+++ b/layout/reftests/w3c-css/submitted/multicol3/reftest.list
@@ -1,2 +1,3 @@
+== broken-column-rule-1.html broken-column-rule-1-ref.html
 == moz-multicol3-column-balancing-break-inside-avoid-1.html moz-multicol3-column-balancing-break-inside-avoid-1-ref.html
 == multicol-height-002.xht reference/multicol-height-002.xht
