From: L. David Baron <dbaron@dbaron.org>

Bug 1035001 - Ensure consistent realloc semantics across platforms, trace-malloc part.

diff --git a/tools/trace-malloc/lib/nsTraceMalloc.c b/tools/trace-malloc/lib/nsTraceMalloc.c
--- a/tools/trace-malloc/lib/nsTraceMalloc.c
+++ b/tools/trace-malloc/lib/nsTraceMalloc.c
@@ -1207,16 +1207,22 @@ calloc(size_t count, size_t size)
 
 NS_EXTERNAL_VIS_(__ptr_t)
 realloc(__ptr_t oldptr, size_t size)
 {
     uint32_t start, end;
     __ptr_t ptr;
     tm_thread *t;
 
+    // Ensure that we have reasonable realloc semantics, regardless of the
+    // underlying malloc implementation.
+    if (!oldptr && !size) {
+        return NULL;
+    }
+
     if (!tracing_enabled || !PR_Initialized() ||
         (t = tm_get_thread())->suppress_tracing != 0) {
         return __libc_realloc(oldptr, size);
     }
 
     t->suppress_tracing++;
     start = PR_IntervalNow();
     ptr = __libc_realloc(oldptr, size);
