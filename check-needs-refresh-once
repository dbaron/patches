From: L. David Baron <dbaron@dbaron.org>

Bug 847287 patch 10 - Only call CheckNeedsRefresh if we might have changed mNeedsRefreshes, to make it cheaper to call EnsureStyleRuleFor more than once per refresh cycle.

This saves some extra work that we don't need to do.

diff --git a/layout/style/AnimationCommon.cpp b/layout/style/AnimationCommon.cpp
--- a/layout/style/AnimationCommon.cpp
+++ b/layout/style/AnimationCommon.cpp
@@ -805,19 +805,19 @@ AnimationPlayerCollection::EnsureStyleRu
     // As a result, we iterate from last animation to first and, if a
     // property has already been set, we don't leave it.
     nsCSSPropertySet properties;
 
     for (size_t playerIdx = mPlayers.Length(); playerIdx-- != 0; ) {
       mPlayers[playerIdx]->ComposeStyle(mStyleRule, properties,
                                         mNeedsRefreshes);
     }
+
+    mManager->CheckNeedsRefresh();
   }
-
-  mManager->CheckNeedsRefresh();
 }
 
 bool
 AnimationPlayerCollection::CanThrottleTransformChanges(TimeStamp aTime)
 {
   if (!nsLayoutUtils::AreAsyncAnimationsEnabled()) {
     return false;
   }
