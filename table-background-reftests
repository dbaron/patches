Add some reftests for table background painting.

diff --git a/layout/reftests/table-background/border-collapse-table-cell-ref.html b/layout/reftests/table-background/border-collapse-table-cell-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-collapse-table-cell-ref.html
@@ -0,0 +1,61 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	/*
+	table { 
+		margin: 0px 3px 2px 4px;
+		border-width: 4px 2px 8px 6px;
+
+		height is 97px:
+		  (2px of border outside height)
+		  extra border width for top row: 0
+		  cell * 5: == 19px * 5 == 95px
+		    border-top: 2px;
+		    padding-top: 1px;
+		    height: 10px;
+		    padding-bottom: 4px;
+		    border-bottom: 2px;
+		  extra border width for top row: 2px
+		  (4px of border outside height)
+
+		width is 287px:
+		  (3px of border outside width)
+		  extra border width for left column: 2px
+		  cell * 5: == 57px * 5 == 285px
+		    border-left: 1px;
+		    padding-left: 3px;
+		    width: 50px;
+		    padding-right: 2px;
+		    border-right: 1px;
+		  (1px of border outside width)
+    */
+
+	div { width: 57px; height: 19px; margin: 38px 117px 80px 120px; }
+	div.color { background-color: aqua; }
+
+	div.imagetl, div.imagebr {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	div.imagetl { background-position: 1px 2px; }
+	div.imagebr { background-position: 56px 17px; }
+
+	</style>
+</head>
+<body>
+
+<div class="color"></div>
+<div class="imagetl"></div>
+<div class="imagebr"></div>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-collapse-table-cell.html b/layout/reftests/table-background/border-collapse-table-cell.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-collapse-table-cell.html
@@ -0,0 +1,107 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	table { 
+		margin: 0 3px 2px 4px; /* zero top to work around collapsing bug */
+		border: transparent solid;
+		border-width: 4px 2px 8px 6px; /* collapsed */
+		padding: 3px 7px 8px 6px; /* ignored */
+		border-collapse: collapse;
+	}
+
+	td {
+		border: transparent solid;
+		border-width: 2px 0 4px 2px; /* collapsed */
+		padding: 1px 2px 4px 3px;
+		empty-cells: show;
+	}
+
+	div { height: 10px; width: 50px; }
+
+	table.color td.t { background-color: aqua; }
+
+	table.imagetl td.t, table.imagebr td.t {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	table.imagetl td.t { background-position: top left; /* default */ }
+	table.imagebr td.t { background-position: bottom right; /* default */ }
+
+	</style>
+</head>
+<body>
+
+<table class="color">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagetl">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagebr">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-collapse-table-column-group-ref.html b/layout/reftests/table-background/border-collapse-table-column-group-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-collapse-table-column-group-ref.html
@@ -0,0 +1,61 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	/*
+	table { 
+		margin: 0px 3px 2px 4px;
+		border-width: 4px 2px 8px 6px;
+
+		height is 97px:
+		  (2px of border outside height)
+		  extra border width for top row: 0
+		  cell * 5: == 19px * 5 == 95px
+		    border-top: 2px;
+		    padding-top: 1px;
+		    height: 10px;
+		    padding-bottom: 4px;
+		    border-bottom: 2px;
+		  extra border width for top row: 2px
+		  (4px of border outside height)
+
+		width is 287px:
+		  (3px of border outside width)
+		  extra border width for left column: 2px
+		  cell * 5: == 57px * 5 == 285px
+		    border-left: 1px;
+		    padding-left: 3px;
+		    width: 50px;
+		    padding-right: 2px;
+		    border-right: 1px;
+		  (1px of border outside width)
+    */
+
+	div { width: 171px; height: 97px; margin: 0px 60px 2px 63px; }
+	div.color { background-color: aqua; }
+
+	div.imagetl, div.imagebr {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	div.imagetl { background-position: 0 0; }
+	div.imagebr { background-position: 171px 97px; }
+
+	</style>
+</head>
+<body>
+
+<div class="color"></div>
+<div class="imagetl"></div>
+<div class="imagebr"></div>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-collapse-table-column-group.html b/layout/reftests/table-background/border-collapse-table-column-group.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-collapse-table-column-group.html
@@ -0,0 +1,107 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	table { 
+		margin: 0 3px 2px 4px; /* zero top to work around collapsing bug */
+		border: transparent solid;
+		border-width: 4px 2px 8px 6px; /* collapsed */
+		padding: 3px 7px 8px 6px; /* ignored */
+		border-collapse: collapse;
+	}
+
+	td {
+		border: transparent solid;
+		border-width: 2px 0 4px 2px; /* collapsed */
+		padding: 1px 2px 4px 3px;
+		empty-cells: show;
+	}
+
+	div { height: 10px; width: 50px; }
+
+	table.color colgroup.t { background-color: aqua; }
+
+	table.imagetl colgroup.t, table.imagebr colgroup.t {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	table.imagetl colgroup.t { background-position: top left; /* default */ }
+	table.imagebr colgroup.t { background-position: bottom right; /* default */ }
+
+	</style>
+</head>
+<body>
+
+<table class="color">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagetl">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagebr">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-collapse-table-column-ref.html b/layout/reftests/table-background/border-collapse-table-column-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-collapse-table-column-ref.html
@@ -0,0 +1,61 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	/*
+	table { 
+		margin: 0px 3px 2px 4px;
+		border-width: 4px 2px 8px 6px;
+
+		height is 97px:
+		  (2px of border outside height)
+		  extra border width for top row: 0
+		  cell * 5: == 19px * 5 == 95px
+		    border-top: 2px;
+		    padding-top: 1px;
+		    height: 10px;
+		    padding-bottom: 4px;
+		    border-bottom: 2px;
+		  extra border width for top row: 2px
+		  (4px of border outside height)
+
+		width is 287px:
+		  (3px of border outside width)
+		  extra border width for left column: 2px
+		  cell * 5: == 57px * 5 == 285px
+		    border-left: 1px;
+		    padding-left: 3px;
+		    width: 50px;
+		    padding-right: 2px;
+		    border-right: 1px;
+		  (1px of border outside width)
+    */
+
+	div { width: 57px; height: 97px; margin: 0px 117px 2px 120px; }
+	div.color { background-color: aqua; }
+
+	div.imagetl, div.imagebr {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	div.imagetl { background-position: 0 0; }
+	div.imagebr { background-position: 57px 97px; }
+
+	</style>
+</head>
+<body>
+
+<div class="color"></div>
+<div class="imagetl"></div>
+<div class="imagebr"></div>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-collapse-table-column.html b/layout/reftests/table-background/border-collapse-table-column.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-collapse-table-column.html
@@ -0,0 +1,107 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	table { 
+		margin: 0 3px 2px 4px; /* zero top to work around collapsing bug */
+		border: transparent solid;
+		border-width: 4px 2px 8px 6px; /* collapsed */
+		padding: 3px 7px 8px 6px; /* ignored */
+		border-collapse: collapse;
+	}
+
+	td {
+		border: transparent solid;
+		border-width: 2px 0 4px 2px; /* collapsed */
+		padding: 1px 2px 4px 3px;
+		empty-cells: show;
+	}
+
+	div { height: 10px; width: 50px; }
+
+	table.color col.t { background-color: aqua; }
+
+	table.imagetl col.t, table.imagebr col.t {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	table.imagetl col.t { background-position: top left; /* default */ }
+	table.imagebr col.t { background-position: bottom right; /* default */ }
+
+	</style>
+</head>
+<body>
+
+<table class="color">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagetl">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagebr">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-collapse-table-ref.html b/layout/reftests/table-background/border-collapse-table-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-collapse-table-ref.html
@@ -0,0 +1,61 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	/*
+	table { 
+		margin: 0px 3px 2px 4px;
+		border-width: 4px 2px 8px 6px;
+
+		height is 97px:
+		  (2px of border outside height)
+		  extra border width for top row: 0
+		  cell * 5: == 19px * 5 == 95px
+		    border-top: 2px;
+		    padding-top: 1px;
+		    height: 10px;
+		    padding-bottom: 4px;
+		    border-bottom: 2px;
+		  extra border width for top row: 2px
+		  (4px of border outside height)
+
+		width is 287px:
+		  (3px of border outside width)
+		  extra border width for left column: 2px
+		  cell * 5: == 57px * 5 == 285px
+		    border-left: 1px;
+		    padding-left: 3px;
+		    width: 50px;
+		    padding-right: 2px;
+		    border-right: 1px;
+		  (1px of border outside width)
+    */
+
+	div { width: 287px; height: 97px; margin: 0px 3px 2px 4px; }
+	div.color { background-color: aqua; }
+
+	div.imagetl, div.imagebr {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	div.imagetl { background-position: 0 0; }
+	div.imagebr { background-position: 287px 97px; }
+
+	</style>
+</head>
+<body>
+
+<div class="color"></div>
+<div class="imagetl"></div>
+<div class="imagebr"></div>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-collapse-table-row-group-ref.html b/layout/reftests/table-background/border-collapse-table-row-group-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-collapse-table-row-group-ref.html
@@ -0,0 +1,61 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	/*
+	table { 
+		margin: 0px 3px 2px 4px;
+		border-width: 4px 2px 8px 6px;
+
+		height is 97px:
+		  (2px of border outside height)
+		  extra border width for top row: 0
+		  cell * 5: == 19px * 5 == 95px
+		    border-top: 2px;
+		    padding-top: 1px;
+		    height: 10px;
+		    padding-bottom: 4px;
+		    border-bottom: 2px;
+		  extra border width for top row: 2px
+		  (4px of border outside height)
+
+		width is 287px:
+		  (3px of border outside width)
+		  extra border width for left column: 2px
+		  cell * 5: == 57px * 5 == 285px
+		    border-left: 1px;
+		    padding-left: 3px;
+		    width: 50px;
+		    padding-right: 2px;
+		    border-right: 1px;
+		  (1px of border outside width)
+    */
+
+	div { width: 287px; height: 57px; margin: 19px 3px 42px 4px; }
+	div.color { background-color: aqua; }
+
+	div.imagetl, div.imagebr {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	div.imagetl { background-position: 0 0; }
+	div.imagebr { background-position: 287px 57px; }
+
+	</style>
+</head>
+<body>
+
+<div class="color"></div>
+<div class="imagetl"></div>
+<div class="imagebr"></div>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-collapse-table-row-group.html b/layout/reftests/table-background/border-collapse-table-row-group.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-collapse-table-row-group.html
@@ -0,0 +1,107 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	table { 
+		margin: 0 3px 2px 4px; /* zero top to work around collapsing bug */
+		border: transparent solid;
+		border-width: 4px 2px 8px 6px; /* collapsed */
+		padding: 3px 7px 8px 6px; /* ignored */
+		border-collapse: collapse;
+	}
+
+	td {
+		border: transparent solid;
+		border-width: 2px 0 4px 2px; /* collapsed */
+		padding: 1px 2px 4px 3px;
+		empty-cells: show;
+	}
+
+	div { height: 10px; width: 50px; }
+
+	table.color tbody.t { background-color: aqua; }
+
+	table.imagetl tbody.t, table.imagebr tbody.t {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	table.imagetl tbody.t { background-position: top left; /* default */ }
+	table.imagebr tbody.t { background-position: bottom right; /* default */ }
+
+	</style>
+</head>
+<body>
+
+<table class="color">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagetl">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagebr">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-collapse-table-row-ref.html b/layout/reftests/table-background/border-collapse-table-row-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-collapse-table-row-ref.html
@@ -0,0 +1,61 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	/*
+	table { 
+		margin: 0px 3px 2px 4px;
+		border-width: 4px 2px 8px 6px;
+
+		height is 97px:
+		  (2px of border outside height)
+		  extra border width for top row: 0
+		  cell * 5: == 19px * 5 == 95px
+		    border-top: 2px;
+		    padding-top: 1px;
+		    height: 10px;
+		    padding-bottom: 4px;
+		    border-bottom: 2px;
+		  extra border width for top row: 2px
+		  (4px of border outside height)
+
+		width is 287px:
+		  (3px of border outside width)
+		  extra border width for left column: 2px
+		  cell * 5: == 57px * 5 == 285px
+		    border-left: 1px;
+		    padding-left: 3px;
+		    width: 50px;
+		    padding-right: 2px;
+		    border-right: 1px;
+		  (1px of border outside width)
+    */
+
+	div { width: 287px; height: 19px; margin: 38px 3px 80px 4px; }
+	div.color { background-color: aqua; }
+
+	div.imagetl, div.imagebr {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	div.imagetl { background-position: 0 0; }
+	div.imagebr { background-position: 287px 19px; }
+
+	</style>
+</head>
+<body>
+
+<div class="color"></div>
+<div class="imagetl"></div>
+<div class="imagebr"></div>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-collapse-table-row.html b/layout/reftests/table-background/border-collapse-table-row.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-collapse-table-row.html
@@ -0,0 +1,107 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	table { 
+		margin: 0 3px 2px 4px; /* zero top to work around collapsing bug */
+		border: transparent solid;
+		border-width: 4px 2px 8px 6px; /* collapsed */
+		padding: 3px 7px 8px 6px; /* ignored */
+		border-collapse: collapse;
+	}
+
+	td {
+		border: transparent solid;
+		border-width: 2px 0 4px 2px; /* collapsed */
+		padding: 1px 2px 4px 3px;
+		empty-cells: show;
+	}
+
+	div { height: 10px; width: 50px; }
+
+	table.color tr.t { background-color: aqua; }
+
+	table.imagetl tr.t, table.imagebr tr.t {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	table.imagetl tr.t { background-position: top left; /* default */ }
+	table.imagebr tr.t { background-position: bottom right; /* default */ }
+
+	</style>
+</head>
+<body>
+
+<table class="color">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagetl">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagebr">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-collapse-table.html b/layout/reftests/table-background/border-collapse-table.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-collapse-table.html
@@ -0,0 +1,107 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	table { 
+		margin: 0 3px 2px 4px; /* zero top to work around collapsing bug */
+		border: transparent solid;
+		border-width: 4px 2px 8px 6px; /* collapsed */
+		padding: 3px 7px 8px 6px; /* ignored */
+		border-collapse: collapse;
+	}
+
+	td {
+		border: transparent solid;
+		border-width: 2px 0 4px 2px; /* collapsed */
+		padding: 1px 2px 4px 3px;
+		empty-cells: show;
+	}
+
+	div { height: 10px; width: 50px; }
+
+	table.color { background-color: aqua; }
+
+	table.imagetl, table.imagebr {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	table.imagetl { background-position: top left; /* default */ }
+	table.imagebr { background-position: bottom right; /* default */ }
+
+	</style>
+</head>
+<body>
+
+<table class="color">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagetl">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagebr">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-separate-table-cell-ref.html b/layout/reftests/table-background/border-separate-table-cell-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-separate-table-cell-ref.html
@@ -0,0 +1,66 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	/*
+	table { 
+		margin: 0px 3px 2px 4px;
+		border-width: 4px 2px 7px 3px;
+
+		border-box height is 145px:
+		  border-top: 4px;
+		  padding-top: 3px
+		  border-spacing: 3px * 6 == 18px
+		  cell * 5: == 21px * 5 == 105px
+		    border-top: 2px;
+		    padding-top: 1px;
+		    height: 10px;
+		    padding-bottom: 4px;
+		    border-bottom: 4px;
+		  padding-bottom: 8px;
+		  border-bottom: 7px;
+
+		border-box width is 325px:
+		  border-left: 3px;
+		  padding-left: 6px
+		  border-spacing: 2px * 6 == 12px
+		  cell * 5: == 59px * 5 == 295px
+		    border-left: 3px;
+		    padding-left: 3px;
+		    width: 50px;
+		    padding-right: 2px;
+		    border-right: 1px;
+		  padding-right: 7px;
+		  border-right: 2px;
+    */
+
+	div.color, div.imagetl, div.imagebr {
+        width: 59px; height: 21px; margin: 58px 136px 126px 137px;
+	}
+	div.color { background-color: aqua; }
+
+	div.imagetl, div.imagebr {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	div.imagetl { background-position: 3px 2px; }
+	div.imagebr { background-position: 17px 58px; }
+
+	</style>
+</head>
+<body>
+
+<div class="color"></div>
+<div class="imagetl"></div>
+<div class="imagebr"></div>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-separate-table-cell.html b/layout/reftests/table-background/border-separate-table-cell.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-separate-table-cell.html
@@ -0,0 +1,108 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	table { 
+		margin: 0 3px 2px 4px; /* zero top to work around collapsing bug */
+		border: transparent solid;
+		border-width: 4px 2px 7px 3px;
+		padding: 3px 7px 8px 6px;
+		border-collapse: separate;
+		border-spacing: 2px 3px;
+	}
+
+	td {
+		border: transparent solid;
+		border-width: 2px 1px 4px 3px;
+		padding: 1px 2px 4px 3px;
+		empty-cells: show;
+	}
+
+	div { height: 10px; width: 50px; }
+
+	table.color td.t { background-color: aqua; }
+
+	table.imagetl td.t, table.imagebr td.t {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	table.imagetl td.t { background-position: top left; /* default */ }
+	table.imagebr td.t { background-position: bottom right; /* default */ }
+
+	</style>
+</head>
+<body>
+
+<table class="color">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagetl">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagebr">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-separate-table-column-group-ref.html b/layout/reftests/table-background/border-separate-table-column-group-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-separate-table-column-group-ref.html
@@ -0,0 +1,89 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	/*
+	table { 
+		margin: 0px 3px 2px 4px;
+		border-width: 4px 2px 7px 3px;
+
+		border-box height is 145px:
+		  border-top: 4px;
+		  padding-top: 3px
+		  border-spacing: 3px * 6 == 18px
+		  cell * 5: == 21px * 5 == 105px
+		    border-top: 2px;
+		    padding-top: 1px;
+		    height: 10px;
+		    padding-bottom: 4px;
+		    border-bottom: 4px;
+		  padding-bottom: 8px;
+		  border-bottom: 7px;
+
+		border-box width is 325px:
+		  border-left: 3px;
+		  padding-left: 6px
+		  border-spacing: 2px * 6 == 12px
+		  cell * 5: == 59px * 5 == 295px
+		    border-left: 3px;
+		    padding-left: 3px;
+		    width: 50px;
+		    padding-right: 2px;
+		    border-right: 1px;
+		  padding-right: 7px;
+		  border-right: 2px;
+    */
+
+	div.color, div.imagetl, div.imagebr {
+        width: 181px; height: 117px; margin: 10px 75px 30px 76px;
+	}
+	div.color { background-color: aqua; }
+
+	div.imagetl, div.imagebr {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	div.imagetl { background-position: 0 0; }
+	div.imagebr { background-position: 117px 181px; }
+
+	div.vstripe, div.hstripe { background: white; position: absolute; }
+	div.vstripe { top: 0; width: 2px; height: 500px; }
+	div.hstripe { left: 0; height: 3px; width: 400px; }
+
+	</style>
+</head>
+<body>
+
+<div class="color"></div>
+<div class="imagetl"></div>
+<div class="imagebr"></div>
+
+<div class="hstripe" style="top: 46px"></div>
+<div class="hstripe" style="top: 70px"></div>
+<div class="hstripe" style="top: 94px"></div>
+<div class="hstripe" style="top: 118px"></div>
+<div class="hstripe" style="top: 193px"></div>
+<div class="hstripe" style="top: 217px"></div>
+<div class="hstripe" style="top: 241px"></div>
+<div class="hstripe" style="top: 265px"></div>
+<div class="hstripe" style="top: 340px"></div>
+<div class="hstripe" style="top: 364px"></div>
+<div class="hstripe" style="top: 388px"></div>
+<div class="hstripe" style="top: 412px"></div>
+
+<div class="vstripe" style="left: 89px"></div>
+<div class="vstripe" style="left: 150px"></div>
+<div class="vstripe" style="left: 211px"></div>
+<div class="vstripe" style="left: 272px"></div>
+<div class="vstripe" style="left: 333px"></div>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-separate-table-column-group.html b/layout/reftests/table-background/border-separate-table-column-group.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-separate-table-column-group.html
@@ -0,0 +1,108 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	table { 
+		margin: 0 3px 2px 4px; /* zero top to work around collapsing bug */
+		border: transparent solid;
+		border-width: 4px 2px 7px 3px;
+		padding: 3px 7px 8px 6px;
+		border-collapse: separate;
+		border-spacing: 2px 3px;
+	}
+
+	td {
+		border: transparent solid;
+		border-width: 2px 1px 4px 3px;
+		padding: 1px 2px 4px 3px;
+		empty-cells: show;
+	}
+
+	div { height: 10px; width: 50px; }
+
+	table.color colgroup.t { background-color: aqua; }
+
+	table.imagetl colgroup.t, table.imagebr colgroup.t {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	table.imagetl colgroup.t { background-position: top left; /* default */ }
+	table.imagebr colgroup.t { background-position: bottom right; /* default */ }
+
+	</style>
+</head>
+<body>
+
+<table class="color">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagetl">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagebr">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-separate-table-column-ref.html b/layout/reftests/table-background/border-separate-table-column-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-separate-table-column-ref.html
@@ -0,0 +1,89 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	/*
+	table { 
+		margin: 0px 3px 2px 4px;
+		border-width: 4px 2px 7px 3px;
+
+		border-box height is 145px:
+		  border-top: 4px;
+		  padding-top: 3px
+		  border-spacing: 3px * 6 == 18px
+		  cell * 5: == 21px * 5 == 105px
+		    border-top: 2px;
+		    padding-top: 1px;
+		    height: 10px;
+		    padding-bottom: 4px;
+		    border-bottom: 4px;
+		  padding-bottom: 8px;
+		  border-bottom: 7px;
+
+		border-box width is 325px:
+		  border-left: 3px;
+		  padding-left: 6px
+		  border-spacing: 2px * 6 == 12px
+		  cell * 5: == 59px * 5 == 295px
+		    border-left: 3px;
+		    padding-left: 3px;
+		    width: 50px;
+		    padding-right: 2px;
+		    border-right: 1px;
+		  padding-right: 7px;
+		  border-right: 2px;
+    */
+
+	div.color, div.imagetl, div.imagebr {
+        width: 59px; height: 117px; margin: 10px 136px 30px 137px;
+	}
+	div.color { background-color: aqua; }
+
+	div.imagetl, div.imagebr {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	div.imagetl { background-position: 0 0; }
+	div.imagebr { background-position: 117px 59px; }
+
+	div.vstripe, div.hstripe { background: white; position: absolute; }
+	div.vstripe { top: 0; width: 2px; height: 500px; }
+	div.hstripe { left: 0; height: 3px; width: 400px; }
+
+	</style>
+</head>
+<body>
+
+<div class="color"></div>
+<div class="imagetl"></div>
+<div class="imagebr"></div>
+
+<div class="hstripe" style="top: 46px"></div>
+<div class="hstripe" style="top: 70px"></div>
+<div class="hstripe" style="top: 94px"></div>
+<div class="hstripe" style="top: 118px"></div>
+<div class="hstripe" style="top: 193px"></div>
+<div class="hstripe" style="top: 217px"></div>
+<div class="hstripe" style="top: 241px"></div>
+<div class="hstripe" style="top: 265px"></div>
+<div class="hstripe" style="top: 340px"></div>
+<div class="hstripe" style="top: 364px"></div>
+<div class="hstripe" style="top: 388px"></div>
+<div class="hstripe" style="top: 412px"></div>
+
+<div class="vstripe" style="left: 89px"></div>
+<div class="vstripe" style="left: 150px"></div>
+<div class="vstripe" style="left: 211px"></div>
+<div class="vstripe" style="left: 272px"></div>
+<div class="vstripe" style="left: 333px"></div>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-separate-table-column.html b/layout/reftests/table-background/border-separate-table-column.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-separate-table-column.html
@@ -0,0 +1,108 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	table { 
+		margin: 0 3px 2px 4px; /* zero top to work around collapsing bug */
+		border: transparent solid;
+		border-width: 4px 2px 7px 3px;
+		padding: 3px 7px 8px 6px;
+		border-collapse: separate;
+		border-spacing: 2px 3px;
+	}
+
+	td {
+		border: transparent solid;
+		border-width: 2px 1px 4px 3px;
+		padding: 1px 2px 4px 3px;
+		empty-cells: show;
+	}
+
+	div { height: 10px; width: 50px; }
+
+	table.color col.t { background-color: aqua; }
+
+	table.imagetl col.t, table.imagebr col.t {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	table.imagetl col.t { background-position: top left; /* default */ }
+	table.imagebr col.t { background-position: bottom right; /* default */ }
+
+	</style>
+</head>
+<body>
+
+<table class="color">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagetl">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagebr">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-separate-table-ref.html b/layout/reftests/table-background/border-separate-table-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-separate-table-ref.html
@@ -0,0 +1,64 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	/*
+	table { 
+		margin: 0px 3px 2px 4px;
+		border-width: 4px 2px 7px 3px;
+
+		border-box height is 145px:
+		  border-top: 4px;
+		  padding-top: 3px
+		  border-spacing: 3px * 6 == 18px
+		  cell * 5: == 21px * 5 == 105px
+		    border-top: 2px;
+		    padding-top: 1px;
+		    height: 10px;
+		    padding-bottom: 4px;
+		    border-bottom: 4px;
+		  padding-bottom: 8px;
+		  border-bottom: 7px;
+
+		border-box width is 325px:
+		  border-left: 3px;
+		  padding-left: 6px
+		  border-spacing: 2px * 6 == 12px
+		  cell * 5: == 59px * 5 == 295px
+		    border-left: 3px;
+		    padding-left: 3px;
+		    width: 50px;
+		    padding-right: 2px;
+		    border-right: 1px;
+		  padding-right: 7px;
+		  border-right: 2px;
+    */
+
+	div { width: 325px; height: 145px; margin: 0px 3px 2px 4px; }
+	div.color { background-color: aqua; }
+
+	div.imagetl, div.imagebr {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	div.imagetl { background-position: 4px 3px; }
+	div.imagebr { background-position: 138px 323px; }
+
+	</style>
+</head>
+<body>
+
+<div class="color"></div>
+<div class="imagetl"></div>
+<div class="imagebr"></div>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-separate-table-row-group-ref.html b/layout/reftests/table-background/border-separate-table-row-group-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-separate-table-row-group-ref.html
@@ -0,0 +1,89 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	/*
+	table { 
+		margin: 0px 3px 2px 4px;
+		border-width: 4px 2px 7px 3px;
+
+		border-box height is 145px:
+		  border-top: 4px;
+		  padding-top: 3px
+		  border-spacing: 3px * 6 == 18px
+		  cell * 5: == 21px * 5 == 105px
+		    border-top: 2px;
+		    padding-top: 1px;
+		    height: 10px;
+		    padding-bottom: 4px;
+		    border-bottom: 4px;
+		  padding-bottom: 8px;
+		  border-bottom: 7px;
+
+		border-box width is 325px:
+		  border-left: 3px;
+		  padding-left: 6px
+		  border-spacing: 2px * 6 == 12px
+		  cell * 5: == 59px * 5 == 295px
+		    border-left: 3px;
+		    padding-left: 3px;
+		    width: 50px;
+		    padding-right: 2px;
+		    border-right: 1px;
+		  padding-right: 7px;
+		  border-right: 2px;
+    */
+
+	div.color, div.imagetl, div.imagebr {
+        width: 303px; height: 69px; margin: 34px 14px 78px 15px;
+	}
+	div.color { background-color: aqua; }
+
+	div.imagetl, div.imagebr {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	div.imagetl { background-position: 0 0; }
+	div.imagebr { background-position: 69px 303px; }
+
+	div.vstripe, div.hstripe { background: white; position: absolute; }
+	div.vstripe { top: 0; width: 2px; height: 500px; }
+	div.hstripe { left: 0; height: 3px; width: 400px; }
+
+	</style>
+</head>
+<body>
+
+<div class="color"></div>
+<div class="imagetl"></div>
+<div class="imagebr"></div>
+
+<div class="hstripe" style="top: 46px"></div>
+<div class="hstripe" style="top: 70px"></div>
+<div class="hstripe" style="top: 94px"></div>
+<div class="hstripe" style="top: 118px"></div>
+<div class="hstripe" style="top: 193px"></div>
+<div class="hstripe" style="top: 217px"></div>
+<div class="hstripe" style="top: 241px"></div>
+<div class="hstripe" style="top: 265px"></div>
+<div class="hstripe" style="top: 340px"></div>
+<div class="hstripe" style="top: 364px"></div>
+<div class="hstripe" style="top: 388px"></div>
+<div class="hstripe" style="top: 412px"></div>
+
+<div class="vstripe" style="left: 89px"></div>
+<div class="vstripe" style="left: 150px"></div>
+<div class="vstripe" style="left: 211px"></div>
+<div class="vstripe" style="left: 272px"></div>
+<div class="vstripe" style="left: 333px"></div>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-separate-table-row-group.html b/layout/reftests/table-background/border-separate-table-row-group.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-separate-table-row-group.html
@@ -0,0 +1,108 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	table { 
+		margin: 0 3px 2px 4px; /* zero top to work around collapsing bug */
+		border: transparent solid;
+		border-width: 4px 2px 7px 3px;
+		padding: 3px 7px 8px 6px;
+		border-collapse: separate;
+		border-spacing: 2px 3px;
+	}
+
+	td {
+		border: transparent solid;
+		border-width: 2px 1px 4px 3px;
+		padding: 1px 2px 4px 3px;
+		empty-cells: show;
+	}
+
+	div { height: 10px; width: 50px; }
+
+	table.color tbody.t { background-color: aqua; }
+
+	table.imagetl tbody.t, table.imagebr tbody.t {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	table.imagetl tbody.t { background-position: top left; /* default */ }
+	table.imagebr tbody.t { background-position: bottom right; /* default */ }
+
+	</style>
+</head>
+<body>
+
+<table class="color">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagetl">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagebr">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-separate-table-row-ref.html b/layout/reftests/table-background/border-separate-table-row-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-separate-table-row-ref.html
@@ -0,0 +1,89 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	/*
+	table { 
+		margin: 0px 3px 2px 4px;
+		border-width: 4px 2px 7px 3px;
+
+		border-box height is 145px:
+		  border-top: 4px;
+		  padding-top: 3px
+		  border-spacing: 3px * 6 == 18px
+		  cell * 5: == 21px * 5 == 105px
+		    border-top: 2px;
+		    padding-top: 1px;
+		    height: 10px;
+		    padding-bottom: 4px;
+		    border-bottom: 4px;
+		  padding-bottom: 8px;
+		  border-bottom: 7px;
+
+		border-box width is 325px:
+		  border-left: 3px;
+		  padding-left: 6px
+		  border-spacing: 2px * 6 == 12px
+		  cell * 5: == 59px * 5 == 295px
+		    border-left: 3px;
+		    padding-left: 3px;
+		    width: 50px;
+		    padding-right: 2px;
+		    border-right: 1px;
+		  padding-right: 7px;
+		  border-right: 2px;
+    */
+
+	div.color, div.imagetl, div.imagebr {
+        width: 303px; height: 21px; margin: 58px 14px 126px 15px;
+	}
+	div.color { background-color: aqua; }
+
+	div.imagetl, div.imagebr {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	div.imagetl { background-position: 0 0; }
+	div.imagebr { background-position: 21px 303px; }
+
+	div.vstripe, div.hstripe { background: white; position: absolute; }
+	div.vstripe { top: 0; width: 2px; height: 500px; }
+	div.hstripe { left: 0; height: 3px; width: 400px; }
+
+	</style>
+</head>
+<body>
+
+<div class="color"></div>
+<div class="imagetl"></div>
+<div class="imagebr"></div>
+
+<div class="hstripe" style="top: 46px"></div>
+<div class="hstripe" style="top: 70px"></div>
+<div class="hstripe" style="top: 94px"></div>
+<div class="hstripe" style="top: 118px"></div>
+<div class="hstripe" style="top: 193px"></div>
+<div class="hstripe" style="top: 217px"></div>
+<div class="hstripe" style="top: 241px"></div>
+<div class="hstripe" style="top: 265px"></div>
+<div class="hstripe" style="top: 340px"></div>
+<div class="hstripe" style="top: 364px"></div>
+<div class="hstripe" style="top: 388px"></div>
+<div class="hstripe" style="top: 412px"></div>
+
+<div class="vstripe" style="left: 89px"></div>
+<div class="vstripe" style="left: 150px"></div>
+<div class="vstripe" style="left: 211px"></div>
+<div class="vstripe" style="left: 272px"></div>
+<div class="vstripe" style="left: 333px"></div>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-separate-table-row.html b/layout/reftests/table-background/border-separate-table-row.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-separate-table-row.html
@@ -0,0 +1,108 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	table { 
+		margin: 0 3px 2px 4px; /* zero top to work around collapsing bug */
+		border: transparent solid;
+		border-width: 4px 2px 7px 3px;
+		padding: 3px 7px 8px 6px;
+		border-collapse: separate;
+		border-spacing: 2px 3px;
+	}
+
+	td {
+		border: transparent solid;
+		border-width: 2px 1px 4px 3px;
+		padding: 1px 2px 4px 3px;
+		empty-cells: show;
+	}
+
+	div { height: 10px; width: 50px; }
+
+	table.color tr.t { background-color: aqua; }
+
+	table.imagetl tr.t, table.imagebr tr.t {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	table.imagetl tr.t { background-position: top left; /* default */ }
+	table.imagebr tr.t { background-position: bottom right; /* default */ }
+
+	</style>
+</head>
+<body>
+
+<table class="color">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagetl">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagebr">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/border-separate-table.html b/layout/reftests/table-background/border-separate-table.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/table-background/border-separate-table.html
@@ -0,0 +1,108 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title>Table background tests</title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<meta http-equiv="Content-Style-Type" content="text/css">
+	<style type="text/css">
+
+	html, body { margin: 0; padding: 0; border: 0; font-size: 16px; }
+	body { padding: 15px; }
+
+	table { 
+		margin: 0 3px 2px 4px; /* zero top to work around collapsing bug */
+		border: transparent solid;
+		border-width: 4px 2px 7px 3px;
+		padding: 3px 7px 8px 6px;
+		border-collapse: separate;
+		border-spacing: 2px 3px;
+	}
+
+	td {
+		border: transparent solid;
+		border-width: 2px 1px 4px 3px;
+		padding: 1px 2px 4px 3px;
+		empty-cells: show;
+	}
+
+	div { height: 10px; width: 50px; }
+
+	table.color { background-color: aqua; }
+
+	table.imagetl, table.imagebr {
+		background-image: url(../bugs/repeatable-diagonal-gradient.png);
+	}
+
+	table.imagetl { background-position: top left; /* default */ }
+	table.imagebr { background-position: bottom right; /* default */ }
+
+	</style>
+</head>
+<body>
+
+<table class="color">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagetl">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+<table class="imagebr">
+	<colgroup><col></colgroup>
+	<colgroup class="t">
+        <col>
+        <col class="t">
+        <col>
+	</colgroup>
+	<colgroup><col></colgroup>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody class="t">
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr class="t"><td><div></div></td><td><div></div></td><td class="t"><div></div></td><td><div></div></td><td><div></div></td></tr>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+	<tbody>
+        <tr><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
+	</tbody>
+</table>
+
+</body>
+</html>
diff --git a/layout/reftests/table-background/reftest.list b/layout/reftests/table-background/reftest.list
--- a/layout/reftests/table-background/reftest.list
+++ b/layout/reftests/table-background/reftest.list
@@ -1,24 +1,41 @@
-!= backgr_border-table-cell.html empty.html
-!= backgr_border-table-column-group.html empty.html
-!= backgr_border-table-column.html empty.html
-!= backgr_border-table-quirks.html empty.html
-!= backgr_border-table-row-group.html empty.html
-!= backgr_border-table-row.html empty.html
-!= backgr_border-table.html empty.html
-!= backgr_fixed-bg.html empty.html
-!= backgr_index.html empty.html
-!= backgr_layers-hide.html empty.html
-!= backgr_layers-opacity.html empty.html
-!= backgr_layers-show.html empty.html
-!= backgr_position-table-cell.html empty.html
-!= backgr_position-table-column-group.html empty.html
-!= backgr_position-table-column.html empty.html
-!= backgr_position-table-row-group.html empty.html
-!= backgr_position-table-row.html empty.html
-!= backgr_position-table.html empty.html
-!= backgr_simple-table-cell.html empty.html
-!= backgr_simple-table-column-group.html empty.html
-!= backgr_simple-table-column.html empty.html
-!= backgr_simple-table-row-group.html empty.html
-!= backgr_simple-table-row.html empty.html
-!= backgr_simple-table.html empty.html
+# these could be moved to crashtests
+!= backgr_border-table-cell.html empty.html
+!= backgr_border-table-column-group.html empty.html
+!= backgr_border-table-column.html empty.html
+!= backgr_border-table-quirks.html empty.html
+!= backgr_border-table-row-group.html empty.html
+!= backgr_border-table-row.html empty.html
+!= backgr_border-table.html empty.html
+!= backgr_fixed-bg.html empty.html
+!= backgr_index.html empty.html
+!= backgr_layers-hide.html empty.html
+!= backgr_layers-opacity.html empty.html
+!= backgr_layers-show.html empty.html
+!= backgr_position-table-cell.html empty.html
+!= backgr_position-table-column-group.html empty.html
+!= backgr_position-table-column.html empty.html
+!= backgr_position-table-row-group.html empty.html
+!= backgr_position-table-row.html empty.html
+!= backgr_position-table.html empty.html
+!= backgr_simple-table-cell.html empty.html
+!= backgr_simple-table-column-group.html empty.html
+!= backgr_simple-table-column.html empty.html
+!= backgr_simple-table-row-group.html empty.html
+!= backgr_simple-table-row.html empty.html
+!= backgr_simple-table.html empty.html
+
+# would also be good to test table-header-group and table-footer-group
+# (and rows and row groups in the presence of their reordering)
+# Also need to test different values of background-origin and background-clip.
+== border-separate-table-cell.html border-separate-table-cell-ref.html
+== border-separate-table-column-group.html border-separate-table-column-group-ref.html
+== border-separate-table-column.html border-separate-table-column-ref.html
+== border-separate-table-row-group.html border-separate-table-row-group-ref.html
+== border-separate-table-row.html border-separate-table-row-ref.html
+== border-separate-table.html border-separate-table-ref.html
+== border-collapse-table-cell.html border-collapse-table-cell-ref.html
+== border-collapse-table-column-group.html border-collapse-table-column-group-ref.html
+== border-collapse-table-column.html border-collapse-table-column-ref.html
+== border-collapse-table-row-group.html border-collapse-table-row-group-ref.html
+== border-collapse-table-row.html border-collapse-table-row-ref.html
+== border-collapse-table.html border-collapse-table-ref.html
