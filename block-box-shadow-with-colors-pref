From: L. David Baron <dbaron@dbaron.org>

Also block -moz-box-shadow when using document-specified colors is disabled, and fix a testing error with the patch for text-shadow.  (Bug 503188)  r=bzbarsky

diff --git a/layout/style/nsCSSPropList.h b/layout/style/nsCSSPropList.h
--- a/layout/style/nsCSSPropList.h
+++ b/layout/style/nsCSSPropList.h
@@ -979,17 +979,18 @@ CSS_PROP_POSITION(
     mOffset.mBottom,
     eCSSType_Value,
     nsnull)
 CSS_PROP_BORDER(
     -moz-box-shadow,
     box_shadow,
     MozBoxShadow,
     CSS_PROPERTY_APPLIES_TO_FIRST_LETTER |
-        CSS_PROPERTY_VALUE_LIST_USES_COMMAS,
+        CSS_PROPERTY_VALUE_LIST_USES_COMMAS |
+        CSS_PROPERTY_IGNORED_WHEN_COLORS_DISABLED,
     Margin,
     mBoxShadow,
     eCSSType_ValueList,
     kBoxShadowTypeKTable)
 CSS_PROP_POSITION(
     -moz-box-sizing,
     box_sizing,
     MozBoxSizing,
diff --git a/layout/style/test/test_dont_use_document_colors.html b/layout/style/test/test_dont_use_document_colors.html
--- a/layout/style/test/test_dont_use_document_colors.html
+++ b/layout/style/test/test_dont_use_document_colors.html
@@ -4,17 +4,17 @@
 -->
 <head>
   <title>Test for preference not to use document colors</title>
   <script type="text/javascript" src="/MochiKit/packed.js"></script>
   <script type="text/javascript" src="/tests/SimpleTest/SimpleTest.js"></script>
   <link rel="stylesheet" type="text/css" href="/tests/SimpleTest/test.css" />
   <style type="text/css">
 
-  #one, #three { background: blue; color: yellow; border: thin solid red; -moz-column-rule: 2px solid green; text-shadow: 2px 2px green; }
+  #one, #three { background: blue; color: yellow; border: thin solid red; -moz-column-rule: 2px solid green; text-shadow: 2px 2px green; -moz-box-shadow: 3px 7px blue; }
   #two { background: transparent; border: thin solid; }
   #five, #six {border: thick solid red; -moz-border-start-color:green; -moz-border-end-color:blue}
   #seven {
     border: 3px solid;
     -moz-border-top-colors: blue aqua fuchsia;
     -moz-border-right-colors: aqua blue fuchsia;
     -moz-border-bottom-colors: blue fuchsia aqua;
     -moz-border-left-colors: fuchsia blue blue;
@@ -88,27 +88,31 @@ function part1()
     isnot(cs1.borderLeftColor, cs2.borderLeftColor,
           "border-left-color applies");
     isnot(cs1.borderBottomColor, cs2.borderBottomColor,
           "border-top-color applies");
     isnot(cs1.MozColumnRuleColor, cs2.MozColumnRuleColor,
           "-moz-column-rule-color applies");
     isnot(cs1.textShadow, cs2.textShadow,
           "text-shadow applies");
+    isnot(cs1.MozBoxShadow, cs2.MozBoxShadow,
+          "-moz-box-shadow applies");
     is(cs1.borderTopColor, cs3.borderTopColor, "border-top-color applies");
     is(cs1.borderRightColor, cs3.borderRightColor,
        "border-right-color applies");
     is(cs1.borderLeftColor, cs3.borderLeftColor,
        "border-left-color applies");
     is(cs1.borderBottomColor, cs3.borderBottomColor, 
        "border-top-color applies");
     is(cs1.MozColumnRuleColor, cs3.MozColumnRuleColor,
        "-moz-column-rule-color applies");
-    is(cs1.TextShadow, cs3.TextShadow,
+    is(cs1.textShadow, cs3.textShadow,
        "text-shadow applies");
+    is(cs1.MozBoxShadow, cs3.MozBoxShadow,
+       "-moz-box-shadow applies");
     isnot(cs5.borderRightColor, cs2.borderRightColor,
           "-moz-border-end-color applies");
     isnot(cs5.borderLeftColor, cs2.borderLeftColor,
           "-moz-border-start-color applies");    
     isnot(cs6.borderRightColor, cs2.borderRightColor,
           "-moz-border-start-color applies");
     isnot(cs6.borderLeftColor, cs2.borderLeftColor,
           "-moz-border-end-color applies");
@@ -167,18 +171,20 @@ function part2()
     is(cs7.MozBorderBottomColors, cs2.MozBorderBottomColors,
        "-moz-border-bottom-colors is blocked");
     is(cs7.MozBorderLeftColors, cs2.MozBorderLeftColors,
        "-moz-border-left-colors is blocked");
     is(cs1.borderBottomColor, cs2.borderBottomColor,
        "border-bottom-color is blocked");
     is(cs1.MozColumnRuleColor, cs2.MozColumnRuleColor,
        "-moz-column-rule-color is blocked");
-    is(cs1.TextShadow, cs2.TextShadow,
+    is(cs1.textShadow, cs2.textShadow,
        "text-shadow is blocked");
+    is(cs1.MozBoxShadow, cs2.MozBoxShadow,
+       "-moz-box-shadow is blocked");
     is(cs3.backgroundColor, cs1.backgroundColor, "background-color transparency preserved (opaque)");
     is(cs3.color, cs4.color, "color is blocked");
     is(cs3.borderTopColor, cs4.borderTopColor, "border-top-color is blocked");
     is(cs3.borderRightColor, cs4.borderRightColor,
        "border-right-color is blocked");
     is(cs3.borderLeftColor, cs4.borderLeftColor,
        "border-left-color is blocked");
     is(cs3.borderBottomColor, cs4.borderBottomColor,
