From: L. David Baron <dbaron@dbaron.org>

Bug 996796 patch 13 - Fix the pseudo element information created by ResolveStyleWithReplacement.

Note that we're not yet using this code for style contexts that have
pseudo-elements, since we don't run transitions or animations on
pseudo-elements on the compositor thread.  But bug 960465 will (with
some more work) start doing so.

diff --git a/layout/style/nsStyleSet.cpp b/layout/style/nsStyleSet.cpp
--- a/layout/style/nsStyleSet.cpp
+++ b/layout/style/nsStyleSet.cpp
@@ -1442,17 +1442,18 @@ nsStyleSet::ResolveStyleWithReplacement(
     aOldStyleContext->RelevantLinkVisited() :
     aNewParentContext->RelevantLinkVisited();
 
   if (relevantLinkVisited) {
     flags |= eIsVisitedLink;
   }
 
   return GetContext(aNewParentContext, ruleNode, visitedRuleNode,
-                    nullptr, nsCSSPseudoElements::ePseudo_NotPseudoElement,
+                    aOldStyleContext->GetPseudo(),
+                    aOldStyleContext->GetPseudoType(),
                     nullptr, flags);
 }
 
 
 already_AddRefed<nsStyleContext>
 nsStyleSet::ResolveStyleForNonElement(nsStyleContext* aParentContext)
 {
   return GetContext(aParentContext, mRuleTree, nullptr,
