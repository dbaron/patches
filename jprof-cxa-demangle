From: L. David Baron <dbaron@dbaron.org>

Bug 855081:  Make jprof compile for me by switching from cplus_demangle (which doesn't link) to abi::__cxa_demangle.

diff --git a/tools/jprof/bfd.cpp b/tools/jprof/bfd.cpp
--- a/tools/jprof/bfd.cpp
+++ b/tools/jprof/bfd.cpp
@@ -7,20 +7,17 @@
 
 #ifdef USE_BFD
 #include <stdio.h>
 #include <string.h>
 #include <fcntl.h>
 #include <unistd.h>
 #include <libgen.h>
 #include <bfd.h>
-
-extern "C" {
-  char *cplus_demangle (const char *mangled, int options);
-}
+#include <cxxabi.h>
 
 static bfd *try_debug_file(const char *filename, unsigned long crc32)
 {
   int fd = open(filename, O_RDONLY);
   if (fd < 0)
     return NULL;
 
   unsigned char buf[4*1024];
@@ -181,19 +178,22 @@ void leaky::ReadSymbols(const char *aFil
     symbol_info syminfo;
     bfd_get_symbol_info (symbolFile, sym, &syminfo);
 
 //    if ((syminfo.type == 'T') || (syminfo.type == 't')) {
       const char* nm = bfd_asymbol_name(sym);
       if (nm && nm[0]) {
 	char* dnm = NULL;
 	if (strncmp("__thunk", nm, 7)) {
-	  dnm = cplus_demangle(nm, 1);
+	  dnm = abi::__cxa_demangle(nm, 0, 0, 0);
 	}
 	sp->Init(dnm ? dnm : nm, syminfo.value + aBaseAddress);
+        if (dnm) {
+          free(dnm);
+        }
         NEXT_SYMBOL
       }
 //    }
   }
 
   bfd_close(symbolFile);
 
   int interesting = sp - externalSymbols;
