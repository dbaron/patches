From: L. David Baron <dbaron@dbaron.org>

Bug 1367830 - Mark hidden window as inactive.

MozReview-Commit-ID: GJOFjU6WcfG

diff --git a/xpfe/appshell/nsAppShellService.cpp b/xpfe/appshell/nsAppShellService.cpp
--- a/xpfe/appshell/nsAppShellService.cpp
+++ b/xpfe/appshell/nsAppShellService.cpp
@@ -133,30 +133,37 @@ nsAppShellService::CreateHiddenWindowHel
 
   RefPtr<nsWebShellWindow> newWindow;
   if (!aIsPrivate) {
     rv = JustCreateTopWindow(nullptr, url,
                              chromeMask, initialWidth, initialHeight,
                              true, nullptr, nullptr, getter_AddRefs(newWindow));
     NS_ENSURE_SUCCESS(rv, rv);
 
+    nsCOMPtr<nsIDocShell> docShell;
+    newWindow->GetDocShell(getter_AddRefs(docShell));
+    if (docShell) {
+      docShell->SetIsActive(false);
+    }
+
     mHiddenWindow.swap(newWindow);
   } else {
     // Create the hidden private window
     chromeMask |= nsIWebBrowserChrome::CHROME_PRIVATE_WINDOW;
 
     rv = JustCreateTopWindow(nullptr, url,
                              chromeMask, initialWidth, initialHeight,
                              true, nullptr, nullptr, getter_AddRefs(newWindow));
     NS_ENSURE_SUCCESS(rv, rv);
 
     nsCOMPtr<nsIDocShell> docShell;
     newWindow->GetDocShell(getter_AddRefs(docShell));
     if (docShell) {
       docShell->SetAffectPrivateSessionLifetime(false);
+      docShell->SetIsActive(false);
     }
 
     mHiddenPrivateWindow.swap(newWindow);
   }
 
   // RegisterTopLevelWindow(newWindow); -- Mac only
 
   return NS_OK;
