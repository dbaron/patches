Trap exit with our crash hooks.

diff --git a/toolkit/xre/nsSigHandlers.cpp b/toolkit/xre/nsSigHandlers.cpp
--- a/toolkit/xre/nsSigHandlers.cpp
+++ b/toolkit/xre/nsSigHandlers.cpp
@@ -50,16 +50,18 @@
 #include "prenv.h"
 #include "nsDebug.h"
 
 #if defined(LINUX)
 #include <sys/time.h>
 #include <sys/resource.h>
 #include <unistd.h>
 #include <stdlib.h> // atoi
+#define _GNU_SOURCE 1
+#include <dlfcn.h>
 #endif
 
 #if defined(SOLARIS)
 #include <sys/resource.h>
 #endif
 
 #ifdef XP_BEOS
 #include <be/app/Application.h>
@@ -144,16 +146,28 @@ ah_crap_handler(int signum)
   printf("Sleeping for %d seconds.\n",_gdb_sleep_duration);
   printf("Type 'gdb %s %d' to attach your debugger to this thread.\n",
          _progname,
          getpid());
 
   sleep(_gdb_sleep_duration);
 
   printf("Done sleeping...\n");
+}
+
+extern "C" {
+
+/* override exit(3) */
+void exit(int status)
+{
+  ah_crap_handler(SIGABRT);
+  void *next = dlsym(RTLD_NEXT, "exit");
+  ((void (*)(int))next)(status);
+}
+
 }
 #endif // CRAWL_STACK_ON_SIGSEGV
 
 #ifdef XP_BEOS
 void beos_signal_handler(int signum) {
 #ifdef DEBUG
 	fprintf(stderr, "beos_signal_handler: %d\n", signum);
 #endif
