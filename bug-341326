Clean up IsFrameOfType methods to call their base class IsFrameOfType methods reliably.  b=341326

diff -r 8f11a01cf60e layout/forms/nsComboboxControlFrame.cpp
--- a/layout/forms/nsComboboxControlFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/forms/nsComboboxControlFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -688,12 +688,6 @@ nsComboboxControlFrame::GetType() const
   return nsGkAtoms::comboboxControlFrame; 
 }
 
-PRBool
-nsComboboxControlFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~(eReplaced | eReplacedContainsBlock));
-}
-
 #ifdef NS_DEBUG
 NS_IMETHODIMP
 nsComboboxControlFrame::GetFrameName(nsAString& aResult) const
@@ -1047,7 +1041,11 @@ public:
       mComboBox(aComboBox)
   {}
 
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsBlockFrame::IsFrameOfType(aFlags &
+      ~(nsIFrame::eReplacedContainsBlock));
+  }
 
   NS_IMETHOD Reflow(nsPresContext*           aPresContext,
                     nsHTMLReflowMetrics&     aDesiredSize,
@@ -1057,12 +1055,6 @@ protected:
 protected:
   nsComboboxControlFrame* mComboBox;
 };
-
-PRBool
-nsComboboxDisplayFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~(eReplacedContainsBlock));
-}
 
 NS_IMETHODIMP
 nsComboboxDisplayFrame::Reflow(nsPresContext*           aPresContext,
diff -r 8f11a01cf60e layout/forms/nsComboboxControlFrame.h
--- a/layout/forms/nsComboboxControlFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/forms/nsComboboxControlFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -131,7 +131,11 @@ public:
   // things move to IsFrameOfType.
   virtual nsIAtom* GetType() const;
 
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsAreaFrame::IsFrameOfType(aFlags &
+      ~(nsIFrame::eReplaced | nsIFrame::eReplacedContainsBlock));
+  }
 
 #ifdef NS_DEBUG
   NS_IMETHOD GetFrameName(nsAString& aResult) const;
diff -r 8f11a01cf60e layout/forms/nsFileControlFrame.cpp
--- a/layout/forms/nsFileControlFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/forms/nsFileControlFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -617,9 +617,3 @@ nsFileControlFrame::MouseListener::Mouse
 
   return NS_OK;
 }
-
-PRBool
-nsFileControlFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~(eReplaced | eReplacedContainsBlock));
-}
diff -r 8f11a01cf60e layout/forms/nsFileControlFrame.h
--- a/layout/forms/nsFileControlFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/forms/nsFileControlFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -124,7 +124,11 @@ protected:
   
   nsresult MouseClick(nsIDOMEvent* aMouseEvent);
 
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsAreaFrame::IsFrameOfType(aFlags &
+      ~(nsIFrame::eReplaced | nsIFrame::eReplacedContainsBlock));
+  }
 
   virtual PRIntn GetSkipSides() const;
 
diff -r 8f11a01cf60e layout/forms/nsFormControlFrame.h
--- a/layout/forms/nsFormControlFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/forms/nsFormControlFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -57,6 +57,12 @@ public:
     * @param aParentFrame the parent frame
     */
   nsFormControlFrame(nsStyleContext*);
+
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsLeafFrame::IsFrameOfType(aFlags &
+      ~(nsIFrame::eReplaced | nsIFrame::eReplacedContainsBlock));
+  }
 
   NS_IMETHOD QueryInterface(const nsIID& aIID, void** aInstancePtr);
 
diff -r 8f11a01cf60e layout/forms/nsGfxCheckboxControlFrame.cpp
--- a/layout/forms/nsGfxCheckboxControlFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/forms/nsGfxCheckboxControlFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -112,12 +112,6 @@ nsGfxCheckboxControlFrame::QueryInterfac
   return nsFormControlFrame::QueryInterface(aIID, aInstancePtr);
 }
 
-PRBool
-nsGfxCheckboxControlFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~(eReplaced | eReplacedContainsBlock));
-}
-
 #ifdef ACCESSIBILITY
 NS_IMETHODIMP nsGfxCheckboxControlFrame::GetAccessible(nsIAccessible** aAccessible)
 {
diff -r 8f11a01cf60e layout/forms/nsGfxCheckboxControlFrame.h
--- a/layout/forms/nsGfxCheckboxControlFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/forms/nsGfxCheckboxControlFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -55,8 +55,6 @@ public:
   nsGfxCheckboxControlFrame(nsStyleContext* aContext);
   virtual ~nsGfxCheckboxControlFrame();
   
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
-
 #ifdef DEBUG
   NS_IMETHOD GetFrameName(nsAString& aResult) const {
     return MakeFrameName(NS_LITERAL_STRING("CheckboxControl"), aResult);
diff -r 8f11a01cf60e layout/forms/nsGfxRadioControlFrame.cpp
--- a/layout/forms/nsGfxRadioControlFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/forms/nsGfxRadioControlFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -75,12 +75,6 @@ nsGfxRadioControlFrame::QueryInterface(c
   }
 
   return nsFormControlFrame::QueryInterface(aIID, aInstancePtr);
-}
-
-PRBool
-nsGfxRadioControlFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~(eReplaced | eReplacedContainsBlock));
 }
 
 #ifdef ACCESSIBILITY
diff -r 8f11a01cf60e layout/forms/nsGfxRadioControlFrame.h
--- a/layout/forms/nsGfxRadioControlFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/forms/nsGfxRadioControlFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -60,8 +60,6 @@ public:
   nsGfxRadioControlFrame(nsStyleContext* aContext);
   ~nsGfxRadioControlFrame();
 
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
-
    //nsIRadioControlFrame methods
   NS_IMETHOD QueryInterface(const nsIID& aIID, void** aInstancePtr);
   NS_IMETHOD SetRadioButtonFaceStyleContext(nsStyleContext *aRadioButtonFaceStyleContext);
diff -r 8f11a01cf60e layout/forms/nsHTMLButtonControlFrame.cpp
--- a/layout/forms/nsHTMLButtonControlFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/forms/nsHTMLButtonControlFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -475,9 +475,3 @@ nsHTMLButtonControlFrame::RemoveFrame(ns
   NS_NOTREACHED("unsupported operation");
   return NS_ERROR_UNEXPECTED;
 }
-
-PRBool
-nsHTMLButtonControlFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~(eReplaced | eReplacedContainsBlock));
-}
diff -r 8f11a01cf60e layout/forms/nsHTMLButtonControlFrame.h
--- a/layout/forms/nsHTMLButtonControlFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/forms/nsHTMLButtonControlFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -126,7 +126,11 @@ public:
     return GetFirstChild(nsnull)->GetContentInsertionFrame();
   }
 
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsHTMLContainerFrame::IsFrameOfType(aFlags &
+      ~(nsIFrame::eReplaced | nsIFrame::eReplacedContainsBlock));
+  }
 
 protected:
   virtual PRBool IsReset(PRInt32 type);
diff -r 8f11a01cf60e layout/forms/nsImageControlFrame.cpp
--- a/layout/forms/nsImageControlFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/forms/nsImageControlFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -93,7 +93,6 @@ public:
                          nsEventStatus* aEventStatus);
 
   virtual nsIAtom* GetType() const;
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
 
 #ifdef ACCESSIBILITY
   NS_IMETHOD GetAccessible(nsIAccessible** aAccessible);
@@ -205,12 +204,6 @@ nsImageControlFrame::GetType() const
 nsImageControlFrame::GetType() const
 {
   return nsGkAtoms::imageControlFrame; 
-}
-
-PRBool
-nsImageControlFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~(eReplaced));
 }
 
 NS_METHOD
diff -r 8f11a01cf60e layout/forms/nsListControlFrame.cpp
--- a/layout/forms/nsListControlFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/forms/nsListControlFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -1825,12 +1825,6 @@ nsListControlFrame::GetType() const
 }
 
 PRBool
-nsListControlFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~(eReplaced | eReplacedContainsBlock));
-}
-
-PRBool
 nsListControlFrame::IsContainingBlock() const
 {
   // We are in fact the containing block for our options.  They should
diff -r 8f11a01cf60e layout/forms/nsListControlFrame.h
--- a/layout/forms/nsListControlFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/forms/nsListControlFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -121,7 +121,11 @@ public:
    */
   virtual nsIAtom* GetType() const;
 
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsHTMLScrollFrame::IsFrameOfType(aFlags &
+      ~(nsIFrame::eReplaced | nsIFrame::eReplacedContainsBlock));
+  }
 
   virtual PRBool IsContainingBlock() const;
 
diff -r 8f11a01cf60e layout/forms/nsTextControlFrame.cpp
--- a/layout/forms/nsTextControlFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/forms/nsTextControlFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -1801,12 +1801,6 @@ nsTextControlFrame::IsLeaf() const
   return PR_TRUE;
 }
 
-PRBool
-nsTextControlFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~(eReplaced | eReplacedContainsBlock));
-}
-
 static PRBool
 IsFocusedContent(nsPresContext* aPresContext, nsIContent* aContent)
 {
diff -r 8f11a01cf60e layout/forms/nsTextControlFrame.h
--- a/layout/forms/nsTextControlFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/forms/nsTextControlFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -107,7 +107,13 @@ public:
   }
 #endif
 
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    // nsStackFrame is already both of these, but that's somewhat bogus,
+    // and we really mean it.
+    return nsStackFrame::IsFrameOfType(aFlags &
+      ~(nsIFrame::eReplaced | nsIFrame::eReplacedContainsBlock));
+  }
 
   // nsIAnonymousContentCreator
   virtual nsresult CreateAnonymousContent(nsTArray<nsIContent*>& aElements);
diff -r 8f11a01cf60e layout/generic/nsBRFrame.cpp
--- a/layout/generic/nsBRFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsBRFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -81,7 +81,11 @@ public:
   virtual nscoord GetMinWidth(nsIRenderingContext *aRenderingContext);
   virtual nscoord GetPrefWidth(nsIRenderingContext *aRenderingContext);
   virtual nsIAtom* GetType() const;
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsFrame::IsFrameOfType(aFlags & ~(nsIFrame::eReplaced));
+  }
 
 #ifdef ACCESSIBILITY  
   NS_IMETHOD GetAccessible(nsIAccessible** aAccessible);
@@ -222,12 +226,6 @@ BRFrame::GetType() const
   return nsGkAtoms::brFrame;
 }
 
-PRBool
-BRFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~(eReplaced));
-}
-
 nsIFrame::ContentOffsets BRFrame::CalcContentOffsetsFromFramePoint(nsPoint aPoint)
 {
   ContentOffsets offsets;
diff -r 8f11a01cf60e layout/generic/nsFirstLetterFrame.cpp
--- a/layout/generic/nsFirstLetterFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsFirstLetterFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -63,7 +63,12 @@ public:
   NS_IMETHOD GetFrameName(nsAString& aResult) const;
 #endif
   virtual nsIAtom* GetType() const;
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsFirstLetterFrameSuper::IsFrameOfType(aFlags &
+      ~(nsIFrame::eBidiInlineContainer));
+  }
 
   virtual nscoord GetMinWidth(nsIRenderingContext *aRenderingContext);
   virtual nscoord GetPrefWidth(nsIRenderingContext *aRenderingContext);
@@ -110,12 +115,6 @@ nsFirstLetterFrame::GetType() const
 nsFirstLetterFrame::GetType() const
 {
   return nsGkAtoms::letterFrame;
-}
-
-PRBool
-nsFirstLetterFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~nsIFrame::eBidiInlineContainer);
 }
 
 PRIntn
diff -r 8f11a01cf60e layout/generic/nsFrame.cpp
--- a/layout/generic/nsFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -554,6 +554,10 @@ nsFrame::Init(nsIContent*      aContent,
               nsIFrame*        aParent,
               nsIFrame*        aPrevInFlow)
 {
+  NS_ASSERTION(IsFrameOfType(eDEBUGAllFrames) &&
+               !IsFrameOfType(eDEBUGNoFrames),
+               "IsFrameOfType implementation that doesn't call base class");
+
   mContent = aContent;
   mParent = aParent;
 
diff -r 8f11a01cf60e layout/generic/nsFrameFrame.cpp
--- a/layout/generic/nsFrameFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsFrameFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -117,7 +117,13 @@ public:
   NS_IMETHOD_(nsrefcnt) Release(void) { return 1; }
 
   virtual nsIAtom* GetType() const;
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    // nsLeafFrame is already eReplacedContainsBlock, but that's somewhat bogus
+    return nsLeafFrame::IsFrameOfType(aFlags &
+      ~(nsIFrame::eReplaced | nsIFrame::eReplacedContainsBlock));
+  }
 
   NS_IMETHOD Init(nsIContent*      aContent,
                   nsIFrame*        aParent,
@@ -355,12 +361,6 @@ nsSubDocumentFrame::GetType() const
   return nsGkAtoms::subDocumentFrame;
 }
 
-PRBool
-nsSubDocumentFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~(eReplaced | eReplacedContainsBlock));
-}
-
 NS_IMETHODIMP
 nsSubDocumentFrame::Reflow(nsPresContext*          aPresContext,
                            nsHTMLReflowMetrics&     aDesiredSize,
diff -r 8f11a01cf60e layout/generic/nsGfxScrollFrame.cpp
--- a/layout/generic/nsGfxScrollFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsGfxScrollFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -1175,13 +1175,6 @@ nsXULScrollFrame::Release(void)
     return NS_OK;
 }
 
-PRBool
-nsXULScrollFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  // Override nsBoxFrame.
-  return !aFlags;
-}
-
 #ifdef NS_DEBUG
 NS_IMETHODIMP
 nsXULScrollFrame::GetFrameName(nsAString& aResult) const
diff -r 8f11a01cf60e layout/generic/nsGfxScrollFrame.h
--- a/layout/generic/nsGfxScrollFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsGfxScrollFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -545,7 +545,14 @@ public:
    */
   virtual nsIAtom* GetType() const;
   
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    // Override bogus IsFrameOfType in nsBoxFrame.
+    if (aFlags & (nsIFrame::eReplacedContainsBlock | nsIFrame::eReplaced))
+      return PR_FALSE;
+    return nsBoxFrame::IsFrameOfType(aFlags);
+  }
+
 #ifdef NS_DEBUG
   NS_IMETHOD GetFrameName(nsAString& aResult) const;
 #endif
diff -r 8f11a01cf60e layout/generic/nsHTMLCanvasFrame.cpp
--- a/layout/generic/nsHTMLCanvasFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsHTMLCanvasFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -254,12 +254,6 @@ nsHTMLCanvasFrame::GetType() const
   return nsGkAtoms::HTMLCanvasFrame;
 }
 
-PRBool
-nsHTMLCanvasFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~(eReplaced));
-}
-
 // get the offset into the content area of the image where aImg starts if it is a continuation.
 // from nsImageFrame
 nscoord 
diff -r 8f11a01cf60e layout/generic/nsHTMLCanvasFrame.h
--- a/layout/generic/nsHTMLCanvasFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsHTMLCanvasFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -87,7 +87,12 @@ public:
 #endif
 
   virtual nsIAtom* GetType() const;
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsSplittableFrame::IsFrameOfType(aFlags & ~(nsIFrame::eReplaced));
+  }
+
 #ifdef DEBUG
   NS_IMETHOD GetFrameName(nsAString& aResult) const;
   NS_IMETHOD List(FILE* out, PRInt32 aIndent) const;
diff -r 8f11a01cf60e layout/generic/nsIFrame.h
--- a/layout/generic/nsIFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsIFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -1432,16 +1432,30 @@ public:
     eReplaced =                         1 << 4,
     // Frame that contains a block but looks like a replaced element
     // from the outside
-    eReplacedContainsBlock =            1 << 5
+    eReplacedContainsBlock =            1 << 5,
+
+
+    // These are to allow nsFrame::Init to assert that IsFrameOfType
+    // implementations all call the base class method.  They are only
+    // meaningful in DEBUG builds.
+    eDEBUGAllFrames =                   1 << 30,
+    eDEBUGNoFrames =                    1 << 31
   };
 
   /**
    * API for doing a quick check if a frame is of a given
    * type. Returns true if the frame matches ALL flags passed in.
+   *
+   * Implementations should always override with inline virtual
+   * functions that call the base class's IsFrameOfType method.
    */
   virtual PRBool IsFrameOfType(PRUint32 aFlags) const
   {
+#ifdef DEBUG
+    return !(aFlags & ~(nsIFrame::eDEBUGAllFrames));
+#else
     return !aFlags;
+#endif
   }
 
   /**
diff -r 8f11a01cf60e layout/generic/nsImageFrame.cpp
--- a/layout/generic/nsImageFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsImageFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -1649,12 +1649,6 @@ nsImageFrame::GetType() const
   return nsGkAtoms::imageFrame;
 }
 
-PRBool
-nsImageFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~(eReplaced));
-}
-
 #ifdef DEBUG
 NS_IMETHODIMP
 nsImageFrame::GetFrameName(nsAString& aResult) const
diff -r 8f11a01cf60e layout/generic/nsImageFrame.h
--- a/layout/generic/nsImageFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsImageFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -129,7 +129,12 @@ public:
 #endif
 
   virtual nsIAtom* GetType() const;
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return ImageFrameSuper::IsFrameOfType(aFlags & ~(nsIFrame::eReplaced));
+  }
+
 #ifdef DEBUG
   NS_IMETHOD GetFrameName(nsAString& aResult) const;
   NS_IMETHOD List(FILE* out, PRInt32 aIndent) const;
diff -r 8f11a01cf60e layout/generic/nsInlineFrame.cpp
--- a/layout/generic/nsInlineFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsInlineFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -122,12 +122,6 @@ nsInlineFrame::GetType() const
   return nsGkAtoms::inlineFrame;
 }
 
-PRBool
-nsInlineFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~nsIFrame::eBidiInlineContainer);
-}
-
 inline PRBool
 IsPaddingZero(nsStyleUnit aUnit, nsStyleCoord &aCoord)
 {
diff -r 8f11a01cf60e layout/generic/nsInlineFrame.h
--- a/layout/generic/nsInlineFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsInlineFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -99,7 +99,12 @@ public:
   NS_IMETHOD GetFrameName(nsAString& aResult) const;
 #endif
   virtual nsIAtom* GetType() const;
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsInlineFrameSuper::IsFrameOfType(aFlags &
+      ~(nsIFrame::eBidiInlineContainer));
+  }
 
   virtual PRBool IsEmpty();
   virtual PRBool IsSelfEmpty();
diff -r 8f11a01cf60e layout/generic/nsLeafFrame.cpp
--- a/layout/generic/nsLeafFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsLeafFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -111,14 +111,6 @@ nsLeafFrame::Reflow(nsPresContext* aPres
   return NS_OK;
 }
 
-PRBool
-nsLeafFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  // We don't actually contain a block, but we do always want a
-  // computed width, so tell a little white lie here.
-  return !(aFlags & ~nsIFrame::eReplacedContainsBlock);
-}
-
 nscoord
 nsLeafFrame::GetIntrinsicHeight()
 {
diff -r 8f11a01cf60e layout/generic/nsLeafFrame.h
--- a/layout/generic/nsLeafFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsLeafFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -73,12 +73,17 @@ public:
    * borderpadding for the desired height.  Ascent will be set to the height,
    * and descent will be set to 0.
    */
-NS_IMETHOD Reflow(nsPresContext*      aPresContext,
+  NS_IMETHOD Reflow(nsPresContext*      aPresContext,
                     nsHTMLReflowMetrics& aDesiredSize,
                     const nsHTMLReflowState& aReflowState,
                     nsReflowStatus&      aStatus);
 
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    // We don't actually contain a block, but we do always want a
+    // computed width, so tell a little white lie here.
+    return nsFrame::IsFrameOfType(aFlags & ~(nsIFrame::eReplacedContainsBlock));
+  }
 
 protected:
   nsLeafFrame(nsStyleContext* aContext) : nsFrame(aContext) {}
diff -r 8f11a01cf60e layout/generic/nsObjectFrame.cpp
--- a/layout/generic/nsObjectFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsObjectFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -503,12 +503,6 @@ nsObjectFrame::GetType() const
 nsObjectFrame::GetType() const
 {
   return nsGkAtoms::objectFrame; 
-}
-
-PRBool
-nsObjectFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~(eReplaced));
 }
 
 #ifdef DEBUG
diff -r 8f11a01cf60e layout/generic/nsObjectFrame.h
--- a/layout/generic/nsObjectFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsObjectFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -91,7 +91,12 @@ public:
                           nsEventStatus* aEventStatus);
 
   virtual nsIAtom* GetType() const;
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsObjectFrameSuper::IsFrameOfType(aFlags & ~(nsIFrame::eReplaced));
+  }
+
   virtual PRBool SupportsVisibilityHidden() { return PR_FALSE; }
   virtual PRBool NeedsView() { return PR_TRUE; }
   virtual nsresult CreateWidgetForView(nsIView* aView);
diff -r 8f11a01cf60e layout/generic/nsTextFrame.cpp
--- a/layout/generic/nsTextFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsTextFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -317,7 +317,12 @@ public:
    */
   virtual nsIAtom* GetType() const;
 
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    // Set the frame state bit for text frames to mark them as replaced.
+    // XXX kipp: temporary
+    return nsFrame::IsFrameOfType(aFlags & ~(nsIFrame::eReplaced));
+  }
   
 #ifdef DEBUG
   NS_IMETHOD List(FILE* out, PRInt32 aIndent) const;
@@ -6344,14 +6349,6 @@ nsTextFrame::GetType() const
   return nsGkAtoms::textFrame;
 }
 
-PRBool
-nsTextFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  // Set the frame state bit for text frames to mark them as replaced.
-  // XXX kipp: temporary
-  return !(aFlags & ~(eReplaced));
-}
-
 /* virtual */ PRBool
 nsTextFrame::IsEmpty()
 {
diff -r 8f11a01cf60e layout/generic/nsTextFrameThebes.cpp
--- a/layout/generic/nsTextFrameThebes.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/generic/nsTextFrameThebes.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -363,7 +363,12 @@ public:
    */
   virtual nsIAtom* GetType() const;
   
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    // Set the frame state bit for text frames to mark them as replaced.
+    // XXX kipp: temporary
+    return nsFrame::IsFrameOfType(aFlags & ~(nsIFrame::eReplaced));
+  }
 
 #ifdef DEBUG
   NS_IMETHOD List(FILE* out, PRInt32 aIndent) const;
@@ -5073,14 +5078,6 @@ nsTextFrame::GetType() const
   return nsGkAtoms::textFrame;
 } 
 
-PRBool
-nsTextFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  // Set the frame state bit for text frames to mark them as replaced.
-  // XXX kipp: temporary
-  return !(aFlags & ~(eReplaced));
-}
-
 /* virtual */ PRBool
 nsTextFrame::IsEmpty()
 {
diff -r 8f11a01cf60e layout/mathml/base/src/nsMathMLContainerFrame.cpp
--- a/layout/mathml/base/src/nsMathMLContainerFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/mathml/base/src/nsMathMLContainerFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -1097,12 +1097,6 @@ nsMathMLContainerFrame::Reflow(nsPresCon
   return NS_OK;
 }
 
-PRBool
-nsMathMLContainerFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~nsIFrame::eMathML);
-}
-
 // see spacing table in Chapter 18, TeXBook (p.170)
 // Our table isn't quite identical to TeX because operators have 
 // built-in values for lspace & rspace in the Operator Dictionary.
diff -r 8f11a01cf60e layout/mathml/base/src/nsMathMLContainerFrame.h
--- a/layout/mathml/base/src/nsMathMLContainerFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/mathml/base/src/nsMathMLContainerFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -116,7 +116,10 @@ public:
   // --------------------------------------------------------------------------
   // Overloaded nsHTMLContainerFrame methods -- see documentation in nsIFrame.h
 
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsHTMLContainerFrame::IsFrameOfType(aFlags & ~(nsIFrame::eMathML));
+  }
 
   NS_IMETHOD
   Init(nsIContent*      aContent,
@@ -375,7 +378,7 @@ public:
   }
 
   virtual PRBool IsFrameOfType(PRUint32 aFlags) const {
-    return !(aFlags & ~nsIFrame::eMathML);
+    return nsBlockFrame::IsFrameOfType(aFlags & ~(nsIFrame::eMathML));
   }
 
 protected:
@@ -458,7 +461,10 @@ public:
   }
 
   virtual PRBool IsFrameOfType(PRUint32 aFlags) const {
-    return !(aFlags & ~nsIFrame::eMathML);
+    // Override nsInlineFrame.   XXX Should we really?
+    if (aFlags & (nsIFrame::eBidiInlineContainer))
+      return PR_FALSE;
+    return nsInlineFrame::IsFrameOfType(aFlags & ~(nsIFrame::eMathML));
   }
 
 protected:
diff -r 8f11a01cf60e layout/mathml/base/src/nsMathMLmtableFrame.cpp
--- a/layout/mathml/base/src/nsMathMLmtableFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/mathml/base/src/nsMathMLmtableFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -650,12 +650,6 @@ nsMathMLmtableOuterFrame::Reflow(nsPresC
   return rv;
 }
 
-PRBool
-nsMathMLmtableOuterFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~nsIFrame::eMathML);
-}
-
 // --------
 // implementation of nsMathMLmtableFrame
 
@@ -671,12 +665,6 @@ NS_NewMathMLmtableFrame(nsIPresShell* aP
 
 nsMathMLmtableFrame::~nsMathMLmtableFrame()
 {
-}
-
-PRBool
-nsMathMLmtableFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~nsIFrame::eMathML);
 }
 
 NS_IMETHODIMP
@@ -725,12 +713,6 @@ nsMathMLmtrFrame::Init(nsIContent* aCont
   nsresult rv = nsTableRowFrame::Init(aContent, aParent, aPrevInFlow);
   nsMathMLFrame::MapCommonAttributesIntoCSS(GetPresContext(), aContent);
   return rv;
-}
-
-PRBool
-nsMathMLmtrFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~nsIFrame::eMathML);
 }
 
 NS_IMETHODIMP
@@ -846,12 +828,6 @@ nsMathMLmtdFrame::GetColSpan()
   return colspan;
 }
 
-PRBool
-nsMathMLmtdFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~nsIFrame::eMathML);
-}
-
 NS_IMETHODIMP
 nsMathMLmtdFrame::AttributeChanged(PRInt32  aNameSpaceID,
                                    nsIAtom* aAttribute,
@@ -929,10 +905,3 @@ nsMathMLmtdInnerFrame::Reflow(nsPresCont
   // ...
   return rv;
 }
-
-PRBool
-nsMathMLmtdInnerFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~nsIFrame::eMathML);
-}
-
diff -r 8f11a01cf60e layout/mathml/base/src/nsMathMLmtableFrame.h
--- a/layout/mathml/base/src/nsMathMLmtableFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/mathml/base/src/nsMathMLmtableFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -95,7 +95,10 @@ public:
                    nsIAtom* aAttribute,
                    PRInt32  aModType);
 
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsTableOuterFrame::IsFrameOfType(aFlags & ~(nsIFrame::eMathML));
+  }
 
 protected:
   nsMathMLmtableOuterFrame(nsStyleContext* aContext) : nsTableOuterFrame(aContext) {}
@@ -152,7 +155,10 @@ public:
     return rv;
   }
 
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsTableFrame::IsFrameOfType(aFlags & ~(nsIFrame::eMathML));
+  }
 
   // helper to restyle and reflow the table when a row is changed -- since MathML
   // attributes are inter-dependent and row/colspan can affect the table, it is
@@ -213,7 +219,10 @@ public:
     return rv;
   }
 
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsTableRowFrame::IsFrameOfType(aFlags & ~(nsIFrame::eMathML));
+  }
 
   // helper to restyle and reflow the table -- @see nsMathMLmtableFrame.
   void RestyleTable()
@@ -253,7 +262,10 @@ public:
 
   virtual PRInt32 GetRowSpan();
   virtual PRInt32 GetColSpan();
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsTableCellFrame::IsFrameOfType(aFlags & ~(nsIFrame::eMathML));
+  }
 
 protected:
   nsMathMLmtdFrame(nsStyleContext* aContext) : nsTableCellFrame(aContext) {}
@@ -302,7 +314,11 @@ public:
          nsHTMLReflowMetrics&     aDesiredSize,
          const nsHTMLReflowState& aReflowState,
          nsReflowStatus&          aStatus);
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsBlockFrame::IsFrameOfType(aFlags & ~(nsIFrame::eMathML));
+  }
 
 protected:
   nsMathMLmtdInnerFrame(nsStyleContext* aContext) : nsBlockFrame(aContext) {}
diff -r 8f11a01cf60e layout/svg/base/src/nsSVGContainerFrame.cpp
--- a/layout/svg/base/src/nsSVGContainerFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/svg/base/src/nsSVGContainerFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -53,12 +53,6 @@ NS_NewSVGContainerFrame(nsIPresShell* aP
   return new (aPresShell) nsSVGContainerFrame(aContext);
 }
 
-PRBool
-nsSVGContainerFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~nsIFrame::eSVG);
-}
-
 NS_IMETHODIMP
 nsSVGContainerFrame::AppendFrames(nsIAtom* aListName,
                                   nsIFrame* aFrameList)
diff -r 8f11a01cf60e layout/svg/base/src/nsSVGContainerFrame.h
--- a/layout/svg/base/src/nsSVGContainerFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/svg/base/src/nsSVGContainerFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -51,7 +51,11 @@ class nsSVGContainerFrame : public nsSVG
                                            nsStyleContext* aContext);
 
 protected:
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsSVGContainerFrameBase::IsFrameOfType(aFlags & ~(nsIFrame::eSVG));
+  }
+
   NS_IMETHOD InitSVG();
   
 private:
diff -r 8f11a01cf60e layout/svg/base/src/nsSVGForeignObjectFrame.cpp
--- a/layout/svg/base/src/nsSVGForeignObjectFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/svg/base/src/nsSVGForeignObjectFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -107,12 +107,6 @@ nsSVGForeignObjectFrame::GetType() const
   return nsGkAtoms::svgForeignObjectFrame;
 }
 
-PRBool
-nsSVGForeignObjectFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~(nsIFrame::eSVG | nsIFrame::eSVGForeignObject));
-}
-
 NS_IMETHODIMP
 nsSVGForeignObjectFrame::AttributeChanged(PRInt32         aNameSpaceID,
                                           nsIAtom*        aAttribute,
diff -r 8f11a01cf60e layout/svg/base/src/nsSVGForeignObjectFrame.h
--- a/layout/svg/base/src/nsSVGForeignObjectFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/svg/base/src/nsSVGForeignObjectFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -87,7 +87,12 @@ public:
    * @see nsGkAtoms::svgForeignObjectFrame
    */
   virtual nsIAtom* GetType() const;
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsSVGForeignObjectFrameBase::IsFrameOfType(aFlags &
+      ~(nsIFrame::eSVG | nsIFrame::eSVGForeignObject));
+  }
 
   virtual void InvalidateInternal(const nsRect& aDamageRect,
                                   nscoord aX, nscoord aY, nsIFrame* aForChild,
diff -r 8f11a01cf60e layout/svg/base/src/nsSVGGeometryFrame.h
--- a/layout/svg/base/src/nsSVGGeometryFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/svg/base/src/nsSVGGeometryFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -65,6 +65,11 @@ public:
                   nsIFrame* aPrevInFlow);
   NS_IMETHOD DidSetStyleContext();
 
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsSVGGeometryFrameBase::IsFrameOfType(aFlags & ~(nsIFrame::eSVG));
+  }
+
   // nsISupports interface:
   NS_IMETHOD QueryInterface(const nsIID& aIID, void** aInstancePtr);
 
diff -r 8f11a01cf60e layout/svg/base/src/nsSVGGlyphFrame.cpp
--- a/layout/svg/base/src/nsSVGGlyphFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/svg/base/src/nsSVGGlyphFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -174,15 +174,6 @@ nsSVGGlyphFrame::GetType() const
   return nsGkAtoms::svgGlyphFrame;
 }
 
-PRBool
-nsSVGGlyphFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  // Set the frame state bit for text frames to mark them as replaced.
-  // XXX kipp: temporary
-
-  return !(aFlags & ~(eSVG | eReplaced));
-}
-
 //----------------------------------------------------------------------
 // nsISVGChildFrame methods
 
diff -r 8f11a01cf60e layout/svg/base/src/nsSVGGlyphFrame.h
--- a/layout/svg/base/src/nsSVGGlyphFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/svg/base/src/nsSVGGlyphFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -85,7 +85,14 @@ public:
    * @see nsGkAtoms::svgGlyphFrame
    */
   virtual nsIAtom* GetType() const;
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    // Set the frame state bit for text frames to mark them as replaced.
+    // XXX kipp: temporary
+
+    return nsSVGGlyphFrameBase::IsFrameOfType(aFlags & ~(nsIFrame::eReplaced));
+  }
 
 #ifdef DEBUG
   NS_IMETHOD GetFrameName(nsAString& aResult) const
diff -r 8f11a01cf60e layout/svg/base/src/nsSVGLeafFrame.cpp
--- a/layout/svg/base/src/nsSVGLeafFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/svg/base/src/nsSVGLeafFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -38,7 +38,10 @@
 
 class nsSVGLeafFrame : public nsFrame
 {
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsFrame::IsFrameOfType(aFlags & ~(nsIFrame::eSVG));
+  }
 
 #ifdef DEBUG
   NS_IMETHOD GetFrameName(nsAString& aResult) const
@@ -56,9 +59,3 @@ NS_NewSVGLeafFrame(nsIPresShell* aPresSh
 {
   return new (aPresShell) nsSVGLeafFrame(aContext);
 }
-
-PRBool
-nsSVGLeafFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~nsIFrame::eSVG);
-}
diff -r 8f11a01cf60e layout/svg/base/src/nsSVGPathGeometryFrame.cpp
--- a/layout/svg/base/src/nsSVGPathGeometryFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/svg/base/src/nsSVGPathGeometryFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -140,12 +140,6 @@ nsSVGPathGeometryFrame::GetType() const
   return nsGkAtoms::svgPathGeometryFrame;
 }
 
-PRBool
-nsSVGPathGeometryFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~nsIFrame::eSVG);
-}
-
 // marker helper
 static void
 RemoveMarkerObserver(nsSVGMarkerProperty *property,
diff -r 8f11a01cf60e layout/svg/base/src/nsSVGPathGeometryFrame.h
--- a/layout/svg/base/src/nsSVGPathGeometryFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/svg/base/src/nsSVGPathGeometryFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -84,7 +84,6 @@ public:
    * @see nsGkAtoms::svgPathGeometryFrame
    */
   virtual nsIAtom* GetType() const;
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
 
 #ifdef DEBUG
   NS_IMETHOD GetFrameName(nsAString& aResult) const
diff -r 8f11a01cf60e layout/svg/base/src/nsSVGStopFrame.cpp
--- a/layout/svg/base/src/nsSVGStopFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/svg/base/src/nsSVGStopFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -66,7 +66,11 @@ public:
    * @see nsGkAtoms::svgStopFrame
    */
   virtual nsIAtom* GetType() const;
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    return nsSVGStopFrameBase::IsFrameOfType(aFlags & ~(nsIFrame::eSVG));
+  }
 
 #ifdef DEBUG
   // nsIFrameDebug interface:
@@ -101,12 +105,6 @@ nsSVGStopFrame::GetType() const
 nsSVGStopFrame::GetType() const
 {
   return nsGkAtoms::svgStopFrame;
-}
-
-PRBool
-nsSVGStopFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  return !(aFlags & ~nsIFrame::eSVG);
 }
 
 NS_IMETHODIMP
diff -r 8f11a01cf60e layout/xul/base/src/nsBoxFrame.cpp
--- a/layout/xul/base/src/nsBoxFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/xul/base/src/nsBoxFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -1502,16 +1502,6 @@ nsBoxFrame::GetType() const
   return nsGkAtoms::boxFrame;
 }
 
-PRBool
-nsBoxFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  // This is bogus, but it's what we've always done.
-  // (Given that we're replaced, we need to say we're a replaced element
-  // that contains a block so nsHTMLReflowState doesn't tell us to be
-  // NS_INTRINSICSIZE wide.)
-  return !(aFlags & ~(eReplaced | eReplacedContainsBlock));
-}
-
 #ifdef DEBUG_LAYOUT
 NS_IMETHODIMP
 nsBoxFrame::GetDebug(PRBool& aDebug)
diff -r 8f11a01cf60e layout/xul/base/src/nsBoxFrame.h
--- a/layout/xul/base/src/nsBoxFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/xul/base/src/nsBoxFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -153,7 +153,17 @@ public:
   NS_IMETHOD DidSetStyleContext();
 
   virtual nsIAtom* GetType() const;
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    // This is bogus, but it's what we've always done.
+    // (Given that we're replaced, we need to say we're a replaced element
+    // that contains a block so nsHTMLReflowState doesn't tell us to be
+    // NS_INTRINSICSIZE wide.)
+    return nsContainerFrame::IsFrameOfType(aFlags &
+      ~(nsIFrame::eReplaced | nsIFrame::eReplacedContainsBlock));
+  }
+
 #ifdef DEBUG
   NS_IMETHOD GetFrameName(nsAString& aResult) const;
 #endif
diff -r 8f11a01cf60e layout/xul/base/src/nsDocElementBoxFrame.cpp
--- a/layout/xul/base/src/nsDocElementBoxFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/xul/base/src/nsDocElementBoxFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -77,7 +77,14 @@ public:
   // nsIAnonymousContentCreator
   virtual nsresult CreateAnonymousContent(nsTArray<nsIContent*>& aElements);
 
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    // Override nsBoxFrame.
+    if (aFlags & (nsIFrame::eReplacedContainsBlock | nsIFrame::eReplaced))
+      return PR_FALSE;
+    return nsBoxFrame::IsFrameOfType(aFlags);
+  }
+
 #ifdef DEBUG
   NS_IMETHOD GetFrameName(nsAString& aResult) const;
 #endif
@@ -158,13 +165,6 @@ NS_INTERFACE_MAP_BEGIN(nsDocElementBoxFr
   NS_INTERFACE_MAP_ENTRY(nsIAnonymousContentCreator)
 NS_INTERFACE_MAP_END_INHERITING(nsBoxFrame)
 
-PRBool
-nsDocElementBoxFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  // Override nsBoxFrame.
-  return !aFlags;
-}
-
 #ifdef DEBUG
 NS_IMETHODIMP
 nsDocElementBoxFrame::GetFrameName(nsAString& aResult) const
diff -r 8f11a01cf60e layout/xul/base/src/nsLeafBoxFrame.cpp
--- a/layout/xul/base/src/nsLeafBoxFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/xul/base/src/nsLeafBoxFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -363,13 +363,6 @@ nsLeafBoxFrame::Reflow(nsPresContext*   
   return NS_OK;
 }
 
-PRBool
-nsLeafBoxFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  // This is bogus, but it's what we've always done.
-  return !(aFlags & ~(eReplaced | eReplacedContainsBlock));
-}
-
 #ifdef DEBUG
 NS_IMETHODIMP
 nsLeafBoxFrame::GetFrameName(nsAString& aResult) const
diff -r 8f11a01cf60e layout/xul/base/src/nsLeafBoxFrame.h
--- a/layout/xul/base/src/nsLeafBoxFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/xul/base/src/nsLeafBoxFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -58,7 +58,14 @@ public:
   virtual nscoord GetFlex(nsBoxLayoutState& aState);
   virtual nscoord GetBoxAscent(nsBoxLayoutState& aState);
 
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    // This is bogus, but it's what we've always done.
+    // Note that nsLeafFrame is also eReplacedContainsBlock.
+    return nsLeafFrame::IsFrameOfType(aFlags &
+      ~(nsIFrame::eReplaced | nsIFrame::eReplacedContainsBlock));
+  }
+
 #ifdef DEBUG
   NS_IMETHOD GetFrameName(nsAString& aResult) const;
 #endif
diff -r 8f11a01cf60e layout/xul/base/src/nsMenuBarFrame.cpp
--- a/layout/xul/base/src/nsMenuBarFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/xul/base/src/nsMenuBarFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -155,13 +155,6 @@ nsMenuBarFrame::Init(nsIContent*      aC
   return rv;
 }
 
-PRBool
-nsMenuBarFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  // Override bogus IsFrameOfType in base class.
-  return !aFlags;
-}
-
 NS_IMETHODIMP
 nsMenuBarFrame::IsOpen()
 {
diff -r 8f11a01cf60e layout/xul/base/src/nsMenuBarFrame.h
--- a/layout/xul/base/src/nsMenuBarFrame.h	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/xul/base/src/nsMenuBarFrame.h	Sat Feb 24 00:11:33 2007 -0800
@@ -130,7 +130,14 @@ public:
   PRBool IsValidItem(nsIContent* aContent);
   PRBool IsDisabled(nsIContent* aContent);
 
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    // Override bogus IsFrameOfType in nsBoxFrame.
+    if (aFlags & (nsIFrame::eReplacedContainsBlock | nsIFrame::eReplaced))
+      return PR_FALSE;
+    return nsBoxFrame::IsFrameOfType(aFlags);
+  }
+
 #ifdef DEBUG
   NS_IMETHOD GetFrameName(nsAString& aResult) const
   {
diff -r 8f11a01cf60e layout/xul/base/src/nsRootBoxFrame.cpp
--- a/layout/xul/base/src/nsRootBoxFrame.cpp	Sat Feb 24 00:11:30 2007 -0800
+++ b/layout/xul/base/src/nsRootBoxFrame.cpp	Sat Feb 24 00:11:33 2007 -0800
@@ -118,7 +118,14 @@ public:
    * @see nsGkAtoms::rootFrame
    */
   virtual nsIAtom* GetType() const;
-  virtual PRBool IsFrameOfType(PRUint32 aFlags) const;
+
+  virtual PRBool IsFrameOfType(PRUint32 aFlags) const
+  {
+    // Override bogus IsFrameOfType in nsBoxFrame.
+    if (aFlags & (nsIFrame::eReplacedContainsBlock | nsIFrame::eReplaced))
+      return PR_FALSE;
+    return nsBoxFrame::IsFrameOfType(aFlags);
+  }
   
 #ifdef DEBUG
   NS_IMETHOD GetFrameName(nsAString& aResult) const;
@@ -266,13 +273,6 @@ nsRootBoxFrame::GetType() const
 nsRootBoxFrame::GetType() const
 {
   return nsGkAtoms::rootFrame;
-}
-
-PRBool
-nsRootBoxFrame::IsFrameOfType(PRUint32 aFlags) const
-{
-  // Override the bogus thing nsBoxFrame does.
-  return !aFlags;
 }
 
 nsIFrame*
