From: L. David Baron <dbaron@dbaron.org>

Add reftests for (unfixed) bug 518172.

diff --git a/layout/reftests/bugs/518172-1a.html b/layout/reftests/bugs/518172-1a.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/518172-1a.html
@@ -0,0 +1,24 @@
+<!DOCTYPE HTML>
+<title>Testcase, bug 518172</title>
+<style type="text/css">
+
+@font-face {
+  font-family: "MarkA";
+  src: url(../fonts/markA.ttf);
+}
+
+html, body { margin: 0; padding: 0; }
+body { font: 200px/200px MarkA; }
+div#one { width: 200px; height:200px; padding: 100px;
+          -moz-transform: rotate(90deg); }
+
+div.box { background: green; position: absolute; }
+
+</style>
+<div id="one">A</div>
+
+<!-- draw green boxes slightly larger (2px extra) than the area that should
+     be covered by the font -->
+<div class="box" style="top: 118px; left: 118px; width: 44px; height: 264px;"></div>
+<div class="box" style="top: 158px; left: 178px; width: 44px; height: 184px;"></div>
+<div class="box" style="top: 198px; left: 238px; width: 44px; height: 104px;"></div>
diff --git a/layout/reftests/bugs/518172-1b.html b/layout/reftests/bugs/518172-1b.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/518172-1b.html
@@ -0,0 +1,24 @@
+<!DOCTYPE HTML>
+<title>Testcase, bug 518172</title>
+<style type="text/css">
+
+@font-face {
+  font-family: "MarkA";
+  src: url(../fonts/markA.ttf);
+}
+
+html, body { margin: 0; padding: 0; }
+body { font: 200px/200px MarkA; }
+div#one { width: 200px; height:200px; padding: 100px;
+          -moz-transform: rotate(90deg); }
+
+div.box { background: red; position: absolute; }
+
+</style>
+<!-- draw red boxes slightly larger (2px extra) than the area that should
+     be covered by the font -->
+<div class="box" style="top: 122px; left: 122px; width: 36px; height: 256px;"></div>
+<div class="box" style="top: 162px; left: 182px; width: 36px; height: 176px;"></div>
+<div class="box" style="top: 202px; left: 242px; width: 36px; height: 96px;"></div>
+
+<div id="one">A</div>
diff --git a/layout/reftests/bugs/518172-2a.html b/layout/reftests/bugs/518172-2a.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/518172-2a.html
@@ -0,0 +1,25 @@
+<!DOCTYPE HTML>
+<title>Testcase, bug 518172</title>
+<style type="text/css">
+
+@font-face {
+  font-family: "MarkA";
+  src: url(../fonts/markA.ttf);
+}
+
+html, body { margin: 0; padding: 0; }
+body { font: 200px/200px MarkA; }
+div#one { width: 200px; height:200px; padding: 100px;
+          -moz-transform: rotate(90deg); }
+div#two { color: transparent; }
+
+div.box { background: green; position: absolute; }
+
+</style>
+<div id="one">A</div><div id="two">A</div>
+
+<!-- draw green boxes slightly larger (2px extra) than the area that should
+     be covered by the font -->
+<div class="box" style="top: 118px; left: 118px; width: 44px; height: 264px;"></div>
+<div class="box" style="top: 158px; left: 178px; width: 44px; height: 184px;"></div>
+<div class="box" style="top: 198px; left: 238px; width: 44px; height: 104px;"></div>
diff --git a/layout/reftests/bugs/518172-2b.html b/layout/reftests/bugs/518172-2b.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/518172-2b.html
@@ -0,0 +1,25 @@
+<!DOCTYPE HTML>
+<title>Testcase, bug 518172</title>
+<style type="text/css">
+
+@font-face {
+  font-family: "MarkA";
+  src: url(../fonts/markA.ttf);
+}
+
+html, body { margin: 0; padding: 0; }
+body { font: 200px/200px MarkA; }
+div#one { width: 200px; height:200px; padding: 100px;
+          -moz-transform: rotate(90deg); }
+div#two { color: transparent; }
+
+div.box { background: red; position: absolute; }
+
+</style>
+<!-- draw red boxes slightly larger (2px extra) than the area that should
+     be covered by the font -->
+<div class="box" style="top: 122px; left: 122px; width: 36px; height: 256px;"></div>
+<div class="box" style="top: 162px; left: 182px; width: 36px; height: 176px;"></div>
+<div class="box" style="top: 202px; left: 242px; width: 36px; height: 96px;"></div>
+
+<div id="one">A</div><div id="two">A</div>
diff --git a/layout/reftests/bugs/518172-a-ref.html b/layout/reftests/bugs/518172-a-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/518172-a-ref.html
@@ -0,0 +1,14 @@
+<!DOCTYPE HTML>
+<title>Testcase, bug 518172</title>
+<style type="text/css">
+
+html, body { margin: 0; padding: 0; }
+div.box { background: green; position: absolute; }
+
+</style>
+
+<!-- draw green boxes slightly larger (2px extra) than the area that should
+     be covered by the font -->
+<div class="box" style="top: 118px; left: 118px; width: 44px; height: 264px;"></div>
+<div class="box" style="top: 158px; left: 178px; width: 44px; height: 184px;"></div>
+<div class="box" style="top: 198px; left: 238px; width: 44px; height: 104px;"></div>
diff --git a/layout/reftests/bugs/518172-b-ref.html b/layout/reftests/bugs/518172-b-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/bugs/518172-b-ref.html
@@ -0,0 +1,17 @@
+<!DOCTYPE HTML>
+<title>Testcase, bug 518172</title>
+<style type="text/css">
+
+@font-face {
+  font-family: "MarkA";
+  src: url(../fonts/markA.ttf);
+}
+
+html, body { margin: 0; padding: 0; }
+body { font: 200px/200px MarkA; }
+div#one { width: 200px; height:200px; padding: 100px;
+          -moz-transform: rotate(90deg); }
+
+</style>
+<div id="one">A</div>
+
diff --git a/layout/reftests/bugs/reftest.list b/layout/reftests/bugs/reftest.list
--- a/layout/reftests/bugs/reftest.list
+++ b/layout/reftests/bugs/reftest.list
@@ -1328,16 +1328,20 @@ fails-if(MOZ_WIDGET_TOOLKIT!="cocoa") ==
 == 513153-1a.html 513153-1-ref.html
 == 513153-1b.html 513153-1-ref.html
 == 513153-2a.html 513153-2-ref.html
 == 513153-2b.html 513153-2-ref.html
 == 513318-1.xul 513318-1-ref.xul
 != 513318-2.xul 513318-2-ref.xul
 != 513318-3.xul 513318-3-ref.xul
 == 514917-1.html 514917-1-ref.html
+HTTP(..) == 518172-1a.html 518172-a-ref.html
+HTTP(..) == 518172-1b.html 518172-b-ref.html
+fails HTTP(..) == 518172-2a.html 518172-a-ref.html # bug 518172
+fails HTTP(..) == 518172-2b.html 518172-b-ref.html # bug 518172
 == 520421-1.html 520421-1-ref.html
 == 520563-1.xhtml 520563-1-ref.xhtml
 == 521525-1.html 521525-1-ref.html
 == 521525-2.html 521525-2-ref.html
 == 521539-1.html 521539-1-ref.html
 == 521542-1.xhtml 521542-1-ref.xhtml
 == 521685-1.html 521685-1-ref.html
 == 523096-1.html 523096-1-ref.html
