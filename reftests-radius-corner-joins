From: L. David Baron <dbaron@dbaron.org>

Add reftests for bug 500141.

diff --git a/layout/reftests/border-radius/corner-joins-1-ref.xhtml b/layout/reftests/border-radius/corner-joins-1-ref.xhtml
new file mode 100644
--- /dev/null
+++ b/layout/reftests/border-radius/corner-joins-1-ref.xhtml
@@ -0,0 +1,85 @@
+<?xml version="1.0"?>
+<html xmlns="http://www.w3.org/1999/xhtml"
+      xmlns:svg="http://www.w3.org/2000/svg">
+<title>border</title>
+<style type="text/css">
+@namespace url("http://www.w3.org/1999/xhtml");
+@namespace svg url("http://www.w3.org/2000/svg");
+
+div.wrapper {
+  float: left;
+  margin-left: 20px;
+  margin-top: 10px;
+}
+
+div.cover, div.cover2 {
+	position: absolute;
+	border: 2px solid white; /* cover areas that may differ */
+	width: 142px;
+	height: 120px;
+	border-radius: 60px;
+	margin-left: -1px;
+	margin-top: -1px;
+}
+div.cover2 {
+	height: 84px;
+	margin-top: 17px;
+	border-radius: 60px / 42px;
+}
+
+svg|svg {
+	display: block;
+	width: 146px;
+	height: 122px;
+	margin-right: -2px;
+	margin-bottom: 20px;
+}
+
+</style>
+<div class="wrapper">
+<div class="cover"></div>
+<div class="cover2"></div>
+<svg:svg>
+  <svg:rect x="0" y="0" width="144px" height="122px" rx="61px" ry="61px"
+            fill="blue"/>
+  <svg:rect x="0" y="18px" width="144px" height="86px" rx="61px" ry="43px"
+            fill="red"/>
+</svg:svg>
+<div class="cover"></div>
+<div class="cover2"></div>
+<svg:svg>
+  <svg:clipPath id="topclip">
+    <svg:rect x="0" y="0" width="144px" height="61px"/>
+  </svg:clipPath>
+  <svg:clipPath id="botclip">
+    <svg:rect x="0" y="61px" width="144px" height="61px"/>
+  </svg:clipPath>
+  <svg:rect x="0" y="0" width="144px" height="122px" rx="61px" ry="61px"
+            fill="black" clip-path="url(#topclip)"/>
+  <svg:rect x="0" y="0" width="144px" height="122px" rx="61px" ry="61px"
+            fill="blue" clip-path="url(#botclip)"/>
+  <svg:rect x="0" y="18px" width="144px" height="86px" rx="61px" ry="43px"
+            fill="red"/>
+</svg:svg>
+</div>
+<div class="wrapper">
+<div class="cover" style="width: 144px"></div>
+<div class="cover2" style="margin-left: 0; border-radius: 58px / 42px"></div>
+<svg:svg>
+  <svg:rect x="0" y="0" width="146px" height="122px" rx="61px" ry="61px"
+            fill="blue"/>
+  <svg:rect x="0" y="18px" width="146px" height="86px" rx="61px" ry="43px"
+            fill="red"/>
+</svg:svg>
+<div class="cover"></div>
+<div class="cover2"></div>
+<svg:svg>
+  <svg:rect x="0" y="0" width="144px" height="122px" rx="61px" ry="61px"
+            fill="black" clip-path="url(#topclip)"/>
+  <svg:rect x="0" y="0" width="144px" height="122px" rx="61px" ry="61px"
+            fill="blue" clip-path="url(#botclip)"/>
+  <svg:rect x="0" y="18px" width="144px" height="86px" rx="61px" ry="43px"
+            fill="red"/>
+</svg:svg>
+</div>
+</html>
diff --git a/layout/reftests/border-radius/corner-joins-1.xhtml b/layout/reftests/border-radius/corner-joins-1.xhtml
new file mode 100644
--- /dev/null
+++ b/layout/reftests/border-radius/corner-joins-1.xhtml
@@ -0,0 +1,74 @@
+<?xml version="1.0"?>
+<html xmlns="http://www.w3.org/1999/xhtml">
+<title>border</title>
+<style type="text/css">
+
+div.wrapper {
+  float: left;
+  margin-left: 20px;
+  margin-top: 10px;
+}
+
+div.test {
+	width: 144px;
+	height: 86px;
+	border-radius: 72px;
+	border-top: 18px solid;
+	border-bottom: 18px solid;
+	background: red;
+	margin-bottom: 20px;
+}
+
+div.cover, div.cover2 {
+	position: absolute;
+	border: 2px solid white; /* cover areas that may differ */
+	width: 142px;
+	height: 120px;
+	border-radius: 60px;
+	margin-left: -1px;
+	margin-top: -1px;
+}
+div.cover2 {
+	height: 84px;
+	margin-top: 17px;
+	border-radius: 60px / 42px;
+}
+
+#one {
+	border-color: blue;
+}
+
+#two {
+	border-bottom-color: blue;
+}
+
+#three {
+	border-color: blue;
+	border-left: 0.01px solid red;
+	border-right: 0.01px solid red;
+}
+
+#four {
+	border-bottom-color: blue;
+	border-left: 0.001px solid red;
+	border-right: 0.001px solid red;
+}
+
+</style>
+<div class="wrapper">
+<div class="cover"></div>
+<div class="cover2"></div>
+<div class="test" id="one"></div>
+<div class="cover"></div>
+<div class="cover2"></div>
+<div class="test" id="two"></div>
+</div>
+<div class="wrapper">
+<div class="cover" style="width: 144px"></div>
+<div class="cover2" style="margin-left: 0; border-radius: 58px / 42px"></div>
+<div class="test" id="three"></div>
+<div class="cover"></div>
+<div class="cover2"></div>
+<div class="test" id="four"></div>
+</div>
+</html>
diff --git a/layout/reftests/border-radius/reftest.list b/layout/reftests/border-radius/reftest.list
--- a/layout/reftests/border-radius/reftest.list
+++ b/layout/reftests/border-radius/reftest.list
@@ -64,8 +64,11 @@ fails-if(cocoaWidget) == intersecting-cl
 # when border-collapse: collapse
 
 == invalidate-1a.html invalidate-1-ref.html
 == invalidate-1b.html invalidate-1-ref.html
 
 # test that border-radius is reduced for scrollbars
 == scrollbar-clamping-1.html scrollbar-clamping-1-ref.html
 == scrollbar-clamping-2.html scrollbar-clamping-2-ref.html
+
+# Test for bad corner joins.
+== corner-joins-1.xhtml corner-joins-1-ref.xhtml
