From: L. David Baron <dbaron@dbaron.org>

Require that the same compiler version be used for C and C++ (at the very least, so that our version checks are valid for both).

diff --git a/build/autoconf/toolchain.m4 b/build/autoconf/toolchain.m4
--- a/build/autoconf/toolchain.m4
+++ b/build/autoconf/toolchain.m4
@@ -29,16 +29,22 @@ read dummy compiler CC_VERSION <<EOF
 $($CC -E $CPPFLAGS $CFLAGS conftest.c 2>/dev/null | grep COMPILER)
 EOF
 read dummy cxxcompiler CXX_VERSION <<EOF
 $($CXX -E $CPPFLAGS $CXXFLAGS conftest.c 2>/dev/null | grep COMPILER)
 EOF
 if test "$compiler" != "$cxxcompiler"; then
     AC_MSG_ERROR([Your C and C++ compilers are different.  You need to use the same compiler.])
 fi
+if test "$CC_VERSION" != "$CXX_VERSION"; then
+    # This may not be strictly necessary, but if we want to drop it, we
+    # should make sure any version checks below apply to both the C and
+    # C++ compiler versions.
+    AC_MSG_ERROR([Your C and C++ compiler versions are different.  You need to use the same compiler version.])
+fi
 CC_VERSION=`echo "$CC_VERSION" | sed 's/ //g'`
 CXX_VERSION=`echo "$CXX_VERSION" | sed 's/ //g'`
 if test "$compiler" = "gcc"; then
     GNU_CC=1
     GNU_CXX=1
     changequote(<<,>>)
     GCC_VERSION_FULL="$CXX_VERSION"
     GCC_VERSION=`echo "$GCC_VERSION_FULL" | $PERL -pe '(split(/\./))[0]>=4&&s/(^\d*\.\d*).*/<<$>>1/;'`
@@ -233,16 +239,22 @@ read dummy host_compiler HOST_CC_VERSION
 EOF
 read dummy host_cxxcompiler HOST_CXX_VERSION <<EOF
 $($HOST_CXX -E conftest.C 2>/dev/null | grep COMPILER)
 EOF
     rm conftest.C
     if test "$host_compiler" != "$host_cxxcompiler"; then
         AC_MSG_ERROR([Your C and C++ host compilers are different.  You need to use the same compiler.])
     fi
+    if test "$HOST_CC_VERSION" != "$HOST_CXX_VERSION"; then
+        # This may not be strictly necessary, but if we want to drop it,
+        # we should make sure any version checks below apply to both the
+        # C and C++ compiler versions.
+        AC_MSG_ERROR([Your C and C++ host compiler versions are different.  You need to use the same compiler version.])
+    fi
     if test -n "$host_compiler"; then
         if test "$host_compiler" = "GCC" ; then
             changequote(<<,>>)
             HOST_GCC_VERSION_FULL="$HOST_CXX_VERSION"
             HOST_GCC_VERSION=`echo "$HOST_GCC_VERSION_FULL" | $PERL -pe '(split(/\./))[0]>=4&&s/(^\d*\.\d*).*/<<$>>1/;'`
 
             HOST_GCC_MAJOR_VERSION=`echo ${HOST_GCC_VERSION} | $AWK -F\. '{ print <<$>>1 }'`
             HOST_GCC_MINOR_VERSION=`echo ${HOST_GCC_VERSION} | $AWK -F\. '{ print <<$>>2 }'`
