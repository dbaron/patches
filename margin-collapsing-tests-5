From: Daniel.S <crazy-daniel@gmx.de>

Bug 477462 - margin-collapsing test suite, wave 5a; dynamic and != tests for negative sibling margins; r=dbaron

diff --git a/layout/reftests/margin-collapsing/block-negative-1-noref1.html b/layout/reftests/margin-collapsing/block-negative-1-noref1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-1-noref1.html
@@ -0,0 +1,20 @@
+<!DOCTYPE html>
+<html>
+<head>
+<style type="text/css">
+#a {
+ height: 20px;
+ background-color: green;
+ margin-bottom: 20px;
+}
+#b {
+ height: 20px;
+ background-color: blue;
+}
+</style>
+</head>
+<body>
+<div id="a"></div>
+<div id="b"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-1-noref2.html b/layout/reftests/margin-collapsing/block-negative-1-noref2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-1-noref2.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html>
+<html>
+<head>
+<style type="text/css">
+#a {
+ height: 20px;
+ background-color: green;
+}
+#margin {
+ height: 20px;
+}
+#b {
+ height: 20px;
+ background-color: blue;
+}
+</style>
+</head>
+<body>
+<div id="a"></div>
+<div id="margin"></div>
+<div id="b"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-1a-dyn1.html b/layout/reftests/margin-collapsing/block-negative-1a-dyn1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-1a-dyn1.html
@@ -0,0 +1,29 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+#a {
+ height: 20px;
+ background-color: green;
+ margin-bottom: 20px;
+}
+#b {
+ display: none;
+ height: 20px;
+ background-color: blue;
+ margin-top: -20px;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('b').style.display = 'block';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="a"></div>
+<div id="b"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-1a-dyn2.html b/layout/reftests/margin-collapsing/block-negative-1a-dyn2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-1a-dyn2.html
@@ -0,0 +1,28 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+#a {
+ height: 20px;
+ background-color: green;
+ margin-bottom: 20px;
+}
+#b {
+ height: 20px;
+ background-color: blue;
+ margin-top: 0;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('b').style.marginTop = '-20px';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="a"></div>
+<div id="b"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-1b-dyn1.html b/layout/reftests/margin-collapsing/block-negative-1b-dyn1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-1b-dyn1.html
@@ -0,0 +1,29 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+#a {
+ height: 20px;
+ background-color: green;
+ margin-bottom: -20px;
+}
+#b {
+ display: none;
+ height: 20px;
+ background-color: blue;
+ margin-top: 20px;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('b').style.display = 'block';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="a"></div>
+<div id="b"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-1b-dyn2.html b/layout/reftests/margin-collapsing/block-negative-1b-dyn2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-1b-dyn2.html
@@ -0,0 +1,28 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+#a {
+ height: 20px;
+ background-color: green;
+ margin-bottom: -20px;
+}
+#b {
+ height: 20px;
+ background-color: blue;
+ margin-top: 0;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('b').style.marginTop = '20px';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="a"></div>
+<div id="b"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-2-noref1.html b/layout/reftests/margin-collapsing/block-negative-2-noref1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-2-noref1.html
@@ -0,0 +1,15 @@
+<!DOCTYPE html>
+<html>
+<head>
+<style type="text/css">
+#b {
+ height: 20px;
+ background-color: green;
+}
+</style>
+</head>
+<body>
+<div id="a"></div>
+<div id="b"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-2-noref2.html b/layout/reftests/margin-collapsing/block-negative-2-noref2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-2-noref2.html
@@ -0,0 +1,19 @@
+<!DOCTYPE html>
+<html>
+<head>
+<style type="text/css">
+#a {
+ height: 20px;
+ background-color: green;
+}
+#b {
+ height: 20px;
+ background-color: blue;
+}
+</style>
+</head>
+<body>
+<div id="a"></div>
+<div id="b"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-2a-dyn1.html b/layout/reftests/margin-collapsing/block-negative-2a-dyn1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-2a-dyn1.html
@@ -0,0 +1,28 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+#a {
+ height: 20px;
+ background-color: green;
+}
+#b {
+ display: none;
+ height: 20px;
+ background-color: blue;
+ margin-top: -20px;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('b').style.display = 'block';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="a"></div>
+<div id="b"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-2a-dyn2.html b/layout/reftests/margin-collapsing/block-negative-2a-dyn2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-2a-dyn2.html
@@ -0,0 +1,27 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+#a {
+ height: 20px;
+ background-color: green;
+}
+#b {
+ height: 20px;
+ background-color: blue;
+ margin-top: 0;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('b').style.marginTop = '-20px';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="a"></div>
+<div id="b"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-2b-dyn1.html b/layout/reftests/margin-collapsing/block-negative-2b-dyn1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-2b-dyn1.html
@@ -0,0 +1,28 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+#a {
+ display: none;
+ height: 20px;
+ background-color: green;
+ margin-bottom: -20px;
+}
+#b {
+ height: 20px;
+ background-color: blue;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('a').style.display = 'block';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="a"></div>
+<div id="b"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-2b-dyn2.html b/layout/reftests/margin-collapsing/block-negative-2b-dyn2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-2b-dyn2.html
@@ -0,0 +1,27 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+#a {
+ height: 20px;
+ background-color: green;
+ margin-bottom: 0;
+}
+#b {
+ height: 20px;
+ background-color: blue;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('a').style.marginBottom = '-20px';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="a"></div>
+<div id="b"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-3-noref1.html b/layout/reftests/margin-collapsing/block-negative-3-noref1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-3-noref1.html
@@ -0,0 +1,21 @@
+<!DOCTYPE html>
+<html>
+<head>
+<style type="text/css">
+html, body {
+ margin: 0; padding: 5px;
+}
+div {
+ height: 20px;
+ background-color: green;
+}
+#positive {
+ margin-bottom: 100px;
+}
+</style>
+</head>
+<body>
+<div id="positive"></div>
+<div></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-3-noref2.html b/layout/reftests/margin-collapsing/block-negative-3-noref2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-3-noref2.html
@@ -0,0 +1,22 @@
+<!DOCTYPE html>
+<html>
+<head>
+<style type="text/css">
+html, body {
+ margin: 0; padding: 5px;
+}
+div {
+ height: 100px;
+}
+#positive, #negative {
+ background-color: green;
+ height: 20px;
+}
+</style>
+</head>
+<body>
+<div id="positive"></div>
+<div></div>
+<div id="negative"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-3a-dyn1.html b/layout/reftests/margin-collapsing/block-negative-3a-dyn1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-3a-dyn1.html
@@ -0,0 +1,32 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+html, body {
+ margin: 0; padding: 5px;
+}
+div {
+ height: 20px;
+ background-color: green;
+}
+#positive {
+ margin-bottom: 100px;
+}
+#negative {
+ display: none;
+ margin-top: -80px;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('negative').style.display = 'block';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="positive"></div>
+<div id="negative"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-3a-dyn2.html b/layout/reftests/margin-collapsing/block-negative-3a-dyn2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-3a-dyn2.html
@@ -0,0 +1,31 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+html, body {
+ margin: 0; padding: 5px;
+}
+div {
+ height: 20px;
+ background-color: green;
+}
+#positive {
+ margin-bottom: 100px;
+}
+#negative {
+ margin-top: 0px;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('negative').style.marginTop = '-80px';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="positive"></div>
+<div id="negative"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-3b-dyn1.html b/layout/reftests/margin-collapsing/block-negative-3b-dyn1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-3b-dyn1.html
@@ -0,0 +1,32 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+html, body {
+ margin: 0; padding: 5px;
+}
+div {
+ height: 20px;
+ background-color: green;
+}
+#negative {
+ margin-bottom: -80px;
+}
+#positive {
+ display: none;
+ margin-top: 100px;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('positive').style.display = 'block';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="negative"></div>
+<div id="positive"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-3b-dyn2.html b/layout/reftests/margin-collapsing/block-negative-3b-dyn2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-3b-dyn2.html
@@ -0,0 +1,31 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+html, body {
+ margin: 0; padding: 5px;
+}
+div {
+ height: 20px;
+ background-color: green;
+}
+#negative {
+ margin-bottom: -80px;
+}
+#positive {
+ margin-top: 0;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('positive').style.marginTop = '100px';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="negative"></div>
+<div id="positive"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-4-noref1.html b/layout/reftests/margin-collapsing/block-negative-4-noref1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-4-noref1.html
@@ -0,0 +1,22 @@
+<!DOCTYPE html>
+<html>
+<head>
+<style type="text/css">
+html, body {
+ margin: 0; padding: 5px;
+}
+div {
+ height: 20px;
+ background-color: green;
+}
+#positive {
+ background-color: blue;
+ margin-bottom: 40px;
+}
+</style>
+</head>
+<body>
+<div id="positive"></div>
+<div></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-4-noref2.html b/layout/reftests/margin-collapsing/block-negative-4-noref2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-4-noref2.html
@@ -0,0 +1,25 @@
+<!DOCTYPE html>
+<html>
+<head>
+<style type="text/css">
+html, body {
+ margin: 0; padding: 5px;
+}
+#positive, #negative {
+ height: 20px;
+ background-color: blue;
+}
+#margin {
+ height: 40px;
+}
+#negative {
+ background-color: green;
+}
+</style>
+</head>
+<body>
+<div id="positive"></div>
+<div id="margin"></div>
+<div id="negative"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-4a-dyn1.html b/layout/reftests/margin-collapsing/block-negative-4a-dyn1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-4a-dyn1.html
@@ -0,0 +1,34 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+html, body {
+ margin: 0; padding: 5px;
+}
+div {
+ height: 20px;
+ background-color: green;
+}
+#positive {
+ margin-top: 30px;
+ margin-bottom: 40px;
+}
+#negative {
+ display: none;
+ margin-top: -90px;
+ background-color: blue;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('negative').style.display = 'block';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="positive"></div>
+<div id="negative"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-4a-dyn2.html b/layout/reftests/margin-collapsing/block-negative-4a-dyn2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-4a-dyn2.html
@@ -0,0 +1,33 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+html, body {
+ margin: 0; padding: 5px;
+}
+div {
+ height: 20px;
+ background-color: green;
+}
+#positive {
+ margin-top: 30px;
+ margin-bottom: 40px;
+}
+#negative {
+ margin-top: 0;
+ background-color: blue;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('negative').style.marginTop = '-90px';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="positive"></div>
+<div id="negative"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-4b-dyn1.html b/layout/reftests/margin-collapsing/block-negative-4b-dyn1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-4b-dyn1.html
@@ -0,0 +1,34 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+html, body {
+ margin: 0; padding: 5px;
+}
+div {
+ height: 20px;
+ background-color: green;
+}
+#negative {
+ margin-top: 30px;
+ margin-bottom: -90px;
+}
+#positive {
+ display: none;
+ margin-top: 40px;
+ background-color: blue;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('positive').style.display = 'block';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="negative"></div>
+<div id="positive"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-4b-dyn2.html b/layout/reftests/margin-collapsing/block-negative-4b-dyn2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-4b-dyn2.html
@@ -0,0 +1,33 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+html, body {
+ margin: 0; padding: 5px;
+}
+div {
+ height: 20px;
+ background-color: green;
+}
+#negative {
+ margin-top: 30px;
+ margin-bottom: -90px;
+}
+#positive {
+ margin-top: 0;
+ background-color: blue;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('positive').style.marginTop = '40px';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="negative"></div>
+<div id="positive"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-5-dyn1.html b/layout/reftests/margin-collapsing/block-negative-5-dyn1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-5-dyn1.html
@@ -0,0 +1,34 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+html, body {
+ margin: 0; padding: 5px;
+}
+div {
+ height: 20px;
+ background-color: green;
+}
+#small {
+ margin-top: 40px;
+ margin-bottom: -40px;
+}
+#big {
+ display: none;
+ margin-top: -60px;
+ background-color: blue;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('big').style.display = 'block';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="small"></div>
+<div id="big"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-5-dyn2.html b/layout/reftests/margin-collapsing/block-negative-5-dyn2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-5-dyn2.html
@@ -0,0 +1,33 @@
+<!DOCTYPE html>
+<html class="reftest-wait">
+<head>
+<style type="text/css">
+html, body {
+ margin: 0; padding: 5px;
+}
+div {
+ height: 20px;
+ background-color: green;
+}
+#small {
+ margin-top: 40px;
+ margin-bottom: -40px;
+}
+#big {
+ margin-top: 0;
+ background-color: blue;
+}
+</style>
+<script type="text/javascript">
+function test() {
+ document.getElementById('big').style.marginTop = '-60px';
+ document.documentElement.removeAttribute('class');
+}
+document.addEventListener('MozReftestInvalidate', test, false);
+</script>
+</head>
+<body>
+<div id="small"></div>
+<div id="big"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-5-noref1.html b/layout/reftests/margin-collapsing/block-negative-5-noref1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-5-noref1.html
@@ -0,0 +1,25 @@
+<!DOCTYPE html>
+<html>
+<head>
+<style type="text/css">
+html, body {
+ margin: 0; padding: 5px;
+}
+div {
+ height: 20px;
+ background-color: green;
+}
+#small {
+ margin-top: 40px;
+ margin-bottom: -40px;
+}
+#big {
+ background-color: blue;
+}
+</style>
+</head>
+<body>
+<div id="small"></div>
+<div id="big"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/block-negative-5-noref2.html b/layout/reftests/margin-collapsing/block-negative-5-noref2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/margin-collapsing/block-negative-5-noref2.html
@@ -0,0 +1,24 @@
+<!DOCTYPE html>
+<html>
+<head>
+<style type="text/css">
+html, body {
+ margin: 0; padding: 5px;
+}
+div {
+ height: 20px;
+}
+#small {
+ background-color: green;
+}
+#big {
+ background-color: blue;
+}
+</style>
+</head>
+<body>
+<div></div>
+<div id="big"></div>
+<div id="small"></div>
+</body>
+</html>
diff --git a/layout/reftests/margin-collapsing/reftest.list b/layout/reftests/margin-collapsing/reftest.list
--- a/layout/reftests/margin-collapsing/reftest.list
+++ b/layout/reftests/margin-collapsing/reftest.list
@@ -60,29 +60,111 @@
 != block-sibling-1c-dyn.html block-sibling-1-noref2.html
 == block-sibling-2-dyn.html block-sibling-2-ref.html
 == block-sibling-2-dyn.html block-sibling-2-ref2.html
 != block-sibling-2-dyn.html block-sibling-2-noref.html
 == block-sibling-3-dyn.html block-sibling-1-ref.html
 == block-sibling-3-dyn.html block-sibling-1-ref2.html
 != block-sibling-3-dyn.html block-sibling-1-noref.html
 == block-negative-1a.html block-negative-1-ref.html
+!= block-negative-1a.html block-negative-1-noref1.html
+!= block-negative-1a.html block-negative-1-noref2.html
 == block-negative-1b.html block-negative-1-ref.html
+!= block-negative-1b.html block-negative-1-noref1.html
+!= block-negative-1b.html block-negative-1-noref2.html
 == block-negative-2a.html block-negative-2-ref.html
+!= block-negative-2a.html block-negative-2-noref1.html
+!= block-negative-2a.html block-negative-2-noref2.html
 == block-negative-2b.html block-negative-2-ref.html
+!= block-negative-2b.html block-negative-2-noref1.html
+!= block-negative-2b.html block-negative-2-noref2.html
 == block-negative-3a.html block-negative-3-ref.html
 == block-negative-3a.html block-negative-3-ref2.html
+!= block-negative-3a.html block-negative-3-noref1.html
+!= block-negative-3a.html block-negative-3-noref2.html
 == block-negative-3b.html block-negative-3-ref.html
 == block-negative-3b.html block-negative-3-ref2.html
+!= block-negative-3b.html block-negative-3-noref1.html
+!= block-negative-3b.html block-negative-3-noref2.html
 == block-negative-4a.html block-negative-4-ref.html
 == block-negative-4a.html block-negative-4-ref2.html
+!= block-negative-4a.html block-negative-4-noref1.html
+!= block-negative-4a.html block-negative-4-noref2.html
 == block-negative-4b.html block-negative-4-ref.html
 == block-negative-4b.html block-negative-4-ref2.html
+!= block-negative-4b.html block-negative-4-noref1.html
+!= block-negative-4b.html block-negative-4-noref2.html
 == block-negative-5.html block-negative-5-ref.html
 == block-negative-5.html block-negative-5-ref2.html
+!= block-negative-5.html block-negative-5-noref1.html
+!= block-negative-5.html block-negative-5-noref2.html
+== block-negative-1a-dyn1.html block-negative-1-ref.html
+!= block-negative-1a-dyn1.html block-negative-1-noref1.html
+!= block-negative-1a-dyn1.html block-negative-1-noref2.html
+== block-negative-1a-dyn2.html block-negative-1-ref.html
+!= block-negative-1a-dyn2.html block-negative-1-noref1.html
+!= block-negative-1a-dyn2.html block-negative-1-noref2.html
+== block-negative-1b-dyn1.html block-negative-1-ref.html
+!= block-negative-1b-dyn1.html block-negative-1-noref1.html
+!= block-negative-1b-dyn1.html block-negative-1-noref2.html
+== block-negative-1b-dyn2.html block-negative-1-ref.html
+!= block-negative-1b-dyn2.html block-negative-1-noref1.html
+!= block-negative-1b-dyn2.html block-negative-1-noref2.html
+== block-negative-2a-dyn1.html block-negative-2-ref.html
+!= block-negative-2a-dyn1.html block-negative-2-noref1.html
+!= block-negative-2a-dyn1.html block-negative-2-noref2.html
+== block-negative-2a-dyn2.html block-negative-2-ref.html
+!= block-negative-2a-dyn2.html block-negative-2-noref1.html
+!= block-negative-2a-dyn2.html block-negative-2-noref2.html
+== block-negative-2b-dyn1.html block-negative-2-ref.html
+!= block-negative-2b-dyn1.html block-negative-2-noref1.html
+!= block-negative-2b-dyn1.html block-negative-2-noref2.html
+== block-negative-2b-dyn2.html block-negative-2-ref.html
+!= block-negative-2b-dyn2.html block-negative-2-noref1.html
+!= block-negative-2b-dyn2.html block-negative-2-noref2.html
+== block-negative-3a-dyn1.html block-negative-3-ref.html
+== block-negative-3a-dyn1.html block-negative-3-ref2.html
+!= block-negative-3a-dyn1.html block-negative-3-noref1.html
+!= block-negative-3a-dyn1.html block-negative-3-noref2.html
+== block-negative-3a-dyn2.html block-negative-3-ref.html
+== block-negative-3a-dyn2.html block-negative-3-ref2.html
+!= block-negative-3a-dyn2.html block-negative-3-noref1.html
+!= block-negative-3a-dyn2.html block-negative-3-noref2.html
+== block-negative-3b-dyn1.html block-negative-3-ref.html
+== block-negative-3b-dyn1.html block-negative-3-ref2.html
+!= block-negative-3b-dyn1.html block-negative-3-noref1.html
+!= block-negative-3b-dyn1.html block-negative-3-noref2.html
+== block-negative-3b-dyn2.html block-negative-3-ref.html
+== block-negative-3b-dyn2.html block-negative-3-ref2.html
+!= block-negative-3b-dyn2.html block-negative-3-noref1.html
+!= block-negative-3b-dyn2.html block-negative-3-noref2.html
+== block-negative-4a-dyn1.html block-negative-4-ref.html
+== block-negative-4a-dyn1.html block-negative-4-ref2.html
+!= block-negative-4a-dyn1.html block-negative-4-noref1.html
+!= block-negative-4a-dyn1.html block-negative-4-noref2.html
+== block-negative-4a-dyn2.html block-negative-4-ref.html
+== block-negative-4a-dyn2.html block-negative-4-ref2.html
+!= block-negative-4a-dyn2.html block-negative-4-noref1.html
+!= block-negative-4a-dyn2.html block-negative-4-noref2.html
+== block-negative-4b-dyn1.html block-negative-4-ref.html
+== block-negative-4b-dyn1.html block-negative-4-ref2.html
+!= block-negative-4b-dyn1.html block-negative-4-noref1.html
+!= block-negative-4b-dyn1.html block-negative-4-noref2.html
+== block-negative-4b-dyn2.html block-negative-4-ref.html
+== block-negative-4b-dyn2.html block-negative-4-ref2.html
+!= block-negative-4b-dyn2.html block-negative-4-noref1.html
+!= block-negative-4b-dyn2.html block-negative-4-noref2.html
+== block-negative-5-dyn1.html block-negative-5-ref.html
+== block-negative-5-dyn1.html block-negative-5-ref2.html
+!= block-negative-5-dyn1.html block-negative-5-noref1.html
+!= block-negative-5-dyn1.html block-negative-5-noref2.html
+== block-negative-5-dyn2.html block-negative-5-ref.html
+== block-negative-5-dyn2.html block-negative-5-ref2.html
+!= block-negative-5-dyn2.html block-negative-5-noref1.html
+!= block-negative-5-dyn2.html block-negative-5-noref2.html
 == block-non-sibling-1a.html block-non-sibling-1-ref.html
 == block-non-sibling-1a.html block-non-sibling-1-ref2.html
 == block-non-sibling-1b.html block-non-sibling-1-ref.html
 == block-non-sibling-1b.html block-non-sibling-1-ref2.html
 == block-non-sibling-1c.html block-non-sibling-1-ref.html
 == block-non-sibling-1c.html block-non-sibling-1-ref2.html
 == block-non-sibling-1d.html block-non-sibling-1-ref.html
 == block-non-sibling-1d.html block-non-sibling-1-ref2.html
