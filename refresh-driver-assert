From: L. David Baron <dbaron@dbaron.org>

Bug 850559:  Assert when a test leaves test control of refresh driver on.

diff --git a/layout/base/nsPresContext.cpp b/layout/base/nsPresContext.cpp
--- a/layout/base/nsPresContext.cpp
+++ b/layout/base/nsPresContext.cpp
@@ -960,16 +960,19 @@ nsPresContext::Init(nsDeviceContext* aDe
       }
     }
 
     if (!mRefreshDriver) {
       mRefreshDriver = new nsRefreshDriver(this);
     }
   }
 
+  MOZ_ASSERT(!mRefreshDriver->IsTestControllingRefreshesEnabled(),
+             "a previous test didn't restore normal refreshing");
+
   // Initialise refresh tick counters for OMTA
   mLastStyleUpdateForAllAnimations =
     mLastUpdateThrottledStyle = mRefreshDriver->MostRecentRefresh();
 
   mLangService = do_GetService(NS_LANGUAGEATOMSERVICE_CONTRACTID);
 
   // Register callbacks so we're notified when the preferences change
   Preferences::RegisterCallback(nsPresContext::PrefChangedCallback,
