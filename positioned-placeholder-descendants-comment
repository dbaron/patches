From: L. David Baron <dbaron@dbaron.org>

Bug 1299736 - Comment about complexity in FrameHasPositionedPlaceholderDescendants.

MozReview-Commit-ID: FStXA2IyPnP

diff --git a/layout/base/RestyleManagerBase.cpp b/layout/base/RestyleManagerBase.cpp
--- a/layout/base/RestyleManagerBase.cpp
+++ b/layout/base/RestyleManagerBase.cpp
@@ -674,16 +674,25 @@ FrameHasPositionedPlaceholderDescendants
                      "SVG text frames can't be out of flow");
         if (aPositionMask & (1 << outOfFlow->StyleDisplay()->mPosition)) {
           return true;
         }
       }
       uint32_t positionMask = aPositionMask;
       // Is it faster to check aPositionMask & (1 << NS_STYLE_POSITION_ABSOLUTE)
       // before we check IsAbsPosContainingBlock?  Not clear....
+      // NOTE:  These tests of f->IsAbsPosContainingBlock() and
+      // f->IsFixedPosContainingBlock() are testing the *new* style of
+      // the children, which may be different from the style used to
+      // construct the current frame tree.  This can cause
+      // FrameHasPositionedPlaceholderDescendants to return false in
+      // cases where we might expect it to return true; however, in
+      // those cases, a deeper descendant should reconstruct the
+      // necessary frames (possibly by returning true from this
+      // function, or possibly by other mechanisms).
       if (f->IsAbsPosContainingBlock()) {
         if (f->IsFixedPosContainingBlock()) {
           continue;
         }
         // We don't care about absolutely positioned things inside f, because
         // they will still use f as their containing block.
         positionMask = (1 << NS_STYLE_POSITION_FIXED);
       }
