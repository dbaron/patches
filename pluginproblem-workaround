From: L. David Baron <dbaron@dbaron.org>

Add workaround for bad pixel in pluginproblem reftest.  (Bug 459144)

diff --git a/modules/plugin/test/reftest/pluginproblemui-direction-ref.html b/modules/plugin/test/reftest/pluginproblemui-direction-1-ref.html
rename from modules/plugin/test/reftest/pluginproblemui-direction-ref.html
rename to modules/plugin/test/reftest/pluginproblemui-direction-1-ref.html
diff --git a/modules/plugin/test/reftest/pluginproblemui-direction-ref.html b/modules/plugin/test/reftest/pluginproblemui-direction-2-ref.html
copy from modules/plugin/test/reftest/pluginproblemui-direction-ref.html
copy to modules/plugin/test/reftest/pluginproblemui-direction-2-ref.html
--- a/modules/plugin/test/reftest/pluginproblemui-direction-ref.html
+++ b/modules/plugin/test/reftest/pluginproblemui-direction-2-ref.html
@@ -1,14 +1,18 @@
 <!DOCTYPE html>
 <html class="reftest-wait">
   <head>
     <title>Plugin Problem UI directionality test</title>
   </head>
   <body dir="ltr" style="text-align: left;">
+    <!-- a variant of pluginproblemui-direction-1.html that covers up
+         the spot where we get random variation with d2d, so that we
+         can still test it with d2d -->
+    <div style="position: absolute; width: 1px; height: 1px; background: red; z-index: 1; left: 401px; top: 19px;"></div>
     <embed type="application/x-test" width="400" height="400" id="crashme"></embed>
     <script type="text/javascript">
       var plugin = document.getElementById("crashme");
       function checkForCrashUI() {
         if (getComputedStyle(plugin, null).MozBinding != "none") {
           document.documentElement.removeAttribute("class");
           clearInterval(interval);
         }
diff --git a/modules/plugin/test/reftest/pluginproblemui-direction-1.html b/modules/plugin/test/reftest/pluginproblemui-direction-2.html
copy from modules/plugin/test/reftest/pluginproblemui-direction-1.html
copy to modules/plugin/test/reftest/pluginproblemui-direction-2.html
--- a/modules/plugin/test/reftest/pluginproblemui-direction-1.html
+++ b/modules/plugin/test/reftest/pluginproblemui-direction-2.html
@@ -1,14 +1,18 @@
 <!DOCTYPE html>
 <html class="reftest-wait">
   <head>
     <title>Plugin Problem UI directionality test</title>
   </head>
   <body dir="rtl" style="text-align: left;">
+    <!-- a variant of pluginproblemui-direction-1.html that covers up
+         the spot where we get random variation with d2d, so that we
+         can still test it with d2d -->
+    <div style="position: absolute; width: 1px; height: 1px; background: red; z-index: 1; left: 401px; top: 19px;"></div>
     <embed type="application/x-test" width="400" height="400" id="crashme"></embed>
     <script type="text/javascript">
       var plugin = document.getElementById("crashme");
       function checkForCrashUI() {
         if (getComputedStyle(plugin, null).MozBinding != "none") {
           document.documentElement.removeAttribute("class");
           clearInterval(interval);
         }
diff --git a/modules/plugin/test/reftest/reftest.list b/modules/plugin/test/reftest/reftest.list
--- a/modules/plugin/test/reftest/reftest.list
+++ b/modules/plugin/test/reftest/reftest.list
@@ -1,11 +1,12 @@
 # basic sanity checking
 random-if(!haveTestPlugin) != plugin-sanity.html about:blank
 fails-if(!haveTestPlugin) == plugin-sanity.html div-sanity.html
 fails-if(!haveTestPlugin) == plugin-alpha-zindex.html div-alpha-zindex.html
 fails-if(!haveTestPlugin) == plugin-alpha-opacity.html div-alpha-opacity.html
 fails-if(!haveTestPlugin) == windowless-clipping-1.html windowless-clipping-1-ref.html
 fails-if(!haveTestPlugin) == border-padding-1.html border-padding-1-ref.html
 fails-if(!haveTestPlugin) == border-padding-2.html border-padding-2-ref.html
-asserts-if(http.oscpu.match(/Linux/),0-1) fails-if(!haveTestPlugin) skip-if(!prefs.getBoolPref("dom.ipc.plugins.enabled")) == pluginproblemui-direction-1.html pluginproblemui-direction-ref.html # assertion is bug 585394
+asserts-if(http.oscpu.match(/Linux/),0-1) random-if(d2d) fails-if(!haveTestPlugin) skip-if(!prefs.getBoolPref("dom.ipc.plugins.enabled")) == pluginproblemui-direction-1.html pluginproblemui-direction-1-ref.html # assertion is bug 585394
+asserts-if(http.oscpu.match(/Linux/),0-1) fails-if(!haveTestPlugin) skip-if(!prefs.getBoolPref("dom.ipc.plugins.enabled")) == pluginproblemui-direction-2.html pluginproblemui-direction-2-ref.html # assertion is bug 585394
 # Disabled for now to investigate Windows/Linux test failures
 # fails-if(!haveTestPlugin) == border-padding-3.html border-padding-3-ref.html
