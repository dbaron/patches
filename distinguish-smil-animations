From: L. David Baron <dbaron@dbaron.org>

Bug 1133439 patch 2 - Distinguish animation-only SMIL restyles based on eRestyle_StyleAttribute_Animations in RestyleManager::PostRestyleEvent.  r=birtles

diff --git a/layout/base/RestyleManager.cpp b/layout/base/RestyleManager.cpp
--- a/layout/base/RestyleManager.cpp
+++ b/layout/base/RestyleManager.cpp
@@ -1798,24 +1798,20 @@ RestyleManager::PostRestyleEvent(Element
   if (aRestyleHint == 0 && !aMinChangeHint) {
     // Nothing to do here
     return;
   }
 
   mPendingRestyles.AddPendingRestyle(aElement, aRestyleHint, aMinChangeHint);
 
   // Set mHavePendingNonAnimationRestyles for any restyle that could
-  // possibly contain non-animation styles.  Unfortunately there's one
-  // level of the cascade and associated change hint
-  // (eRestyle_StyleAttribute) where we don't fully distinguish.
-  // FIXME (bug 1133439): We could at least distinguish by having two
-  // separate eRestyle_StyleAttribute hints, one for animations and one
-  // for other things.
-  if (aRestyleHint & ~(eRestyle_CSSTransitions | eRestyle_CSSAnimations |
-                       eRestyle_SVGAttrAnimations)) {
+  // possibly contain non-animation styles (i.e., those that require us
+  // to do an animation-only style flush before processing style changes
+  // to ensure correct initialization of CSS transitions).
+  if (aRestyleHint & ~eRestyle_AllHintsWithAnimations) {
     mHavePendingNonAnimationRestyles = true;
   }
 
   PostRestyleEventInternal(false);
 }
 
 void
 RestyleManager::PostRestyleEventInternal(bool aForLazyConstruction)
