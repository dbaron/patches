From: L. David Baron <dbaron@dbaron.org>

Bug 837211 patch 4 - Off-by-default preference, available only in nightly/aurora versions, for testing the effect of supporting -webkit- prefixes or unprefixed properties.  r=bzbarsky

Note that this does not emulate the WebKit quirk of supporting
element.style["-webkit-animation"] or supporting the uppercase
element.style.WebkitAnimation (etc.) as opposed to the lowercase (and
enumerable) element.style.webkitAnimation.

Note that this also does not add aliases for transition or animation
events.

diff --git a/layout/style/nsCSSParser.cpp b/layout/style/nsCSSParser.cpp
--- a/layout/style/nsCSSParser.cpp
+++ b/layout/style/nsCSSParser.cpp
@@ -2951,16 +2951,18 @@ CSSParserImpl::ParseAtRule(RuleAppendFun
     newSection = eCSSSection_General;
 
   } else if (mToken.mIdent.LowerCaseEqualsLiteral("page")) {
     parseFunc = &CSSParserImpl::ParsePageRule;
     newSection = eCSSSection_General;
 
   } else if ((nsCSSProps::IsEnabled(eCSSPropertyAlias_MozAnimation) &&
               mToken.mIdent.LowerCaseEqualsLiteral("-moz-keyframes")) ||
+             (nsCSSProps::IsEnabled(eCSSPropertyAlias_WebkitAnimation) &&
+              mToken.mIdent.LowerCaseEqualsLiteral("-webkit-keyframes")) ||
              mToken.mIdent.LowerCaseEqualsLiteral("keyframes")) {
     parseFunc = &CSSParserImpl::ParseKeyframesRule;
     newSection = eCSSSection_General;
 
   } else if (mToken.mIdent.LowerCaseEqualsLiteral("supports")) {
     parseFunc = &CSSParserImpl::ParseSupportsRule;
     newSection = eCSSSection_General;
 
diff --git a/layout/style/nsCSSPropAliasList.h b/layout/style/nsCSSPropAliasList.h
--- a/layout/style/nsCSSPropAliasList.h
+++ b/layout/style/nsCSSPropAliasList.h
@@ -166,16 +166,200 @@ CSS_PROP_ALIAS(-moz-text-decoration-line
                MozTextDecorationLine,
                0,
                "")
 CSS_PROP_ALIAS(-moz-text-decoration-style,
                text_decoration_style,
                MozTextDecorationStyle,
                0,
                "")
+
+#ifdef ALPHA_BUILD
+  #define WEBKIT_PREFIX_PREF "layout.css.test-webkit-prefixes"
+#else
+  // CSS_PROPERTY_DISABLED_BY_DEFAULT will mean that the properties will
+  // be unconditionally *disabled*.
+  #define WEBKIT_PREFIX_PREF ""
+#endif
+
+// -webkit- prefixes
+CSS_PROP_ALIAS(-webkit-animation,
+               animation,
+               WebkitAnimation,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-animation-delay,
+               animation_delay,
+               WebkitAnimationDelay,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-animation-direction,
+               animation_direction,
+               WebkitAnimationDirection,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-animation-duration,
+               animation_duration,
+               WebkitAnimationDuration,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-animation-fill-mode,
+               animation_fill_mode,
+               WebkitAnimationFillMode,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-animation-iteration-count,
+               animation_iteration_count,
+               WebkitAnimationIterationCount,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-animation-name,
+               animation_name,
+               WebkitAnimationName,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-animation-play-state,
+               animation_play_state,
+               WebkitAnimationPlayState,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-animation-timing-function,
+               animation_timing_function,
+               WebkitAnimationTimingFunction,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+
+CSS_PROP_ALIAS(-webkit-text-size-adjust,
+               text_size_adjust,
+               WebkitTextSizeAdjust,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+
+CSS_PROP_ALIAS(-webkit-transform,
+               transform,
+               WebkitTransform,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-transform-origin,
+               transform_origin,
+               WebkitTransformOrigin,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-transform-style,
+               transform_style,
+               WebkitTransformStyle,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+
+CSS_PROP_ALIAS(-webkit-transition,
+               transition,
+               WebkitTransition,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-transition-delay,
+               transition_delay,
+               WebkitTransitionDelay,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-transition-duration,
+               transition_duration,
+               WebkitTransitionDuration,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-transition-property,
+               transition_property,
+               WebkitTransitionProperty,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-transition-timing-function,
+               transition_timing_function,
+               WebkitTransitionTimingFunction,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+
+CSS_PROP_ALIAS(-webkit-border-radius,
+               border_radius,
+               WebkitBorderRadius,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-border-top-left-radius,
+               border_top_left_radius,
+               WebkitBorderTopLeftRadius, // really no dom property
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-border-top-right-radius,
+               border_top_right_radius,
+               WebkitBorderTopRightRadius, // really no dom property
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-border-bottom-left-radius,
+               border_bottom_left_radius,
+               WebkitBorderBottomLeftRadius, // really no dom property
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-border-bottom-right-radius,
+               border_bottom_right_radius,
+               WebkitBorderBottomRightRadius, // really no dom property
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+
+CSS_PROP_ALIAS(-webkit-appearance,
+               appearance,
+               WebkitAppearance,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-background-clip,
+               background_clip,
+               WebkitBackgroundClip,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-background-origin,
+               background_origin,
+               WebkitBackgroundOrigin,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-background-size,
+               background_size,
+               WebkitBackgroundSize,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-border-image,
+               border_image,
+               WebkitBorderImage,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-box-shadow,
+               box_shadow,
+               WebkitBoxShadow,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(-webkit-user-select,
+               user_select,
+               WebkitUserSelect,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+
+// no prefixes
+CSS_PROP_ALIAS(text-size-adjust,
+               text_size_adjust,
+               TextSizeAdjust,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(appearance,
+               appearance,
+               Appearance,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+CSS_PROP_ALIAS(user-select,
+               user_select,
+               UserSelect,
+               CSS_PROPERTY_DISABLED_BY_DEFAULT,
+               WEBKIT_PREFIX_PREF)
+
+#undef WEBKIT_PREFIX_PREF
 CSS_PROP_ALIAS(padding-inline-end,
                padding_end,
                PaddingInlineEnd,
                0,
                "layout.css.vertical-text.enabled")
 CSS_PROP_ALIAS(padding-inline-start,
                padding_start,
                PaddingInlineStart,
