From: L. David Baron <dbaron@dbaron.org>

Make trace-malloc work again following mozalloc landing.  (Bug 576776)

diff --git a/tools/trace-malloc/lib/nsTraceMalloc.c b/tools/trace-malloc/lib/nsTraceMalloc.c
--- a/tools/trace-malloc/lib/nsTraceMalloc.c
+++ b/tools/trace-malloc/lib/nsTraceMalloc.c
@@ -34,16 +34,23 @@
  * use your version of this file under the terms of the MPL, indicate your
  * decision by deleting the provisions above and replace them with the notice
  * and other provisions required by the GPL or the LGPL. If you do not delete
  * the provisions above, a recipient may use your version of this file under
  * the terms of any one of the MPL, the GPL or the LGPL.
  *
  * ***** END LICENSE BLOCK ***** */
 #ifdef NS_TRACE_MALLOC
+
+/*
+ * We need to redefine |malloc|, etc. in this file; without this, we'll
+ * end up redefining |moz_malloc|, etc. instead.
+ */
+#define MOZALLOC_DONT_DEFINE_MACRO_WRAPPERS
+
  /*
   * TODO:
   * - FIXME https://bugzilla.mozilla.org/show_bug.cgi?id=392008
   * - extend logfile so 'F' record tells free stack
   */
 #include <errno.h>
 #include <fcntl.h>
 #include <stdio.h>
