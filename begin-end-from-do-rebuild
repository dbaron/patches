From: L. David Baron <dbaron@dbaron.org>

Bug 1115812 patch N - Call BeginProcessingRestyles and EndProcessingRestyles from DoRebuildAllStyleData.

diff --git a/layout/base/RestyleManager.cpp b/layout/base/RestyleManager.cpp
--- a/layout/base/RestyleManager.cpp
+++ b/layout/base/RestyleManager.cpp
@@ -1527,33 +1527,36 @@ RestyleManager::RebuildAllStyleData(nsCh
   // by just posting a style change -- except we really need to restyle
   // the root frame rather than the root element's primary frame.
   ProcessPendingRestyles();
 }
 
 void
 RestyleManager::DoRebuildAllStyleData(RestyleTracker& aRestyleTracker)
 {
+  BeginProcessingRestyles();
+
   mInRebuildAllStyleData = true;
 
   // Tell the style set to get the old rule tree out of the way
   // so we can recalculate while maintaining rule tree immutability
   nsresult rv = mPresContext->StyleSet()->BeginReconstruct();
   if (NS_FAILED(rv)) {
     return;
   }
 
   // Recalculate all of the style contexts for the document
   // Note that we can ignore the return value of ComputeStyleChangeFor
   // because we never need to reframe the root frame
   // Note: The restyle tracker we pass in here doesn't matter.
   ComputeAndProcessStyleChange(mPresContext->PresShell()->GetRootFrame(),
                                nsChangeHint(0), aRestyleTracker,
                                eRestyle_ForceDescendants);
-  FlushOverflowChangedTracker();
+
+  EndProcessingRestyles();
 
   if (mInRebuildAllStyleData) {
     // Tell the style set it's safe to destroy the old rule tree.  We
     // must do this after the ProcessRestyledFrames call in case the
     // change list has frame reconstructs in it (since frames to be
     // reconstructed will still have their old style context pointers
     // until they are destroyed).
     mPresContext->StyleSet()->EndReconstruct();
