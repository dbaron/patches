From: L. David Baron <dbaron@dbaron.org>

Free trace-malloc static data structures on shutdown.

diff --git a/tools/trace-malloc/lib/nsTraceMalloc.c b/tools/trace-malloc/lib/nsTraceMalloc.c
--- a/tools/trace-malloc/lib/nsTraceMalloc.c
+++ b/tools/trace-malloc/lib/nsTraceMalloc.c
@@ -594,16 +594,17 @@ static PLHashEntry *lfdset_allocentry(vo
 
 static void lfdset_freeentry(void *pool, PLHashEntry *he, PRUintn flag)
 {
     lfdset_entry *le;
 
     if (flag != HT_FREE_ENTRY)
         return;
     le = (lfdset_entry*) he;
+    __libc_free((char*) le->base.key);
     __libc_free((void*) le);
 }
 
 static PLHashAllocOps lfdset_hashallocops = {
     generic_alloctable, generic_freetable,
     lfdset_allocentry,  lfdset_freeentry
 };
 
@@ -1552,16 +1553,17 @@ NS_TraceMallocShutdown(void)
             fp->fd = -1;
         }
         if (fp != &default_logfile) {
             if (fp == logfp)
                 logfp = &default_logfile;
             free((void*) fp);
         }
     }
+    /* XXX destroy the libraries, filenames, and methods tables */
     if (tmlock) {
         PRLock *lock = tmlock;
         tmlock = NULL;
         PR_DestroyLock(lock);
     }
     if (tracing_enabled) {
         tracing_enabled = 0;
         ShutdownHooker();
