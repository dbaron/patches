When propagating flushes up to the parent document, promote style flushes into layout flushes, since media queries mean that to get the correct style we need our container to be the correct size.  b=156716

diff --git a/content/base/src/nsDocument.cpp b/content/base/src/nsDocument.cpp
--- a/content/base/src/nsDocument.cpp
+++ b/content/base/src/nsDocument.cpp
@@ -4964,8 +4964,15 @@ nsDocument::FlushPendingNotifications(mo
   // flush ourselves, then don't flush the parent, since that can cause things
   // like resizes of our frame's widget, which we can't handle while flushing
   // is unsafe.
+  // Since media queries mean that a size change of our container can
+  // affect style, we need to promote a style flush on ourself to a
+  // layout flush on our parent, since we need our container to be the
+  // correct size to determine the correct style.
   if (mParentDocument && IsSafeToFlush()) {
-    mParentDocument->FlushPendingNotifications(aType);
+    mozFlushType parentType = aType;
+    if (aType == Flush_Style)
+      parentType = Flush_Layout;
+    mParentDocument->FlushPendingNotifications(parentType);
   }
 
   nsPresShellIterator iter(this);
