From: L. David Baron <dbaron@dbaron.org>

Bug 1367830 - Flush layout in accessibility test that uses the hidden window, to avoid duplicate reorder events.

TODO: See if this fixes the intermittent failure.

MozReview-Commit-ID: 6OiOidwZfY

diff --git a/accessible/tests/mochitest/events/test_docload.html b/accessible/tests/mochitest/events/test_docload.html
--- a/accessible/tests/mochitest/events/test_docload.html
+++ b/accessible/tests/mochitest/events/test_docload.html
@@ -18,22 +18,24 @@
 
   <script type="application/javascript">
     // Front end stuff sometimes likes to stuff things in the hidden window(s)
     // in which case there's accessibles for that content.
     Components.utils.import("resource://gre/modules/Services.jsm");
 
     // Force the creation of an accessible for the hidden window's document.
     var doc = Services.appShell.hiddenDOMWindow.document;
+    doc.body.offsetWidth; // flush layout, since hidden window is inactive
     gAccService.getAccessibleFor(doc);
 
     // The private hidden window will be lazily created that's why we need to do
     // it here *before* loading '../events.js' or else we'll have a duplicate
     // reorder event.
     var privateDoc = Services.appShell.hiddenPrivateDOMWindow.document;
+    privateDoc.body.offsetWidth; // flush layout, since hidden window is inactive
 
     // Force the creation of an accessible for the private hidden window's doc.
     gAccService.getAccessibleFor(privateDoc);
   </script>
 
   <script type="application/javascript"
           src="../events.js"></script>
 
