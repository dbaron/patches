From: L. David Baron <dbaron@dbaron.org>

Make split-profile run jprof in the directory with the jprof-log.  No bug.

diff --git a/tools/jprof/split-profile.py b/tools/jprof/split-profile.py
--- a/tools/jprof/split-profile.py
+++ b/tools/jprof/split-profile.py
@@ -88,17 +88,24 @@ splits = read_splits(splitfile)
 
 def generate_profile(options, destfile):
     """
     Run jprof to generate one split of the profile.
     """
     args = [jprof] + options + passthrough
     print "Generating {0}".format(destfile)
     destio = open(destfile, "w")
-    process = subprocess.Popen(args, stdout=destio)
+    # jprof expects the "jprof-map" file to be in its current working directory
+    cwd = None
+    for option in passthrough:
+        if option.find("jprof-log"):
+            cwd = os.path.dirname(option)
+    if cwd is None:
+        raise StandardError("no jprof-log option given")
+    process = subprocess.Popen(args, stdout=destio, cwd=cwd)
     process.wait()
     destio.close()
     if process.returncode != 0:
         os.remove(destfile)
         sys.stderr.write("Error {0} from command:\n  {1}\n".format(process.returncode, " ".join(args)))
         sys.exit(process.returncode)
 
 def output_filename(number, splitname):
