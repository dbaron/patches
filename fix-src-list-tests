Adjust expected results based on http://lists.w3.org/Archives/Public/www-style/2008Nov/0190.html and add tests for format().

diff --git a/layout/reftests/font-face/src-list-1-ref.html b/layout/reftests/font-face/order-1-ref.html
copy from layout/reftests/font-face/src-list-1-ref.html
copy to layout/reftests/font-face/order-1-ref.html
diff --git a/layout/reftests/font-face/src-list-2-ref.html b/layout/reftests/font-face/order-2-ref.html
copy from layout/reftests/font-face/src-list-2-ref.html
copy to layout/reftests/font-face/order-2-ref.html
--- a/layout/reftests/font-face/src-list-2-ref.html
+++ b/layout/reftests/font-face/order-2-ref.html
@@ -11,16 +11,24 @@
 		src: url(../fonts/markA.ttf);
 	}
 
 	@font-face {
 		font-family: "Mark2B";
 		src: url(../fonts/mark2B.ttf);
 	}
 
+	span.spacer {
+		/* to ensure the same vertical positioning of the text */
+		display: inline-block;
+		height: 3em;
+		width: 1em;
+		vertical-align: baseline;
+	}
+
 	</style>
 </head>
 <body>
 
-<p><span style="font-family: MarkA">A</span><span style="font-family: Mark2B">B</span>C</p>
+<p><span style="font-family: MarkA">A</span><span style="font-family: Mark2B">B</span>C<span class="spacer"></span></p>
 
 </body>
 </html>
diff --git a/layout/reftests/font-face/order-2.html b/layout/reftests/font-face/order-2.html
--- a/layout/reftests/font-face/order-2.html
+++ b/layout/reftests/font-face/order-2.html
@@ -23,16 +23,24 @@
 
 	@font-face {
 		font-family: "One";
 		src: url(../fonts/markA.ttf);
 	}
 
 	body { font-family: "One"; }
 
+	span.spacer {
+		/* to ensure the same vertical positioning of the text */
+		display: inline-block;
+		height: 3em;
+		width: 1em;
+		vertical-align: baseline;
+	}
+
 	</style>
 </head>
 <body>
 
-<p>ABC</p>
+<p>ABC<span class="spacer"></span></p>
 
 </body>
 </html>
diff --git a/layout/reftests/font-face/src-list-3-ref.html b/layout/reftests/font-face/order-3-ref.html
rename from layout/reftests/font-face/src-list-3-ref.html
rename to layout/reftests/font-face/order-3-ref.html
--- a/layout/reftests/font-face/src-list-3-ref.html
+++ b/layout/reftests/font-face/order-3-ref.html
@@ -11,16 +11,24 @@
 		src: url(../fonts/markA.ttf);
 	}
 
 	@font-face {
 		font-family: "Mark2B";
 		src: url(../fonts/mark2B.ttf);
 	}
 
+	span.spacer {
+		/* to ensure the same vertical positioning of the text */
+		display: inline-block;
+		height: 3em;
+		width: 1em;
+		vertical-align: baseline;
+	}
+
 	</style>
 </head>
 <body>
 
-<p><span style="font-family: MarkA">A</span><span style="font-family: Mark2B">B</span>C</p>
+<p><span style="font-family: MarkA">A</span><span style="font-family: Mark2B">B</span>C<span class="spacer"></span></p>
 
 </body>
 </html>
diff --git a/layout/reftests/font-face/order-3.html b/layout/reftests/font-face/order-3.html
--- a/layout/reftests/font-face/order-3.html
+++ b/layout/reftests/font-face/order-3.html
@@ -23,16 +23,24 @@
 
 	@font-face {
 		font-family: "One";
 		src: url(../fonts/markA.ttf);
 	}
 
 	body { font-family: "One"; }
 
+	span.spacer {
+		/* to ensure the same vertical positioning of the text */
+		display: inline-block;
+		height: 3em;
+		width: 1em;
+		vertical-align: baseline;
+	}
+
 	</style>
 </head>
 <body>
 
-<p>ABC</p>
+<p>ABC<span class="spacer"></span></p>
 
 </body>
 </html>
diff --git a/layout/reftests/font-face/reftest.list b/layout/reftests/font-face/reftest.list
--- a/layout/reftests/font-face/reftest.list
+++ b/layout/reftests/font-face/reftest.list
@@ -6,22 +6,24 @@ fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTT
 fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) == download-2.html download-2-ref.html
 HTTP(..) != download-2.html about:blank
 HTTP(..) == fallback-to-system-1.html fallback-to-system-1-ref.html
 fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) == name-override-simple-1.html name-override-simple-1-ref.html
 fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) != name-override-simple-1.html download-1-notref.html
 fails HTTP(..) == name-override-1.html name-override-1-ref.html
 HTTP(..) == multiple-descriptor-1.html multiple-descriptor-1-ref.html
 fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) != multiple-descriptor-1.html multiple-descriptor-1-notref.html
-HTTP(..) == src-list-1.html src-list-1-ref.html
-fails-if(MOZ_WIDGET_TOOLKIT!="gtk2") HTTP(..) == src-list-2.html src-list-2-ref.html
-fails-if(MOZ_WIDGET_TOOLKIT!="gtk2") HTTP(..) == src-list-3.html src-list-3-ref.html
+fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) == src-list-1.html src-list-1-ref.html
+fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) == src-list-2.html src-list-2-ref.html
+fails HTTP(..) == src-list-format-1.html src-list-format-1-ref.html
+fails HTTP(..) == src-list-format-2.html src-list-format-2-ref.html
+fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) == src-list-format-3.html src-list-format-3-ref.html
 # FIXME: The behavior here is neither mandated nor specified by the spec, but
 # it really ought to be.
-HTTP(..) == order-1.html src-list-1-ref.html
-fails-if(MOZ_WIDGET_TOOLKIT!="gtk2") HTTP(..) == order-2.html src-list-2-ref.html
-fails-if(MOZ_WIDGET_TOOLKIT!="gtk2") HTTP(..) == order-3.html src-list-3-ref.html
+HTTP(..) == order-1.html order-1-ref.html
+fails-if(MOZ_WIDGET_TOOLKIT!="gtk2") HTTP(..) == order-2.html order-2-ref.html
+fails-if(MOZ_WIDGET_TOOLKIT!="gtk2") HTTP(..) == order-3.html order-3-ref.html
 fails-if(MOZ_WIDGET_TOOLKIT=="cocoa") random-if(MOZ_WIDGET_TOOLKIT=="windows") HTTP(..) == multiple-in-family-1.html multiple-in-family-1-ref.html
 fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") fails-if(MOZ_WIDGET_TOOLKIT=="cocoa") random-if(MOZ_WIDGET_TOOLKIT=="windows") HTTP(..) != multiple-in-family-1.html multiple-in-family-1-notref.html
 random-if(MOZ_WIDGET_TOOLKIT=="windows") HTTP(..) == prop-order-over-rule-order-1a.html prop-order-over-rule-order-2a.html
 random-if(MOZ_WIDGET_TOOLKIT=="windows") HTTP(..) == prop-order-over-rule-order-1b.html prop-order-over-rule-order-2b.html
 random-if(MOZ_WIDGET_TOOLKIT=="windows") fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) != prop-order-over-rule-order-1a.html prop-order-over-rule-order-1b.html
 fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) == cross-iframe-1.html cross-iframe-1-ref.html
diff --git a/layout/reftests/font-face/src-list-1-ref.html b/layout/reftests/font-face/src-list-1-ref.html
--- a/layout/reftests/font-face/src-list-1-ref.html
+++ b/layout/reftests/font-face/src-list-1-ref.html
@@ -2,22 +2,22 @@
 	"http://www.w3.org/TR/html4/strict.dtd">
 <html lang="en-US">
 <head>
 	<title></title>
 	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 	<style type="text/css">
 
 	@font-face {
-		font-family: "MarkA";
-		src: url(../fonts/markA.ttf);
+		font-family: "MarkD";
+		src: url(../fonts/markD.ttf);
 	}
 
-	body { font-family: "MarkA"; }
+	body { font-family: "MarkD"; }
 
 	</style>
 </head>
 <body>
 
-<p>ABC</p>
+<p>DBC</p>
 
 </body>
 </html>
diff --git a/layout/reftests/font-face/src-list-2-ref.html b/layout/reftests/font-face/src-list-2-ref.html
--- a/layout/reftests/font-face/src-list-2-ref.html
+++ b/layout/reftests/font-face/src-list-2-ref.html
@@ -2,25 +2,22 @@
 	"http://www.w3.org/TR/html4/strict.dtd">
 <html lang="en-US">
 <head>
 	<title></title>
 	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 	<style type="text/css">
 
 	@font-face {
-		font-family: "MarkA";
-		src: url(../fonts/markA.ttf);
+		font-family: "MarkD";
+		src: url(../fonts/markD.ttf);
 	}
 
-	@font-face {
-		font-family: "Mark2B";
-		src: url(../fonts/mark2B.ttf);
-	}
+	body { font-family: MarkD; }
 
 	</style>
 </head>
 <body>
 
-<p><span style="font-family: MarkA">A</span><span style="font-family: Mark2B">B</span>C</p>
+<p>DBC</p>
 
 </body>
 </html>
diff --git a/layout/reftests/font-face/src-list-2.html b/layout/reftests/font-face/src-list-2.html
--- a/layout/reftests/font-face/src-list-2.html
+++ b/layout/reftests/font-face/src-list-2.html
@@ -3,17 +3,17 @@
 <html lang="en-US">
 <head>
 	<title></title>
 	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 	<style type="text/css">
 
 	@font-face {
 		font-family: "One";
-		src: url(../fonts/markA.ttf), url(../fonts/mark2A.ttf), url(../fonts/mark2B.ttf), url(../fonts/markB.ttf);
+		src: url(../fonts/markA.ttf), url(../fonts/markB.ttf);
 	}
 
 	body { font-family: "One"; }
 
 	</style>
 </head>
 <body>
 
diff --git a/layout/reftests/font-face/src-list-3.html b/layout/reftests/font-face/src-list-3.html
deleted file mode 100644
--- a/layout/reftests/font-face/src-list-3.html
+++ /dev/null
@@ -1,23 +0,0 @@
-<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
-	"http://www.w3.org/TR/html4/strict.dtd">
-<html lang="en-US">
-<head>
-	<title></title>
-	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
-	<style type="text/css">
-
-	@font-face {
-		font-family: "One";
-		src: url(../fonts/markA.ttf), url(../fonts/mark2B.ttf), url(../fonts/mark2A.ttf), url(../fonts/markB.ttf);
-	}
-
-	body { font-family: "One"; }
-
-	</style>
-</head>
-<body>
-
-<p>ABC</p>
-
-</body>
-</html>
diff --git a/layout/reftests/font-face/src-list-format-1-ref.html b/layout/reftests/font-face/src-list-format-1-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/src-list-format-1-ref.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "Mark2D";
+		src: url(../fonts/mark2D.ttf);
+	}
+
+	body { font-family: "Mark2D"; }
+
+	</style>
+</head>
+<body>
+
+<p>DBC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/src-list-format-1.html b/layout/reftests/font-face/src-list-format-1.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/src-list-format-1.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/markA.ttf) format("unknown"), url(../fonts/mark2A.ttf);
+	}
+
+	body { font-family: "One"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/src-list-format-2-ref.html b/layout/reftests/font-face/src-list-format-2-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/src-list-format-2-ref.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "Mark2D";
+		src: url(../fonts/mark2D.ttf);
+	}
+
+	body { font-family: "Mark2D"; }
+
+	</style>
+</head>
+<body>
+
+<p>DBC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/src-list-format-2.html b/layout/reftests/font-face/src-list-format-2.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/src-list-format-2.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/markA.ttf) format("unknown"), url(../fonts/mark2A.ttf) format("truetype");
+	}
+
+	body { font-family: "One"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/src-list-format-3-ref.html b/layout/reftests/font-face/src-list-format-3-ref.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/src-list-format-3-ref.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "MarkD";
+		src: url(../fonts/markD.ttf);
+	}
+
+	body { font-family: MarkD; }
+
+	</style>
+</head>
+<body>
+
+<p>DBC</p>
+
+</body>
+</html>
diff --git a/layout/reftests/font-face/src-list-format-3.html b/layout/reftests/font-face/src-list-format-3.html
new file mode 100644
--- /dev/null
+++ b/layout/reftests/font-face/src-list-format-3.html
@@ -0,0 +1,23 @@
+<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
+	"http://www.w3.org/TR/html4/strict.dtd">
+<html lang="en-US">
+<head>
+	<title></title>
+	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
+	<style type="text/css">
+
+	@font-face {
+		font-family: "One";
+		src: url(../fonts/markA.ttf) format("unknown", "truetype"), url(../fonts/mark2A.ttf) format("truetype");
+	}
+
+	body { font-family: "One"; }
+
+	</style>
+</head>
+<body>
+
+<p>ABC</p>
+
+</body>
+</html>
