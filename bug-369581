Make non-box frames with 'height:auto' respect min-height from overridable nsITheme::GetMinimumWidgetSize.  b=369581

diff -r e6fe6bea6623 layout/generic/nsHTMLReflowState.cpp
--- a/layout/generic/nsHTMLReflowState.cpp	Wed Feb 07 15:47:33 2007 -0800
+++ b/layout/generic/nsHTMLReflowState.cpp	Wed Feb 07 16:36:23 2007 -0800
@@ -2098,6 +2098,30 @@ nsHTMLReflowState::ComputeMinMaxValues(n
     }
   }
 
+  // The use of nsITheme::GetMinimumWidgetSize in nsFrame::ComputeSize
+  // isn't sufficient in the case of heights that can grow, when the
+  // style height is 'auto'.
+  const nsStyleDisplay *disp = frame->GetStyleDisplay();
+  if (frame->IsThemed(disp)) {
+    nsSize size(0, 0);
+    PRBool canOverride = PR_TRUE;
+    nsPresContext *presContext = frame->GetPresContext();
+    presContext->GetTheme()->
+      GetMinimumWidgetSize(rendContext, frame, disp->mAppearance,
+                           &size, &canOverride);
+
+    if (canOverride) {
+      // The only case where we need to bother.
+
+      // GMWS() returns border-box size in device pixels; we need
+      // content box size in app units
+      nscoord height = presContext->DevPixelsToAppUnits(size.height) -
+                       mComputedBorderPadding.TopBottom();
+      if (height > mComputedMinHeight)
+        mComputedMinHeight = height;
+    }
+  }
+
   // If the computed value of 'min-height' is greater than the value of
   // 'max-height', 'max-height' is set to the value of 'min-height'
   if (mComputedMinHeight > mComputedMaxHeight) {
