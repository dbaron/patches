From: L. David Baron <dbaron@dbaron.org>

Add SETCOORD_STORE_CALC to nsRuleNode.  (Bug 363249)

diff --git a/layout/style/nsRuleNode.cpp b/layout/style/nsRuleNode.cpp
--- a/layout/style/nsRuleNode.cpp
+++ b/layout/style/nsRuleNode.cpp
@@ -382,16 +382,17 @@ nsRuleNode::CalcLengthWithInitialFont(ns
 #define SETCOORD_NONE                   0x100  // O
 #define SETCOORD_INITIAL_ZERO           0x200
 #define SETCOORD_INITIAL_AUTO           0x400
 #define SETCOORD_INITIAL_NONE           0x800
 #define SETCOORD_INITIAL_NORMAL         0x1000
 #define SETCOORD_INITIAL_HALF           0x2000
 #define SETCOORD_CALC_LENGTH_ONLY       0x4000
 #define SETCOORD_CALC_CLAMP_NONNEGATIVE 0x8000 // modifier for CALC_LENGTH_ONLY
+#define SETCOORD_STORE_CALC             0x00010000
 
 #define SETCOORD_LP     (SETCOORD_LENGTH | SETCOORD_PERCENT)
 #define SETCOORD_LH     (SETCOORD_LENGTH | SETCOORD_INHERIT)
 #define SETCOORD_AH     (SETCOORD_AUTO | SETCOORD_INHERIT)
 #define SETCOORD_LAH    (SETCOORD_AUTO | SETCOORD_LENGTH | SETCOORD_INHERIT)
 #define SETCOORD_LPH    (SETCOORD_LP | SETCOORD_INHERIT)
 #define SETCOORD_LPAH   (SETCOORD_LP | SETCOORD_AH)
 #define SETCOORD_LPEH   (SETCOORD_LP | SETCOORD_ENUMERATED | SETCOORD_INHERIT)
@@ -476,16 +477,20 @@ static PRBool SetCoord(const nsCSSValue&
   else if (((aMask & SETCOORD_INITIAL_NORMAL) != 0) &&
            (aValue.GetUnit() == eCSSUnit_Initial)) {
     aCoord.SetNormalValue();
   }
   else if (((aMask & SETCOORD_INITIAL_HALF) != 0) &&
            (aValue.GetUnit() == eCSSUnit_Initial)) {
     aCoord.SetPercentValue(0.5f);
   }
+  else if (((aMask & SETCOORD_STORE_CALC) != 0) &&
+           (aValue.IsCalcUnit())) {
+    aCoord.SetPointerValue(aValue.GetArrayValue(), eStyleUnit_Calc);
+  }
   else {
     result = PR_FALSE;  // didn't set anything
   }
   return result;
 }
 
 // This inline function offers a shortcut for SetCoord() by refusing to accept
 // SETCOORD_LENGTH and SETCOORD_INHERIT masks.
