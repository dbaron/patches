Disable antialiasing for border-collapse borders too, and fix a build warning by not passing what is now an integer through a float parameter.  b=371182

diff -r 060537112aed layout/base/nsCSSRendering.cpp
--- a/layout/base/nsCSSRendering.cpp	Thu Feb 22 22:46:43 2007 -0800
+++ b/layout/base/nsCSSRendering.cpp	Thu Feb 22 23:03:18 2007 -0800
@@ -1719,6 +1719,7 @@ void nsCSSRendering::PaintBorder(nsPresC
 
 #ifdef MOZ_CAIRO_GFX
   gfxContext *ctx = (gfxContext*) aRenderingContext.GetNativeGraphicData(nsIRenderingContext::NATIVE_THEBES_CONTEXT);
+  gfxContext::AntialiasMode oldMode = ctx->CurrentAntialiasMode();
   ctx->SetAntialiasMode(gfxContext::MODE_ALIASED);
 #endif
 
@@ -1752,7 +1753,7 @@ void nsCSSRendering::PaintBorder(nsPresC
   }
 
 #ifdef MOZ_CAIRO_GFX
-  ctx->SetAntialiasMode(gfxContext::MODE_COVERAGE);
+  ctx->SetAntialiasMode(oldMode);
 #endif
 }
 
@@ -4181,7 +4182,7 @@ nsCSSRendering::DrawTableBorderSegment(n
                                        nscolor                  aBorderColor,
                                        const nsStyleBackground* aBGColor,
                                        const nsRect&            aBorder,
-                                       float                    aPixelsToTwips,
+                                       PRInt32                  aAppUnitsPerCSSPixel,
                                        PRUint8                  aStartBevelSide,
                                        nscoord                  aStartBevelOffset,
                                        PRUint8                  aEndBevelSide,
@@ -4190,7 +4191,7 @@ nsCSSRendering::DrawTableBorderSegment(n
   aContext.SetColor (aBorderColor); 
 
   PRBool horizontal = ((NS_SIDE_TOP == aStartBevelSide) || (NS_SIDE_BOTTOM == aStartBevelSide));
-  nscoord twipsPerPixel = NSIntPixelsToAppUnits(1, aPixelsToTwips);
+  nscoord twipsPerPixel = NSIntPixelsToAppUnits(1, aAppUnitsPerCSSPixel);
   PRBool ridgeGroove = NS_STYLE_BORDER_STYLE_RIDGE;
 
   if ((twipsPerPixel >= aBorder.width) || (twipsPerPixel >= aBorder.height) ||
@@ -4199,6 +4200,12 @@ nsCSSRendering::DrawTableBorderSegment(n
     aStartBevelOffset = 0;
     aEndBevelOffset = 0;
   }
+
+#ifdef MOZ_CAIRO_GFX
+  gfxContext *ctx = (gfxContext*) aContext.GetNativeGraphicData(nsIRenderingContext::NATIVE_THEBES_CONTEXT);
+  gfxContext::AntialiasMode oldMode = ctx->CurrentAntialiasMode();
+  ctx->SetAntialiasMode(gfxContext::MODE_ALIASED);
+#endif
 
   switch (aBorderStyle) {
   case NS_STYLE_BORDER_STYLE_NONE:
@@ -4393,6 +4400,10 @@ nsCSSRendering::DrawTableBorderSegment(n
     NS_ASSERTION(PR_FALSE, "Unexpected 'auto' table border");
     break;
   }
+
+#ifdef MOZ_CAIRO_GFX
+  ctx->SetAntialiasMode(oldMode);
+#endif
 }
 
 // End table border-collapsing section
diff -r 060537112aed layout/base/nsCSSRendering.h
--- a/layout/base/nsCSSRendering.h	Thu Feb 22 22:46:43 2007 -0800
+++ b/layout/base/nsCSSRendering.h	Thu Feb 22 23:02:50 2007 -0800
@@ -207,7 +207,7 @@ public:
                                      nscolor                  aBorderColor,
                                      const nsStyleBackground* aBGColor,
                                      const nsRect&            aBorderRect,
-                                     float                    aPixelsToTwips,
+                                     PRInt32                  aAppUnitsPerCSSPixel,
                                      PRUint8                  aStartBevelSide = 0,
                                      nscoord                  aStartBevelOffset = 0,
                                      PRUint8                  aEndBevelSide = 0,
diff -r 060537112aed layout/reftests/pixel-rounding/reftest.list
--- a/layout/reftests/pixel-rounding/reftest.list	Thu Feb 22 22:46:43 2007 -0800
+++ b/layout/reftests/pixel-rounding/reftest.list	Thu Feb 22 23:06:29 2007 -0800
@@ -80,8 +80,8 @@ fails-if(MOZ_WIDGET_TOOLKIT=="windows") 
 fails-if(MOZ_WIDGET_TOOLKIT=="windows") == background-image-width-left-6.html background-image-width-6.html # bug 371316
 
 
-# These all fail due to any of bug 371182, bug 155955, and maybe also
-# bug 371180, plus a bunch of other bugs that ought to be filed.
+# These all fail due to bug 155955, and maybe also bug 371180, plus a
+# bunch of other bugs that ought to be filed.
 fails == collapsed-border-height-4.html border-base-ref.html
 fails == collapsed-border-height-5.html border-height-10-ref.html
 fails == collapsed-border-height-6.html border-height-10-ref.html
diff -r 060537112aed layout/reftests/table-width/reftest.list
--- a/layout/reftests/table-width/reftest.list	Thu Feb 22 22:46:43 2007 -0800
+++ b/layout/reftests/table-width/reftest.list	Thu Feb 22 23:06:09 2007 -0800
@@ -42,5 +42,5 @@
 == percent-basis.html percent-basis-ref.html
 fails-if(MOZ_WIDGET_TOOLKIT=="cocoa") == default-box-sizing-separate-standards.html default-box-sizing-separate-standards-ref.html # bug 361523
 fails-if(MOZ_WIDGET_TOOLKIT=="cocoa") == default-box-sizing-separate-quirks.html default-box-sizing-separate-quirks-ref.html # bug 361523
-fails == default-box-sizing-collapse-standards.html default-box-sizing-collapse-standards-ref.html # bug 155955, bug 371180, bug 371182
-fails == default-box-sizing-collapse-quirks.html default-box-sizing-collapse-quirks-ref.html # bug 371180, bug 371182
+fails == default-box-sizing-collapse-standards.html default-box-sizing-collapse-standards-ref.html # bug 155955, bug 371180
+fails == default-box-sizing-collapse-quirks.html default-box-sizing-collapse-quirks-ref.html # bug 371180
