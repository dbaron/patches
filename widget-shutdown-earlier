Clean up widgets before gfx shutdown.

diff --git a/modules/libpr0n/decoders/icon/nsIconModule.cpp b/modules/libpr0n/decoders/icon/nsIconModule.cpp
--- a/modules/libpr0n/decoders/icon/nsIconModule.cpp
+++ b/modules/libpr0n/decoders/icon/nsIconModule.cpp
@@ -115,14 +115,15 @@ IconDecoderModuleCtor(nsIModule* aSelf)
 {
   return NS_OK;
 }
 
 PR_STATIC_CALLBACK(void)
 IconDecoderModuleDtor(nsIModule* aSelf)
 {
 #ifdef MOZ_WIDGET_GTK2
+  // XXX This should happen at xpcom-shutdown so it's before gfx shutdown.
   nsIconChannel::Shutdown();
 #endif
 }
 
 NS_IMPL_NSGETMODULE_WITH_CTOR_DTOR(nsIconDecoderModule, components,
                                    IconDecoderModuleCtor, IconDecoderModuleDtor)
diff --git a/widget/src/gtk2/nsWidgetFactory.cpp b/widget/src/gtk2/nsWidgetFactory.cpp
--- a/widget/src/gtk2/nsWidgetFactory.cpp
+++ b/widget/src/gtk2/nsWidgetFactory.cpp
@@ -289,16 +289,18 @@ static const nsModuleComponentInfo compo
     NS_IDLE_SERVICE_CID,
     "@mozilla.org/widget/idleservice;1",
     nsIdleServiceGTKConstructor },
 };
 
 PR_STATIC_CALLBACK(void)
 nsWidgetGtk2ModuleDtor(nsIModule *aSelf)
 {
+  // XXX A bunch of these things need to happen before GFX shutdown, so
+  // they should happen earlier than the module destructor!
   nsFilePicker::Shutdown();
   nsSound::Shutdown();
   nsWindow::ReleaseGlobals();
   nsAppShellShutdown(aSelf);
 }
 
 NS_IMPL_NSGETMODULE_WITH_CTOR_DTOR(nsWidgetGtk2Module,
                                    components,
