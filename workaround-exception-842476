From: L. David Baron <dbaron@dbaron.org>

Bug 842476: Work around leak resulting from exception that happens during unload by propagating only the prompts we expect and not the later ones.

Make this test less sensitive to the timing of its own unloading by
passing on only the expected messages and not any messages that occur
during unloading.  Such messages might cause exceptions (e.g.,
"'TypeError: can't access dead object' when calling method:
[nsIPrompt::alert]"), and those exceptions might in turn trigger leaks
in nsXPConnect that last until shutdown because we store the most recent
exception from a call to an XPCWrappedJS on the XPCJSRuntime through
shutdown (rather than reporting it, as we probably should, and then
freeing it), leaking the window.

diff --git a/dom/browser-element/mochitest/file_browserElement_SetVisibleFrames_Outer.html b/dom/browser-element/mochitest/file_browserElement_SetVisibleFrames_Outer.html
--- a/dom/browser-element/mochitest/file_browserElement_SetVisibleFrames_Outer.html
+++ b/dom/browser-element/mochitest/file_browserElement_SetVisibleFrames_Outer.html
@@ -16,17 +16,17 @@ function handlePrompt(e) {
   }
   else if (numPrompts == 3) {
     if (e.detail.message != 'child2:hidden') {
       alert("parent:fail Didn't get expected 'child2:hidden'.");
     }
 
     alert('parent:ready');
   }
-  else if (numPrompts > 3) {
+  else if (numPrompts == 4 || numPrompts == 5) {
     alert(e.detail.message);
   }
 }
 
 var iframe1 = document.createElement('iframe');
 iframe1.mozbrowser = true;
 iframe1.addEventListener('mozbrowsershowmodalprompt', handlePrompt);
 
