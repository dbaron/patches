From: Bobby Holley <bobbyholley@stanford.edu>

Null-check document pointer.  (Bug 516307)  r=bzbarsky

diff --git a/content/base/src/nsImageLoadingContent.cpp b/content/base/src/nsImageLoadingContent.cpp
--- a/content/base/src/nsImageLoadingContent.cpp
+++ b/content/base/src/nsImageLoadingContent.cpp
@@ -285,17 +285,18 @@ nsImageLoadingContent::OnStopDecode(imgI
   // 2) We want to block onload until all visible images are decoded. We do this
   // by blocking onload until all in progress decodes get at least one frame
   // decoded. However, if all the data comes in while painting is suppressed
   // (ie, before the initial paint delay is finished), we fire onload without
   // doing a paint first. This means that decode-on-draw images don't start
   // decoding, so we can't wait for them to finish. See bug 512435.
 
   // We can only do this if we have a presshell
-  nsIPresShell* shell = GetOurDocument()->GetPrimaryShell();
+  nsIDocument* doc = GetOurDocument();
+  nsIPresShell* shell = doc ? doc->GetPrimaryShell() : nsnull;
   if (shell) {
 
     // We need to figure out whether to kick off decoding
     PRBool doRequestDecode = PR_FALSE;
 
     // If we haven't got the initial reflow yet, IsPaintingSuppressed actually
     // returns false
     if (!shell->DidInitialReflow())
