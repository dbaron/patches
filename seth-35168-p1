# HG changeset patch
# User Seth Fowler <seth@mozilla.com>
# Date 1408497897 25200
#      Tue Aug 19 18:24:57 2014 -0700
# Node ID e15a7a0c8f701f2543322c30ee63d43134612a33
# Parent  108038542674b7330dd34200836cea01f66a0867
Bug 35168 (Part 1) - Add GetNormalRect to nsIFrame. r=dbaron

diff --git a/layout/generic/nsFrame.cpp b/layout/generic/nsFrame.cpp
--- a/layout/generic/nsFrame.cpp
+++ b/layout/generic/nsFrame.cpp
@@ -5163,16 +5163,29 @@ nsIFrame::MovePositionBy(const nsPoint& 
       (Properties().Get(nsIFrame::ComputedOffsetProperty()));
   }
   nsHTMLReflowState::ApplyRelativePositioning(this, computedOffsets ?
                                               *computedOffsets : nsMargin(),
                                               &position);
   SetPosition(position);
 }
 
+nsRect
+nsIFrame::GetNormalRect() const
+{
+  // It might be faster to first check
+  // StyleDisplay()->IsRelativelyPositionedStyle().
+  nsPoint* normalPosition = static_cast<nsPoint*>
+    (Properties().Get(NormalPositionProperty()));
+  if (normalPosition) {
+    return nsRect(*normalPosition, GetSize());
+  }
+  return GetRect();
+}
+
 nsPoint
 nsIFrame::GetNormalPosition() const
 {
   // It might be faster to first check
   // StyleDisplay()->IsRelativelyPositionedStyle().
   nsPoint* normalPosition = static_cast<nsPoint*>
     (Properties().Get(NormalPositionProperty()));
   if (normalPosition) {
diff --git a/layout/generic/nsIFrame.h b/layout/generic/nsIFrame.h
--- a/layout/generic/nsIFrame.h
+++ b/layout/generic/nsIFrame.h
@@ -741,16 +741,21 @@ public:
    * nsHTMLReflowState::ApplyRelativePositioning is called.  When moving
    * a frame during the reflow process prior to calling
    * nsHTMLReflowState::ApplyRelativePositioning, the position should
    * simply be adjusted directly (e.g., using SetPosition()).
    */
   void MovePositionBy(const nsPoint& aTranslation);
 
   /**
+   * Return frame's rect without relative positioning
+   */
+  nsRect GetNormalRect() const;
+
+  /**
    * Return frame's position without relative positioning
    */
   nsPoint GetNormalPosition() const;
   mozilla::LogicalPoint
   GetLogicalNormalPosition(mozilla::WritingMode aWritingMode,
                            nscoord aContainerWidth) const
   {
     return mozilla::LogicalPoint(aWritingMode,
