Add test that the nsRuleNode::Compute*Data functions don't touch aStartStruct when they shouldn't.

diff --git a/layout/style/test/Makefile.in b/layout/style/test/Makefile.in
--- a/layout/style/test/Makefile.in
+++ b/layout/style/test/Makefile.in
@@ -79,6 +79,7 @@ _TEST_FILES =	test_bug74880.html \
 		test_bug379741.html \
 		test_bug383075.html \
 		test_bug387615.html \
+		test_compute_data_with_start_struct.html \
 		test_dont_use_document_colors.html \
 		test_inherit_storage.html \
 		test_inherit_computation.html \
diff --git a/layout/style/test/test_compute_data_with_start_struct.html b/layout/style/test/test_compute_data_with_start_struct.html
new file mode 100644
--- /dev/null
+++ b/layout/style/test/test_compute_data_with_start_struct.html
@@ -0,0 +1,51 @@
+<!DOCTYPE HTML>
+<html>
+<head>
+  <title>Test for correct handling of aStartStruct parameter to nsRuleNode::Compute*Data</title>
+  <script type="text/javascript" src="/MochiKit/MochiKit.js"></script>
+  <script type="text/javascript" src="/tests/SimpleTest/SimpleTest.js"></script>
+  <script type="text/javascript" src="property_database.js"></script>
+  <style type="text/css" id="stylesheet"></style>
+  <link rel="stylesheet" type="text/css" href="/tests/SimpleTest/test.css" />
+</head>
+<body>
+<p id="display">
+  <span id="test"></span>
+  <span id="initial"></span>
+  <span id="other"></span>
+</p>
+<div id="content" style="display: none">
+  
+</div>
+<pre id="test">
+<script class="testbody" type="text/javascript">
+
+var gStyleSheet = document.getElementById("stylesheet").sheet;
+var gRule1 = gStyleSheet.cssRules[gStyleSheet.insertRule("#test, #other {}", gStyleSheet.cssRules.length)];
+var gRule2 = gStyleSheet.cssRules[gStyleSheet.insertRule("#test, #initial {}", gStyleSheet.cssRules.length)];
+
+var gTest = getComputedStyle(document.getElementById("test"), "");
+var gInitial = getComputedStyle(document.getElementById("initial"), "");
+var gOther = getComputedStyle(document.getElementById("other"), "");
+
+for (var prop in gCSSProperties) {
+  var info = gCSSProperties[prop];
+  gRule1.setProperty(prop, info.other_values[0], "");
+  gRule2.setProperty(prop, info.initial_values[0], "");
+}
+
+for (var prop in gCSSProperties) {
+  var info = gCSSProperties[prop];
+  var initial_val = gTest.getPropertyValue(prop);
+  var other_val = gOther.getPropertyValue(prop);
+  isnot(initial_val, other_val, "initial and other values of " + prop + " are different");
+  is(gTest.getPropertyValue(prop), initial_val, prop + " is initial value before removing property");
+  gRule2.removeProperty(prop);
+  is(gTest.getPropertyValue(prop), other_val, prop + " is not touched when its value comes from aStartStruct");
+  gRule2.setProperty(prop, info.initial_values[0], "");
+}
+
+</script>
+</pre>
+</body>
+</html>
