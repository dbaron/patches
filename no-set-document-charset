From: L. David Baron <dbaron@dbaron.org>

Bug 703133 - Don't call SetDocumentCharset in the middle of an image container notification.

diff --git a/dom/html/MediaDocument.cpp b/dom/html/MediaDocument.cpp
--- a/dom/html/MediaDocument.cpp
+++ b/dom/html/MediaDocument.cpp
@@ -297,20 +297,16 @@ MediaDocument::GetFileName(nsAString& aR
   // This is necessary to deal with a media document being opened in a new
   // window or a new tab, in which case |originCharset| of |nsIURI| is not
   // reliable.
   if (mCharacterSetSource != kCharsetUninitialized) {
     mCharacterSet->Name(docCharset);
   } else {
     // resort to |originCharset|
     url->GetOriginCharset(docCharset);
-    auto encoding = Encoding::ForLabelNoReplacement(docCharset);
-    if (encoding) {
-      SetDocumentCharacterSet(WrapNotNull(encoding));
-    }
   }
 
   nsresult rv;
   nsCOMPtr<nsITextToSubURI> textToSubURI =
     do_GetService(NS_ITEXTTOSUBURI_CONTRACTID, &rv);
   if (NS_SUCCEEDED(rv)) {
     // UnEscapeURIForUI always succeeds
     textToSubURI->UnEscapeURIForUI(docCharset, fileName, aResult);
