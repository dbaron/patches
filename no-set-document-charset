From: L. David Baron <dbaron@dbaron.org>

Don't call SetDocumentCharset in the middle of an image container notification.  (Bug 703133)

diff --git a/content/html/document/src/MediaDocument.cpp b/content/html/document/src/MediaDocument.cpp
--- a/content/html/document/src/MediaDocument.cpp
+++ b/content/html/document/src/MediaDocument.cpp
@@ -323,17 +323,16 @@ MediaDocument::GetFileName(nsAString& aR
   // This is necessary to deal with a media document being opened in a new 
   // window or a new tab, in which case |originCharset| of |nsIURI| is not 
   // reliable.
   if (mCharacterSetSource != kCharsetUninitialized) {  
     docCharset = mCharacterSet;
   } else {  
     // resort to |originCharset|
     url->GetOriginCharset(docCharset);
-    SetDocumentCharacterSet(docCharset);
   }
 
   nsresult rv;
   nsCOMPtr<nsITextToSubURI> textToSubURI = 
     do_GetService(NS_ITEXTTOSUBURI_CONTRACTID, &rv);
   if (NS_SUCCEEDED(rv)) {
     // UnEscapeURIForUI always succeeds
     textToSubURI->UnEscapeURIForUI(docCharset, fileName, aResult);
