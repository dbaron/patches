From: L. David Baron <dbaron@dbaron.org>

Don't resolve a bogus non-element parent when we don't need to and it confuses things.  (Bug 510071)

diff --git a/layout/style/nsComputedDOMStyle.cpp b/layout/style/nsComputedDOMStyle.cpp
--- a/layout/style/nsComputedDOMStyle.cpp
+++ b/layout/style/nsComputedDOMStyle.cpp
@@ -346,16 +346,18 @@ GetStyleContextForFrame(nsIFrame* aFrame
 }    
 
 /* static */
 already_AddRefed<nsStyleContext>
 nsComputedDOMStyle::GetStyleContextForContent(nsIContent* aContent,
                                               nsIAtom* aPseudo,
                                               nsIPresShell* aPresShell)
 {
+  NS_ASSERTION(aContent->IsNodeOfType(nsINode::eELEMENT),
+               "aContent must be an element");
   if (!aPseudo) {
     aPresShell->FlushPendingNotifications(Flush_Style);
     nsIFrame* frame = aPresShell->GetPrimaryFrameFor(aContent);
     if (frame) {
       nsStyleContext* result = GetStyleContextForFrame(frame);
       // Don't use the style context if it was influenced by
       // pseudo-elements, since then it's not the primary style
       // for this element.
@@ -366,30 +368,25 @@ nsComputedDOMStyle::GetStyleContextForCo
       }
     }
   }
 
   // No frame has been created or we have a pseudo, so resolve the
   // style ourselves
   nsRefPtr<nsStyleContext> parentContext;
   nsIContent* parent = aPseudo ? aContent : aContent->GetParent();
-  if (parent)
+  if (parent && parent->IsNodeOfType(nsINode::eELEMENT))
     parentContext = GetStyleContextForContent(parent, nsnull, aPresShell);
 
   nsPresContext *presContext = aPresShell->GetPresContext();
   if (!presContext)
     return nsnull;
 
   nsStyleSet *styleSet = aPresShell->StyleSet();
 
-  if (!aContent->IsNodeOfType(nsINode::eELEMENT)) {
-    NS_ASSERTION(!aPseudo, "Shouldn't have a pseudo for a non-element!");
-    return styleSet->ResolveStyleForNonElement(parentContext);
-  }
-
   if (aPseudo) {
     return styleSet->ResolvePseudoStyleFor(aContent, aPseudo, parentContext);
   }
 
   return styleSet->ResolveStyleFor(aContent, parentContext);
 }
 
 NS_IMETHODIMP
