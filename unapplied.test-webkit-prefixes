From: L. David Baron <dbaron@dbaron.org>

NOT FOR CHECKIN:  Patch for testing the effect of supporting -webkit- prefixes or unprefixed properties.

FIXME: Test that names are all correct

FIXME: Add aliases for transition/animation events.

diff --git a/dom/interfaces/css/nsIDOMCSS2Properties.idl b/dom/interfaces/css/nsIDOMCSS2Properties.idl
--- a/dom/interfaces/css/nsIDOMCSS2Properties.idl
+++ b/dom/interfaces/css/nsIDOMCSS2Properties.idl
@@ -756,16 +756,124 @@ interface nsIDOMCSS2Properties : nsISupp
                                         // raises(DOMException) on setting
 
            attribute DOMString        MozBorderImage;
                                         // raises(DOMException) on setting
 
            attribute DOMString        MozColorCorrection;
                                         // raises(DOMException) on setting
 
+           attribute DOMString         WebkitAnimation
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitAnimationDelay
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitAnimationDirection
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitAnimationDuration
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitAnimationFillMode
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitAnimationIterationCount
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitAnimationName
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitAnimationPlayState
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitAnimationTimingFunction
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitTextSizeAdjust
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitTransform
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitTransformOrigin
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitTransformStyle
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitTransition
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitTransitionDelay
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitTransitionDuration
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitTransitionProperty
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         WebkitTransitionTimingFunction
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         Animation
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         AnimationDelay
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         AnimationDirection
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         AnimationDuration
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         AnimationFillMode
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         AnimationIterationCount
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         AnimationName
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         AnimationPlayState
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         AnimationTimingFunction
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         TextSizeAdjust
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         Transform
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         TransformOrigin
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         TransformStyle
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         Transition
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         TransitionDelay
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         TransitionDuration
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         TransitionProperty
+                                        // raises(DOMException) on setting
+
+           attribute DOMString         TransitionTimingFunction
+                                        // raises(DOMException) on setting
+
 /* XXXdholbert NOTE: Flexbox properties are commented out here, until our
    layout engine responds to them.  In builds with MOZ_FLEXBOX enabled, this
    block should be uncommented (and this interface's uuid should be revved).
    (This would be #ifdef MOZ_FLEXBOX, if that worked in IDL files.)
            attribute DOMString        MozAlignItems;
                                         // raises(DOMException) on setting
 
            attribute DOMString        MozAlignSelf;
diff --git a/layout/style/nsCSSParser.cpp b/layout/style/nsCSSParser.cpp
--- a/layout/style/nsCSSParser.cpp
+++ b/layout/style/nsCSSParser.cpp
@@ -1501,17 +1501,19 @@ CSSParserImpl::ParseAtRule(RuleAppendFun
   } else if (mToken.mIdent.LowerCaseEqualsLiteral("font-face")) {
     parseFunc = &CSSParserImpl::ParseFontFaceRule;
     newSection = eCSSSection_General;
 
   } else if (mToken.mIdent.LowerCaseEqualsLiteral("page")) {
     parseFunc = &CSSParserImpl::ParsePageRule;
     newSection = eCSSSection_General;
 
-  } else if (mToken.mIdent.LowerCaseEqualsLiteral("-moz-keyframes")) {
+  } else if (mToken.mIdent.LowerCaseEqualsLiteral("keyframes") ||
+             mToken.mIdent.LowerCaseEqualsLiteral("-moz-keyframes") ||
+             mToken.mIdent.LowerCaseEqualsLiteral("-webkit-keyframes")) {
     parseFunc = &CSSParserImpl::ParseKeyframesRule;
     newSection = eCSSSection_General;
 
   } else {
     if (!NonMozillaVendorIdentifier(mToken.mIdent)) {
       REPORT_UNEXPECTED_TOKEN(PEUnknownAtRule);
       OUTPUT_ERROR();
     }
diff --git a/layout/style/nsCSSPropAliasList.h b/layout/style/nsCSSPropAliasList.h
--- a/layout/style/nsCSSPropAliasList.h
+++ b/layout/style/nsCSSPropAliasList.h
@@ -37,8 +37,48 @@
 
 CSS_PROP_ALIAS(-moz-transform, transform, MozTransform, "")
 CSS_PROP_ALIAS(-moz-transform-origin, transform_origin, MozTransformOrigin, "")
 CSS_PROP_ALIAS(-moz-perspective-origin, perspective_origin, MozPerspectiveOrigin, "")
 CSS_PROP_ALIAS(-moz-perspective, perspective, MozPerspective, "")
 CSS_PROP_ALIAS(-moz-transform-style, transform_style, MozTransformStyle, "")
 CSS_PROP_ALIAS(-moz-backface-visibility, backface_visibility, MozBackfaceVisibility, "")
 CSS_PROP_ALIAS(-moz-border-image, border_image, MozBorderImage, "")
+
+// -webkit- prefixes
+CSS_PROP_ALIAS(-webkit-animation, animation, WebkitAnimation, "")
+CSS_PROP_ALIAS(-webkit-animation-delay, animation_delay, WebkitAnimationDelay, "")
+CSS_PROP_ALIAS(-webkit-animation-direction, animation_direction, WebkitAnimationDirection, "")
+CSS_PROP_ALIAS(-webkit-animation-duration, animation_duration, WebkitAnimationDuration, "")
+CSS_PROP_ALIAS(-webkit-animation-fill-mode, animation_fill_mode, WebkitAnimationFillMode, "")
+CSS_PROP_ALIAS(-webkit-animation-iteration-count, animation_iteration_count, WebkitAnimationIterationCount, "")
+CSS_PROP_ALIAS(-webkit-animation-name, animation_name, WebkitAnimationName, "")
+CSS_PROP_ALIAS(-webkit-animation-play-state, animation_play_state, WebkitAnimationPlayState, "")
+CSS_PROP_ALIAS(-webkit-animation-timing-function, animation_timing_function, WebkitAnimationTimingFunction, "")
+CSS_PROP_ALIAS(-webkit-text-size-adjust, _moz_text_size_adjust, WebkitTextSizeAdjust, "")
+CSS_PROP_ALIAS(-webkit-transform, _moz_transform, WebkitTransform, "")
+CSS_PROP_ALIAS(-webkit-transform-origin, _moz_transform_origin, WebkitTransformOrigin, "")
+CSS_PROP_ALIAS(-webkit-transform-style, transform_style, WebkitTransformStyle, "")
+CSS_PROP_ALIAS(-webkit-transition, transition, WebkitTransition, "")
+CSS_PROP_ALIAS(-webkit-transition-delay, transition_delay, WebkitTransitionDelay, "")
+CSS_PROP_ALIAS(-webkit-transition-duration, transition_duration, WebkitTransitionDuration, "")
+CSS_PROP_ALIAS(-webkit-transition-property, transition_property, WebkitTransitionProperty, "")
+CSS_PROP_ALIAS(-webkit-transition-timing-function, transition_timing_function, WebkitTransitionTimingFunction, "")
+
+// no prefixes
+CSS_PROP_ALIAS(animation, animation, Animation, "")
+CSS_PROP_ALIAS(animation-delay, animation_delay, AnimationDelay, "")
+CSS_PROP_ALIAS(animation-direction, animation_direction, AnimationDirection, "")
+CSS_PROP_ALIAS(animation-duration, animation_duration, AnimationDuration, "")
+CSS_PROP_ALIAS(animation-fill-mode, animation_fill_mode, AnimationFillMode, "")
+CSS_PROP_ALIAS(animation-iteration-count, animation_iteration_count, AnimationIterationCount, "")
+CSS_PROP_ALIAS(animation-name, animation_name, AnimationName, "")
+CSS_PROP_ALIAS(animation-play-state, animation_play_state, AnimationPlayState, "")
+CSS_PROP_ALIAS(animation-timing-function, animation_timing_function, AnimationTimingFunction, "")
+CSS_PROP_ALIAS(text-size-adjust, _moz_text_size_adjust, TextSizeAdjust, "")
+CSS_PROP_ALIAS(transform, _moz_transform, Transform, "")
+CSS_PROP_ALIAS(transform-origin, _moz_transform_origin, TransformOrigin, "")
+CSS_PROP_ALIAS(transform-style, transform_style, TransformStyle, "")
+CSS_PROP_ALIAS(transition, transition, Transition, "")
+CSS_PROP_ALIAS(transition-delay, transition_delay, TransitionDelay, "")
+CSS_PROP_ALIAS(transition-duration, transition_duration, TransitionDuration, "")
+CSS_PROP_ALIAS(transition-property, transition_property, TransitionProperty, "")
+CSS_PROP_ALIAS(transition-timing-function, transition_timing_function, TransitionTimingFunction, "")
