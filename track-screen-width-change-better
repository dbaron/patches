From: L. David Baron <dbaron@dbaron.org>

Don't assume ordering of callers of nsPresContext::ScreenWidthInchesForFontInflation; instead, track changes only for the caller that cares about changes.  (Bug 759755)  r=bzbarsky

diff --git a/layout/base/nsPresContext.cpp b/layout/base/nsPresContext.cpp
--- a/layout/base/nsPresContext.cpp
+++ b/layout/base/nsPresContext.cpp
@@ -1402,25 +1402,22 @@ nsPresContext::ScreenWidthInchesForFontI
   }
 
   nsDeviceContext *dx = DeviceContext();
   nsRect clientRect;
   dx->GetClientRect(clientRect); // FIXME: GetClientRect looks expensive
   float deviceWidthInches =
     float(clientRect.width) / float(dx->AppUnitsPerPhysicalInch());
 
-  if (deviceWidthInches != mLastFontInflationScreenWidth) {
-    if (mLastFontInflationScreenWidth != -1.0) {
-      if (aChanged) {
-        *aChanged = true;
-      } else {
-        NS_NOTREACHED("somebody should have checked for screen width change "
-                      "and triggered a reflow");
-      }
-    }
+  if (mLastFontInflationScreenWidth == -1.0) {
+    mLastFontInflationScreenWidth = deviceWidthInches;
+  }
+
+  if (deviceWidthInches != mLastFontInflationScreenWidth && aChanged) {
+    *aChanged = true;
     mLastFontInflationScreenWidth = deviceWidthInches;
   }
 
   return deviceWidthInches;
 }
 
 void
 nsPresContext::SetImageLoaders(nsIFrame* aTargetFrame,
diff --git a/layout/base/nsPresContext.h b/layout/base/nsPresContext.h
--- a/layout/base/nsPresContext.h
+++ b/layout/base/nsPresContext.h
@@ -542,20 +542,20 @@ public:
   nscoord GetAutoQualityMinFontSize() {
     return DevPixelsToAppUnits(mAutoQualityMinFontSizePixelsPref);
   }
 
   /**
    * Return the device's screen width in inches, for font size
    * inflation.
    *
-   * Set |aChanged| to true if the result returned is different from a
-   * previous call to this method.  If a caller passes |aChanged| as
-   * null, then something else must have already checked whether there
-   * was a change (by calling this method).
+   * If |aChanged| is non-null, then aChanged is filled in with whether
+   * the return value has changed since either:
+   *  a. the last time the function was called with non-null aChanged, or
+   *  b. the first time the function was called.
    */
   float ScreenWidthInchesForFontInflation(bool* aChanged = nsnull);
 
   static PRInt32 AppUnitsPerCSSPixel() { return nsDeviceContext::AppUnitsPerCSSPixel(); }
   PRUint32 AppUnitsPerDevPixel() const  { return mDeviceContext->AppUnitsPerDevPixel(); }
   static PRInt32 AppUnitsPerCSSInch() { return nsDeviceContext::AppUnitsPerCSSInch(); }
 
   static nscoord CSSPixelsToAppUnits(PRInt32 aPixels)
