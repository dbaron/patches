From: L. David Baron <dbaron@dbaron.org>

Set mIsTopOfPage to false when reflowing blocks that have clearance.  Fixes regression from this patch series on layout/reftests/bugs/563584-10b.html .  (FIXME: Doesn't actually fix it yet)  (Bug 563584)

diff --git a/layout/generic/nsBlockFrame.cpp b/layout/generic/nsBlockFrame.cpp
--- a/layout/generic/nsBlockFrame.cpp
+++ b/layout/generic/nsBlockFrame.cpp
@@ -3095,18 +3095,21 @@ nsBlockFrame::ReflowBlockFrame(nsBlockRe
       availSpace.height += topMargin;
     }
     
     // Reflow the block into the available space
     // construct the html reflow state for the block. ReflowBlock 
     // will initialize it
     nsHTMLReflowState blockHtmlRS(aState.mPresContext, aState.mReflowState, frame, 
                                   nsSize(availSpace.width, availSpace.height));
-    blockHtmlRS.mFlags.mHasClearance = aLine->HasClearance();
-    
+    if (aLine->HasClearance()) {
+      blockHtmlRS.mFlags.mHasClearance = PR_TRUE;
+      blockHtmlRS.mFlags.mIsTopOfPage = PR_FALSE;
+    }
+
     nsFloatManager::SavedState floatManagerState;
     if (mayNeedRetry) {
       blockHtmlRS.mDiscoveredClearance = &clearanceFrame;
       aState.mFloatManager->PushState(&floatManagerState);
     } else if (!applyTopMargin) {
       blockHtmlRS.mDiscoveredClearance = aState.mReflowState.mDiscoveredClearance;
     }
     
