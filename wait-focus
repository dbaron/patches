From: L. David Baron <dbaron@dbaron.org>

Wait for window to have focus.  (Bug 541404)

diff --git a/browser/components/privatebrowsing/test/browser/browser_privatebrowsing_openlocation.js b/browser/components/privatebrowsing/test/browser/browser_privatebrowsing_openlocation.js
--- a/browser/components/privatebrowsing/test/browser/browser_privatebrowsing_openlocation.js
+++ b/browser/components/privatebrowsing/test/browser/browser_privatebrowsing_openlocation.js
@@ -56,24 +56,24 @@ function test() {
             browser.addEventListener("load", function() {
               browser.removeEventListener("load", arguments.callee, true);
 
               is(browser.currentURI.spec, url,
                  "The correct URL should be loaded via the open location dialog");
               executeSoon(callback);
             }, true);
 
-            executeSoon(function() {
+            SimpleTest.waitForFocus(function() {
               let input = dialog.document.getElementById("dialog.input");
               is(input.value, autofilled, "The input field should be correctly auto-filled");
               input.focus();
               for (let i = 0; i < url.length; ++i)
                 EventUtils.synthesizeKey(url[i], {}, dialog);
               EventUtils.synthesizeKey("VK_RETURN", {}, dialog);
-            });
+            }, dialog);
           }, false);
           break;
 
         case "domwindowclosed":
           Services.ww.unregisterNotification(arguments.callee);
           break;
       }
     }
