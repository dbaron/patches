From: L. David Baron <dbaron@dbaron.org>

Bug 1058346 patch 1 - Expose a simpler variant of RulesMatching from SVGAttrAnimationRuleProcessor.

This allows nsStyleSet::RuleNodeWithReplacement to call it without
constructing an entire (and unnecessary) ElementRuleProcessorData, which
will happen in patch 2.

diff --git a/layout/style/SVGAttrAnimationRuleProcessor.cpp b/layout/style/SVGAttrAnimationRuleProcessor.cpp
--- a/layout/style/SVGAttrAnimationRuleProcessor.cpp
+++ b/layout/style/SVGAttrAnimationRuleProcessor.cpp
@@ -22,20 +22,26 @@ SVGAttrAnimationRuleProcessor::~SVGAttrAnimation
 {
 }
 
 NS_IMPL_ISUPPORTS(SVGAttrAnimationRuleProcessor, nsIStyleRuleProcessor)
 
 /* virtual */ void
 SVGAttrAnimationRuleProcessor::RulesMatching(ElementRuleProcessorData* aData)
 {
-  Element* element = aData->mElement;
-  if (element->IsSVG()) {
-    static_cast<nsSVGElement*>(element)->
-      WalkAnimatedContentStyleRules(aData->mRuleWalker);
+  ElementRulesMatching(aData->mElement, aData->mRuleWalker);
+}
+
+void
+SVGAttrAnimationRuleProcessor::ElementRulesMatching(Element* aElement,
+                                                nsRuleWalker* aRuleWalker)
+{
+  if (aElement->IsSVG()) {
+    static_cast<nsSVGElement*>(aElement)->
+      WalkAnimatedContentStyleRules(aRuleWalker);
   }
 }
 
 /* virtual */ nsRestyleHint
 SVGAttrAnimationRuleProcessor::HasStateDependentStyle(StateRuleProcessorData* aData)
 {
   return nsRestyleHint(0);
 }
diff --git a/layout/style/SVGAttrAnimationRuleProcessor.h b/layout/style/SVGAttrAnimationRuleProcessor.h
--- a/layout/style/SVGAttrAnimationRuleProcessor.h
+++ b/layout/style/SVGAttrAnimationRuleProcessor.h
@@ -7,19 +7,24 @@
 /* style rule processor for SVG Animation (SMIL Animation) rules */
 
 #ifndef mozilla_SVGAttrAnimationRuleProcessor_h_
 #define mozilla_SVGAttrAnimationRuleProcessor_h_
 
 #include "nsIStyleRuleProcessor.h"
 
 class nsIDocument;
+class nsRuleWalker;
 
 namespace mozilla {
 
+namespace dom {
+class Element;
+}
+
 class SVGAttrAnimationRuleProcessor MOZ_FINAL : public nsIStyleRuleProcessor
 {
 public:
   SVGAttrAnimationRuleProcessor();
 
 private:
   ~SVGAttrAnimationRuleProcessor();
 
@@ -41,16 +46,20 @@ public:
   virtual bool MediumFeaturesChanged(nsPresContext* aPresContext) MOZ_OVERRIDE;
   virtual size_t SizeOfExcludingThis(mozilla::MallocSizeOf aMallocSizeOf)
     const MOZ_MUST_OVERRIDE MOZ_OVERRIDE;
   virtual size_t SizeOfIncludingThis(mozilla::MallocSizeOf aMallocSizeOf)
     const MOZ_MUST_OVERRIDE MOZ_OVERRIDE;
 
   size_t DOMSizeOfIncludingThis(mozilla::MallocSizeOf aMallocSizeOf) const;
 
+  // A shortcut for nsStyleSet to call RulesMatching with less setup.
+  void ElementRulesMatching(mozilla::dom::Element* aElement,
+                            nsRuleWalker* aRuleWalker);
+
 private:
   SVGAttrAnimationRuleProcessor(const SVGAttrAnimationRuleProcessor& aCopy) MOZ_DELETE;
   SVGAttrAnimationRuleProcessor& operator=(const SVGAttrAnimationRuleProcessor& aCopy) MOZ_DELETE;
 };
 
 } // namespace mozilla
 
 #endif /* !defined(mozilla_SVGAttrAnimationRuleProcessor_h_) */
