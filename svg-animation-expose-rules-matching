From: L. David Baron <dbaron@dbaron.org>

Bug 1058346 patch 1 - Expose a simpler variant of RulesMatching from SVGAnimationRuleProcessor.

diff --git a/layout/style/SVGAnimationRuleProcessor.cpp b/layout/style/SVGAnimationRuleProcessor.cpp
--- a/layout/style/SVGAnimationRuleProcessor.cpp
+++ b/layout/style/SVGAnimationRuleProcessor.cpp
@@ -22,20 +22,26 @@ SVGAnimationRuleProcessor::~SVGAnimation
 {
 }
 
 NS_IMPL_ISUPPORTS(SVGAnimationRuleProcessor, nsIStyleRuleProcessor)
 
 /* virtual */ void
 SVGAnimationRuleProcessor::RulesMatching(ElementRuleProcessorData* aData)
 {
-  Element* element = aData->mElement;
-  if (element->IsSVG()) {
-    static_cast<nsSVGElement*>(element)->
-      WalkAnimatedContentStyleRules(aData->mRuleWalker);
+  ElementRulesMatching(aData->mElement, aData->mRuleWalker);
+}
+
+void
+SVGAnimationRuleProcessor::ElementRulesMatching(Element* aElement,
+                                                nsRuleWalker* aRuleWalker)
+{
+  if (aElement->IsSVG()) {
+    static_cast<nsSVGElement*>(aElement)->
+      WalkAnimatedContentStyleRules(aRuleWalker);
   }
 }
 
 /* virtual */ nsRestyleHint
 SVGAnimationRuleProcessor::HasStateDependentStyle(StateRuleProcessorData* aData)
 {
   return nsRestyleHint(0);
 }
diff --git a/layout/style/SVGAnimationRuleProcessor.h b/layout/style/SVGAnimationRuleProcessor.h
--- a/layout/style/SVGAnimationRuleProcessor.h
+++ b/layout/style/SVGAnimationRuleProcessor.h
@@ -7,19 +7,24 @@
 /* style rule processor for SVG Animation (SMIL Animation) rules */
 
 #ifndef mozilla_SVGAnimationRuleProcessor_h_
 #define mozilla_SVGAnimationRuleProcessor_h_
 
 #include "nsIStyleRuleProcessor.h"
 
 class nsIDocument;
+class nsRuleWalker;
 
 namespace mozilla {
 
+namespace dom {
+class Element;
+}
+
 class SVGAnimationRuleProcessor MOZ_FINAL : public nsIStyleRuleProcessor
 {
 public:
   SVGAnimationRuleProcessor();
 
 private:
   ~SVGAnimationRuleProcessor();
 
@@ -41,16 +46,20 @@ public:
   virtual bool MediumFeaturesChanged(nsPresContext* aPresContext) MOZ_OVERRIDE;
   virtual size_t SizeOfExcludingThis(mozilla::MallocSizeOf aMallocSizeOf)
     const MOZ_MUST_OVERRIDE MOZ_OVERRIDE;
   virtual size_t SizeOfIncludingThis(mozilla::MallocSizeOf aMallocSizeOf)
     const MOZ_MUST_OVERRIDE MOZ_OVERRIDE;
 
   size_t DOMSizeOfIncludingThis(mozilla::MallocSizeOf aMallocSizeOf) const;
 
+  // A shortcut for nsStyleSet to call RulesMatching with less setup.
+  void ElementRulesMatching(mozilla::dom::Element* aElement,
+                            nsRuleWalker* aRuleWalker);
+
 private:
   SVGAnimationRuleProcessor(const SVGAnimationRuleProcessor& aCopy) MOZ_DELETE;
   SVGAnimationRuleProcessor& operator=(const SVGAnimationRuleProcessor& aCopy) MOZ_DELETE;
 };
 
 } // namespace mozilla
 
 #endif /* !defined(mozilla_SVGAnimationRuleProcessor_h_) */
