From: L. David Baron <dbaron@dbaron.org>

Fix style rule inheritance macros.  (Bug 435442, patch 4)

diff --git a/layout/style/nsCSSRules.cpp b/layout/style/nsCSSRules.cpp
--- a/layout/style/nsCSSRules.cpp
+++ b/layout/style/nsCSSRules.cpp
@@ -65,27 +65,38 @@
 #include "nsStyleConsts.h"
 #include "nsDOMError.h"
 #include "nsStyleUtil.h"
 #include "mozilla/css/Declaration.h"
 #include "nsPrintfCString.h"
 
 namespace css = mozilla::css;
 
-#define IMPL_STYLE_RULE_INHERIT(_class, super) \
-/* virtual */ already_AddRefed<nsIStyleSheet> _class::GetStyleSheet() const { return super::GetStyleSheet(); }  \
-/* virtual */ void _class::SetStyleSheet(nsCSSStyleSheet* aSheet) { super::SetStyleSheet(aSheet); }  \
-/* virtual */ void _class::SetParentRule(css::GroupRule* aRule) { super::SetParentRule(aRule); }  \
-nsIDOMCSSRule* _class::GetDOMRuleWeak(nsresult *aResult) { *aResult = NS_OK; return this; }  \
-/* virtual */ void _class::MapRuleInfoInto(nsRuleData* aRuleData) { }
+#define IMPL_STYLE_RULE_INHERIT_GET_STYLE_SHEET(class_, super_) \
+/* virtual */ already_AddRefed<nsIStyleSheet> class_::GetStyleSheet() const \
+  { return super_::GetStyleSheet(); }
+#define IMPL_STYLE_RULE_INHERIT_SET_STYLE_SHEET(class_, super_) \
+/* virtual */ void class_::SetStyleSheet(nsCSSStyleSheet* aSheet) \
+  { super_::SetStyleSheet(aSheet); }
+#define IMPL_STYLE_RULE_INHERIT_SET_PARENT_RULE(class_, super_) \
+/* virtual */ void class_::SetParentRule(css::GroupRule* aRule) \
+  { super_::SetParentRule(aRule); }
+#define IMPL_STYLE_RULE_INHERIT_GET_DOM_RULE_WEAK(class_, super_) \
+nsIDOMCSSRule* class_::GetDOMRuleWeak(nsresult *aResult) \
+  { *aResult = NS_OK; return this; }
+#define IMPL_STYLE_RULE_INHERIT_MAP_RULE_INFO_INTO(class_, super_) \
+/* virtual */ void class_::MapRuleInfoInto(nsRuleData* aRuleData) \
+  { NS_ABORT_IF_FALSE(PR_FALSE, "should not be called"); }
 
-#define IMPL_STYLE_RULE_INHERIT2(_class, super) \
-/* virtual */ already_AddRefed<nsIStyleSheet> _class::GetStyleSheet() const { return super::GetStyleSheet(); }  \
-/* virtual */ void  _class::SetParentRule(css::GroupRule* aRule) { super::SetParentRule(aRule); }  \
-/* virtual */ void _class::MapRuleInfoInto(nsRuleData* aRuleData) { }
+#define IMPL_STYLE_RULE_INHERIT(class_, super_) \
+IMPL_STYLE_RULE_INHERIT_GET_STYLE_SHEET(class_, super_) \
+IMPL_STYLE_RULE_INHERIT_SET_STYLE_SHEET(class_, super_) \
+IMPL_STYLE_RULE_INHERIT_SET_PARENT_RULE(class_, super_) \
+IMPL_STYLE_RULE_INHERIT_GET_DOM_RULE_WEAK(class_, super_) \
+IMPL_STYLE_RULE_INHERIT_MAP_RULE_INFO_INTO(class_, super_)
 
 // -------------------------------
 // Style Rule List for group rules
 //
 
 namespace mozilla {
 namespace css {
 
@@ -617,17 +628,19 @@ GroupRule::~GroupRule()
   if (mRuleCollection) {
     mRuleCollection->DropReference();
   }
 }
 
 NS_IMPL_ADDREF(GroupRule)
 NS_IMPL_RELEASE(GroupRule)
 
-IMPL_STYLE_RULE_INHERIT2(GroupRule, nsCSSRule)
+IMPL_STYLE_RULE_INHERIT_GET_STYLE_SHEET(GroupRule, nsCSSRule)
+IMPL_STYLE_RULE_INHERIT_SET_PARENT_RULE(GroupRule, nsCSSRule)
+IMPL_STYLE_RULE_INHERIT_MAP_RULE_INFO_INTO(GroupRule, nsCSSRule)
 
 static PRBool
 SetStyleSheetReference(nsICSSRule* aRule, void* aSheet)
 {
   nsCSSStyleSheet* sheet = (nsCSSStyleSheet*)aSheet;
   aRule->SetStyleSheet(sheet);
   return PR_TRUE;
 }
