Better approach to some tests to avoid subpixel spacing differences.  (Bug 457821)

diff --git a/layout/reftests/font-face/multiple-in-family-1-notref.html b/layout/reftests/font-face/multiple-in-family-1-notref.html
--- a/layout/reftests/font-face/multiple-in-family-1-notref.html
+++ b/layout/reftests/font-face/multiple-in-family-1-notref.html
@@ -13,11 +13,14 @@
 
 	body { font-family: "MarkA"; }
 
 	</style>
 </head>
 <body>
 
 <p>ABC</p>
+<p>A</p>
+<p>B</p>
+<p>C</p>
 
 </body>
 </html>
diff --git a/layout/reftests/font-face/multiple-in-family-1-ref.html b/layout/reftests/font-face/multiple-in-family-1-ref.html
--- a/layout/reftests/font-face/multiple-in-family-1-ref.html
+++ b/layout/reftests/font-face/multiple-in-family-1-ref.html
@@ -11,16 +11,24 @@
 		src: url(../fonts/markA.ttf);
 	}
 
 	@font-face {
 		font-family: "MarkB";
 		src: url(../fonts/markB.ttf);
 	}
 
+	@font-face {
+		font-family: "MarkD";
+		src: url(../fonts/markD.ttf);
+	}
+
 	</style>
 </head>
 <body>
 
-<p><span style="font-family: MarkA">A</span><span style="font-family: MarkB">B</span>C</p>
+<p style="font-family: MarkD">DDC</p>
+<p style="font-family: MarkA">A</p>
+<p style="font-family: MarkB">B</p>
+<p style="font-family: MarkA">C</p>
 
 </body>
 </html>
diff --git a/layout/reftests/font-face/multiple-in-family-1.html b/layout/reftests/font-face/multiple-in-family-1.html
--- a/layout/reftests/font-face/multiple-in-family-1.html
+++ b/layout/reftests/font-face/multiple-in-family-1.html
@@ -18,11 +18,14 @@
 
 	body { font-family: "MarkA", "MarkB"; }
 
 	</style>
 </head>
 <body>
 
 <p>ABC</p>
+<p>A</p>
+<p>B</p>
+<p>C</p>
 
 </body>
 </html>
diff --git a/layout/reftests/font-face/order-2-ref.html b/layout/reftests/font-face/order-2-ref.html
--- a/layout/reftests/font-face/order-2-ref.html
+++ b/layout/reftests/font-face/order-2-ref.html
@@ -2,33 +2,22 @@
 	"http://www.w3.org/TR/html4/strict.dtd">
 <html lang="en-US">
 <head>
 	<title></title>
 	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 	<style type="text/css">
 
 	@font-face {
-		font-family: "MarkA";
-		src: url(../fonts/markA.ttf);
+		font-family: "MarkXMark2Y";
+		src: url(../fonts/markXmark2Y.ttf);
 	}
 
-	@font-face {
-		font-family: "Mark2B";
-		src: url(../fonts/mark2B.ttf);
-	}
-
-	span.spacer {
-		/* to ensure the same vertical positioning of the text */
-		display: inline-block;
-		height: 3em;
-		width: 1em;
-		vertical-align: baseline;
-	}
+	body { font-family: "MarkXMark2Y"; }
 
 	</style>
 </head>
 <body>
 
-<p><span style="font-family: MarkA">A</span><span style="font-family: Mark2B">B</span>C<span class="spacer"></span></p>
+<p>XYC</p>
 
 </body>
 </html>
diff --git a/layout/reftests/font-face/order-2.html b/layout/reftests/font-face/order-2.html
--- a/layout/reftests/font-face/order-2.html
+++ b/layout/reftests/font-face/order-2.html
@@ -23,24 +23,16 @@
 
 	@font-face {
 		font-family: "One";
 		src: url(../fonts/markA.ttf);
 	}
 
 	body { font-family: "One"; }
 
-	span.spacer {
-		/* to ensure the same vertical positioning of the text */
-		display: inline-block;
-		height: 3em;
-		width: 1em;
-		vertical-align: baseline;
-	}
-
 	</style>
 </head>
 <body>
 
-<p>ABC<span class="spacer"></span></p>
+<p>ABC</p>
 
 </body>
 </html>
diff --git a/layout/reftests/font-face/order-3-ref.html b/layout/reftests/font-face/order-3-ref.html
--- a/layout/reftests/font-face/order-3-ref.html
+++ b/layout/reftests/font-face/order-3-ref.html
@@ -2,33 +2,22 @@
 	"http://www.w3.org/TR/html4/strict.dtd">
 <html lang="en-US">
 <head>
 	<title></title>
 	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 	<style type="text/css">
 
 	@font-face {
-		font-family: "MarkA";
-		src: url(../fonts/markA.ttf);
+		font-family: "MarkXMark2Y";
+		src: url(../fonts/markXmark2Y.ttf);
 	}
 
-	@font-face {
-		font-family: "Mark2B";
-		src: url(../fonts/mark2B.ttf);
-	}
-
-	span.spacer {
-		/* to ensure the same vertical positioning of the text */
-		display: inline-block;
-		height: 3em;
-		width: 1em;
-		vertical-align: baseline;
-	}
+	body { font-family: "MarkXMark2Y"; }
 
 	</style>
 </head>
 <body>
 
-<p><span style="font-family: MarkA">A</span><span style="font-family: Mark2B">B</span>C<span class="spacer"></span></p>
+<p>XYC</p>
 
 </body>
 </html>
diff --git a/layout/reftests/font-face/order-3.html b/layout/reftests/font-face/order-3.html
--- a/layout/reftests/font-face/order-3.html
+++ b/layout/reftests/font-face/order-3.html
@@ -23,24 +23,16 @@
 
 	@font-face {
 		font-family: "One";
 		src: url(../fonts/markA.ttf);
 	}
 
 	body { font-family: "One"; }
 
-	span.spacer {
-		/* to ensure the same vertical positioning of the text */
-		display: inline-block;
-		height: 3em;
-		width: 1em;
-		vertical-align: baseline;
-	}
-
 	</style>
 </head>
 <body>
 
-<p>ABC<span class="spacer"></span></p>
+<p>ABC</p>
 
 </body>
 </html>
diff --git a/layout/reftests/font-face/reftest.list b/layout/reftests/font-face/reftest.list
--- a/layout/reftests/font-face/reftest.list
+++ b/layout/reftests/font-face/reftest.list
@@ -14,16 +14,16 @@ fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTT
 fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) == src-list-1.html src-list-1-ref.html
 fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) == src-list-2.html src-list-2-ref.html
 fails HTTP(..) == src-list-format-1.html src-list-format-1-ref.html
 fails HTTP(..) == src-list-format-2.html src-list-format-2-ref.html
 fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) == src-list-format-3.html src-list-format-3-ref.html
 # FIXME: The behavior here is neither mandated nor specified by the spec, but
 # it really ought to be.
 HTTP(..) == order-1.html order-1-ref.html
-fails-if(MOZ_WIDGET_TOOLKIT!="gtk2") HTTP(..) == order-2.html order-2-ref.html
-fails-if(MOZ_WIDGET_TOOLKIT!="gtk2") HTTP(..) == order-3.html order-3-ref.html
-fails-if(MOZ_WIDGET_TOOLKIT=="cocoa") random-if(MOZ_WIDGET_TOOLKIT=="windows") HTTP(..) == multiple-in-family-1.html multiple-in-family-1-ref.html
+fails HTTP(..) == order-2.html order-2-ref.html
+fails HTTP(..) == order-3.html order-3-ref.html
+fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") fails-if(MOZ_WIDGET_TOOLKIT=="cocoa") random-if(MOZ_WIDGET_TOOLKIT=="windows") HTTP(..) == multiple-in-family-1.html multiple-in-family-1-ref.html
 fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") fails-if(MOZ_WIDGET_TOOLKIT=="cocoa") random-if(MOZ_WIDGET_TOOLKIT=="windows") HTTP(..) != multiple-in-family-1.html multiple-in-family-1-notref.html
 random-if(MOZ_WIDGET_TOOLKIT=="windows") HTTP(..) == prop-order-over-rule-order-1a.html prop-order-over-rule-order-2a.html
 random-if(MOZ_WIDGET_TOOLKIT=="windows") HTTP(..) == prop-order-over-rule-order-1b.html prop-order-over-rule-order-2b.html
 random-if(MOZ_WIDGET_TOOLKIT=="windows") fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) != prop-order-over-rule-order-1a.html prop-order-over-rule-order-1b.html
 fails-if(MOZ_WIDGET_TOOLKIT=="gtk2") HTTP(..) == cross-iframe-1.html cross-iframe-1-ref.html
diff --git a/layout/reftests/fonts/mark-generate.py b/layout/reftests/fonts/mark-generate.py
--- a/layout/reftests/fonts/mark-generate.py
+++ b/layout/reftests/fonts/mark-generate.py
@@ -61,8 +61,27 @@ for codepoint in range(ord("A"), ord("D"
         f.fullname = n
         f.copyright = "Copyright (c) 2008 Mozilla Corporation"
 
         g = f.createChar(codepoint, charname)
         g.importOutlines("mark" + mark + "-glyph.svg")
         g.width = width
 
         f.generate("mark" + mark + charname + ".ttf")
+
+# And, for references, generate markXmark2Y
+f = fontforge.font()
+n = "MarkXMark2Y"
+f.fontname = n
+f.familyname = n
+f.fullname = n
+f.copyright = "Copyright (c) 2008 Mozilla Corporation"
+
+g = f.createChar(ord("X"), "X")
+g.importOutlines("mark-glyph.svg")
+g.width = 1500
+
+g = f.createChar(ord("Y"), "Y")
+g.importOutlines("mark2-glyph.svg")
+g.width = 1800
+
+f.generate("markXmark2Y.ttf")
+
diff --git a/layout/reftests/fonts/markXmark2Y.ttf b/layout/reftests/fonts/markXmark2Y.ttf
new file mode 100644
index 0000000000000000000000000000000000000000..7a949e345591f1cef9023cb3d78fbd6a94666a29
GIT binary patch
literal 1648
zc$~ddO>7%Q6#i!a+$e!GYN$B$Fct`siaKjopeUF^3HX5GQngX!<bqaS$F^!`t&M|{
zN=T95RN6aK;TD7h5=yLaXcZ(5h33#>k2xT52?r=b;egs^`_1geO{E-456tZBeBYaS
zZ{B<J0|DSUEW^b4LSeFa?#I0mz?r1<#D^D0a#M?b2M{IlsdCe6p+9wm{1)50<&WDE
zX=4d6DT7t@=37xjOK>L0k5n5=vuA(%dYR)dl5f;1p8r?*hfj#N+1{v8(6i}$OIw5F
zFV~vw#s07GJNX*<U?V7dXyJS6_mTHCy~P$jz*`(2C6{wvvodh6RN(j>z_`!~=G)OP
z)PN&7{u)$lY}c;-ee<LK{6FY5cPPQnZ{LvJJ{_$%tH!4C7Y5=&9b+?E!HkNP)>gHp
zgT>Yo8+|HT7DH<(**nO@Hk?rGat4em+WOVF7r!Da45i?hU29KRKR^4vPb(!%n=%^3
z47L2nb3_Aa-50t1Hhg-hM$M$1Nap3qgyt4htQM={)7&4R6h+Z@U5n0R2b5>sEF9|H
ze=DZ-?7IJR(dQT^buD0qSzw;UN#i;*nL=h=U?ks3S@<Kj?%3P;j%g5L-Be;*i90Dr
zJji#1lAj((54?JM;H9+a*|~k&xc+c9ZIsjw`O%8K$Q@NSdujjm^b6g#D|R2gXMT2n
z!yXj7TU&c~;|8?@zB+}}O997}aW;R;THE^fCu4K3PbtPxJkQ&*zhAH5T!IDHx|U!b
zJbaU26GLKue=YQivkA6wR0IijDE~s8CaZ^RLTf23a2yK>Hh2%dOfcUO`VeCa$Hj1h
zZAhNk7(0|NV;lkR>JmcKQAG`Hp41_fG0Z*(mvxk=$XS;;qrvKtE3J@v>hDpfPBaIM
z2d$;BUahs|P<dG9Tz6C!gUj_s!;|Ad*a||gT@N^~NTm>$c)j*f4$~BS;iZ!L<rG1M
z39mD}CP~GwFR(A@b=tZQ>2F1QnW2{wW7^Nd498<x)>FxUKQa`8xppB4s}-5cxN=M$
zaDgnFJ;hJO@pL{<(V-CYNjjunB&*$XwTqalg!9aRblq&mbzS*%X1lLJ^eIOVE4Dsg
Z2HxbGL&WzbehXP{o%#Gv)gOFs9|1)|^9ld}

