From: L. David Baron <dbaron@dbaron.org>

Bug 1363262 - Don't call First() on empty strings in nsCommandLine::HandleFlagWithParam.  r=bsmedberg

MozReview-Commit-ID: 91J55PjzwmF

diff --git a/toolkit/components/commandlines/nsCommandLine.cpp b/toolkit/components/commandlines/nsCommandLine.cpp
--- a/toolkit/components/commandlines/nsCommandLine.cpp
+++ b/toolkit/components/commandlines/nsCommandLine.cpp
@@ -182,21 +182,25 @@ nsCommandLine::HandleFlagWithParam(const
   }
 
   if (found == int32_t(mArgs.Length()) - 1) {
     return NS_ERROR_INVALID_ARG;
   }
 
   ++found;
 
-  if (mArgs[found].First() == '-') {
-    return NS_ERROR_INVALID_ARG;
+  { // scope for validity of |param|, which RemoveArguments call invalidates
+    const nsString& param = mArgs[found];
+    if (!param.IsEmpty() && param.First() == '-') {
+      return NS_ERROR_INVALID_ARG;
+    }
+
+    aResult = *param;
   }
 
-  aResult = mArgs[found];
   RemoveArguments(found - 1, found);
 
   return NS_OK;
 }
 
 NS_IMETHODIMP
 nsCommandLine::GetState(uint32_t *aResult)
 {
