
# HG changeset patch
# User Brian Hackett <bhackett1024@gmail.com>
# Date 1410531357 25200
# Node ID d3f70a7f23867ff70e523963b94e48963244c8ea
# Parent  c599b5ffe37687293f22b855c8940c0a38a0a8a0
Bug 1064159 - Fix !unknownProperties() assertion, r=jandem.

diff --git a/js/src/jsinfer.cpp b/js/src/jsinfer.cpp
--- a/js/src/jsinfer.cpp
+++ b/js/src/jsinfer.cpp
@@ -3062,17 +3062,18 @@ InlineAddTypeProperty(ExclusiveContext *
     // Propagate new types from partially initialized types to fully
     // initialized types for the acquired properties analysis. Note that we
     // don't need to do this for other property changes, as these will also be
     // reflected via shape changes on the object that will prevent the object
     // from acquiring the fully initialized type.
     if (obj->newScript() && obj->newScript()->initializedType()) {
         if (type.isObjectUnchecked() && types->unknownObject())
             type = Type::AnyObjectType();
-        obj->newScript()->initializedType()->addPropertyType(cx, id, type);
+        if (!obj->newScript()->initializedType()->unknownProperties())
+            obj->newScript()->initializedType()->addPropertyType(cx, id, type);
     }
 }
 
 void
 TypeObject::addPropertyType(ExclusiveContext *cx, jsid id, Type type)
 {
     InlineAddTypeProperty(cx, this, id, type);
 }
