Make 'width', 'height', and 'aspect-ratio' features use the page size when printing.  (Bug 466171)

diff --git a/layout/style/nsMediaFeatures.cpp b/layout/style/nsMediaFeatures.cpp
--- a/layout/style/nsMediaFeatures.cpp
+++ b/layout/style/nsMediaFeatures.cpp
@@ -57,26 +57,34 @@ static const PRInt32 kScanKeywords[] = {
   eCSSKeyword_progressive,              NS_STYLE_SCAN_PROGRESSIVE,
   eCSSKeyword_interlace,                NS_STYLE_SCAN_INTERLACE,
   eCSSKeyword_UNKNOWN,                  -1
 };
 
 static nsresult
 GetWidth(nsPresContext* aPresContext, nsCSSValue& aResult)
 {
-    nscoord width = aPresContext->GetVisibleArea().width;
+    nscoord width;
+    if (aPresContext->IsRootPaginatedDocument())
+        width = aPresContext->GetPageSize().width;
+    else
+        width = aPresContext->GetVisibleArea().width;
     float pixelWidth = aPresContext->AppUnitsToFloatCSSPixels(width);
     aResult.SetFloatValue(pixelWidth, eCSSUnit_Pixel);
     return NS_OK;
 }
 
 static nsresult
 GetHeight(nsPresContext* aPresContext, nsCSSValue& aResult)
 {
-    nscoord height = aPresContext->GetVisibleArea().height;
+    nscoord height;
+    if (aPresContext->IsRootPaginatedDocument())
+        height = aPresContext->GetPageSize().height;
+    else
+        height = aPresContext->GetVisibleArea().height;
     float pixelHeight = aPresContext->AppUnitsToFloatCSSPixels(height);
     aResult.SetFloatValue(pixelHeight, eCSSUnit_Pixel);
     return NS_OK;
 }
 
 static nsIDeviceContext*
 GetDeviceContextFor(nsPresContext* aPresContext)
 {
@@ -136,17 +144,21 @@ GetOrientation(nsPresContext* aPresConte
 }
 
 static nsresult
 GetAspectRatio(nsPresContext* aPresContext, nsCSSValue& aResult)
 {
     nsRefPtr<nsCSSValue::Array> a = nsCSSValue::Array::Create(2);
     NS_ENSURE_TRUE(a, NS_ERROR_OUT_OF_MEMORY);
 
-    nsSize size = aPresContext->GetVisibleArea().Size();
+    nsSize size;
+    if (aPresContext->IsRootPaginatedDocument())
+        size = aPresContext->GetPageSize();
+    else
+        size = aPresContext->GetVisibleArea().Size();
     a->Item(0).SetIntValue(size.width, eCSSUnit_Integer);
     a->Item(1).SetIntValue(size.height, eCSSUnit_Integer);
 
     aResult.SetArrayValue(a, eCSSUnit_Array);
     return NS_OK;
 }
 
 static nsresult
