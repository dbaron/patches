From: L. David Baron <dbaron@dbaron.org>

Bug 945632:  Add debugging for gfx/heap-textures leak.

diff --git a/gfx/layers/ipc/ISurfaceAllocator.h b/gfx/layers/ipc/ISurfaceAllocator.h
--- a/gfx/layers/ipc/ISurfaceAllocator.h
+++ b/gfx/layers/ipc/ISurfaceAllocator.h
@@ -161,22 +161,30 @@ public:
 #endif
   }
 
   MOZ_DEFINE_MALLOC_SIZE_OF_ON_ALLOC(MallocSizeOfOnAlloc)
   MOZ_DEFINE_MALLOC_SIZE_OF_ON_FREE(MallocSizeOfOnFree)
 
   static void DidAlloc(void* aPointer)
   {
-    sAmount += MallocSizeOfOnAlloc(aPointer);
+    size_t size = MallocSizeOfOnAlloc(aPointer);
+    sAmount += size;
+  #ifdef DEBUG
+    printf("DidAlloc: allocating %p, object size %llu size now %llu\n", aPointer, size, size_t(sAmount));
+  #endif
   }
 
   static void WillFree(void* aPointer)
   {
-    sAmount -= MallocSizeOfOnFree(aPointer);
+    size_t size = MallocSizeOfOnFree(aPointer);
+    sAmount -= size;
+  #ifdef DEBUG
+    printf("WillFree: freeing %p, object size %llu, size now %llu\n", aPointer, size, size_t(sAmount));
+  #endif
   }
 
   NS_IMETHOD CollectReports(nsIHandleReportCallback* aHandleReport,
                             nsISupports* aData)
   {
     return MOZ_COLLECT_REPORT(
       "explicit/gfx/heap-textures", KIND_HEAP, UNITS_BYTES, sAmount,
       "Heap memory shared between threads by texture clients and hosts.");
