From: L. David Baron <dbaron@dbaron.org>

Add reftests for bug 623922.

menulist-shrinkwrap-1 tests one of the important characteristics of the
fix:  that the intrinsic size of a menulist doesn't depend on which item
is selected.  It passes both with and without the patch, across
platforms.

menulist-shrinkwrap-2 tests the actual bug being fixed:  that a menulist
at its intrinsic size doesn't truncate some of the items with "...".  It
passes on Mac OS X with and without this patch.  This patch changes it
from failing to passing on Linux.  It fails on Windows XP and Windows 7
both with and without the patch, although the patch slightly reduces the
amount of text truncated on Windows 7, from "long i..." to "long it...",
although it's constant at "long i..." on Windows XP.

diff --git a/layout/reftests/xul/menulist-shrinkwrap-1-ref.xul b/layout/reftests/xul/menulist-shrinkwrap-1-ref.xul
new file mode 100644
--- /dev/null
+++ b/layout/reftests/xul/menulist-shrinkwrap-1-ref.xul
@@ -0,0 +1,9 @@
+<?xml version="1.0"?>
+<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul" align="left">
+  <menulist style="color: transparent">
+    <menupopup>
+      <menuitem value="1" label="short" />
+      <menuitem value="2" label="long item" />
+    </menupopup>
+  </menulist>
+</window>
diff --git a/layout/reftests/xul/menulist-shrinkwrap-1.xul b/layout/reftests/xul/menulist-shrinkwrap-1.xul
new file mode 100644
--- /dev/null
+++ b/layout/reftests/xul/menulist-shrinkwrap-1.xul
@@ -0,0 +1,9 @@
+<?xml version="1.0"?>
+<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul" align="left">
+  <menulist style="color: transparent">
+    <menupopup>
+      <menuitem value="1" label="long item" />
+      <menuitem value="2" label="short" />
+    </menupopup>
+  </menulist>
+</window>
diff --git a/layout/reftests/xul/menulist-shrinkwrap-2-ref.xul b/layout/reftests/xul/menulist-shrinkwrap-2-ref.xul
new file mode 100644
--- /dev/null
+++ b/layout/reftests/xul/menulist-shrinkwrap-2-ref.xul
@@ -0,0 +1,24 @@
+<?xml version="1.0"?>
+<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
+  <style xmlns="http://www.w3.org/1999/xhtml">
+    <![CDATA[
+      menulist, menuitem, label { font: Menu }
+      #measurelabel { color: transparent }
+    ]]>
+  </style>
+  <stack>
+    <vbox>
+      <menulist>
+        <menupopup>
+          <menuitem value="1" label="long item" />
+          <menuitem value="2" label="short" />
+        </menupopup>
+      </menulist>
+    </vbox>
+    <hbox>
+      <label id="measurelabel" value="long item" />
+      <!-- cover up the right edge of the above -->
+      <box flex="1" style="background: white" />
+    </hbox>
+  </stack>
+</window>
diff --git a/layout/reftests/xul/menulist-shrinkwrap-2.xul b/layout/reftests/xul/menulist-shrinkwrap-2.xul
new file mode 100644
--- /dev/null
+++ b/layout/reftests/xul/menulist-shrinkwrap-2.xul
@@ -0,0 +1,24 @@
+<?xml version="1.0"?>
+<window xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
+  <style xmlns="http://www.w3.org/1999/xhtml">
+    <![CDATA[
+      menulist, menuitem, label { font: Menu }
+      #measurelabel { color: transparent }
+    ]]>
+  </style>
+  <stack>
+    <vbox align="left">
+      <menulist>
+        <menupopup>
+          <menuitem value="1" label="long item" />
+          <menuitem value="2" label="short" />
+        </menupopup>
+      </menulist>
+    </vbox>
+    <hbox>
+      <label id="measurelabel" value="long item" />
+      <!-- cover up the right edge of the above -->
+      <box flex="1" style="background: white" />
+    </hbox>
+  </stack>
+</window>
diff --git a/layout/reftests/xul/reftest.list b/layout/reftests/xul/reftest.list
--- a/layout/reftests/xul/reftest.list
+++ b/layout/reftests/xul/reftest.list
@@ -1,1 +1,3 @@
 == menuitem-key.xul menuitem-key-ref.xul
+== menulist-shrinkwrap-1.xul menulist-shrinkwrap-1-ref.xul
+fails-if(winWidget) == menulist-shrinkwrap-2.xul menulist-shrinkwrap-2-ref.xul
