From: L. David Baron <dbaron@dbaron.org>

Bug 917021:  We should not store the NormalPositionProperty on all frames, only relatively positioned ones.  r=dholbert

This also fixes nsHTMLReflowState::ApplyRelativePositioning to no-op for
svg:text, as it should (since nsIFrame::IsRelativelyPositioned() checks
more than nsStyleDisplay::IsRelativelyPositionedStyle()).

diff --git a/layout/generic/nsHTMLReflowState.cpp b/layout/generic/nsHTMLReflowState.cpp
--- a/layout/generic/nsHTMLReflowState.cpp
+++ b/layout/generic/nsHTMLReflowState.cpp
@@ -844,16 +844,25 @@ nsHTMLReflowState::ComputeRelativeOffset
   }
 }
 
 /* static */ void
 nsHTMLReflowState::ApplyRelativePositioning(nsIFrame* aFrame,
                                             const nsMargin& aComputedOffsets,
                                             nsPoint* aPosition)
 {
+  if (!aFrame->IsRelativelyPositioned()) {
+    NS_ASSERTION(!aFrame->Properties().Get(nsIFrame::NormalPositionProperty()),
+                 "We assume that changing the 'position' property causes "
+                 "frame reconstruction.  If that ever changes, this code "
+                 "should call "
+                 "props.Delete(nsIFrame::NormalPositionProperty())");
+    return;
+  }
+
   // Store the normal position
   FrameProperties props = aFrame->Properties();
   nsPoint* normalPosition = static_cast<nsPoint*>
     (props.Get(nsIFrame::NormalPositionProperty()));
   if (normalPosition) {
     *normalPosition = *aPosition;
   } else {
     props.Set(nsIFrame::NormalPositionProperty(), new nsPoint(*aPosition));
