From: L. David Baron <dbaron@dbaron.org>

Explicitly gc.

diff --git a/toolkit/content/tests/chrome/bug451286_window.xul b/toolkit/content/tests/chrome/bug451286_window.xul
--- a/toolkit/content/tests/chrome/bug451286_window.xul
+++ b/toolkit/content/tests/chrome/bug451286_window.xul
@@ -18,23 +18,27 @@
     const Cc = Components.classes;
     const Cr = Components.results;
     const SEARCH_TEXT = "text";
     const DATAURI = "data:text/html," + SEARCH_TEXT;
 
     var gFindBar = null;
     var gBrowser;
 
-    var imports = ["SimpleTest", "ok", "snapshotWindow", "compareSnapshots"];
+    var imports = ["SimpleTest", "ok", "snapshotWindow", "compareSnapshots",
+                   "SpecialPowers"];
     for each (var name in imports) {
       window[name] = window.opener.wrappedJSObject[name];
     }
 
     function finish() {
       window.close();
+      // Garbage collect objects created in this test can cause
+      // assertions, so GC now to blame those assertions to this test.
+      SpecialPowers.gc();
       SimpleTest.finish();
     }
 
     function startTest() {
       gFindBar = document.getElementById("FindToolbar");
       gBrowser = document.getElementById("content");
       gBrowser.addEventListener("pageshow", onPageShow, false);
 
diff --git a/toolkit/content/tests/chrome/test_bug451286.xul b/toolkit/content/tests/chrome/test_bug451286.xul
--- a/toolkit/content/tests/chrome/test_bug451286.xul
+++ b/toolkit/content/tests/chrome/test_bug451286.xul
@@ -27,16 +27,18 @@ https://bugzilla.mozilla.org/show_bug.cg
     </div>
     <pre id="test">
     </pre>
   </body>
 
   <script class="testbody" type="application/javascript">
     <![CDATA[
 
+      SimpleTest.expectAssertions(5);
+
       /** Test for Bug 451286 **/
       SimpleTest.waitForExplicitFinish();
       window.open("bug451286_window.xul", "451286test", 
                   "chrome,width=600,height=600");
 
     ]]>
   </script>
 
