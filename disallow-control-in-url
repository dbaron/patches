From: L. David Baron <dbaron@dbaron.org>

Disallow control characters less than space inside unquoted url(), per spec.  (Bug 604179)

diff --git a/layout/style/nsCSSScanner.cpp b/layout/style/nsCSSScanner.cpp
--- a/layout/style/nsCSSScanner.cpp
+++ b/layout/style/nsCSSScanner.cpp
@@ -931,34 +931,34 @@ nsCSSScanner::NextURL(nsCSSToken& aToken
 
   // start of a non-quoted url (which may be empty)
   PRBool ok = PR_TRUE;
   for (;;) {
     ch = Read();
     if (ch < 0) break;
     if (ch == CSS_ESCAPE) {
       ParseAndAppendEscape(ident);
-    } else if ((ch == '"') || (ch == '\'') || (ch == '(')) {
-      // This is an invalid URL spec
-      ok = PR_FALSE;
-      Pushback(ch); // push it back so the parser can match tokens and
-                    // then closing parenthesis
-      break;
     } else if (IsWhitespace(ch)) {
       // Whitespace is allowed at the end of the URL
       EatWhiteSpace();
       if (LookAhead(')')) {
         Pushback(')');  // leave the closing symbol
         // done!
         break;
       }
       // Whitespace is followed by something other than a
       // ")". This is an invalid url spec.
       ok = PR_FALSE;
       break;
+    } else if (ch == '"' || ch == '\'' || ch == '(' || ch < PRUnichar(' ')) {
+      // This is an invalid URL spec
+      ok = PR_FALSE;
+      Pushback(ch); // push it back so the parser can match tokens and
+                    // then closing parenthesis
+      break;
     } else if (ch == ')') {
       Pushback(ch);
       // All done
       break;
     } else {
       // A regular url character.
       ident.Append(PRUnichar(ch));
     }
