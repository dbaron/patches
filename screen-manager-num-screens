Allow screen manager array to be larger than mNumScreens (but don't make it happen yet).  b=403706

diff --git a/widget/src/gtk2/nsScreenManagerGtk.cpp b/widget/src/gtk2/nsScreenManagerGtk.cpp
--- a/widget/src/gtk2/nsScreenManagerGtk.cpp
+++ b/widget/src/gtk2/nsScreenManagerGtk.cpp
@@ -95,13 +95,14 @@ nsScreenManagerGtk :: EnsureInit(void)
     // isn't running on the current display
     if (!screenInfo) {
       mNumScreens = 1;
+
       nsRefPtr<nsScreenGtk> screen = new nsScreenGtk();
-      if (!screen)
+      if (!screen || !mCachedScreenArray.AppendObject(screen)) {
+        mNumScreens = 0;
         return NS_ERROR_OUT_OF_MEMORY;
+      }
 
       screen->Init();
-
-      mCachedScreenArray.AppendObject(screen);
     }
     // If Xinerama is enabled and there's more than one screen, fill
     // in the info for all of the screens.  If that's not the case
@@ -110,17 +111,15 @@ nsScreenManagerGtk :: EnsureInit(void)
 #ifdef DEBUG
       printf("Xinerama superpowers activated for %d screens!\n", mNumScreens);
 #endif
-      int i;
-      for (i=0; i < mNumScreens; i++) {
+      for (int i = 0; i < mNumScreens; ++i) {
         nsRefPtr<nsScreenGtk> screen = new nsScreenGtk();
-        if (!screen) {
+        if (!screen || !mCachedScreenArray.AppendObject(screen))
+          mNumScreens = 0;
           return NS_ERROR_OUT_OF_MEMORY;
         }
 
         // initialize this screen object
         screen->Init(&screenInfo[i]);
-
-        mCachedScreenArray.AppendObject(screen);
       }
     }
 
@@ -162,7 +161,7 @@ nsScreenManagerGtk :: ScreenForRect ( PR
     // surface area.
     PRUint32 area = 0;
     nsRect   windowRect(aX, aY, aWidth, aHeight);
-    for (PRInt32 i = 0, i_end = mCachedScreenArray.Count(); i < i_end; ++i) {
+    for (PRInt32 i = 0, i_end = mNumScreens; i < i_end; ++i) {
       PRInt32  x, y, width, height;
       x = y = width = height = 0;
       mCachedScreenArray[i]->GetRect(&x, &y, &width, &height);
diff --git a/widget/src/gtk2/nsScreenManagerGtk.h b/widget/src/gtk2/nsScreenManagerGtk.h
--- a/widget/src/gtk2/nsScreenManagerGtk.h
+++ b/widget/src/gtk2/nsScreenManagerGtk.h
@@ -59,9 +59,12 @@ private:
 
   nsresult EnsureInit(void);
 
-  // cache the primary screen object to avoid memory allocation every
-  // time
+  // Cached screen array.  This may have more objects in it than the
+  // number of screens if the number of screens changes dynamically over
+  // time, but we want to re-use the same screen objects.  It is never,
+  // however, smaller than mNumScreens.
   nsCOMArray<nsIScreen> mCachedScreenArray;
+
   // how many screens do we have?
   int mNumScreens;
 
