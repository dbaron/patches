From: L. David Baron <dbaron@dbaron.org>

Bug 827687, patch 2:  Be more careful walking segments.  r=bzbarsky

diff --git a/layout/style/nsAnimationManager.cpp b/layout/style/nsAnimationManager.cpp
--- a/layout/style/nsAnimationManager.cpp
+++ b/layout/style/nsAnimationManager.cpp
@@ -249,24 +249,32 @@ ElementAnimations::EnsureStyleRuleFor(Ti
         }
         properties.AddProperty(prop.mProperty);
 
         NS_ABORT_IF_FALSE(prop.mSegments.Length() > 0,
                           "property should not be in animations if it "
                           "has no segments");
 
         // FIXME: Maybe cache the current segment?
-        const AnimationPropertySegment *segment = prop.mSegments.Elements();
+        const AnimationPropertySegment *segment = prop.mSegments.Elements(),
+                               *segmentEnd = segment + prop.mSegments.Length();
         while (segment->mToKey < positionInIteration) {
           NS_ABORT_IF_FALSE(segment->mFromKey < segment->mToKey,
                             "incorrect keys");
           ++segment;
+          if (segment == segmentEnd) {
+            NS_ABORT_IF_FALSE(false, "incorrect positionInIteration");
+            break; // in order to continue in outer loop (just below)
+          }
           NS_ABORT_IF_FALSE(segment->mFromKey == (segment-1)->mToKey,
                             "incorrect keys");
         }
+        if (segment == segmentEnd) {
+          continue;
+        }
         NS_ABORT_IF_FALSE(segment->mFromKey < segment->mToKey,
                           "incorrect keys");
         NS_ABORT_IF_FALSE(segment - prop.mSegments.Elements() <
                             prop.mSegments.Length(),
                           "ran off end");
 
         if (!mStyleRule) {
           // Allocate the style rule now that we know we have animation data.
