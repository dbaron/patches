From: L. David Baron <dbaron@dbaron.org>

Bug 827687, patch 2:  Be more careful walking segments.

diff --git a/layout/style/nsAnimationManager.cpp b/layout/style/nsAnimationManager.cpp
--- a/layout/style/nsAnimationManager.cpp
+++ b/layout/style/nsAnimationManager.cpp
@@ -249,21 +249,26 @@ ElementAnimations::EnsureStyleRuleFor(Ti
         }
         properties.AddProperty(prop.mProperty);
 
         NS_ABORT_IF_FALSE(prop.mSegments.Length() > 0,
                           "property should not be in animations if it "
                           "has no segments");
 
         // FIXME: Maybe cache the current segment?
-        const AnimationPropertySegment *segment = prop.mSegments.Elements();
+        const AnimationPropertySegment *segment = prop.mSegments.Elements(),
+                               *segmentEnd = segment + prop.mSegments.Length();
         while (segment->mToKey < positionInIteration) {
           NS_ABORT_IF_FALSE(segment->mFromKey < segment->mToKey,
                             "incorrect keys");
           ++segment;
+          if (segment == segmentEnd) {
+            NS_ABORT_IF_FALSE(false, "incorrect positionInIteration");
+            continue;
+          }
           NS_ABORT_IF_FALSE(segment->mFromKey == (segment-1)->mToKey,
                             "incorrect keys");
         }
         NS_ABORT_IF_FALSE(segment->mFromKey < segment->mToKey,
                           "incorrect keys");
         NS_ABORT_IF_FALSE(segment - prop.mSegments.Elements() <
                             prop.mSegments.Length(),
                           "ran off end");
