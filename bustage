From: L. David Baron <dbaron@dbaron.org>

Add NS_FINAL_CLASS annotations to rule classes.  r=bzbarsky  Add virtual that I missed on nsCSSGroupRule.  (Bug 596140)  a=me

diff --git a/layout/style/nsCSSRules.cpp b/layout/style/nsCSSRules.cpp
--- a/layout/style/nsCSSRules.cpp
+++ b/layout/style/nsCSSRules.cpp
@@ -181,19 +181,19 @@ CSSGroupRuleRuleListImpl::Item(PRUint32 
 
   NS_ADDREF(*aReturn = rule);
   return NS_OK;
 }
 
 // -------------------------------------------
 // CharsetRule
 //
-class CSSCharsetRuleImpl : public nsCSSRule,
-                           public nsICSSRule,
-                           public nsIDOMCSSCharsetRule
+class NS_FINAL_CLASS CSSCharsetRuleImpl : public nsCSSRule,
+                                          public nsICSSRule,
+                                          public nsIDOMCSSCharsetRule
 {
 public:
   CSSCharsetRuleImpl(const nsAString& aEncoding);
   CSSCharsetRuleImpl(const CSSCharsetRuleImpl& aCopy);
 private:
   ~CSSCharsetRuleImpl() {}
 public:
   NS_DECL_ISUPPORTS
@@ -348,19 +348,19 @@ CSSCharsetRuleImpl::GetParentRule(nsIDOM
   return NS_OK;
 }
 
 
 
 // -------------------------------------------
 // nsICSSImportRule
 //
-class CSSImportRuleImpl : public nsCSSRule,
-                          public nsICSSImportRule,
-                          public nsIDOMCSSImportRule
+class NS_FINAL_CLASS CSSImportRuleImpl : public nsCSSRule,
+                                         public nsICSSImportRule,
+                                         public nsIDOMCSSImportRule
 {
 public:
   CSSImportRuleImpl(nsMediaList* aMedia);
   CSSImportRuleImpl(const CSSImportRuleImpl& aCopy);
 private:
   ~CSSImportRuleImpl();
 public:
 
@@ -1226,19 +1226,19 @@ nsCSSDocumentRule::UseForPresentation(ns
 nsCSSDocumentRule::URL::~URL()
 {
   NS_CSS_DELETE_LIST_MEMBER(nsCSSDocumentRule::URL, this, next);
 }
 
 // -------------------------------------------
 // nsICSSNameSpaceRule
 //
-class CSSNameSpaceRuleImpl : public nsCSSRule,
-                             public nsICSSNameSpaceRule,
-                             public nsIDOMCSSRule
+class NS_FINAL_CLASS CSSNameSpaceRuleImpl : public nsCSSRule,
+                                            public nsICSSNameSpaceRule,
+                                            public nsIDOMCSSRule
 {
 public:
   CSSNameSpaceRuleImpl(void);
   CSSNameSpaceRuleImpl(const CSSNameSpaceRuleImpl& aCopy);
 private:
   ~CSSNameSpaceRuleImpl();
 public:
   NS_DECL_ISUPPORTS
diff --git a/layout/style/nsCSSRules.h b/layout/style/nsCSSRules.h
--- a/layout/style/nsCSSRules.h
+++ b/layout/style/nsCSSRules.h
@@ -69,17 +69,17 @@ nsIDOMCSSRule* GetDOMRuleWeak(nsresult* 
 
 // inherits from nsCSSRule and also implements methods on nsICSSGroupRule
 // so they can be shared between nsCSSMediaRule and nsCSSDocumentRule
 class nsCSSGroupRule : public nsCSSRule, public nsICSSGroupRule
 {
 protected:
   nsCSSGroupRule();
   nsCSSGroupRule(const nsCSSGroupRule& aCopy);
-  ~nsCSSGroupRule();
+  virtual ~nsCSSGroupRule();
 
   // Implement part of nsISupports.
   NS_IMETHOD_(nsrefcnt) AddRef();
   NS_IMETHOD_(nsrefcnt) Release();
 protected:
   nsAutoRefCnt mRefCnt;
   NS_DECL_OWNINGTHREAD
 public:
@@ -116,18 +116,18 @@ protected:
   nsresult InsertRule(const nsAString & aRule, PRUint32 aIndex,
                       PRUint32* _retval);
   nsresult DeleteRule(PRUint32 aIndex);
 
   nsCOMArray<nsICSSRule> mRules;
   CSSGroupRuleRuleListImpl* mRuleCollection;
 };
 
-class nsCSSMediaRule : public nsCSSGroupRule,
-                       public nsIDOMCSSMediaRule
+class NS_FINAL_CLASS nsCSSMediaRule : public nsCSSGroupRule,
+                                      public nsIDOMCSSMediaRule
 {
 public:
   nsCSSMediaRule();
   nsCSSMediaRule(const nsCSSMediaRule& aCopy);
   virtual ~nsCSSMediaRule();
 
   NS_DECL_ISUPPORTS_INHERITED
 
@@ -158,18 +158,18 @@ public:
 
   // @media rule methods
   nsresult SetMedia(nsMediaList* aMedia);
   
 protected:
   nsRefPtr<nsMediaList> mMedia;
 };
 
-class nsCSSDocumentRule : public nsCSSGroupRule,
-                          public nsIDOMCSSMozDocumentRule
+class NS_FINAL_CLASS nsCSSDocumentRule : public nsCSSGroupRule,
+                                         public nsIDOMCSSMozDocumentRule
 {
 public:
   nsCSSDocumentRule(void);
   nsCSSDocumentRule(const nsCSSDocumentRule& aCopy);
   virtual ~nsCSSDocumentRule(void);
 
   NS_DECL_ISUPPORTS_INHERITED
 
@@ -252,19 +252,19 @@ protected:
 
 private:
   // NOT TO BE IMPLEMENTED
   // This object cannot be allocated on its own, only as part of
   // nsCSSFontFaceRule.
   void* operator new(size_t size) CPP_THROW_NEW;
 };
 
-class nsCSSFontFaceRule : public nsCSSRule,
-                          public nsICSSRule,
-                          public nsIDOMCSSFontFaceRule
+class NS_FINAL_CLASS nsCSSFontFaceRule : public nsCSSRule,
+                                         public nsICSSRule,
+                                         public nsIDOMCSSFontFaceRule
 {
 public:
   NS_DECL_ISUPPORTS
 
   // nsIStyleRule methods
 #ifdef DEBUG
   virtual void List(FILE* out = stdout, PRInt32 aIndent = 0) const;
 #endif
diff --git a/layout/style/nsCSSStyleRule.cpp b/layout/style/nsCSSStyleRule.cpp
--- a/layout/style/nsCSSStyleRule.cpp
+++ b/layout/style/nsCSSStyleRule.cpp
@@ -1265,18 +1265,18 @@ DOMCSSStyleRuleImpl::GetCSSStyleRule(nsI
 {
   *aResult = Rule();
   NS_IF_ADDREF(*aResult);
   return NS_OK;
 }
 
 // -- nsCSSStyleRule -------------------------------
 
-class CSSStyleRuleImpl : public nsCSSRule,
-                         public nsICSSStyleRule
+class NS_FINAL_CLASS CSSStyleRuleImpl : public nsCSSRule,
+                                        public nsICSSStyleRule
 {
 public:
   CSSStyleRuleImpl(nsCSSSelectorList* aSelector,
                    css::Declaration *aDeclaration);
 private:
   // for |Clone|
   CSSStyleRuleImpl(const CSSStyleRuleImpl& aCopy);
   // for |DeclarationChanged|
