From: L. David Baron <dbaron@dbaron.org>

Add test for bug 403443.

diff --git a/layout/base/tests/scrolling_helper.html b/layout/base/tests/scrolling_helper.html
--- a/layout/base/tests/scrolling_helper.html
+++ b/layout/base/tests/scrolling_helper.html
@@ -123,16 +123,40 @@ iframe {
 
 <div id="testTableNoBackground" class="testcase">
   <table style="position:fixed; width:200px; height:200px;">
     <tr><td></td></tr>
   </table>
   <div style="height:300px; background:-moz-linear-gradient(top, red, black);"></div>
 </div>
 
+<iframe class="testcase" id="testNoBlitInSVG" height="200" width="200"
+  src="data:text/html,<body class='testcase' style='margin-bottom: 500px'>This is a bunch of text inside of the IFRAME that is hopefully long enough to make it be scrollable, but, just in case, we'll have a big margin at the bottom too."></iframe>
+<script>
+// We're not in XHTML, so we have to make our SVG elements with script.
+var SVG_NS = "http://www.w3.org/2000/svg";
+var svg = document.createElementNS(SVG_NS, "svg");
+svg.setAttribute("style", "width: 300px; height: 300px");
+var g = document.createElementNS(SVG_NS, "g");
+g.setAttribute("transform", "translate(100,100) rotate(30)");
+var fo = document.createElementNS(SVG_NS, "foreignObject");
+fo.setAttribute("x", "0");
+fo.setAttribute("y", "0");
+fo.setAttribute("width", "100%");
+fo.setAttribute("height", "100%");
+var iframe = document.getElementById("testNoBlitInSVG");
+iframe.parentNode.replaceChild(svg, iframe);
+fo.appendChild(iframe);
+g.appendChild(fo);
+svg.appendChild(g);
+</script>
+
+<iframe class="testcase" id="testNoBlitInTransform" height="200" width="200" style="-moz-transform: rotate(30deg)"
+  src="data:text/html,<body class='testcase' style='margin-bottom: 500px'>This is a bunch of text inside of the IFRAME that is hopefully long enough to make it be scrollable, but, just in case, we'll have a big margin at the bottom too."></iframe>
+
 <script>
 var testcases = document.querySelectorAll("div.testcase");
 var tests = [];
 var iframes = document.querySelectorAll("iframe.testcase");
 
 var currentTest = -1;
 
 function ok(a, msg) {
@@ -304,16 +328,24 @@ function testHiddenTable(blitRegion, pai
 
 function testTableNoBackground(blitRegion, paintRegion) {
   ok(blitRegion.equalsRegion(new Region([[0,0,200,180]])),
      "Should blit everything that was already visible: " + blitRegion.toString());
   ok(paintRegion.equalsRegion(new Region([[0,180,200,200]])),
      "Should repaint area that was scrolled into view: " + paintRegion.toString());
 }
 
+function testNoBlitInSVG(blitRegion, paintRegion) {
+  ok(blitRegion.isEmpty(), "should not blit when in transformed SVG");
+}
+
+function testNoBlitInTransform(blitRegion, paintRegion) {
+  ok(blitRegion.isEmpty(), "should not blit when in CSS Transform");
+}
+
 function clientRectToRect(cr)
 {
   return [cr.left, cr.top, cr.right, cr.bottom];
 }
 
 function regionForReason(requests, reason)
 {
   var rects = [];
