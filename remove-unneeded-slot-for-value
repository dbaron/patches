From: L. David Baron <dbaron@dbaron.org>

Remove unneeded SlotForValue calls (since SlotForValue will soon require EnsureMutable has been called).  (Bug 522595)

diff --git a/layout/style/nsCSSDeclaration.h b/layout/style/nsCSSDeclaration.h
--- a/layout/style/nsCSSDeclaration.h
+++ b/layout/style/nsCSSDeclaration.h
@@ -143,21 +143,26 @@ public:
     NS_PRECONDITION(mData, "How did that happen?");
     if (nsCSSProps::IsShorthand(aProperty)) {
       return nsnull;
     }
 
     void* slot = mData->SlotForValue(aProperty);
 
     NS_ASSERTION(!slot || !mImportantData ||
-                 !mImportantData->SlotForValue(aProperty),
+                 !mImportantData->StorageFor(aProperty),
                  "Property both important and not?");
     return slot;
   }
 
+  PRBool HasNonImportantValueFor(nsCSSProperty aProperty) const {
+    NS_ABORT_IF_FALSE(nsCSSProps::IsShorthand(aProperty), "must be longhand");
+    return !!mData->StorageFor(aProperty);
+  }
+
   /**
    * Clear the data, in preparation for its replacement with entirely
    * new data by a call to |CompressFrom|.
    */
   void ClearData() {
     mData = nsnull;
     mImportantData = nsnull;
     mOrder.Clear();
diff --git a/layout/style/nsStyleAnimation.cpp b/layout/style/nsStyleAnimation.cpp
--- a/layout/style/nsStyleAnimation.cpp
+++ b/layout/style/nsStyleAnimation.cpp
@@ -802,18 +802,18 @@ BuildStyleRule(nsCSSProperty aProperty,
   // and delete the declaration.
   if (!declaration->InitializeEmpty() ||
       NS_FAILED(doc->CSSLoader()->GetParserFor(nsnull,
                                                getter_AddRefs(parser))) ||
       NS_FAILED(parser->ParseProperty(aProperty, aSpecifiedValue,
                                       doc->GetDocumentURI(), baseURI,
                                       aTargetElement->NodePrincipal(),
                                       declaration, &changed)) ||
-      // SlotForValue checks whether property parsed w/out CSS parsing errors
-      !declaration->SlotForValue(aProperty) ||
+      // check whether property parsed without CSS parsing errors
+      !declaration->HasNonImportantValueFor(aProperty) ||
       NS_FAILED(NS_NewCSSStyleRule(getter_AddRefs(styleRule), nsnull,
                                    declaration))) {
     NS_WARNING("failure in BuildStyleRule");
     declaration->RuleAbort();  // deletes declaration
     return nsnull;
   }
 
   return styleRule.forget();
