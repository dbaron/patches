Allow freelists to be non-empty following last ditch GC since JSGC_END callback happens with GC unlocked.  b=366975

diff -r 8e2d3f9f724f js/src/jsgc.c
--- a/js/src/jsgc.c	Fri Jan 12 17:25:37 2007 -0800
+++ b/js/src/jsgc.c	Sun Jan 14 11:02:22 2007 -0800
@@ -1460,9 +1460,8 @@ js_NewGCThing(JSContext *cx, uintN flags
              * barrier. The latter happens when GC is canceled due to
              * !gcCallback(cx, JSGC_BEGIN) or no gcPoke.
              */
-            if (rt->gcMallocBytes >= rt->gcMaxMallocBytes)
+            if (rt->gcMallocBytes >= rt->gcMaxMallocBytes || flbase[flindex])
                 break;
-            JS_ASSERT(!flbase[flindex]);
             tmpthing = arenaList->freeList;
             if (tmpthing) {
                 maxFreeThings = MAX_THREAD_LOCAL_THINGS;
@@ -1506,9 +1505,8 @@ js_NewGCThing(JSContext *cx, uintN flags
              * arena. Prefer to order free things by ascending address in the
              * (unscientific) hope of better cache locality.
              */
-            if (rt->gcMallocBytes >= rt->gcMaxMallocBytes)
+            if (rt->gcMallocBytes >= rt->gcMaxMallocBytes || flbase[flindex])
                 break;
-            JS_ASSERT(!flbase[flindex]);
             METER(nfree = 0);
             lastptr = &flbase[flindex];
             maxFreeThings = MAX_THREAD_LOCAL_THINGS;
