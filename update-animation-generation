From: L. David Baron <dbaron@dbaron.org>

Bug 847287 patch N - Update animation generation.

diff --git a/layout/style/nsAnimationManager.cpp b/layout/style/nsAnimationManager.cpp
--- a/layout/style/nsAnimationManager.cpp
+++ b/layout/style/nsAnimationManager.cpp
@@ -831,18 +831,20 @@ nsAnimationManager::UpdateCascadeResults
           // earlier animations.
           propertiesOverridden.AddProperty(prop.mProperty);
         }
       }
     }
   }
 
   if (changed) {
-    aElementAnimations->
-      UpdateAnimationGeneration(aElementAnimations->mManager->PresContext());
+    nsPresContext* presContext = aElementAnimations->mManager->PresContext();
+    presContext->RestyleManager()->IncrementAnimationGeneration();
+    aElementAnimations->UpdateAnimationGeneration(presContext);
+    aElementAnimations->PostResendToLayer();
   }
 }
 
 /* virtual */ void
 nsAnimationManager::WillRefresh(mozilla::TimeStamp aTime)
 {
   MOZ_ASSERT(mPresContext,
              "refresh driver should not notify additional observers "
diff --git a/layout/style/nsTransitionManager.cpp b/layout/style/nsTransitionManager.cpp
--- a/layout/style/nsTransitionManager.cpp
+++ b/layout/style/nsTransitionManager.cpp
@@ -687,17 +687,19 @@ nsTransitionManager::UpdateCascadeResult
 #ifdef DEBUG
     MOZ_ASSERT(!propertiesWithTransitions.HasProperty(prop.mProperty),
                "we're assuming we have only one transition per property");
     propertiesWithTransitions.AddProperty(prop.mProperty);
 #endif
   }
 
   if (changed) {
+    mPresContext->RestyleManager()->IncrementAnimationGeneration();
     aTransitions->UpdateAnimationGeneration(mPresContext);
+    aTransitions->PostResendToLayer();
 
     // Invalidate our style rule.
     aTransitions->mStyleRuleRefreshTime = TimeStamp();
     aTransitions->mNeedsRefreshes = true;
   }
 }
 
 /*
