From: L. David Baron <dbaron@dbaron.org>

Bug 960465 patch N - Pull CheckNeedsRefresh call out of the loop.

FIXME: Should this be resurrected from what I removed in a merge?

