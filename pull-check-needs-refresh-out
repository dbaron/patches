From: L. David Baron <dbaron@dbaron.org>

Bug 960465 patch N - Pull CheckNeedsRefresh call out of the loop.

diff --git a/layout/style/nsAnimationManager.cpp b/layout/style/nsAnimationManager.cpp
--- a/layout/style/nsAnimationManager.cpp
+++ b/layout/style/nsAnimationManager.cpp
@@ -1026,24 +1026,25 @@ nsAnimationManager::FlushAnimations(Flus
     bool canThrottleTick = aFlags == Can_Throttle &&
       ea->CanPerformOnCompositorThread(
         CommonElementAnimationData::CanAnimateFlags(0)) &&
       ea->CanThrottleAnimation(now);
 
     nsRefPtr<css::AnimValuesStyleRule> oldStyleRule = ea->mStyleRule;
     ea->EnsureStyleRuleFor(now, canThrottleTick);
     ea->GetEventsAt(now, mPendingEvents);
-    CheckNeedsRefresh();
     if (oldStyleRule != ea->mStyleRule) {
       ea->PostRestyleForAnimation(mPresContext);
     } else {
       didThrottle = true;
     }
   }
 
+  CheckNeedsRefresh();
+
   if (didThrottle) {
     mPresContext->Document()->SetNeedStyleFlush();
   }
 
   DispatchEvents(); // may destroy us
 }
 
 void
