From: L. David Baron <dbaron@dbaron.org>

Bug 837211 patch 3:  Add flag to control whether CSS properties are enabled, so that properties can be disabled without substantive code change.

diff --git a/dom/bindings/GenerateCSS2PropertiesWebIDL.py b/dom/bindings/GenerateCSS2PropertiesWebIDL.py
--- a/dom/bindings/GenerateCSS2PropertiesWebIDL.py
+++ b/dom/bindings/GenerateCSS2PropertiesWebIDL.py
@@ -6,16 +6,17 @@ import sys
 import string
 
 propList = eval(sys.stdin.read())
 props = ""
 for [prop, pref] in propList:
     extendedAttrs = ["Throws", "TreatNullAs=EmptyString"]
     if pref is not "":
         extendedAttrs.append('Pref="%s"' % pref)
+    # FIXME: CHECK FLAG!
     if not prop.startswith("Moz"):
         prop = prop[0].lower() + prop[1:]
     # Unfortunately, even some of the getters here are fallible
     # (e.g. on nsComputedDOMStyle).
     props += "  [%s] attribute DOMString %s;\n" % (", ".join(extendedAttrs),
                                                    prop)
 
 idlFile = open(sys.argv[1], "r");
diff --git a/layout/style/nsCSSPropAliasList.h b/layout/style/nsCSSPropAliasList.h
--- a/layout/style/nsCSSPropAliasList.h
+++ b/layout/style/nsCSSPropAliasList.h
@@ -29,18 +29,20 @@
   nsCSSPropList.h, prefixes should just be included in this file (rather
   than needing the CSS_PROP_DOMPROP_PREFIXED(prop) macro).
 
   -. 'flags' is a flags word, as for properties.  Currently only
   CSS_PROPERTY_DISABLED_BY_DEFAULT is supported, and the flags are
   not otherwise available for aliases.
 
   -. 'pref' is the name of a pref that controls whether the property
-  is enabled.  The property is enabled if 'pref' is an empty string,
-  or if the boolean property whose name is 'pref' is set to true.
+  is enabled.  If 'pref' is a non-empty string, then the property is
+  enabled if a boolean preference with that name exists and is true.
+  Otherwise is it enabled iff the CSS_PROPERTY_DISABLED_BY_DEFAULT
+  property flag is not set.
 
  ******/
 
 CSS_PROP_ALIAS(-moz-transform-origin,
                transform_origin,
                MozTransformOrigin,
                0,
               "layout.css.prefixes.transforms")
diff --git a/layout/style/nsCSSPropList.h b/layout/style/nsCSSPropList.h
--- a/layout/style/nsCSSPropList.h
+++ b/layout/style/nsCSSPropList.h
@@ -35,18 +35,20 @@
   parameter must also define the CSS_PROP_PUBLIC_OR_PRIVATE(publicname_,
   privatename_) macro to yield either publicname_ or privatename_.
   The names differ in that publicname_ has Moz prefixes where they are
   used, and also in CssFloat vs. Float.  The caller's choice depends on
   whether the use is for internal use such as eCSSProperty_* or
   nsRuleData::ValueFor* or external use such as exposing DOM properties.
 
   -. 'pref' is the name of a pref that controls whether the property
-  is enabled.  The property is enabled if 'pref' is an empty string,
-  or if the boolean property whose name is 'pref' is set to true.
+  is enabled.  If 'pref' is a non-empty string, then the property is
+  enabled if a boolean preference with that name exists and is true.
+  Otherwise is it enabled iff the CSS_PROPERTY_DISABLED_BY_DEFAULT
+  property flag is not set.
 
   -. 'flags', a bitfield containing CSS_PROPERTY_* flags.
 
   -. 'parsevariant', to be passed to ParseVariant in the parser.
 
   -. 'kwtable', which is either nullptr or the name of the appropriate
   keyword table member of class nsCSSProps, for use in
   nsCSSProps::LookupPropertyValue.
diff --git a/layout/style/nsCSSProps.cpp b/layout/style/nsCSSProps.cpp
--- a/layout/style/nsCSSProps.cpp
+++ b/layout/style/nsCSSProps.cpp
@@ -2471,22 +2471,22 @@ nsCSSProps::gPropertyIndexInStruct[eCSSP
   #undef CSS_PROP_BACKENDONLY
 
 };
 
 /* static */ bool
 nsCSSProps::gPropertyEnabled[eCSSProperty_COUNT_with_aliases] = {
   #define CSS_PROP(name_, id_, method_, flags_, pref_, parsevariant_,     \
                    kwtable_, stylestruct_, stylestructoffset_, animtype_) \
-    true,
+    !(pref_)[0] && !((flags_) & CSS_PROPERTY_DISABLED_BY_DEFAULT),
   #include "nsCSSPropList.h"
   #undef CSS_PROP
 
   #define  CSS_PROP_SHORTHAND(name_, id_, method_, flags_, pref_) \
-    true,
+    !(pref_)[0] && !((flags_) & CSS_PROPERTY_DISABLED_BY_DEFAULT),
   #include "nsCSSPropList.h"
   #undef CSS_PROP_SHORTHAND
 
   #define CSS_PROP_ALIAS(aliasname_, propid_, aliasmethod_, flags_, pref_) \
-    true,
+    !(pref_)[0] && !((flags_) & CSS_PROPERTY_DISABLED_BY_DEFAULT),
   #include "nsCSSPropAliasList.h"
   #undef CSS_PROP_ALIAS
 };
diff --git a/layout/style/nsCSSProps.h b/layout/style/nsCSSProps.h
--- a/layout/style/nsCSSProps.h
+++ b/layout/style/nsCSSProps.h
@@ -102,16 +102,20 @@ MOZ_STATIC_ASSERT((CSS_PROPERTY_PARSE_PR
 #define CSS_PROPERTY_IS_ALIAS                     (1<<17)
 
 // Does the property apply to ::-moz-placeholder?
 #define CSS_PROPERTY_APPLIES_TO_PLACEHOLDER       (1<<18)
 
 // This property is allowed in an @page rule.
 #define CSS_PROPERTY_APPLIES_TO_PAGE_RULE         (1<<19)
 
+// This property is disabled by default (see also pref field in
+// nsCSSPropList.h and nsCSSPropAliasList.h).
+#define CSS_PROPERTY_DISABLED_BY_DEFAULT          (1<<20)
+
 /**
  * Types of animatable values.
  */
 enum nsStyleAnimType {
   // requires a custom implementation in
   // nsStyleAnimation::ExtractComputedValue
   eStyleAnimType_Custom,
 
