From: L. David Baron <dbaron@dbaron.org>

Check all open windows between browser tests rather than just browser windows.  (FIXME: TEST-UNEXPECTED-FAIL | chrome://mochikit/content/browser/browser/components/test/browser/browser_bug538331.js | Found an unexpected window chrome://global/content/alerts/alert.xul at the end of test run)

diff --git a/testing/mochitest/browser-test.js b/testing/mochitest/browser-test.js
--- a/testing/mochitest/browser-test.js
+++ b/testing/mochitest/browser-test.js
@@ -82,21 +82,22 @@ Tester.prototype = {
         let msg = baseMsg.replace("{elt}", "tab") +
                   ": " + lastTab.linkedBrowser.currentURI.spec;
         this.currentTest.addResult(new testResult(false, msg, "", false));
         gBrowser.removeTab(lastTab);
       }
     }
 
     this.dumper.dump("TEST-INFO | checking window state\n");
-    let windowsEnum = this._wm.getEnumerator("navigator:browser");
+    let windowsEnum = this._wm.getEnumerator(null);
     while (windowsEnum.hasMoreElements()) {
       let win = windowsEnum.getNext();
-      if (win != window && !win.closed) {
-        let msg = baseMsg.replace("{elt}", "browser window");
+      if (!win.closed && win != window &&
+          win.location != "chrome://mochikit/content/browser-harness.xul") {
+        let msg = baseMsg.replace("{elt}", "window") + " " + win.location;
         if (this.currentTest)
           this.currentTest.addResult(new testResult(false, msg, "", false));
         else
           this.dumper.dump("TEST-UNEXPECTED-FAIL | (browser-test.js) | " + msg + "\n");
 
         win.close();
       }
     }
