From: L. David Baron <dbaron@dbaron.org>

Check all open windows between browser tests rather than just browser windows.

diff --git a/testing/mochitest/browser-test.js b/testing/mochitest/browser-test.js
--- a/testing/mochitest/browser-test.js
+++ b/testing/mochitest/browser-test.js
@@ -75,21 +75,22 @@ Tester.prototype = {
       let msg = "Found " + (gBrowser.tabs.length - 1) +
                 " unexpected tab(s) at the end of test run";      
       this.currentTest.addResult(new testResult(false, msg, "", false));
       while (gBrowser.tabs.length > 1)
         gBrowser.removeTab(gBrowser.tabContainer.lastChild);
     }
 
     this.dumper.dump("TEST-INFO | checking window state\n");
-    let windowsEnum = this._wm.getEnumerator("navigator:browser");
+    let windowsEnum = this._wm.getEnumerator(null);
     while (windowsEnum.hasMoreElements()) {
       let win = windowsEnum.getNext();
-      if (win != window && !win.closed) {
-        let msg = "Found an unexpected browser window";
+      if (!win.closed && win != window &&
+          win.location != "chrome://mochikit/content/browser-harness.xul") {
+        let msg = "Found an unexpected window " + win.location;
         if (this.currentTest) {
           msg += " at the end of test run";
           this.currentTest.addResult(new testResult(false, msg, "", false));
         }
         else
           this.dumper.dump("TEST-UNEXPECTED-FAIL | (browser-test.js) | " + msg + "\n");
 
         win.close();
