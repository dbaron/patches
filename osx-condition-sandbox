From: L. David Baron <dbaron@dbaron.org>

Bug 1121327 - Make the OSX variable in the reftest condition sandbox be an integer (1006, 1010) so that it scales for 10.10, and undefined for non-Mac rather than 0.

diff --git a/layout/generic/nsRubyBaseContainerFrame.cpp b/layout/generic/nsRubyBaseContainerFrame.cpp
--- a/layout/generic/nsRubyBaseContainerFrame.cpp
+++ b/layout/generic/nsRubyBaseContainerFrame.cpp
@@ -260,16 +260,19 @@ nsRubyBaseContainerFrame::AddInlinePrefI
     }
   }
   aData->currentLine += sum;
 }
 
 /* virtual */ bool 
 nsRubyBaseContainerFrame::IsFrameOfType(uint32_t aFlags) const 
 {
+  if (aFlags & eSupportsCSSTransforms) {
+    return false;
+  }
   return nsContainerFrame::IsFrameOfType(aFlags & 
          ~(nsIFrame::eLineParticipant));
 }
 
 void
 nsRubyBaseContainerFrame::GetTextContainers(TextContainerArray& aTextContainers)
 {
   MOZ_ASSERT(aTextContainers.IsEmpty());
diff --git a/layout/tools/reftest/reftest.js b/layout/tools/reftest/reftest.js
--- a/layout/tools/reftest/reftest.js
+++ b/layout/tools/reftest/reftest.js
@@ -663,19 +663,22 @@ function BuildConditionSandbox(aURL) {
     var hh = CC[NS_NETWORK_PROTOCOL_CONTRACTID_PREFIX + "http"].
                  getService(CI.nsIHttpProtocolHandler);
     var httpProps = ["userAgent", "appName", "appVersion", "vendor",
                      "vendorSub", "product", "productSub", "platform",
                      "oscpu", "language", "misc"];
     sandbox.http = new sandbox.Object();
     httpProps.forEach((x) => sandbox.http[x] = hh[x]);
 
-    // Set OSX to the Mac OS X version for Mac, and 0 otherwise.
-    var osxmatch = /Mac OS X (\d+.\d+)$/.exec(hh.oscpu);
-    sandbox.OSX = osxmatch ? parseFloat(osxmatch[1]) : 0;
+    // Set OSX to be the Mac OS X verion, as an integer, or undefined
+    // for other platforms.  The integer is formed by 100 times the
+    // major verion plus the minor version, so 1006 for 10.6, 1010 for
+    // 10.10, etc.
+    var osxmatch = /Mac OS X (\d+).(\d+)$/.exec(hh.oscpu);
+    sandbox.OSX = osxmatch ? parseInt(osxmatch[1]) * 100 + parseInt(osxmatch[2]) : 0;
 
     // see if we have the test plugin available,
     // and set a sandox prop accordingly
     var navigator = gContainingWindow.navigator;
     var testPlugin = navigator.plugins["Test Plug-in"];
     sandbox.haveTestPlugin = !!testPlugin;
 
     // Set a flag on sandbox if the windows default theme is active
