Make cycle collector shut down more cleanly.

diff --git a/xpcom/base/nsCycleCollector.cpp b/xpcom/base/nsCycleCollector.cpp
--- a/xpcom/base/nsCycleCollector.cpp
+++ b/xpcom/base/nsCycleCollector.cpp
@@ -1380,9 +1380,6 @@ nsCycleCollector::nsCycleCollector() :
 
 nsCycleCollector::~nsCycleCollector()
 {
-    if (this == sCollector)
-        sCollector = nsnull;
-
     mGraph.Clear();    
 
     for (PRUint32 i = 0; i < nsIProgrammingLanguage::MAX+1; ++i) {
@@ -1886,6 +1883,9 @@ nsCycleCollector_shutdown()
 nsCycleCollector_shutdown()
 {
     getCollector()->Shutdown();
+
+    delete sCollector;
+    sCollector = nsnull;
 }
 
 #ifdef DEBUG
