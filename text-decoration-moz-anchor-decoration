Fix serialization bugs with text-decoration:-moz-anchor-decoration.  (Bug 481596)  r+sr=bzbarsky

diff --git a/layout/base/nsStyleConsts.h b/layout/base/nsStyleConsts.h
--- a/layout/base/nsStyleConsts.h
+++ b/layout/base/nsStyleConsts.h
@@ -600,18 +600,20 @@
 // the smallest NS_STYLE_VERTICAL_ALIGN_* value below!
 
 // See nsStyleText, nsStyleFont
 #define NS_STYLE_TEXT_DECORATION_NONE           0
 #define NS_STYLE_TEXT_DECORATION_UNDERLINE      NS_FONT_DECORATION_UNDERLINE
 #define NS_STYLE_TEXT_DECORATION_OVERLINE       NS_FONT_DECORATION_OVERLINE
 #define NS_STYLE_TEXT_DECORATION_LINE_THROUGH   NS_FONT_DECORATION_LINE_THROUGH
 #define NS_STYLE_TEXT_DECORATION_BLINK          0x08
-#define NS_STYLE_TEXT_DECORATION_OVERRIDE_ALL   0x10
-#define NS_STYLE_TEXT_DECORATION_PREF_ANCHORS   0x20
+#define NS_STYLE_TEXT_DECORATION_PREF_ANCHORS   0x10
+// OVERRIDE_ALL does not occur in stylesheets; it only comes from HTML
+// attribute mapping (and thus appears in computed data)
+#define NS_STYLE_TEXT_DECORATION_OVERRIDE_ALL   0x20
 #define NS_STYLE_TEXT_DECORATION_LINES_MASK     (NS_STYLE_TEXT_DECORATION_UNDERLINE | NS_STYLE_TEXT_DECORATION_OVERLINE | NS_STYLE_TEXT_DECORATION_LINE_THROUGH)
 
 // See nsStyleText
 #define NS_STYLE_TEXT_TRANSFORM_NONE            0
 #define NS_STYLE_TEXT_TRANSFORM_CAPITALIZE      1
 #define NS_STYLE_TEXT_TRANSFORM_LOWERCASE       2
 #define NS_STYLE_TEXT_TRANSFORM_UPPERCASE       3
 
diff --git a/layout/style/nsCSSDeclaration.cpp b/layout/style/nsCSSDeclaration.cpp
--- a/layout/style/nsCSSDeclaration.cpp
+++ b/layout/style/nsCSSDeclaration.cpp
@@ -310,17 +310,17 @@ nsCSSDeclaration::AppendCSSValueToString
   }
   else if (eCSSUnit_Enumerated == unit) {
     if (eCSSProperty_text_decoration == aProperty) {
       PRInt32 intValue = aValue.GetIntValue();
       NS_ABORT_IF_FALSE(NS_STYLE_TEXT_DECORATION_NONE != intValue,
                         "none should be parsed as eCSSUnit_None");
       PRInt32 mask;
       for (mask = NS_STYLE_TEXT_DECORATION_UNDERLINE;
-           mask <= NS_STYLE_TEXT_DECORATION_BLINK; 
+           mask <= NS_STYLE_TEXT_DECORATION_PREF_ANCHORS; 
            mask <<= 1) {
         if ((mask & intValue) == mask) {
           AppendASCIItoUTF16(nsCSSProps::LookupPropertyValue(aProperty, mask), aResult);
           intValue &= ~mask;
           if (0 != intValue) { // more left
             aResult.Append(PRUnichar(' '));
           }
         }
diff --git a/layout/style/test/property_database.js b/layout/style/test/property_database.js
--- a/layout/style/test/property_database.js
+++ b/layout/style/test/property_database.js
@@ -1663,17 +1663,17 @@ var gCSSProperties = {
 		other_values: [ "center", "justify", "end" ],
 		invalid_values: []
 	},
 	"text-decoration": {
 		domProp: "textDecoration",
 		inherited: false,
 		type: CSS_TYPE_LONGHAND,
 		initial_values: [ "none" ],
-		other_values: [ "underline", "overline", "line-through", "blink line-through underline", "underline overline line-through blink" ],
+		other_values: [ "underline", "overline", "line-through", "blink line-through underline", "underline overline line-through blink", "-moz-anchor-decoration", "blink -moz-anchor-decoration" ],
 		invalid_values: [ "underline none", "none underline", "line-through blink line-through" ]
 	},
 	"text-indent": {
 		domProp: "textIndent",
 		inherited: true,
 		type: CSS_TYPE_LONGHAND,
 		initial_values: [ "0" ],
 		other_values: [ "2em", "5%", "-10px" ],
