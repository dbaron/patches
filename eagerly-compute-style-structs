From: L. David Baron <dbaron@dbaron.org>

Eagerly compute style structs during style context construction.

MozReview-Commit-ID: 8lKlezEVW9d

diff --git a/layout/style/nsStyleContext.cpp b/layout/style/nsStyleContext.cpp
--- a/layout/style/nsStyleContext.cpp
+++ b/layout/style/nsStyleContext.cpp
@@ -165,16 +165,23 @@ nsStyleContext::FinishConstruction(bool 
   mPrevSibling = this;
   if (mParent) {
     mParent->AddChild(this);
   }
 
   SetStyleBits();
   if (!mSource.IsServoComputedValues()) {
     ApplyStyleFixups(aSkipParentDisplayBasedStyleFixup);
+
+    // Eagerly compute all the style structs, both to improve memory
+    // locality during struct computation and to improve it during use
+    // of structs.
+#define STYLE_STRUCT(name_, checkdata_cb_) Style##name_();
+#include "nsStyleStructList.h"
+#undef STYLE_STRUCT
   }
 
   #define eStyleStruct_LastItem (nsStyleStructID_Length - 1)
   NS_ASSERTION(NS_STYLE_INHERIT_MASK & NS_STYLE_INHERIT_BIT(LastItem),
                "NS_STYLE_INHERIT_MASK must be bigger, and other bits shifted");
   #undef eStyleStruct_LastItem
 }
 
