From: L. David Baron <dbaron@dbaron.org>

Ensure intrinsic size is always initialized.  (Bug 541028)  r=bzbarsky

diff --git a/layout/generic/nsImageFrame.cpp b/layout/generic/nsImageFrame.cpp
--- a/layout/generic/nsImageFrame.cpp
+++ b/layout/generic/nsImageFrame.cpp
@@ -274,18 +274,20 @@ PRBool
 nsImageFrame::UpdateIntrinsicSize(imgIContainer* aImage)
 {
   NS_PRECONDITION(aImage, "null image");
 
   PRBool intrinsicSizeChanged = PR_FALSE;
   
   if (aImage) {
     nsIntSize imageSizeInPx;
-    aImage->GetWidth(&imageSizeInPx.width);
-    aImage->GetHeight(&imageSizeInPx.height);
+    if (NS_FAILED(aImage->GetWidth(&imageSizeInPx.width)) ||
+        NS_FAILED(aImage->GetHeight(&imageSizeInPx.height))) {
+      imageSizeInPx.SizeTo(0, 0);
+    }
     nsSize newSize(nsPresContext::CSSPixelsToAppUnits(imageSizeInPx.width),
                    nsPresContext::CSSPixelsToAppUnits(imageSizeInPx.height));
     if (mIntrinsicSize != newSize) {
       intrinsicSizeChanged = PR_TRUE;
       mIntrinsicSize = newSize;
     }
   }
 
