From: L. David Baron <dbaron@dbaron.org>

Bug 1157455 patch 1 - Add tests for OMTA transforms in degrees in addition to those in radians.  r=birtles

In bug 1156456 I landed tests with the transform in radians to work
around float rounding issues with having the transform in degrees.  This
bug will fix the problems with degrees, so I'm duplicating the tests
here to have variants with both degrees and radians.

diff --git a/layout/reftests/transform-3d/animate-cube-ref.html b/layout/reftests/transform-3d/animate-cube-degrees-ref.html
rename from layout/reftests/transform-3d/animate-cube-ref.html
rename to layout/reftests/transform-3d/animate-cube-degrees-ref.html
--- a/layout/reftests/transform-3d/animate-cube-ref.html
+++ b/layout/reftests/transform-3d/animate-cube-degrees-ref.html
@@ -17,21 +17,17 @@ div, div::before, div::after {
 }
 
 div {
   position: absolute;
   top: 0; right: 0; bottom: 0; left: 0;
   margin: auto;
   transform-origin: 50% 50% 100px;
   background: #006;
-  /* FIXME: use radians rather than degrees for now to avoid the rounding
-     issue described in
-     https://bugzilla.mozilla.org/show_bug.cgi?id=1156456#c19 */
-  /* transform: rotateY(-120deg) rotateX(60deg); */
-  transform: rotateY(-2.0944rad) rotateX(1.0472rad);
+  transform: rotateY(-120deg) rotateX(60deg);
   transform-style: preserve-3d;
 }
 
 div::before, div::after {
   position: absolute;
   top: 0; left: 0;
   content: "";
 }
diff --git a/layout/reftests/transform-3d/animate-cube-zoom-ref.html b/layout/reftests/transform-3d/animate-cube-degrees-zoom-ref.html
rename from layout/reftests/transform-3d/animate-cube-zoom-ref.html
rename to layout/reftests/transform-3d/animate-cube-degrees-zoom-ref.html
--- a/layout/reftests/transform-3d/animate-cube-zoom-ref.html
+++ b/layout/reftests/transform-3d/animate-cube-degrees-zoom-ref.html
@@ -17,21 +17,17 @@ div, div::before, div::after {
 }
 
 div {
   position: absolute;
   top: 0; right: 0; bottom: 0; left: 0;
   margin: auto;
   transform-origin: 50% 50% 100px;
   background: #006;
-  /* FIXME: use radians rather than degrees for now to avoid the rounding
-     issue described in
-     https://bugzilla.mozilla.org/show_bug.cgi?id=1156456#c19 */
-  /* transform: rotateY(-120deg) rotateX(60deg); */
-  transform: rotateY(-2.0944rad) rotateX(1.0472rad);
+  transform: rotateY(-120deg) rotateX(60deg);
   transform-style: preserve-3d;
 }
 
 div::before, div::after {
   position: absolute;
   top: 0; left: 0;
   content: "";
 }
diff --git a/layout/reftests/transform-3d/animate-cube-zoom.html b/layout/reftests/transform-3d/animate-cube-degrees-zoom.html
rename from layout/reftests/transform-3d/animate-cube-zoom.html
rename to layout/reftests/transform-3d/animate-cube-degrees-zoom.html
--- a/layout/reftests/transform-3d/animate-cube-zoom.html
+++ b/layout/reftests/transform-3d/animate-cube-degrees-zoom.html
@@ -13,21 +13,17 @@ body {
 }
 
 div, div::before, div::after {
   width: 200px; height: 200px;
 }
 
 @keyframes HoldTransform {
   from, to {
-    /* FIXME: use radians rather than degrees for now to avoid the rounding
-       issue described in
-       https://bugzilla.mozilla.org/show_bug.cgi?id=1156456#c19 */
-    /* transform: rotateY(-120deg) rotateX(60deg); */
-    transform: rotateY(-2.0944rad) rotateX(1.0472rad);
+    transform: rotateY(-120deg) rotateX(60deg);
   }
 }
 
 div {
   position: absolute;
   top: 0; right: 0; bottom: 0; left: 0;
   margin: auto;
   transform-origin: 50% 50% 100px;
diff --git a/layout/reftests/transform-3d/animate-cube.html b/layout/reftests/transform-3d/animate-cube-degrees.html
rename from layout/reftests/transform-3d/animate-cube.html
rename to layout/reftests/transform-3d/animate-cube-degrees.html
--- a/layout/reftests/transform-3d/animate-cube.html
+++ b/layout/reftests/transform-3d/animate-cube-degrees.html
@@ -13,21 +13,17 @@ body {
 }
 
 div, div::before, div::after {
   width: 200px; height: 200px;
 }
 
 @keyframes HoldTransform {
   from, to {
-    /* FIXME: use radians rather than degrees for now to avoid the rounding
-       issue described in
-       https://bugzilla.mozilla.org/show_bug.cgi?id=1156456#c19 */
-    /* transform: rotateY(-120deg) rotateX(60deg); */
-    transform: rotateY(-2.0944rad) rotateX(1.0472rad);
+    transform: rotateY(-120deg) rotateX(60deg);
   }
 }
 
 div {
   position: absolute;
   top: 0; right: 0; bottom: 0; left: 0;
   margin: auto;
   transform-origin: 50% 50% 100px;
diff --git a/layout/reftests/transform-3d/animate-cube-ref.html b/layout/reftests/transform-3d/animate-cube-radians-ref.html
copy from layout/reftests/transform-3d/animate-cube-ref.html
copy to layout/reftests/transform-3d/animate-cube-radians-ref.html
--- a/layout/reftests/transform-3d/animate-cube-ref.html
+++ b/layout/reftests/transform-3d/animate-cube-radians-ref.html
@@ -17,20 +17,17 @@ div, div::before, div::after {
 }
 
 div {
   position: absolute;
   top: 0; right: 0; bottom: 0; left: 0;
   margin: auto;
   transform-origin: 50% 50% 100px;
   background: #006;
-  /* FIXME: use radians rather than degrees for now to avoid the rounding
-     issue described in
-     https://bugzilla.mozilla.org/show_bug.cgi?id=1156456#c19 */
-  /* transform: rotateY(-120deg) rotateX(60deg); */
+  /* approximately rotateY(-120deg) rotateX(60deg); */
   transform: rotateY(-2.0944rad) rotateX(1.0472rad);
   transform-style: preserve-3d;
 }
 
 div::before, div::after {
   position: absolute;
   top: 0; left: 0;
   content: "";
diff --git a/layout/reftests/transform-3d/animate-cube-zoom-ref.html b/layout/reftests/transform-3d/animate-cube-radians-zoom-ref.html
copy from layout/reftests/transform-3d/animate-cube-zoom-ref.html
copy to layout/reftests/transform-3d/animate-cube-radians-zoom-ref.html
--- a/layout/reftests/transform-3d/animate-cube-zoom-ref.html
+++ b/layout/reftests/transform-3d/animate-cube-radians-zoom-ref.html
@@ -17,20 +17,17 @@ div, div::before, div::after {
 }
 
 div {
   position: absolute;
   top: 0; right: 0; bottom: 0; left: 0;
   margin: auto;
   transform-origin: 50% 50% 100px;
   background: #006;
-  /* FIXME: use radians rather than degrees for now to avoid the rounding
-     issue described in
-     https://bugzilla.mozilla.org/show_bug.cgi?id=1156456#c19 */
-  /* transform: rotateY(-120deg) rotateX(60deg); */
+  /* approximately rotateY(-120deg) rotateX(60deg); */
   transform: rotateY(-2.0944rad) rotateX(1.0472rad);
   transform-style: preserve-3d;
 }
 
 div::before, div::after {
   position: absolute;
   top: 0; left: 0;
   content: "";
diff --git a/layout/reftests/transform-3d/animate-cube-zoom.html b/layout/reftests/transform-3d/animate-cube-radians-zoom.html
copy from layout/reftests/transform-3d/animate-cube-zoom.html
copy to layout/reftests/transform-3d/animate-cube-radians-zoom.html
--- a/layout/reftests/transform-3d/animate-cube-zoom.html
+++ b/layout/reftests/transform-3d/animate-cube-radians-zoom.html
@@ -13,20 +13,17 @@ body {
 }
 
 div, div::before, div::after {
   width: 200px; height: 200px;
 }
 
 @keyframes HoldTransform {
   from, to {
-    /* FIXME: use radians rather than degrees for now to avoid the rounding
-       issue described in
-       https://bugzilla.mozilla.org/show_bug.cgi?id=1156456#c19 */
-    /* transform: rotateY(-120deg) rotateX(60deg); */
+    /* approximately rotateY(-120deg) rotateX(60deg); */
     transform: rotateY(-2.0944rad) rotateX(1.0472rad);
   }
 }
 
 div {
   position: absolute;
   top: 0; right: 0; bottom: 0; left: 0;
   margin: auto;
diff --git a/layout/reftests/transform-3d/animate-cube.html b/layout/reftests/transform-3d/animate-cube-radians.html
copy from layout/reftests/transform-3d/animate-cube.html
copy to layout/reftests/transform-3d/animate-cube-radians.html
--- a/layout/reftests/transform-3d/animate-cube.html
+++ b/layout/reftests/transform-3d/animate-cube-radians.html
@@ -13,20 +13,17 @@ body {
 }
 
 div, div::before, div::after {
   width: 200px; height: 200px;
 }
 
 @keyframes HoldTransform {
   from, to {
-    /* FIXME: use radians rather than degrees for now to avoid the rounding
-       issue described in
-       https://bugzilla.mozilla.org/show_bug.cgi?id=1156456#c19 */
-    /* transform: rotateY(-120deg) rotateX(60deg); */
+    /* approximately rotateY(-120deg) rotateX(60deg); */
     transform: rotateY(-2.0944rad) rotateX(1.0472rad);
   }
 }
 
 div {
   position: absolute;
   top: 0; right: 0; bottom: 0; left: 0;
   margin: auto;
diff --git a/layout/reftests/transform-3d/reftest.list b/layout/reftests/transform-3d/reftest.list
--- a/layout/reftests/transform-3d/reftest.list
+++ b/layout/reftests/transform-3d/reftest.list
@@ -52,11 +52,14 @@ fuzzy-if(winWidget&&!layersGPUAccelerate
 == rotatex-transformorigin-1a.html rotatex-transformorigin-1-ref.html
 fuzzy-if((gtk2Widget&&layersOMTC)||(winWidget&&!layersGPUAccelerated),1,86) == overflow-hidden-1a.html overflow-hidden-1-ref.html
 == transform-style-flat-1a.html transform-style-flat-1-ref.html
 pref(layout.css.will-change.enabled,true) == willchange-containing-block.html?willchange willchange-containing-block.html?ref
 pref(layout.css.will-change.enabled,true) != willchange-containing-block.html?willchange willchange-containing-block.html?noblock
 fuzzy-if(winWidget&&!layersGPUAccelerated,1,606) == scroll-perspective-1.html scroll-perspective-1-ref.html
 # Bugs
 fails-if(!layersGPUAccelerated) == 1035611-1.html 1035611-1-ref.html # Bug 1072898 for !layersGPUAccelerated failures
-== animate-cube.html animate-cube-ref.html
-fuzzy-if(/^Windows\x20NT\x206\.1/.test(http.oscpu)&&!layersGPUAccelerated,16,6) fuzzy-if(Mulet,16,9) == animate-cube-zoom.html animate-cube-zoom-ref.html
-!= animate-cube-ref.html animate-cube-zoom-ref.html
+== animate-cube-radians.html animate-cube-radians-ref.html
+fuzzy-if(/^Windows\x20NT\x206\.1/.test(http.oscpu)&&!layersGPUAccelerated,16,6) fuzzy-if(Mulet,16,9) == animate-cube-radians-zoom.html animate-cube-radians-zoom-ref.html
+!= animate-cube-radians-ref.html animate-cube-radians-zoom-ref.html
+random == animate-cube-degrees.html animate-cube-degrees-ref.html # Bug 1157455
+random == animate-cube-degrees-zoom.html animate-cube-degrees-zoom-ref.html # Bug 1157455
+!= animate-cube-degrees-ref.html animate-cube-degrees-zoom-ref.html
