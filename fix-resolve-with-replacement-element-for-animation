From: L. David Baron <dbaron@dbaron.org>

Bug 996796 patch 13 - Fix the aElementForAnimation passed from ResolveStyleWithReplacement.

FIXME: WRITE ME

diff --git a/layout/style/nsStyleSet.cpp b/layout/style/nsStyleSet.cpp
--- a/layout/style/nsStyleSet.cpp
+++ b/layout/style/nsStyleSet.cpp
@@ -1428,16 +1428,22 @@ nsStyleSet::ResolveStyleWithReplacement(
   uint32_t flags = eNoFlags;
   if (aOldStyleContext->IsLinkContext()) {
     flags |= eIsLink;
   }
   if (aOldStyleContext->RelevantLinkVisited()) {
     flags |= eIsVisitedLink;
   }
 
+  if (pseudoType == nsCSSPseudoElements::ePseudo_NotPseudoElement ||
+      pseudoType == nsCSSPseudoElements::ePseudo_before ||
+      pseudoType == nsCSSPseudoElements::ePseudo_after) {
+    flags |= eDoAnimation;
+  }
+
   return GetContext(aNewParentStyleContext, ruleNode, visitedRuleNode,
                     aOldStyleContext->GetPseudo(),
                     aOldStyleContext->GetPseudoType(),
                     nullptr, flags);
 }
 
 
 already_AddRefed<nsStyleContext>
