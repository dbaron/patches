From: L. David Baron <dbaron@dbaron.org>

Bug 996796 patch 14 - Fix the aElementForAnimation passed from ResolveStyleWithReplacement.

FIXME: WRITE ME

diff --git a/layout/style/nsStyleSet.cpp b/layout/style/nsStyleSet.cpp
--- a/layout/style/nsStyleSet.cpp
+++ b/layout/style/nsStyleSet.cpp
@@ -1436,16 +1436,23 @@ nsStyleSet::ResolveStyleWithReplacement(
   bool relevantLinkVisited = aOldStyleContext->IsLinkContext() ?
     aStyleContext->RelevantLinkVisited() :
     aNewParentContext->RelevantLinkVisited();
 
   if (relevantLinkVisited) {
     flags |= eIsVisitedLink;
   }
 
+  nsCSSPseudoElements::Type pseudoType = aOldStyleContext->GetPseudoType();
+  if (pseudoType == nsCSSPseudoElements::ePseudo_NotPseudoElement ||
+      pseudoType == nsCSSPseudoElements::ePseudo_before ||
+      pseudoType == nsCSSPseudoElements::ePseudo_after) {
+    flags |= eDoAnimation;
+  }
+
   return GetContext(aNewParentStyleContext, ruleNode, visitedRuleNode,
                     aOldStyleContext->GetPseudo(),
                     aOldStyleContext->GetPseudoType(),
                     nullptr, flags);
 }
 
 
 already_AddRefed<nsStyleContext>
