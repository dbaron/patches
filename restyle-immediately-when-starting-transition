From: L. David Baron <dbaron@dbaron.org>

Bug 960465 patch N - Part 1 of switching from posting restyle for animation to immediately restyling:  do the immediate restyle when we start transitions.

This makes the way we start transitions more like the way we start
animations.

diff --git a/layout/base/RestyleManager.cpp b/layout/base/RestyleManager.cpp
--- a/layout/base/RestyleManager.cpp
+++ b/layout/base/RestyleManager.cpp
@@ -1800,16 +1800,21 @@ TryStartingTransition(nsPresContext *aPr
                       nsRefPtr<nsStyleContext> *aNewStyleContext /* inout */)
 {
   if (!aContent || !aContent->IsElement()) {
     return;
   }
 
   bool startedAny = aPresContext->TransitionManager()->StyleContextChanged(
     aContent->AsElement(), aOldStyleContext, *aNewStyleContext);
+  if (startedAny) {
+    *aNewStyleContext = aPresContext->StyleSet()->ResolveStyleWithReplacement(
+      aContent->AsElement(), (*aNewStyleContext)->GetParent(),
+      *aNewStyleContext, eRestyle_CSSTransitions);
+  }
 }
 
 static inline dom::Element*
 ElementForStyleContext(nsIContent* aParentContent,
                        nsIFrame* aFrame,
                        nsCSSPseudoElements::Type aPseudoType)
 {
   // We don't expect XUL tree stuff here.
