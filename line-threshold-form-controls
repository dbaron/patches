From: L. David Baron <dbaron@dbaron.org>

Make effect of form controls on font size inflation text threshold not depend on user changes to their value.  (Bug 747857)

diff --git a/layout/generic/nsFontInflationData.cpp b/layout/generic/nsFontInflationData.cpp
--- a/layout/generic/nsFontInflationData.cpp
+++ b/layout/generic/nsFontInflationData.cpp
@@ -312,29 +312,40 @@ nsFontInflationData::ScanTextIn(nsIFrame
     nsFrameList::Enumerator kids(lists.CurrentList());
     for (; !kids.AtEnd(); kids.Next()) {
       nsIFrame *kid = kids.get();
       if (kid->GetStateBits() & NS_FRAME_FONT_INFLATION_FLOW_ROOT) {
         // Goes in a different set of inflation data.
         continue;
       }
 
-      if (kid->GetType() == nsGkAtoms::textFrame) {
+      nsIAtom *fType = kid->GetType();
+      if (fType == nsGkAtoms::textFrame) {
         nsIContent *content = kid->GetContent();
         if (content && kid == content->GetPrimaryFrame()) {
           PRUint32 len = nsTextFrameUtils::
             ComputeApproximateLengthWithWhitespaceCompression(
               content, kid->GetStyleText());
           if (len != 0) {
             nscoord fontSize = kid->GetStyleFont()->mFont.size;
             if (fontSize > 0) {
               mTextAmount += fontSize * len;
             }
           }
         }
+      } else if (fType == nsGkAtoms::textInputFrame) {
+        // We don't want changes to the amount of text in a text input
+        // to change what we count towards inflation.
+        nscoord fontSize = kid->GetStyleFont()->mFont.size;
+        PRInt32 charCount = static_cast<nsTextControlFrame*>kid->GetCols();
+        mTextAmount += charCount * fontSize;
+      } else if (fType == nsGkAtoms::comboboxControlFrame) {
+        // FIXME: Count the number of characters in the largest option.
+      } else if (fType == nsGkAtoms::listControlFrame) {
+        // FIXME: Count the number of characters in the largest option.
       } else {
         // recursive step
         ScanTextIn(kid);
       }
 
       if (mTextAmount >= mTextThreshold) {
         return;
       }
