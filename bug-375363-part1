Fix handling of initial and -moz-inherit for -moz-broken-image-icon, quotes, and -moz-box-ordinal-group.  b=375363

diff --git a/layout/style/nsCSSDeclaration.cpp b/layout/style/nsCSSDeclaration.cpp
--- a/layout/style/nsCSSDeclaration.cpp
+++ b/layout/style/nsCSSDeclaration.cpp
@@ -266,10 +266,21 @@ PRBool nsCSSDeclaration::AppendValueToSt
       case eCSSType_Quotes: {
         const nsCSSQuotes* quotes = 
             *NS_STATIC_CAST(nsCSSQuotes*const*, storage);
+        NS_ASSERTION((quotes->mOpen.GetUnit() != eCSSUnit_String) ==
+                     (quotes->mNext == nsnull),
+                     "non-strings must be alone");
         do {
           AppendCSSValueToString(aProperty, quotes->mOpen, aResult);
-          aResult.Append(PRUnichar(' '));
-          AppendCSSValueToString(aProperty, quotes->mClose, aResult);
+          NS_ASSERTION((quotes->mOpen.GetUnit() == eCSSUnit_String) ==
+                       (quotes->mClose.GetUnit() == eCSSUnit_String),
+                       "strings must come in pairs");
+          NS_ASSERTION((quotes->mOpen.GetUnit() != eCSSUnit_String) ==
+                       (quotes->mClose.GetUnit() == eCSSUnit_Null),
+                       "non-strings must be alone");
+          if (quotes->mClose.GetUnit() != eCSSUnit_Null) {
+            aResult.Append(PRUnichar(' '));
+            AppendCSSValueToString(aProperty, quotes->mClose, aResult);
+          }
           quotes = quotes->mNext;
           if (quotes) {
             aResult.Append(PRUnichar(' '));
diff --git a/layout/style/nsCSSParser.cpp b/layout/style/nsCSSParser.cpp
--- a/layout/style/nsCSSParser.cpp
+++ b/layout/style/nsCSSParser.cpp
@@ -4517,7 +4517,7 @@ PRBool CSSParserImpl::ParseSingleValuePr
     return ParseVariant(aErrorCode, aValue, VARIANT_HK,
                         nsCSSProps::kBoxPackKTable);
   case eCSSProperty_box_ordinal_group:
-    return ParseVariant(aErrorCode, aValue, VARIANT_INTEGER, nsnull);
+    return ParseVariant(aErrorCode, aValue, VARIANT_HI, nsnull);
 #ifdef MOZ_SVG
   case eCSSProperty_clip_path:
     return ParseVariant(aErrorCode, aValue, VARIANT_HUO, nsnull);
@@ -4593,7 +4593,7 @@ PRBool CSSParserImpl::ParseSingleValuePr
   case eCSSProperty_width:
     return ParsePositiveVariant(aErrorCode, aValue, VARIANT_AHLP, nsnull);
   case eCSSProperty_force_broken_image_icon:
-    return ParsePositiveVariant(aErrorCode, aValue, VARIANT_INTEGER, nsnull);
+    return ParsePositiveVariant(aErrorCode, aValue, VARIANT_HI, nsnull);
   case eCSSProperty_caption_side:
     return ParseVariant(aErrorCode, aValue, VARIANT_HK, 
                         nsCSSProps::kCaptionSideKTable);
diff --git a/layout/style/nsRuleNode.cpp b/layout/style/nsRuleNode.cpp
--- a/layout/style/nsRuleNode.cpp
+++ b/layout/style/nsRuleNode.cpp
@@ -2599,6 +2599,11 @@ nsRuleNode::ComputeUIResetData(nsStyleSt
   // force-broken-image-icons: integer
   if (eCSSUnit_Integer == uiData.mForceBrokenImageIcon.GetUnit()) {
     ui->mForceBrokenImageIcon = uiData.mForceBrokenImageIcon.GetIntValue();
+  } else if (eCSSUnit_Inherit == uiData.mForceBrokenImageIcon.GetUnit()) {
+    inherited = PR_TRUE;
+    ui->mForceBrokenImageIcon = parentUI->mForceBrokenImageIcon;
+  } else if (eCSSUnit_Initial == uiData.mForceBrokenImageIcon.GetUnit()) {
+    ui->mForceBrokenImageIcon = 0;
   }
   COMPUTE_END_RESET(UIReset, ui)
 }
@@ -3978,6 +3983,11 @@ nsRuleNode::ComputeXULData(nsStyleStruct
   // box-ordinal-group: integer
   if (eCSSUnit_Integer == xulData.mBoxOrdinal.GetUnit()) {
     xul->mBoxOrdinal = xulData.mBoxOrdinal.GetIntValue();
+  } else if (eCSSUnit_Inherit == xulData.mBoxOrdinal.GetUnit()) {
+    inherited = PR_TRUE;
+    xul->mBoxOrdinal = parentXUL->mBoxOrdinal;
+  } else if (eCSSUnit_Initial == xulData.mBoxOrdinal.GetUnit()) {
+    xul->mBoxOrdinal = 1;
   }
 
   COMPUTE_END_RESET(XUL, xul)
diff --git a/layout/style/test/test_inherit_storage.html b/layout/style/test/test_inherit_storage.html
--- a/layout/style/test/test_inherit_storage.html
+++ b/layout/style/test/test_inherit_storage.html
@@ -27,9 +27,6 @@ var gDeclaration = document.getElementBy
 
 /* all failures covered by bug 375363 */
 var gKnownFails = {
-  "-moz-force-broken-image-icon": true,
-  "quotes": true,
-  "-moz-box-ordinal-group": true,
   "background-position": true
 };
 
diff --git a/layout/style/test/test_initial_storage.html b/layout/style/test/test_initial_storage.html
--- a/layout/style/test/test_initial_storage.html
+++ b/layout/style/test/test_initial_storage.html
@@ -27,9 +27,6 @@ var gDeclaration = document.getElementBy
 
 /* all failures covered by bug 375363 */
 var gKnownFails = {
-  "-moz-force-broken-image-icon": true,
-  "quotes": true,
-  "-moz-box-ordinal-group": true,
   "background-position": true
 };
 
