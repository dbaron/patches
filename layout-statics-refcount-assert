From: L. David Baron <dbaron@dbaron.org>

Add assertions that nsLayoutStatics reference counting is only on the main thread.  (Bug 537572)

diff --git a/layout/build/nsLayoutStatics.cpp b/layout/build/nsLayoutStatics.cpp
--- a/layout/build/nsLayoutStatics.cpp
+++ b/layout/build/nsLayoutStatics.cpp
@@ -392,26 +392,32 @@ nsLayoutStatics::Shutdown()
   nsFrameList::Shutdown();
 
   nsFileControlFrame::DestroyUploadLastDir();
 }
 
 void
 nsLayoutStatics::AddRef()
 {
+  NS_ASSERTION(NS_IsMainThread(),
+               "nsLayoutStatics reference counting must be on main thread");
+
   NS_ASSERTION(sLayoutStaticRefcnt,
                "nsLayoutStatics already dropped to zero!");
 
   ++sLayoutStaticRefcnt;
   NS_LOG_ADDREF(&sLayoutStaticRefcnt, sLayoutStaticRefcnt,
                 "nsLayoutStatics", 1);
 }
 
 void
 nsLayoutStatics::Release()
 {
+  NS_ASSERTION(NS_IsMainThread(),
+               "nsLayoutStatics reference counting must be on main thread");
+
   --sLayoutStaticRefcnt;
   NS_LOG_RELEASE(&sLayoutStaticRefcnt, sLayoutStaticRefcnt,
                  "nsLayoutStatics");
 
   if (!sLayoutStaticRefcnt)
     Shutdown();
 }
