From: L. David Baron <dbaron@dbaron.org>

Add assertions (currently just NS_WARN_IF_FALSE) that nsLayoutStatics reference counting is only on the main thread.  (Bug 537572)

diff --git a/layout/build/nsLayoutStatics.cpp b/layout/build/nsLayoutStatics.cpp
--- a/layout/build/nsLayoutStatics.cpp
+++ b/layout/build/nsLayoutStatics.cpp
@@ -384,26 +384,34 @@ nsLayoutStatics::Shutdown()
   NS_ShutdownChainItemPool();
 
   nsFrameList::Shutdown();
 }
 
 void
 nsLayoutStatics::AddRef()
 {
+  // This should be an assertion, but it currently can't be.
+  NS_WARN_IF_FALSE(NS_IsMainThread(),
+                   "nsLayoutStatics reference counting must be on main thread");
+
   NS_ASSERTION(sLayoutStaticRefcnt,
                "nsLayoutStatics already dropped to zero!");
 
   ++sLayoutStaticRefcnt;
   NS_LOG_ADDREF(&sLayoutStaticRefcnt, sLayoutStaticRefcnt,
                 "nsLayoutStatics", 1);
 }
 
 void
 nsLayoutStatics::Release()
 {
+  // This should be an assertion, but it currently can't be.
+  NS_WARN_IF_FALSE(NS_IsMainThread(),
+                   "nsLayoutStatics reference counting must be on main thread");
+
   --sLayoutStaticRefcnt;
   NS_LOG_RELEASE(&sLayoutStaticRefcnt, sLayoutStaticRefcnt,
                  "nsLayoutStatics");
 
   if (!sLayoutStaticRefcnt)
     Shutdown();
 }
