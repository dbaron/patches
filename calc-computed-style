From: L. David Baron <dbaron@dbaron.org>

Handle stored calc() expressions in computed style.  (Bug 363249)

diff --git a/layout/style/nsComputedDOMStyle.cpp b/layout/style/nsComputedDOMStyle.cpp
--- a/layout/style/nsComputedDOMStyle.cpp
+++ b/layout/style/nsComputedDOMStyle.cpp
@@ -3692,17 +3692,21 @@ nsComputedDOMStyle::SetValueToCoord(nsRO
                                                       aTable));
       break;
 
     case eStyleUnit_None:
       aValue->SetIdent(eCSSKeyword_none);
       break;
 
     default:
-      NS_ERROR("Can't handle this unit");
+      if (aCoord.IsCalcUnit()) {
+        // FIXME: WRITE ME
+      } else {
+        NS_ERROR("Can't handle this unit");
+      }
       break;
   }
 }
 
 nscoord
 nsComputedDOMStyle::StyleCoordToNSCoord(const nsStyleCoord& aCoord,
                                         PercentageBaseGetter aPercentageBaseGetter,
                                         nscoord aDefaultValue)
@@ -3714,17 +3718,23 @@ nsComputedDOMStyle::StyleCoordToNSCoord(
     case eStyleUnit_Percent:
       {
         nscoord percentageBase;
         if ((this->*aPercentageBaseGetter)(percentageBase)) {
           return nscoord(aCoord.GetPercentValue() * percentageBase);
         }
       }
       // Fall through to returning aDefaultValue if we have no percentage base.
+      break;
     default:
+      if (aCoord.IsCalcUnit()) {
+        // FIXME: WRITE ME
+      } else {
+        NS_ERROR("Can't handle this unit");
+      }
       break;
   }
 
   return aDefaultValue;
 }
 
 PRBool
 nsComputedDOMStyle::GetCBContentWidth(nscoord& aWidth)
