From: L. David Baron <dbaron@dbaron.org>

Change checkComplete in test_referer.html to check whether all tests are complete, rather than just the last.  (Bug 600458)

diff --git a/content/media/test/test_referer.html b/content/media/test/test_referer.html
--- a/content/media/test/test_referer.html
+++ b/content/media/test/test_referer.html
@@ -16,24 +16,23 @@ https://bugzilla.mozilla.org/show_bug.cg
 <div id="content" style="display: none">
   
 </div>
 <pre id="test">
 <script type="application/javascript">
 var media = [];
 
 function checkComplete() {
-  complete = true;
   for (var i=0; i<media.length; ++i) {
-    complete = media[i]._complete;
+    if (!media[i]._complete) {
+      return;
+    }
   }
 
-  if (complete) {
-    SimpleTest.finish();
-  }
+  SimpleTest.finish();
 }
  
 function loadError(evt) {
   // Prevent mochitest's onerror handler catching the 'error' event on bubble.
   evt.stopPropagation();
   // If no referer is sent then the sjs returns an error
   ok(false, "check referer is sent with media request");
   evt.target._complete = true;
