From: L. David Baron <dbaron@dbaron.org>

Make animation logging report to the error console instead of stderr.

This addresses roc's comments in bug 780342.

diff --git a/layout/style/AnimationCommon.cpp b/layout/style/AnimationCommon.cpp
--- a/layout/style/AnimationCommon.cpp
+++ b/layout/style/AnimationCommon.cpp
@@ -16,17 +16,18 @@
 #include "mozilla/LookAndFeel.h"
 #include "Layers.h"
 #include "FrameLayerBuilder.h"
 #include "nsDisplayList.h"
 #include "mozilla/MemoryReporting.h"
 #include "RestyleManager.h"
 #include "nsStyleSet.h"
 #include "nsStyleChangeList.h"
-
+#include "nsContentUtils.h"
+#include "nsIScriptError.h"
 
 using namespace mozilla::layers;
 
 namespace mozilla {
 namespace css {
 
 /* static */ bool
 IsGeometricProperty(nsCSSProperty aProperty)
@@ -431,30 +432,35 @@ CommonElementAnimationData::IsCompositor
   void* prop = aFrame->Properties().Get(nsIFrame::RefusedAsyncAnimation());
   return bool(reinterpret_cast<intptr_t>(prop));
 }
 
 /* static */ void
 CommonElementAnimationData::LogAsyncAnimationFailure(nsCString& aMessage,
                                                      const nsIContent* aContent)
 {
+  nsString message;
+  AppendASCIItoUTF16(aMessage, message);
+
   if (aContent) {
-    aMessage.AppendLiteral(" [");
-    aMessage.Append(nsAtomCString(aContent->Tag()));
+    message.AppendLiteral(" [");
+    message.Append(nsAtomString(aContent->Tag()));
 
     nsIAtom* id = aContent->GetID();
     if (id) {
-      aMessage.AppendLiteral(" with id '");
-      aMessage.Append(nsAtomCString(aContent->GetID()));
-      aMessage.AppendLiteral("'");
+      message.AppendLiteral(" with id '");
+      message.Append(nsAtomString(aContent->GetID()));
+      message.AppendLiteral("'");
     }
-    aMessage.AppendLiteral("]");
+    message.AppendLiteral("]");
   }
-  aMessage.AppendLiteral("\n");
-  printf_stderr(aMessage.get());
+
+  nsContentUtils::ReportToConsoleNonLocalized(message,
+    nsIScriptError::warningFlag, NS_LITERAL_CSTRING("CSS Animations"),
+    aContent->OwnerDoc());
 }
 
 bool
 CommonElementAnimationData::CanThrottleTransformChanges(TimeStamp aTime)
 {
   if (!nsLayoutUtils::AreAsyncAnimationsEnabled()) {
     return false;
   }
