Adjust two reftests to match the non-assembly version of the code.  (Bug 465088)

diff --git a/modules/libpr0n/test/reftest/pngsuite-ancillary/ccwn2c08.html b/modules/libpr0n/test/reftest/pngsuite-ancillary/ccwn2c08.html
--- a/modules/libpr0n/test/reftest/pngsuite-ancillary/ccwn2c08.html
+++ b/modules/libpr0n/test/reftest/pngsuite-ancillary/ccwn2c08.html
@@ -1,9 +1,13 @@
-<html><body>
+<html>
+<head>
+<script src="lcms-asm-check.js" type="application/ecmascript"></script>
+</head>
+<body>
 <table cellpadding='0' cellspacing='0' width='32' height='32'>
 <tr height='1'>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
@@ -214,17 +218,23 @@
   <td width='1' style='background-color: rgba(73,255,188,1)'></td>
   <td width='1' style='background-color: rgba(95,255,187,1)'></td>
   <td width='1' style='background-color: rgba(110,255,187,1)'></td>
   <td width='1' style='background-color: rgba(120,255,184,1)'></td>
   <td width='1' style='background-color: rgba(127,255,179,1)'></td>
   <td width='1' style='background-color: rgba(126,255,168,1)'></td>
   <td width='1' style='background-color: rgba(121,255,148,1)'></td>
   <td width='1' style='background-color: rgba(127,255,120,1)'></td>
+<script type="application/ecmascript">
+if (lcms_has_assembly) {
   <td width='1' style='background-color: rgba(150,255,91,1)'></td>
+} else {
+  <td width='1' style='background-color: rgba(150,255,92,1)'></td>
+}
+</script>
   <td width='1' style='background-color: rgba(165,255,73,1)'></td>
   <td width='1' style='background-color: rgba(176,255,53,1)'></td>
   <td width='1' style='background-color: rgba(205,255,133,1)'></td>
   <td width='1' style='background-color: rgba(252,255,248,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
@@ -391,17 +401,23 @@
   <td width='1' style='background-color: rgba(192,255,176,1)'></td>
   <td width='1' style='background-color: rgba(205,255,163,1)'></td>
   <td width='1' style='background-color: rgba(214,255,154,1)'></td>
   <td width='1' style='background-color: rgba(222,255,141,1)'></td>
   <td width='1' style='background-color: rgba(230,255,128,1)'></td>
   <td width='1' style='background-color: rgba(238,255,113,1)'></td>
   <td width='1' style='background-color: rgba(247,255,96,1)'></td>
   <td width='1' style='background-color: rgba(254,253,75,1)'></td>
+<script type="application/ecmascript">
+if (lcms_has_assembly) {
   <td width='1' style='background-color: rgba(255,245,49,1)'></td>
+} else {
+  <td width='1' style='background-color: rgba(255,245,50,1)'></td>
+}
+</script>
   <td width='1' style='background-color: rgba(255,245,187,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
@@ -426,17 +442,23 @@
   <td width='1' style='background-color: rgba(214,255,175,1)'></td>
   <td width='1' style='background-color: rgba(222,255,165,1)'></td>
   <td width='1' style='background-color: rgba(230,255,154,1)'></td>
   <td width='1' style='background-color: rgba(238,255,140,1)'></td>
   <td width='1' style='background-color: rgba(246,255,127,1)'></td>
   <td width='1' style='background-color: rgba(254,254,112,1)'></td>
   <td width='1' style='background-color: rgba(255,245,95,1)'></td>
   <td width='1' style='background-color: rgba(255,235,75,1)'></td>
+<script type="application/ecmascript">
+if (lcms_has_assembly) {
   <td width='1' style='background-color: rgba(255,224,49,1)'></td>
+} else {
+  <td width='1' style='background-color: rgba(255,224,50,1)'></td>
+}
+</script>
   <td width='1' style='background-color: rgba(255,240,203,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
diff --git a/modules/libpr0n/test/reftest/pngsuite-ancillary/ccwn3p08.html b/modules/libpr0n/test/reftest/pngsuite-ancillary/ccwn3p08.html
--- a/modules/libpr0n/test/reftest/pngsuite-ancillary/ccwn3p08.html
+++ b/modules/libpr0n/test/reftest/pngsuite-ancillary/ccwn3p08.html
@@ -1,9 +1,13 @@
-<html><body>
+<html>
+<head>
+<script src="lcms-asm-check.js" type="application/ecmascript"></script>
+</head>
+<body>
 <table cellpadding='0' cellspacing='0' width='32' height='32'>
 <tr height='1'>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
@@ -181,17 +185,23 @@
   <td width='1' style='background-color: rgba(77,255,185,1)'></td>
   <td width='1' style='background-color: rgba(77,255,185,1)'></td>
   <td width='1' style='background-color: rgba(101,255,166,1)'></td>
   <td width='1' style='background-color: rgba(114,255,164,1)'></td>
   <td width='1' style='background-color: rgba(114,255,164,1)'></td>
   <td width='1' style='background-color: rgba(99,255,130,1)'></td>
   <td width='1' style='background-color: rgba(90,255,120,1)'></td>
   <td width='1' style='background-color: rgba(127,255,95,1)'></td>
+<script type="application/ecmascript">
+if (lcms_has_assembly) {
   <td width='1' style='background-color: rgba(163,255,91,1)'></td>
+} else {
+  <td width='1' style='background-color: rgba(163,255,92,1)'></td>
+}
+</script>
   <td width='1' style='background-color: rgba(199,255,148,1)'></td>
   <td width='1' style='background-color: rgba(253,255,253,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
@@ -215,18 +225,25 @@
   <td width='1' style='background-color: rgba(77,255,185,1)'></td>
   <td width='1' style='background-color: rgba(116,255,190,1)'></td>
   <td width='1' style='background-color: rgba(116,255,190,1)'></td>
   <td width='1' style='background-color: rgba(138,255,169,1)'></td>
   <td width='1' style='background-color: rgba(114,255,164,1)'></td>
   <td width='1' style='background-color: rgba(123,255,159,1)'></td>
   <td width='1' style='background-color: rgba(134,255,127,1)'></td>
   <td width='1' style='background-color: rgba(153,255,104,1)'></td>
+<script type="application/ecmascript">
+if (lcms_has_assembly) {
   <td width='1' style='background-color: rgba(163,255,91,1)'></td>
   <td width='1' style='background-color: rgba(163,255,91,1)'></td>
+} else {
+  <td width='1' style='background-color: rgba(163,255,92,1)'></td>
+  <td width='1' style='background-color: rgba(163,255,92,1)'></td>
+}
+</script>
   <td width='1' style='background-color: rgba(205,255,136,1)'></td>
   <td width='1' style='background-color: rgba(253,255,246,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
@@ -248,17 +265,23 @@
   <td width='1' style='background-color: rgba(90,255,198,1)'></td>
   <td width='1' style='background-color: rgba(105,255,193,1)'></td>
   <td width='1' style='background-color: rgba(116,255,190,1)'></td>
   <td width='1' style='background-color: rgba(134,255,195,1)'></td>
   <td width='1' style='background-color: rgba(151,255,182,1)'></td>
   <td width='1' style='background-color: rgba(138,255,169,1)'></td>
   <td width='1' style='background-color: rgba(123,255,159,1)'></td>
   <td width='1' style='background-color: rgba(134,255,127,1)'></td>
+<script type="application/ecmascript">
+if (lcms_has_assembly) {
   <td width='1' style='background-color: rgba(163,255,91,1)'></td>
+} else {
+  <td width='1' style='background-color: rgba(163,255,92,1)'></td>
+}
+</script>
   <td width='1' style='background-color: rgba(186,255,96,1)'></td>
   <td width='1' style='background-color: rgba(186,255,96,1)'></td>
   <td width='1' style='background-color: rgba(195,255,79,1)'></td>
   <td width='1' style='background-color: rgba(217,255,115,1)'></td>
   <td width='1' style='background-color: rgba(253,255,246,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
@@ -847,18 +870,25 @@
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
   <td width='1' style='background-color: rgba(255,255,255,1)'></td>
 </tr>
 <tr height='1'>
   <td width='1' style='background-color: rgba(205,241,255,1)'></td>
+<script type="application/ecmascript">
+if (lcms_has_assembly) {
   <td width='1' style='background-color: rgba(83,212,255,1)'></td>
   <td width='1' style='background-color: rgba(83,212,255,1)'></td>
+} else {
+  <td width='1' style='background-color: rgba(83,211,255,1)'></td>
+  <td width='1' style='background-color: rgba(83,211,255,1)'></td>
+}
+</script>
   <td width='1' style='background-color: rgba(98,205,255,1)'></td>
   <td width='1' style='background-color: rgba(151,210,255,1)'></td>
   <td width='1' style='background-color: rgba(159,194,255,1)'></td>
   <td width='1' style='background-color: rgba(159,194,255,1)'></td>
   <td width='1' style='background-color: rgba(178,173,255,1)'></td>
   <td width='1' style='background-color: rgba(219,126,255,1)'></td>
   <td width='1' style='background-color: rgba(219,126,255,1)'></td>
   <td width='1' style='background-color: rgba(241,122,255,1)'></td>
diff --git a/modules/libpr0n/test/reftest/pngsuite-ancillary/lcms-asm-check.js b/modules/libpr0n/test/reftest/pngsuite-ancillary/lcms-asm-check.js
new file mode 100644
--- /dev/null
+++ b/modules/libpr0n/test/reftest/pngsuite-ancillary/lcms-asm-check.js
@@ -0,0 +1,28 @@
+// This is a workaround for bug 465088, that the lcms assembly doesn't
+// quite match the non-assembly output.
+
+function check_lcms_has_assembly()
+{
+    // We have assembly code on x86 and x86_64 architectures.
+    // Unfortunately, detecting that is a little complicated.
+
+    if (navigator.platform == "MacIntel") {
+        return true;
+    }
+
+    if (navigator.platform == "Win32" || navigator.platform == "OS/2") {
+        // Assume all Windows and OS/2 is x86 or x86_64.  We don't
+        // expose any way for Web content to check.
+        return true;
+    }
+
+    // On most Unix-like platforms, navigator.platform is basically
+    // |uname -sm|.
+    if (navigator.platform.match(/(i[3456]86|x86_64|amd64)/)) {
+        return true;
+    }
+
+    return false;
+}
+
+var lcms_has_assembly = check_lcms_has_assembly();
