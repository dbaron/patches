From: L. David Baron <dbaron@dbaron.org>

Run the drawWindow tests on a toplevel window.

diff --git a/content/canvas/test/test_drawWindow.html b/content/canvas/test/test_drawWindow.html
--- a/content/canvas/test/test_drawWindow.html
+++ b/content/canvas/test/test_drawWindow.html
@@ -7,20 +7,34 @@
   <script type="application/javascript" src="/tests/SimpleTest/WindowSnapshot.js"></script>
   <link rel="stylesheet" type="text/css" href="/tests/SimpleTest/test.css"/>
   <script type="application/javascript">
 
   const CANVAS_WIDTH = 200;
   const CANVAS_HEIGHT = 100;
 
   SimpleTest.waitForExplicitFinish();
-  window.addEventListener("load", runTests, false);
+  window.addEventListener("load", openIframe, false);
+
+  var iframe;
+
+  function openIframe(event) {
+    if (event.target != document) {
+      return;
+    }
+
+    // Need to open as a toplevel chrome window so that
+    // DRAWWINDOW_USE_WIDGET_LAYERS is honored.
+    iframe = SpecialPowers.wrap(window).open("file_drawWindow_source.html", "", "chrome,width=200,height=100");
+    iframe = SpecialPowers.unwrap(iframe);
+    iframe.addEventListener("load", runTests, false);
+  }
 
   function runTests(event) {
-    if (event.target != document) {
+    if (event.target != iframe.document) {
       return;
     }
 
     var refCanvas = document.getElementById("refCanvas");
     var testCanvas = document.getElementById("testCanvas");
 
     var refCx = refCanvas.getContext("2d");
     var testCx = testCanvas.getContext("2d");
