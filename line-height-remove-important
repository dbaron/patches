
# HG changeset patch
# User Boris Zbarsky <bzbarsky@mit.edu>
# Date 1304612792 14400
# Node ID e5668cb2a02fb6b87f94739f721e813e462330d6
# Parent  285a5ec885015b060052e564cf93cde2e89eab71
Bug 349259.  Allow pages to override line-height on form controls, except for <select>.  r=dbaron

diff --git a/layout/style/forms.css b/layout/style/forms.css
--- a/layout/style/forms.css
+++ b/layout/style/forms.css
@@ -92,23 +92,17 @@ input {
      must be the same here, for buttons, and for <select> (including its
      internal padding magic) */
   padding: 1px 0 1px 0;
   border: 2px inset ThreeDFace;
   background-color: -moz-Field;
   color: -moz-FieldText;
   font: -moz-field;
   text-rendering: optimizeLegibility;
-  /*
-   * Note that the "UA !important" tests in
-   * layout/style/test/test_animations.html depend on this rule, because
-   * they need some UA !important rule to test.  If this changes, use a
-   * different one there.
-   */
-  line-height: normal !important;
+  line-height: normal;
   text-align: start;
   text-transform: none;
   word-spacing: normal;
   letter-spacing: normal;
   cursor: text;
   -moz-binding: url("chrome://global/content/platformHTMLBindings.xml#inputFields");
   text-indent: 0;
   -moz-user-select: text;
@@ -214,16 +208,22 @@ textarea:-moz-read-write {
 }
 
 select {
   margin: 0;
   border-color: ThreeDFace;
   background-color: -moz-Combobox;
   color: -moz-ComboboxText;
   font: -moz-list;
+  /*
+   * Note that the "UA !important" tests in
+   * layout/style/test/test_animations.html depend on this rule, because
+   * they need some UA !important rule to test.  If this changes, use a
+   * different one there.
+   */
   line-height: normal !important;
   white-space: nowrap !important;
   word-wrap: normal !important;
   text-align: start; 
   cursor: default;
   -moz-box-sizing: border-box;
   -moz-user-select: none;
   -moz-appearance: menulist;
@@ -532,17 +532,17 @@ input[type="submit"] {
   /* The sum of border-top, border-bottom, padding-top, padding-bottom
      must be the same here, for text inputs, and for <select>.  For
      buttons, make sure to include the -moz-focus-inner border/padding. */
   padding: 0px 6px 0px 6px;
   border: 2px outset ButtonFace;
   background-color: ButtonFace;
   color: ButtonText; 
   font: -moz-button;
-  line-height: normal !important;
+  line-height: normal;
   white-space: pre;
   cursor: default;
   -moz-box-sizing: border-box;
   -moz-user-select: none;
   -moz-binding: none;
   text-align: center;
   text-shadow: none;
 }
diff --git a/layout/style/test/test_animations.html b/layout/style/test/test_animations.html
--- a/layout/style/test/test_animations.html
+++ b/layout/style/test/test_animations.html
@@ -1198,22 +1198,22 @@ is(cs.marginRight, "10px", "bug 651456 a
 advance_clock(0); // still forces a refresh
 is(cs.marginRight, "10px", "bug 651456 at 100ms (2)");
 advance_clock(100);
 is(cs.marginRight, "20px", "bug 651456 at 200ms");
 done_div();
 
 // Test that UA !important rules override animations.
 // This test depends on forms.css having a rule
-//   input { line-height: !important }
+//   select { line-height: !important }
 // If that rule changes, we should rewrite it to depend on a different rule.
-new_element("input", "");
+new_element("select", "");
 var default_line_height = cs.lineHeight;
 done_div();
-new_element("input", "-moz-animation: uaoverride 2s linear infinite");
+new_element("select", "-moz-animation: uaoverride 2s linear infinite");
 is(cs.lineHeight, default_line_height,
    "animations should not override UA !important at 0ms");
 is(cs.marginTop, "20px",
    "rest of animation should still work when UA !important present at 0ms");
 advance_clock(200);
 is(cs.lineHeight, default_line_height,
    "animations should not override UA !important at 200ms");
 is(cs.marginTop, "40px",

