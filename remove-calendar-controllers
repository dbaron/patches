Remove calendar controllers to fix XPConnect assertions.

diff --git a/calendar/base/content/calendar-common-sets.js b/calendar/base/content/calendar-common-sets.js
--- a/calendar/base/content/calendar-common-sets.js
+++ b/calendar/base/content/calendar-common-sets.js
@@ -405,3 +405,7 @@ function injectCalendarCommandController
     top.controllers.insertControllerAt(0, calendarController);
     document.commandDispatcher.updateCommands("calendar_commands");
 }
+
+function removeCalendarCommandController() {
+    top.controllers.removeController(calendarController);
+}
diff --git a/calendar/lightning/content/messenger-overlay-sidebar.js b/calendar/lightning/content/messenger-overlay-sidebar.js
--- a/calendar/lightning/content/messenger-overlay-sidebar.js
+++ b/calendar/lightning/content/messenger-overlay-sidebar.js
@@ -451,6 +451,8 @@ function ltnFinish() {
     getCompositeCalendar().removeObserver(agendaTreeView.calendarObserver);
 
     unloadCalendarManager();
+
+    removeCalendarCommandController();
 }
 
 // After 1.5 was released, the search box was moved into an optional toolbar
diff --git a/calendar/resources/content/calendar.js b/calendar/resources/content/calendar.js
--- a/calendar/resources/content/calendar.js
+++ b/calendar/resources/content/calendar.js
@@ -209,19 +209,21 @@ function refreshUIBits() {
 
 function calendarFinish()
 {
-   // Workaround to make the selected tab persist. See bug 249552.
-   var tabbox = document.getElementById("tablist");
-   tabbox.setAttribute("selectedIndex", tabbox.selectedIndex);
+    // Workaround to make the selected tab persist. See bug 249552.
+    var tabbox = document.getElementById("tablist");
+    tabbox.setAttribute("selectedIndex", tabbox.selectedIndex);
 
-   unloadCalendarManager();
+    unloadCalendarManager();
 
-   // Finish the offline manager
-   calendarOfflineManager.uninit();
+    // Finish the offline manager
+    calendarOfflineManager.uninit();
+
+    removeCalendarCommandController();
 }
 
 function closeCalendar()
 {
-   self.close();
+    self.close();
 }
 
 function onSelectionChanged(aEvent) {
